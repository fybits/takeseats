let e,t,r,n,i,s,o,a,l,u,c,h,f,d,p,m,g,v,y,x,b,_,S;function C(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function w(e){return e&&e.__esModule?e.default:e}var T,P,A,k,M,R,I,E,O,z,F,U,D,B,L,G,j,N,V,X,Y,H,W,q,$,K,Q,J=globalThis,Z={},ee={},et=J.parcelRequire4692;null==et&&((et=function(e){if(e in Z)return Z[e].exports;if(e in ee){var t=ee[e];delete ee[e];var r={id:e,exports:{}};return Z[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){ee[e]=t},J.parcelRequire4692=et);var er=et.register;er("eVz1R",function(e,t){C(e.exports,"ExtensionType",()=>n),C(e.exports,"extensions",()=>o);var r,n=((r=n||{}).Application="application",r.WebGLPipes="webgl-pipes",r.WebGLPipesAdaptor="webgl-pipes-adaptor",r.WebGLSystem="webgl-system",r.WebGPUPipes="webgpu-pipes",r.WebGPUPipesAdaptor="webgpu-pipes-adaptor",r.WebGPUSystem="webgpu-system",r.CanvasSystem="canvas-system",r.CanvasPipesAdaptor="canvas-pipes-adaptor",r.CanvasPipes="canvas-pipes",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r.MaskEffect="mask-effect",r.BlendMode="blend-mode",r.TextureSource="texture-source",r.Environment="environment",r);let i=e=>{if("function"==typeof e||"object"==typeof e&&e.extension){if(!e.extension)throw Error("Extension class must have an extension object");e={..."object"!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if("object"==typeof e)e={...e};else throw Error("Invalid extension type");return"string"==typeof e.type&&(e.type=[e.type]),e},s=(e,t)=>i(e).priority??t,o={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(i).forEach(e=>{e.type.forEach(t=>this._removeHandlers[t]?.(e))}),this},add(...e){return e.map(i).forEach(e=>{e.type.forEach(t=>{let r=this._addHandlers,n=this._queue;r[t]?r[t]?.(e):(n[t]=n[t]||[],n[t]?.push(e))})}),this},handle(e,t,r){let n=this._addHandlers,i=this._removeHandlers;if(n[e]||i[e])throw Error(`Extension type ${e} already has a handler`);n[e]=t,i[e]=r;let s=this._queue;return s[e]&&(s[e]?.forEach(e=>t(e)),delete s[e]),this},handleByMap(e,t){return this.handle(e,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(e,t,r=-1){return this.handle(e,e=>{t.findIndex(t=>t.name===e.name)>=0||(t.push({name:e.name,value:e.ref}),t.sort((e,t)=>s(t.value,r)-s(e.value,r)))},e=>{let r=t.findIndex(t=>t.name===e.name);-1!==r&&t.splice(r,1)})},handleByList(e,t,r=-1){return this.handle(e,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((e,t)=>s(t,r)-s(e,r)))},e=>{let r=t.indexOf(e.ref);-1!==r&&t.splice(r,1)})}}}),er("gkJjD",function(e,t){var r=et("jdQ1F");e.exports=Promise.all([r("jdbnD"),r("7NZcv"),r("5C52e")]).then(()=>et("7aJAr"))}),er("jdQ1F",function(e,t){e.exports=function(e){return import(et("awTFk").resolve(e))}}),er("awTFk",function(e,t){C(e.exports,"register",()=>r,e=>r=e),C(e.exports,"resolve",()=>n,e=>n=e);var r,n,i=new Map;r=function(e,t){for(var r=0;r<t.length-1;r+=2)i.set(t[r],{baseUrl:e,path:t[r+1]})},n=function(e){var t=i.get(e);if(null==t)throw Error("Could not resolve bundle with id "+e);return new URL(t.path,t.baseUrl).toString()}}),er("1Rc9a",function(e,t){var r=et("jdQ1F");e.exports=Promise.all([r("jdbnD"),r("7NZcv"),r("8XtbB")]).then(()=>et("6rz4M"))}),er("28YnR",function(e,t){var r=et("eVz1R"),n=et("jgXaH"),i=et("vwyRu"),s=et("lcq2f"),o=et("i8D1k"),a=et("2rfX3"),l=et("4XrO5"),u=et("c9SSH");et("i4n4u"),(0,r.extensions).add(n.AlphaMask,i.ColorMask,s.StencilMask,u.VideoSource,l.ImageSource,a.CanvasSource,o.BufferImageSource)}),er("jgXaH",function(e,t){C(e.exports,"AlphaMask",()=>o);var r=et("eVz1R"),n=et("9Qy7u"),i=et("kARrF"),s=et("kBq1a");class o{constructor(e){this.priority=0,this.pipe="alphaMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof n.Sprite),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(e,t){(0,i.addMaskBounds)(this.mask,e,t)}addLocalBounds(e,t){(0,s.addMaskLocalBounds)(this.mask,e,t)}containsPoint(e,t){return t(this.mask,e)}destroy(){this.reset()}static test(e){return e instanceof n.Sprite}}o.extension=r.ExtensionType.MaskEffect}),er("9Qy7u",function(e,t){C(e.exports,"Sprite",()=>o);var r=et("ep73P"),n=et("5h88T"),i=et("1ZKfN"),s=et("lR3Ev");class o extends s.Container{constructor(e=n.Texture.EMPTY){e instanceof n.Texture&&(e={texture:e});let{texture:t,anchor:i,roundPixels:s,width:o,height:a,...l}=e;super({label:"Sprite",...l}),this.renderPipeId="sprite",this.batched=!0,this._didSpriteUpdate=!1,this._bounds={minX:0,maxX:1,minY:0,maxY:0},this._sourceBounds={minX:0,maxX:1,minY:0,maxY:0},this._boundsDirty=!0,this._sourceBoundsDirty=!0,this._roundPixels=0,this._anchor=new r.ObservablePoint({_onUpdate:()=>{this.onViewUpdate()}}),i&&(this.anchor=i),this.texture=t,this.allowChildren=!1,this.roundPixels=s??!1,o&&(this.width=o),a&&(this.height=a)}static from(e,t=!1){return new o(e instanceof n.Texture?e:(0,n.Texture).from(e,t))}set texture(e){e||(e=n.Texture.EMPTY);let t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}get bounds(){return this._boundsDirty&&(this._updateBounds(),this._boundsDirty=!1),this._bounds}get sourceBounds(){return this._sourceBoundsDirty&&(this._updateSourceBounds(),this._sourceBoundsDirty=!1),this._sourceBounds}containsPoint(e){let t=this.sourceBounds;return e.x>=t.maxX&&e.x<=t.minX&&e.y>=t.maxY&&e.y<=t.minY}addBounds(e){let t=this._texture.trim?this.sourceBounds:this.bounds;e.addFrame(t.minX,t.minY,t.maxX,t.maxY)}onViewUpdate(){this._didChangeId+=4096,this._didSpriteUpdate=!0,this._sourceBoundsDirty=this._boundsDirty=!0,!this.didViewUpdate&&(this.didViewUpdate=!0,this.renderGroup&&this.renderGroup.onChildViewUpdate(this))}_updateBounds(){(0,i.updateQuadBounds)(this._bounds,this._anchor,this._texture,0)}_updateSourceBounds(){let e=this._anchor,t=this._texture,r=this._sourceBounds,{width:n,height:i}=t.orig;r.maxX=-e._x*n,r.minX=r.maxX+n,r.maxY=-e._y*i,r.minY=r.maxY+i}destroy(e=!1){if(super.destroy(e),"boolean"==typeof e?e:e?.texture){let t="boolean"==typeof e?e:e?.textureSource;this._texture.destroy(t)}this._texture=null,this._bounds=null,this._sourceBounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this._setWidth(e,this._texture.orig.width)}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this._setHeight(e,this._texture.orig.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this._texture.orig.width,e.height=Math.abs(this.scale.y)*this._texture.orig.height,e}setSize(e,t){let r,n;"object"!=typeof e?(r=e,n=t??e):(r=e.width,n=e.height??e.width),void 0!==r&&this._setWidth(r,this._texture.orig.width),void 0!==n&&this._setHeight(n,this._texture.orig.height)}}}),er("ep73P",function(e,t){C(e.exports,"ObservablePoint",()=>r);class r{constructor(e,t,r){this._x=t||0,this._y=r||0,this._observer=e}clone(e){return new r(e??this._observer,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this._observer._onUpdate(this)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this._observer._onUpdate(this)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=0 y=0 scope=${this._observer}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer._onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer._onUpdate(this))}}}),er("5h88T",function(e,t){C(e.exports,"Texture",()=>h);var r=et("gpXaq"),n=et("dhBBn"),i=et("soqVu"),s=et("l80qL"),o=et("eX50w"),a=et("EqaNP"),l=et("i8D1k"),u=et("9Ur0D"),c=et("iKeK4");class h extends w(r){constructor({source:e,label:t,frame:r,orig:n,trim:o,defaultAnchor:a,defaultBorders:l,rotate:c,dynamic:h}={}){if(super(),this.uid=(0,s.uid)("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new i.Rectangle,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=t,this.source=e?.source??new u.TextureSource,this.noFrame=!r,r)this.frame.copyFrom(r);else{let{width:e,height:t}=this._source;this.frame.width=e,this.frame.height=t}this.orig=n||this.frame,this.trim=o,this.rotate=c??0,this.defaultAnchor=a,this.defaultBorders=l,this.destroyed=!1,this.dynamic=h||!1,this.updateUvs()}set source(e){this._source&&this._source.off("resize",this.update,this),this._source=e,e.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new c.TextureMatrix(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){let{uvs:e,frame:t}=this,{width:r,height:i}=this._source,s=t.x/r,o=t.y/i,a=t.width/r,l=t.height/i,u=this.rotate;if(u){let t=a/2,r=l/2,i=s+t,c=o+r;u=(0,n.groupD8).add(u,n.groupD8.NW),e.x0=i+t*(0,n.groupD8).uX(u),e.y0=c+r*(0,n.groupD8).uY(u),u=(0,n.groupD8).add(u,2),e.x1=i+t*(0,n.groupD8).uX(u),e.y1=c+r*(0,n.groupD8).uY(u),u=(0,n.groupD8).add(u,2),e.x2=i+t*(0,n.groupD8).uX(u),e.y2=c+r*(0,n.groupD8).uY(u),u=(0,n.groupD8).add(u,2),e.x3=i+t*(0,n.groupD8).uX(u),e.y3=c+r*(0,n.groupD8).uY(u)}else e.x0=s,e.y0=o,e.x1=s+a,e.y1=o,e.x2=s+a,e.y2=o+l,e.x3=s,e.y3=o+l}destroy(e=!1){this._source&&e&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return(0,o.deprecation)(o.v8_0_0,"Texture.baseTexture is now Texture.source"),this._source}}h.EMPTY=new h({label:"EMPTY",source:new u.TextureSource({label:"EMPTY"})}),h.EMPTY.destroy=a.NOOP,h.WHITE=new h({source:new l.BufferImageSource({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"}),h.WHITE.destroy=a.NOOP}),er("gpXaq",function(e,t){var r=Object.prototype.hasOwnProperty,n="~";function i(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,o){if("function"!=typeof r)throw TypeError("The listener must be a function");var a=new s(r,i||e,o),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function l(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1)),l.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)r.call(e,t)&&i.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},l.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=Array(s);i<s;i++)o[i]=r[i].fn;return o},l.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},l.prototype.emit=function(e,t,r,i,s,o){var a=n?n+e:e;if(!this._events[a])return!1;var l,u,c=this._events[a],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,s),!0;case 6:return c.fn.call(c.context,t,r,i,s,o),!0}for(u=1,l=Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var f,d=c.length;for(u=0;u<d;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(f=1,l=Array(h-1);f<h;f++)l[f-1]=arguments[f];c[u].fn.apply(c[u].context,l)}}return!0},l.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},l.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},l.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||i&&!o.once||r&&o.context!==r||a(this,s);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||r&&o[l].context!==r)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:a(this,s)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,e.exports=l}),er("dhBBn",function(e,t){C(e.exports,"groupD8",()=>c);var r=et("dNaJE");let n=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],i=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],s=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],o=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],a=[],l=[],u=Math.sign;!function(){for(let e=0;e<16;e++){let t=[];a.push(t);for(let r=0;r<16;r++){let a=u(n[e]*n[r]+s[e]*i[r]),l=u(i[e]*n[r]+o[e]*i[r]),c=u(n[e]*s[r]+s[e]*o[r]),h=u(i[e]*s[r]+o[e]*o[r]);for(let e=0;e<16;e++)if(n[e]===a&&i[e]===l&&s[e]===c&&o[e]===h){t.push(e);break}}}for(let e=0;e<16;e++){let t=new r.Matrix;t.set(n[e],i[e],s[e],o[e],0,0),l.push(t)}}();let c={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>n[e],uY:e=>i[e],vX:e=>s[e],vY:e=>o[e],inv:e=>8&e?15&e:7&-e,add:(e,t)=>a[e][t],sub:(e,t)=>a[e][c.inv(t)],rotate180:e=>4^e,isVertical:e=>(3&e)==2,byDirection:(e,t)=>2*Math.abs(e)<=Math.abs(t)?t>=0?c.S:c.N:2*Math.abs(t)<=Math.abs(e)?e>0?c.E:c.W:t>0?e>0?c.SE:c.SW:e>0?c.NE:c.NW,matrixAppendRotationInv:(e,t,r=0,n=0)=>{let i=l[c.inv(t)];i.tx=r,i.ty=n,e.append(i)}}}),er("dNaJE",function(e,t){C(e.exports,"Matrix",()=>i);var r=et("gIu8o"),n=et("2NXni");class i{constructor(e=1,t=0,r=0,n=1,i=0,s=0){this.array=null,this.a=e,this.b=t,this.c=r,this.d=n,this.tx=i,this.ty=s}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,r,n,i,s){return this.a=e,this.b=t,this.c=r,this.d=n,this.tx=i,this.ty=s,this}toArray(e,t){this.array||(this.array=new Float32Array(9));let r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0),r[8]=1,r}apply(e,t){t=t||new n.Point;let r=e.x,i=e.y;return t.x=this.a*r+this.c*i+this.tx,t.y=this.b*r+this.d*i+this.ty,t}applyInverse(e,t){t=t||new n.Point;let r=this.a,i=this.b,s=this.c,o=this.d,a=this.tx,l=this.ty,u=1/(r*o+-(s*i)),c=e.x,h=e.y;return t.x=o*u*c+-s*u*h+(l*s-a*o)*u,t.y=r*u*h+-i*u*c+(-l*r+a*i)*u,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){let t=Math.cos(e),r=Math.sin(e),n=this.a,i=this.c,s=this.tx;return this.a=n*t-this.b*r,this.b=n*r+this.b*t,this.c=i*t-this.d*r,this.d=i*r+this.d*t,this.tx=s*t-this.ty*r,this.ty=s*r+this.ty*t,this}append(e){let t=this.a,r=this.b,n=this.c,i=this.d;return this.a=e.a*t+e.b*n,this.b=e.a*r+e.b*i,this.c=e.c*t+e.d*n,this.d=e.c*r+e.d*i,this.tx=e.tx*t+e.ty*n+this.tx,this.ty=e.tx*r+e.ty*i+this.ty,this}appendFrom(e,t){let r=e.a,n=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,l=t.a,u=t.b,c=t.c,h=t.d;return this.a=r*l+n*c,this.b=r*u+n*h,this.c=i*l+s*c,this.d=i*u+s*h,this.tx=o*l+a*c+t.tx,this.ty=o*u+a*h+t.ty,this}setTransform(e,t,r,n,i,s,o,a,l){return this.a=Math.cos(o+l)*i,this.b=Math.sin(o+l)*i,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=e-(r*this.a+n*this.c),this.ty=t-(r*this.b+n*this.d),this}prepend(e){let t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){let t=this.a,r=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=r*e.a+this.d*e.c,this.d=r*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){let t=this.a,n=this.b,i=this.c,s=this.d,o=e.pivot,a=-Math.atan2(-i,s),l=Math.atan2(n,t),u=Math.abs(a+l);return u<1e-5||1e-5>Math.abs(r.PI_2-u)?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(t*t+n*n),e.scale.y=Math.sqrt(i*i+s*s),e.position.x=this.tx+(o.x*t+o.y*i),e.position.y=this.ty+(o.x*n+o.y*s),e}invert(){let e=this.a,t=this.b,r=this.c,n=this.d,i=this.tx,s=e*n-t*r;return this.a=n/s,this.b=-t/s,this.c=-r/s,this.d=e/s,this.tx=(r*this.ty-n*i)/s,this.ty=-(e*this.ty-t*i)/s,this}isIdentity(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let e=new i;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return o.identity()}static get shared(){return s.identity()}}let s=new i,o=new i}),er("gIu8o",function(e,t){C(e.exports,"PI_2",()=>r),C(e.exports,"RAD_TO_DEG",()=>n),C(e.exports,"DEG_TO_RAD",()=>i);let r=2*Math.PI,n=180/Math.PI,i=Math.PI/180}),er("2NXni",function(e,t){C(e.exports,"Point",()=>r);class r{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new r(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return n.x=0,n.y=0,n}}let n=new r}),er("soqVu",function(e,t){C(e.exports,"Rectangle",()=>i);var r=et("2NXni");let n=[new r.Point,new r.Point,new r.Point,new r.Point];class i{constructor(e=0,t=0,r=0,n=0){this.type="rectangle",this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new i(0,0,0,0)}clone(){return new i(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,t){return!(this.width<=0)&&!(this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}strokeContains(e,t,r){let{width:n,height:i}=this;if(n<=0||i<=0)return!1;let s=this.x,o=this.y;return e>=s-r/2&&e<=s+n+r/2&&t>=o-r/2&&t<=o+i+r/2&&!(e>s+r/2&&e<s+n-r/2&&t>o+r/2&&t<o+i-r/2)}intersects(e,t){if(!t){let t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;let r=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>r}let r=this.left,i=this.right,s=this.top,o=this.bottom;if(i<=r||o<=s)return!1;let a=n[0].set(e.left,e.top),l=n[1].set(e.left,e.bottom),u=n[2].set(e.right,e.top),c=n[3].set(e.right,e.bottom);if(u.x<=a.x||l.y<=a.y)return!1;let h=Math.sign(t.a*t.d-t.b*t.c);if(0===h||(t.apply(a,a),t.apply(l,l),t.apply(u,u),t.apply(c,c),Math.max(a.x,l.x,u.x,c.x)<=r||Math.min(a.x,l.x,u.x,c.x)>=i||Math.max(a.y,l.y,u.y,c.y)<=s||Math.min(a.y,l.y,u.y,c.y)>=o))return!1;let f=h*(l.y-a.y),d=h*(a.x-l.x),p=f*r+d*s,m=f*i+d*s,g=f*r+d*o,v=f*i+d*o;if(Math.max(p,m,g,v)<=f*a.x+d*a.y||Math.min(p,m,g,v)>=f*c.x+d*c.y)return!1;let y=h*(a.y-u.y),x=h*(u.x-a.x),b=y*r+x*s,_=y*i+x*s,S=y*r+x*o,C=y*i+x*o;return!(Math.max(b,_,S,C)<=y*a.x+x*a.y||Math.min(b,_,S,C)>=y*c.x+x*c.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){let t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),i=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=n,this.height=Math.max(i-n,0),this}ceil(e=1,t=.001){let r=Math.ceil((this.x+this.width-t)*e)/e,n=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=n-this.y,this}enlarge(e){let t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),i=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=n,this.height=i-n,this}getBounds(e){return(e=e||new i).copyFrom(this),e}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}}),er("l80qL",function(e,t){C(e.exports,"uid",()=>n);let r={default:-1};function n(e="default"){return void 0===r[e]&&(r[e]=-1),++r[e]}}),er("eX50w",function(e,t){C(e.exports,"v8_0_0",()=>n),C(e.exports,"deprecation",()=>i);let r={},n="8.0.0";function i(e,t,n=3){if(r[t])return;let i=Error().stack;void 0===i?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(i=i.split("\n").splice(n).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(i))),r[t]=!0}}),er("EqaNP",function(e,t){C(e.exports,"NOOP",()=>r);let r=()=>{}}),er("i8D1k",function(e,t){C(e.exports,"BufferImageSource",()=>i);var r=et("eVz1R"),n=et("9Ur0D");class i extends n.TextureSource{constructor(e){let t=e.resource||new Float32Array(e.width*e.height*4),r=e.format;r||(t instanceof Float32Array?r="rgba32float":t instanceof Int32Array?r="rgba32uint":t instanceof Uint32Array?r="rgba32uint":t instanceof Int16Array?r="rgba16uint":t instanceof Uint16Array?r="rgba16uint":(Int8Array,r="bgra8unorm")),super({...e,resource:t,format:r}),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}i.extension=r.ExtensionType.TextureSource}),er("9Ur0D",function(e,t){C(e.exports,"TextureSource",()=>l);var r=et("gpXaq"),n=et("domwE"),i=et("5d1vV"),s=et("l80qL"),o=et("2mVLe");let a=class e extends w(r){constructor(t={}){super(),this.options=t,this.uid=(0,s.uid)("textureSource"),this._resourceType="textureSource",this._resourceId=(0,s.uid)("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...e.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new o.TextureStyle((0,i.definedProps)(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(e){this.style!==e&&(this._style?.off("change",this._onStyleChange,this),this._style=e,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(e){this._style.addressMode=e}get repeatMode(){return this._style.addressMode}set repeatMode(e){this._style.addressMode=e}get magFilter(){return this._style.magFilter}set magFilter(e){this._style.magFilter=e}get minFilter(){return this._style.minFilter}set minFilter(e){this._style.minFilter=e}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(e){this._style.mipmapFilter=e}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(e){this._style.lodMinClamp=e}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(e){this._style.lodMaxClamp=e}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){let e=this._resolution;if(this.resize(this.resourceWidth/e,this.resourceHeight/e))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=(0,s.uid)("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){let{resource:e}=this;return e.naturalWidth||e.videoWidth||e.displayWidth||e.width}get resourceHeight(){let{resource:e}=this;return e.naturalHeight||e.videoHeight||e.displayHeight||e.height}get resolution(){return this._resolution}set resolution(e){this._resolution!==e&&(this._resolution=e,this.width=this.pixelWidth/e,this.height=this.pixelHeight/e)}resize(e,t,r){r=r||this._resolution,e=e||this.width,t=t||this.height;let n=Math.round(e*r),i=Math.round(t*r);return this.width=n/r,this.height=i/r,this._resolution=r,(this.pixelWidth!==n||this.pixelHeight!==i)&&(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=i,this.emit("resize",this),this._resourceId=(0,s.uid)("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(e){this._style.wrapMode=e}get wrapMode(){return this._style.wrapMode}set scaleMode(e){this._style.scaleMode=e}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=(0,n.isPow2)(this.pixelWidth)&&(0,n.isPow2)(this.pixelHeight)}static test(e){throw Error("Unimplemented")}};a.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let l=a}),er("domwE",function(e,t){function r(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}function n(e){return!(e&e-1)&&!!e}C(e.exports,"nextPow2",()=>r),C(e.exports,"isPow2",()=>n)}),er("5d1vV",function(e,t){C(e.exports,"definedProps",()=>r);function r(e){let t={};for(let r in e)void 0!==e[r]&&(t[r]=e[r]);return t}}),er("2mVLe",function(e,t){C(e.exports,"TextureStyle",()=>a);var r=et("gpXaq"),n=et("l80qL"),i=et("eX50w");let s=Object.create(null),o=class e extends w(r){constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,t={...e.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(e){this.addressModeU=e,this.addressModeV=e,this.addressModeW=e}get addressMode(){return this.addressModeU}set wrapMode(e){(0,i.deprecation)(i.v8_0_0,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=e}get wrapMode(){return this.addressMode}set scaleMode(e){this.magFilter=e,this.minFilter=e,this.mipmapFilter=e}get scaleMode(){return this.magFilter}set maxAnisotropy(e){this._maxAnisotropy=Math.min(e,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){let e=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=function(e){let t=s[e];return void 0===t&&(s[e]=(0,n.uid)("resource")),t}(e),this._resourceId}destroy(){this.emit("destroy",this),this.removeAllListeners()}};o.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let a=o}),er("iKeK4",function(e,t){C(e.exports,"TextureMatrix",()=>i);var r=et("dNaJE");let n=new r.Matrix;class i{constructor(e,t){this.mapCoord=new r.Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,void 0===t?this.clampMargin=e.width<10?0:.5:this.clampMargin=t,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){this.texture!==e&&(this._texture?.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,t){void 0===t&&(t=e);let r=this.mapCoord;for(let n=0;n<e.length;n+=2){let i=e[n],s=e[n+1];t[n]=i*r.a+s*r.c+r.tx,t[n+1]=i*r.b+s*r.d+r.ty}return t}update(){let e=this._texture;this._updateID++;let t=e.uvs;this.mapCoord.set(t.x1-t.x0,t.y1-t.y0,t.x3-t.x0,t.y3-t.y0,t.x0,t.y0);let r=e.orig,i=e.trim;i&&(n.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(n));let s=e.source,o=this.uClampFrame,a=this.clampMargin/s._resolution,l=this.clampOffset;return o[0]=(e.frame.x+a+l)/s.width,o[1]=(e.frame.y+a+l)/s.height,o[2]=(e.frame.x+e.frame.width-a+l)/s.width,o[3]=(e.frame.y+e.frame.height-a+l)/s.height,this.uClampOffset[0]=l/s.pixelWidth,this.uClampOffset[1]=l/s.pixelHeight,this.isSimple=e.frame.width===s.width&&e.frame.height===s.height&&0===e.rotate,!0}}}),er("1ZKfN",function(e,t){C(e.exports,"updateQuadBounds",()=>r);function r(e,t,r,n){let{width:i,height:s}=r.orig,o=r.trim;if(o){let r=o.width,a=o.height;e.minX=o.x-t._x*i-n,e.maxX=e.minX+r,e.minY=o.y-t._y*s-n,e.maxY=e.minY+a}else e.minX=-t._x*i-n,e.maxX=e.minX+i,e.minY=-t._y*s-n,e.maxY=e.minY+s}}),er("lR3Ev",function(e,t){C(e.exports,"UPDATE_COLOR",()=>S),C(e.exports,"UPDATE_BLEND",()=>T),C(e.exports,"UPDATE_VISIBLE",()=>P),C(e.exports,"Container",()=>A);var r=et("gpXaq"),n=et("AHTcQ"),i=et("jorMT"),s=et("dNaJE"),o=et("gIu8o"),a=et("ep73P"),l=et("l80qL"),u=et("eX50w"),c=et("1AFlc"),h=et("4u67k"),f=et("6UPd0"),d=et("eHtGW"),p=et("bMTFJ"),m=et("8Eetq"),g=et("5gOfB"),v=et("hmS23"),y=et("e84qN");let x=new a.ObservablePoint(null),b=new a.ObservablePoint(null),_=new a.ObservablePoint(null,1,1),S=1,T=2,P=4;class A extends w(r){constructor(e={}){super(),this.uid=(0,l.uid)("renderable"),this._updateFlags=15,this.isRenderGroupRoot=!1,this.renderGroup=null,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new s.Matrix,this.relativeGroupTransform=new s.Matrix,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new a.ObservablePoint(this,0,0),this._scale=_,this._pivot=b,this._skew=x,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didChangeId=0,this._didLocalTransformChangeId=-1,(0,y.assignWithIgnore)(this,e,{children:!0,parent:!0,effects:!0}),e.children?.forEach(e=>this.addChild(e)),this.effects=[],e.parent?.addChild(this)}static mixin(e){Object.defineProperties(A.prototype,Object.getOwnPropertyDescriptors(e))}addChild(...e){if(this.allowChildren||(0,u.deprecation)(u.v8_0_0,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let t=0;t<e.length;t++)this.addChild(e[t]);return e[0]}let t=e[0];return t.parent===this?(this.children.splice(this.children.indexOf(t),1),this.children.push(t),this.renderGroup&&!this.isRenderGroupRoot&&(this.renderGroup.structureDidChange=!0)):(t.parent&&t.parent.removeChild(t),this.children.push(t),this.sortableChildren&&(this.sortDirty=!0),t.parent=this,t.didChange=!0,t.didViewUpdate=!1,t._updateFlags=15,this.renderGroup&&this.renderGroup.addChild(t),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this),0!==t._zIndex&&t.depthOfChildModified()),t}removeChild(...e){if(e.length>1){for(let t=0;t<e.length;t++)this.removeChild(e[t]);return e[0]}let t=e[0],r=this.children.indexOf(t);return r>-1&&(this.children.splice(r,1),this.renderGroup&&this.renderGroup.removeChild(t),t.parent=null,this.emit("childRemoved",t,this,r),t.emit("removed",this)),t}_onUpdate(e){if(e&&e===this._skew&&this._updateSkew(),this._didChangeId++,!this.didChange){if(this.didChange=!0,this.isRenderGroupRoot){let e=this.renderGroup.renderGroupParent;e&&e.onChildUpdate(this)}else this.renderGroup&&this.renderGroup.onChildUpdate(this)}}set isRenderGroup(e){if(this.isRenderGroupRoot&&!1===e)throw Error("[Pixi] cannot undo a render group just yet");e&&this.enableRenderGroup()}get isRenderGroup(){return this.isRenderGroupRoot}enableRenderGroup(){if(this.renderGroup&&this.renderGroup.root===this)return;this.isRenderGroupRoot=!0;let e=this.renderGroup;if(e&&e.removeChild(this),this.renderGroup=new v.RenderGroup(this),e){for(let t=0;t<e.renderGroupChildren.length;t++){let r=e.renderGroupChildren[t],n=r.root;for(;n;){if(n===this){this.renderGroup.addRenderGroupChild(r);break}n=n.parent}}e.addRenderGroupChild(this.renderGroup)}this._updateIsSimple(),this.groupTransform=s.Matrix.IDENTITY}_updateIsSimple(){this.isSimple=!this.isRenderGroupRoot&&0===this.effects.length}get worldTransform(){return this._worldTransform||(this._worldTransform=new s.Matrix),this.renderGroup&&(this.isRenderGroupRoot?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this._worldTransform.appendFrom(this.relativeGroupTransform,this.renderGroup.worldTransform)),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*o.RAD_TO_DEG}set angle(e){this.rotation=e*o.DEG_TO_RAD}get pivot(){return this._pivot===b&&(this._pivot=new a.ObservablePoint(this,0,0)),this._pivot}set pivot(e){this._pivot===b&&(this._pivot=new a.ObservablePoint(this,0,0)),"number"==typeof e?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===x&&(this._skew=new a.ObservablePoint(this,0,0)),this._skew}set skew(e){this._skew===x&&(this._skew=new a.ObservablePoint(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===_&&(this._scale=new a.ObservablePoint(this,1,1)),this._scale}set scale(e){this._scale===_&&(this._scale=new a.ObservablePoint(this,0,0)),"number"==typeof e?this._scale.set(e):this._scale.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){let t=this.getLocalBounds().width;this._setWidth(e,t)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){let t=this.getLocalBounds().height;this._setHeight(e,t)}getSize(e){e||(e={});let t=this.getLocalBounds();return e.width=Math.abs(this.scale.x*t.width),e.height=Math.abs(this.scale.y*t.height),e}setSize(e,t){let r,n;let i=this.getLocalBounds();"object"!=typeof e?(r=e,n=t??e):(r=e.width,n=e.height??e.width),void 0!==r&&this._setWidth(r,i.width),void 0!==n&&this._setHeight(n,i.height)}_updateSkew(){let e=this._rotation,t=this._skew;this._cx=Math.cos(e+t._y),this._sx=Math.sin(e+t._y),this._cy=-Math.sin(e-t._x),this._sy=Math.cos(e-t._x)}updateTransform(e){return this.position.set("number"==typeof e.x?e.x:this.position.x,"number"==typeof e.y?e.y:this.position.y),this.scale.set("number"==typeof e.scaleX?e.scaleX||1:this.scale.x,"number"==typeof e.scaleY?e.scaleY||1:this.scale.y),this.rotation="number"==typeof e.rotation?e.rotation:this.rotation,this.skew.set("number"==typeof e.skewX?e.skewX:this.skew.x,"number"==typeof e.skewY?e.skewY:this.skew.y),this.pivot.set("number"==typeof e.pivotX?e.pivotX:this.pivot.x,"number"==typeof e.pivotY?e.pivotY:this.pivot.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){if((15&this._didLocalTransformChangeId)===this._didChangeId)return;this._didLocalTransformChangeId=this._didChangeId;let e=this.localTransform,t=this._scale,r=this._pivot,n=this._position,i=t._x,s=t._y,o=r._x,a=r._y;e.a=this._cx*i,e.b=this._sx*i,e.c=this._cy*s,e.d=this._sy*s,e.tx=n._x-(o*e.a+a*e.c),e.ty=n._y-(o*e.b+a*e.d)}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=S,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){let t=(0,n.Color).shared.setValue(e??16777215).toBgrNumber();t!==this.localColor&&(this.localColor=t,this._updateFlags|=S,this._onUpdate())}get tint(){let e=this.localColor;return((255&e)<<16)+(65280&e)+(e>>16&255)}set blendMode(e){this.localBlendMode!==e&&(this.renderGroup&&!this.isRenderGroupRoot&&(this.renderGroup.structureDidChange=!0),this._updateFlags|=T,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(2&this.localDisplayStatus)}set visible(e){(2&this.localDisplayStatus)>>1!=(e?1:0)&&(this.renderGroup&&!this.isRenderGroupRoot&&(this.renderGroup.structureDidChange=!0),this._updateFlags|=P,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(4&this.localDisplayStatus)}set culled(e){(4&this.localDisplayStatus)>>2!=(e?1:0)&&(this.renderGroup&&!this.isRenderGroupRoot&&(this.renderGroup.structureDidChange=!0),this._updateFlags|=P,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(1&this.localDisplayStatus)}set renderable(e){(1&this.localDisplayStatus)!=(e?1:0)&&(this._updateFlags|=P,this.localDisplayStatus^=1,this.renderGroup&&!this.isRenderGroupRoot&&(this.renderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return 7===this.localDisplayStatus&&this.groupAlpha>0}destroy(e=!1){if(this.destroyed)return;this.destroyed=!0,this.removeFromParent(),this.parent=null,this._mask=null,this._filters=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners();let t="boolean"==typeof e?e:e?.children,r=this.removeChildren(0,this.children.length);if(t)for(let t=0;t<r.length;++t)r[t].destroy(e)}}A.mixin(c.childrenHelperMixin),A.mixin(g.toLocalGlobalMixin),A.mixin(p.onRenderMixin),A.mixin(d.measureMixin),A.mixin(h.effectsMixin),A.mixin(f.findMixin),A.mixin(m.sortMixin),A.mixin(i.cullingMixin)}),er("AHTcQ",function(e,t){C(e.exports,"Color",()=>s);var r=et("jyvmC"),n=et("flk9m");(0,r.extend)([n.default]);let i=class e{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(t){if(t instanceof e)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else if(null===t)throw Error("Cannot set Color#value to null");else null!==this._value&&this._isSourceEqual(this._value,t)||(this._normalize(t),this._value=this._cloneSource(t))}get value(){return this._value}_cloneSource(e){if("string"==typeof e||"number"==typeof e||e instanceof Number||null===e);else if(Array.isArray(e)||ArrayBuffer.isView(e))return e.slice(0);else if("object"==typeof e&&null!==e)return{...e};return e}_isSourceEqual(e,t){let r=typeof e;if(r!==typeof t)return!1;if("number"===r||"string"===r||e instanceof Number);else if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length===t.length&&e.every((e,r)=>e===t[r]);else if(null!==e&&null!==t){let r=Object.keys(e),n=Object.keys(t);return r.length===n.length&&r.every(r=>e[r]===t[r])}return e===t}toRgba(){let[e,t,r,n]=this._components;return{r:e,g:t,b:r,a:n}}toRgb(){let[e,t,r]=this._components;return{r:e,g:t,b:r}}toRgbaString(){let[e,t,r]=this.toUint8RgbArray();return`rgba(${e},${t},${r},${this.alpha})`}toUint8RgbArray(e){let[t,r,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),(e=e||this._arrayRgb)[0]=Math.round(255*t),e[1]=Math.round(255*r),e[2]=Math.round(255*n),e}toArray(e){this._arrayRgba||(this._arrayRgba=[]),e=e||this._arrayRgba;let[t,r,n,i]=this._components;return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}toRgbArray(e){this._arrayRgb||(this._arrayRgb=[]),e=e||this._arrayRgb;let[t,r,n]=this._components;return e[0]=t,e[1]=r,e[2]=n,e}toNumber(){return this._int}toBgrNumber(){let[e,t,r]=this.toUint8RgbArray();return(r<<16)+(t<<8)+e}toLittleEndianNumber(){let e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(t){let[r,n,i,s]=e._temp.setValue(t)._components;return this._components[0]*=r,this._components[1]*=n,this._components[2]*=i,this._components[3]*=s,this._refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this._refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(1===e)return -16777216+this._int;if(0===e)return t?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,i=255&this._int;return t&&(r=r*e+.5|0,n=n*e+.5|0,i=i*e+.5|0),(255*e<<24)+(r<<16)+(n<<8)+i}toHex(){let e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){let e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}_normalize(t){let n,i,s,o;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){let e=t;n=(e>>16&255)/255,i=(e>>8&255)/255,s=(255&e)/255,o=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[n,i,s,o=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[n,i,s,o=255]=t,n/=255,i/=255,s/=255,o/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){let r=e.HEX_PATTERN.exec(t);r&&(t=`#${r[2]}`)}let a=(0,r.colord)(t);a.isValid()&&({r:n,g:i,b:s,a:o}=a.rgba,n/=255,i/=255,s/=255)}if(void 0!==n)this._components[0]=n,this._components[1]=i,this._components[2]=s,this._components[3]=o,this._refreshInt();else throw Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);let[e,t,r]=this._components;this._int=(255*e<<16)+(255*t<<8)+(255*r|0)}_clamp(e,t=0,r=1){return"number"==typeof e?Math.min(Math.max(e,t),r):(e.forEach((n,i)=>{e[i]=Math.min(Math.max(n,t),r)}),e)}static isColorLike(t){return"number"==typeof t||"string"==typeof t||t instanceof Number||t instanceof e||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||void 0!==t.r&&void 0!==t.g&&void 0!==t.b||void 0!==t.r&&void 0!==t.g&&void 0!==t.b&&void 0!==t.a||void 0!==t.h&&void 0!==t.s&&void 0!==t.l||void 0!==t.h&&void 0!==t.s&&void 0!==t.l&&void 0!==t.a||void 0!==t.h&&void 0!==t.s&&void 0!==t.v||void 0!==t.h&&void 0!==t.s&&void 0!==t.v&&void 0!==t.a}};i.shared=new i,i._temp=new i,i.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let s=i}),er("jyvmC",function(e,t){C(e.exports,"colord",()=>k),C(e.exports,"extend",()=>R);var r={grad:.9,turn:360,rad:360/(2*Math.PI)},n=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},i=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=Math.pow(10,t)),Math.round(r*e)/r+0},s=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),e>r?r:e>t?e:t},o=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},a=function(e){return{r:s(e.r,0,255),g:s(e.g,0,255),b:s(e.b,0,255),a:s(e.a)}},l=function(e){return{r:i(e.r),g:i(e.g),b:i(e.b),a:i(e.a,3)}},u=/^#([0-9a-f]{3,8})$/i,c=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},h=function(e){var t=e.r,r=e.g,n=e.b,i=e.a,s=Math.max(t,r,n),o=s-Math.min(t,r,n),a=o?s===t?(r-n)/o:s===r?2+(n-t)/o:4+(t-r)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},f=function(e){var t=e.h,r=e.s,n=e.v,i=e.a;t=t/360*6,r/=100,n/=100;var s=Math.floor(t),o=n*(1-r),a=n*(1-(t-s)*r),l=n*(1-(1-t+s)*r),u=s%6;return{r:255*[n,a,o,o,l,n][u],g:255*[l,n,n,a,o,o][u],b:255*[o,o,l,n,n,a][u],a:i}},d=function(e){return{h:o(e.h),s:s(e.s,0,100),l:s(e.l,0,100),a:s(e.a)}},p=function(e){return{h:i(e.h),s:i(e.s),l:i(e.l),a:i(e.a,3)}},m=function(e){var t,r;return f((t=e.s,{h:e.h,s:(t*=((r=e.l)<50?r:100-r)/100)>0?2*t/(r+t)*100:0,v:r+t,a:e.a}))},g=function(e){var t,r,n,i;return{h:(t=h(e)).h,s:(i=(200-(r=t.s))*(n=t.v)/100)>0&&i<200?r*n/100/(i<=100?i:200-i)*100:0,l:i/2,a:t.a}},v=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,y=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,x=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,b=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_={string:[[function(e){var t=u.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?i(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?i(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=x.exec(e)||b.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:a({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t,n,i=v.exec(e)||y.exec(e);return i?m(d({h:(t=i[1],void 0===(n=i[2])&&(n="deg"),Number(t)*(r[n]||1)),s:Number(i[3]),l:Number(i[4]),a:void 0===i[5]?1:Number(i[5])/(i[6]?100:1)})):null},"hsl"]],object:[[function(e){var t=e.r,r=e.g,i=e.b,s=e.a;return n(t)&&n(r)&&n(i)?a({r:Number(t),g:Number(r),b:Number(i),a:Number(void 0===s?1:s)}):null},"rgb"],[function(e){var t=e.h,r=e.s,i=e.l,s=e.a;return n(t)&&n(r)&&n(i)?m(d({h:Number(t),s:Number(r),l:Number(i),a:Number(void 0===s?1:s)})):null},"hsl"],[function(e){var t,r=e.h,i=e.s,a=e.v,l=e.a;return n(r)&&n(i)&&n(a)?f({h:o((t={h:Number(r),s:Number(i),v:Number(a),a:Number(void 0===l?1:l)}).h),s:s(t.s,0,100),v:s(t.v,0,100),a:s(t.a)}):null},"hsv"]]},S=function(e,t){for(var r=0;r<t.length;r++){var n=t[r][0](e);if(n)return[n,t[r][1]]}return[null,void 0]},w=function(e,t){var r=g(e);return{h:r.h,s:s(r.s+100*t,0,100),l:r.l,a:r.a}},T=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},P=function(e,t){var r=g(e);return{h:r.h,s:r.s,l:s(r.l+100*t,0,100),a:r.a}},A=function(){function e(e){this.parsed=("string"==typeof e?S(e.trim(),_.string):"object"==typeof e&&null!==e?S(e,_.object):[null,void 0])[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return i(T(this.rgba),2)},e.prototype.isDark=function(){return .5>T(this.rgba)},e.prototype.isLight=function(){return T(this.rgba)>=.5},e.prototype.toHex=function(){var e,t,r,n,s,o;return t=(e=l(this.rgba)).r,r=e.g,n=e.b,o=(s=e.a)<1?c(i(255*s)):"","#"+c(t)+c(r)+c(n)+o},e.prototype.toRgb=function(){return l(this.rgba)},e.prototype.toRgbString=function(){var e,t,r,n,i;return t=(e=l(this.rgba)).r,r=e.g,n=e.b,(i=e.a)<1?"rgba("+t+", "+r+", "+n+", "+i+")":"rgb("+t+", "+r+", "+n+")"},e.prototype.toHsl=function(){return p(g(this.rgba))},e.prototype.toHslString=function(){var e,t,r,n,i;return t=(e=p(g(this.rgba))).h,r=e.s,n=e.l,(i=e.a)<1?"hsla("+t+", "+r+"%, "+n+"%, "+i+")":"hsl("+t+", "+r+"%, "+n+"%)"},e.prototype.toHsv=function(){var e;return{h:i((e=h(this.rgba)).h),s:i(e.s),v:i(e.v),a:i(e.a,3)}},e.prototype.invert=function(){var e;return k({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a})},e.prototype.saturate=function(e){return void 0===e&&(e=.1),k(w(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),k(w(this.rgba,-e))},e.prototype.grayscale=function(){return k(w(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),k(P(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),k(P(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){var t;return"number"==typeof e?k({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):i(this.rgba.a,3)},e.prototype.hue=function(e){var t=g(this.rgba);return"number"==typeof e?k({h:e,s:t.s,l:t.l,a:t.a}):i(t.h)},e.prototype.isEqual=function(e){return this.toHex()===k(e).toHex()},e}(),k=function(e){return e instanceof A?e:new A(e)},M=[],R=function(e){e.forEach(function(e){0>M.indexOf(e)&&(e(A,_),M.push(e))})}}),er("flk9m",function(e,t){C(e.exports,"default",()=>r);function r(e,t){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var i in r)n[r[i]]=i;var s={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var i,o=n[this.toHex()];if(o)return o;if(null==t?void 0:t.closest){var a=this.toRgb(),l=1/0,u="black";if(!s.length)for(var c in r)s[c]=new e(r[c]).toRgb();for(var h in r){var f=(i=s[h],Math.pow(a.r-i.r,2)+Math.pow(a.g-i.g,2)+Math.pow(a.b-i.b,2));f<l&&(l=f,u=h)}return u}},t.string.push([function(t){var n=t.toLowerCase(),i="transparent"===n?"#0000":r[n];return i?new e(i).toRgb():null},"name"])}}),er("jorMT",function(e,t){C(e.exports,"cullingMixin",()=>r);let r={cullArea:null,cullable:!1,cullableChildren:!0}}),er("1AFlc",function(e,t){C(e.exports,"childrenHelperMixin",()=>i);var r=et("hpsHk"),n=et("eX50w");let i={allowChildren:!0,removeChildren(e=0,t){let n=t??this.children.length,i=n-e,s=[];if(i>0&&i<=n){for(let t=n-1;t>=e;t--){let e=this.children[t];e&&(this.renderGroup&&this.renderGroup.removeChild(e),s.push(e),e.parent=null)}(0,r.removeItems)(this.children,e,n);for(let e=0;e<s.length;++e)this.emit("childRemoved",s[e],this,e),s[e].emit("removed",this);return s}if(0===i&&0===this.children.length)return s;throw RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(e){let t=this.getChildAt(e);return this.removeChild(t)},getChildAt(e){if(e<0||e>=this.children.length)throw Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]},setChildIndex(e,t){if(t<0||t>=this.children.length)throw Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(e),this.addChildAt(e,t)},getChildIndex(e){let t=this.children.indexOf(e);if(-1===t)throw Error("The supplied Container must be a child of the caller");return t},addChildAt(e,t){this.allowChildren||(0,n.deprecation)(n.v8_0_0,"addChildAt: Only Containers will be allowed to add children in v8.0.0");let{children:r}=this;if(t<0||t>r.length)throw Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${r.length}`);if(e.parent){let r=e.parent.children.indexOf(e);if(e.parent===this&&r===t)return e;-1!==r&&e.parent.children.splice(r,1)}return t===r.length?r.push(e):r.splice(t,0,e),e.parent=this,e.didChange=!0,e.didViewUpdate=!1,e._updateFlags=15,this.renderGroup&&this.renderGroup.addChild(e),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",e,this,t),e.emit("added",this),e},swapChildren(e,t){if(e===t)return;let r=this.getChildIndex(e),n=this.getChildIndex(t);this.children[r]=t,this.children[n]=e},removeFromParent(){this.parent?.removeChild(this)}}}),er("hpsHk",function(e,t){C(e.exports,"removeItems",()=>r);function r(e,t,r){let n;let i=e.length;if(t>=i||0===r)return;r=t+r>i?i-t:r;let s=i-r;for(n=t;n<s;++n)e[n]=e[n+r];e.length=s}}),er("4u67k",function(e,t){C(e.exports,"effectsMixin",()=>s);var r=et("fq91v"),n=et("fGBJF"),i=et("e98Fy");let s={_mask:null,_filters:null,effects:[],addEffect(e){-1===this.effects.indexOf(e)&&(this.effects.push(e),this.effects.sort((e,t)=>e.priority-t.priority),this.renderGroup&&(this.renderGroup.structureDidChange=!0),this._updateIsSimple())},removeEffect(e){let t=this.effects.indexOf(e);-1!==t&&(this.effects.splice(t,1),!this.isRenderGroupRoot&&this.renderGroup&&(this.renderGroup.structureDidChange=!0),this._updateIsSimple())},set mask(value){if(this._mask||(this._mask={mask:null,effect:null}),this._mask.mask===value||(this._mask.effect&&(this.removeEffect(this._mask.effect),(0,n.MaskEffectManager).returnMaskEffect(this._mask.effect),this._mask.effect=null),this._mask.mask=value,null==value))return;let e=(0,n.MaskEffectManager).getMaskEffect(value);this._mask.effect=e,this.addEffect(e)},get mask(){return this._mask?.mask},set filters(value){!Array.isArray(value)&&value&&(value=[value]),this._filters||(this._filters={filters:null,effect:null,filterArea:null});let e=value?.length>0,t=this._filters.effect&&!e||!this._filters.effect&&e;if(value=Array.isArray(value)?value.slice(0):value,this._filters.filters=Object.freeze(value),t){if(e){let e=(0,i.BigPool).get(r.FilterEffect);this._filters.effect=e,this.addEffect(e)}else{let e=this._filters.effect;this.removeEffect(e),e.filterArea=null,e.filters=null,this._filters.effect=null,(0,i.BigPool).return(e)}}e&&(this._filters.effect.filters=value,this._filters.effect.filterArea=this.filterArea)},get filters(){return this._filters?.filters},set filterArea(value){this._filters||(this._filters={filters:null,effect:null,filterArea:null}),this._filters.filterArea=value},get filterArea(){return this._filters?.filterArea}}}),er("fq91v",function(e,t){C(e.exports,"FilterEffect",()=>r);class r{constructor(e){this.pipe="filter",this.priority=1,this.filters=e?.filters,this.filterArea=e?.filterArea}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null,this.filterArea=null}}}),er("fGBJF",function(e,t){C(e.exports,"MaskEffectManager",()=>i);var r=et("eVz1R"),n=et("e98Fy");let i=new class{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(e=>{this.add({test:e.test,maskClass:e})}))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let t=0;t<this._tests.length;t++){let r=this._tests[t];if(r.test(e))return(0,n.BigPool).get(r.maskClass,e)}return e}returnMaskEffect(e){(0,n.BigPool).return(e)}};(0,r.extensions).handleByList(r.ExtensionType.MaskEffect,i._effectClasses)}),er("e98Fy",function(e,t){C(e.exports,"BigPool",()=>n);var r=et("iYfXR");let n=new class{constructor(){this._poolsByClass=new Map}prepopulate(e,t){this.getPool(e).prepopulate(t)}get(e,t){return this.getPool(e).get(t)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new r.Pool(e)),this._poolsByClass.get(e)}stats(){let e={};return this._poolsByClass.forEach(t=>{let r=e[t._classType.name]?t._classType.name+t._classType.ID:t._classType.name;e[r]={free:t.totalFree,used:t.totalUsed,size:t.totalSize}}),e}}}),er("iYfXR",function(e,t){C(e.exports,"Pool",()=>r);class r{constructor(e,t){this._pool=[],this._count=0,this._index=0,this._classType=e,t&&this.prepopulate(t)}prepopulate(e){for(let t=0;t<e;t++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){let t;return t=this._index>0?this._pool[--this._index]:new this._classType,t.init?.(e),t}return(e){e.reset?.(),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}}}),er("6UPd0",function(e,t){C(e.exports,"findMixin",()=>n);var r=et("eX50w");let n={label:null,get name(){return(0,r.deprecation)(r.v8_0_0,"Container.name property has been removed, use Container.label instead"),this.label},set name(value){(0,r.deprecation)(r.v8_0_0,"Container.name property has been removed, use Container.label instead"),this.label=value},getChildByName(e,t=!1){return this.getChildByLabel(e,t)},getChildByLabel(e,t=!1){let r=this.children;for(let t=0;t<r.length;t++){let n=r[t];if(n.label===e||e instanceof RegExp&&e.test(n.label))return n}if(t)for(let t=0;t<r.length;t++){let n=r[t].getChildByLabel(e,!0);if(n)return n}return null},getChildrenByLabel(e,t=!1,r=[]){let n=this.children;for(let t=0;t<n.length;t++){let i=n[t];(i.label===e||e instanceof RegExp&&e.test(i.label))&&r.push(i)}if(t)for(let t=0;t<n.length;t++)n[t].getChildrenByLabel(e,!0,r);return r}}}),er("eHtGW",function(e,t){C(e.exports,"measureMixin",()=>l);var r=et("dNaJE"),n=et("ggeMF"),i=et("dXx4G"),s=et("5pskN"),o=et("96kAF");let a=new r.Matrix,l={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(e,t){let r=Math.sign(this.scale.x)||1;0!==t?this.scale.x=e/t*r:this.scale.x=r},_setHeight(e,t){let r=Math.sign(this.scale.y)||1;0!==t?this.scale.y=e/t*r:this.scale.y=r},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new n.Bounds});let e=this._localBoundsCacheData;return e.index=1,e.didChange=!1,e.data[0]!==this._didChangeId>>12&&(e.didChange=!0,e.data[0]=this._didChangeId>>12),(0,o.checkChildrenDidChange)(this,e),e.didChange&&(0,s.getLocalBounds)(this,e.localBounds,a),e.localBounds},getBounds(e,t){return(0,i.getGlobalBounds)(this,e,t||new n.Bounds)}}}),er("ggeMF",function(e,t){C(e.exports,"Bounds",()=>s);var r=et("dNaJE"),n=et("soqVu");let i=new r.Matrix;class s{constructor(e=1/0,t=1/0,r=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=i,this.minX=e,this.minY=t,this.maxX=r,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new n.Rectangle);let e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=i,this}set(e,t,r,n){this.minX=e,this.minY=t,this.maxX=r,this.maxY=n}addFrame(e,t,r,n,i){i||(i=this.matrix);let s=i.a,o=i.b,a=i.c,l=i.d,u=i.tx,c=i.ty,h=this.minX,f=this.minY,d=this.maxX,p=this.maxY,m=s*e+a*t+u,g=o*e+l*t+c;m<h&&(h=m),g<f&&(f=g),m>d&&(d=m),g>p&&(p=g),m=s*r+a*t+u,g=o*r+l*t+c,m<h&&(h=m),g<f&&(f=g),m>d&&(d=m),g>p&&(p=g),m=s*e+a*n+u,g=o*e+l*n+c,m<h&&(h=m),g<f&&(f=g),m>d&&(d=m),g>p&&(p=g),m=s*r+a*n+u,g=o*r+l*n+c,m<h&&(h=m),g<f&&(f=g),m>d&&(d=m),g>p&&(p=g),this.minX=h,this.minY=f,this.maxX=d,this.maxY=p}addRect(e,t){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,t)}addBounds(e,t){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,t)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){let t=this.minX,r=this.minY,n=this.maxX,i=this.maxY,{a:s,b:o,c:a,d:l,tx:u,ty:c}=e,h=s*t+a*r+u,f=o*t+l*r+c;this.minX=h,this.minY=f,this.maxX=h,this.maxY=f,h=s*n+a*r+u,f=o*n+l*r+c,this.minX=h<this.minX?h:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=h>this.maxX?h:this.maxX,this.maxY=f>this.maxY?f:this.maxY,h=s*t+a*i+u,f=o*t+l*i+c,this.minX=h<this.minX?h:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=h>this.maxX?h:this.maxX,this.maxY=f>this.maxY?f:this.maxY,h=s*n+a*i+u,f=o*n+l*i+c,this.minX=h<this.minX?h:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=h>this.maxX?h:this.maxX,this.maxY=f>this.maxY?f:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,t,r,n){return this.minX<e&&(this.minX=e),this.maxX>t&&(this.maxX=t),this.minY<r&&(this.minY=r),this.maxY>n&&(this.maxY=n),this}pad(e,t=e){return this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new s(this.minX,this.minY,this.maxX,this.maxY)}scale(e,t=e){return this.minX*=e,this.minY*=t,this.maxX*=e,this.maxY*=t,this}get x(){return this.minX}set x(e){let t=this.maxX-this.minX;this.minX=e,this.maxX=e+t}get y(){return this.minY}set y(e){let t=this.maxY-this.minY;this.minY=e,this.maxY=e+t}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,t,r,n){let i=this.minX,s=this.minY,o=this.maxX,a=this.maxY;n||(n=this.matrix);let l=n.a,u=n.b,c=n.c,h=n.d,f=n.tx,d=n.ty;for(let n=t;n<r;n+=2){let t=e[n],r=e[n+1],p=l*t+c*r+f,m=u*t+h*r+d;i=p<i?p:i,s=m<s?m:s,o=p>o?p:o,a=m>a?m:a}this.minX=i,this.minY=s,this.maxX=o,this.maxY=a}containsPoint(e,t){return this.minX<=e&&this.minY<=t&&this.maxX>=e&&this.maxY>=t}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}}}),er("dXx4G",function(e,t){C(e.exports,"getGlobalBounds",()=>i),C(e.exports,"updateTransformBackwards",()=>s);var r=et("dNaJE"),n=et("96ND8");function i(e,t,i){let o,a;return i.clear(),o=e.parent?t?e.parent.worldTransform:s(e,a=(0,n.matrixPool).get().identity()):r.Matrix.IDENTITY,function e(t,i,s,o){let a;if(!t.visible||!t.measurable)return;o?a=t.worldTransform:(t.updateLocalTransform(),(a=(0,n.matrixPool).get()).appendFrom(t.localTransform,s));let l=i,u=!!t.effects.length;if(u&&(i=(0,n.boundsPool).get().clear()),t.boundsArea)i.addRect(t.boundsArea,a);else{t.addBounds&&(i.matrix=a,t.addBounds(i));for(let r=0;r<t.children.length;r++)e(t.children[r],i,a,o)}if(u){for(let e=0;e<t.effects.length;e++)t.effects[e].addBounds?.(i);l.addBounds(i,r.Matrix.IDENTITY),(0,n.boundsPool).return(i)}o||(0,n.matrixPool).return(a)}(e,i,o,t),a&&(0,n.matrixPool).return(a),i.isValid||i.set(0,0,0,0),i}function s(e,t){let r=e.parent;return r&&(s(r,t),r.updateLocalTransform(),t.append(r.localTransform)),t}}),er("96ND8",function(e,t){C(e.exports,"matrixPool",()=>s),C(e.exports,"boundsPool",()=>o);var r=et("dNaJE"),n=et("iYfXR"),i=et("ggeMF");let s=new n.Pool(r.Matrix),o=new n.Pool(i.Bounds)}),er("5pskN",function(e,t){C(e.exports,"getLocalBounds",()=>i);var r=et("dNaJE");et("8CF4q");var n=et("96ND8");function i(e,t,i){return t.clear(),i||(i=r.Matrix.IDENTITY),function e(t,i,s,o,a){let l;if(a)l=(0,n.matrixPool).get(),l=s.copyTo(l);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();let e=t.localTransform;(l=(0,n.matrixPool).get()).appendFrom(e,s)}let u=i,c=!!t.effects.length;if(c&&(i=(0,n.boundsPool).get().clear()),t.boundsArea)i.addRect(t.boundsArea,l);else{t.renderPipeId&&(i.matrix=l,t.addBounds(i));let r=t.children;for(let t=0;t<r.length;t++)e(r[t],i,l,o,!1)}if(c){for(let e=0;e<t.effects.length;e++)t.effects[e].addLocalBounds?.(i,o);u.addBounds(i,r.Matrix.IDENTITY),(0,n.boundsPool).return(i)}(0,n.matrixPool).return(l)}(e,t,i,e,!0),t.isValid||t.set(0,0,0,0),t}}),er("8CF4q",function(e,t){C(e.exports,"warn",()=>n);let r=0;function n(...e){500!==r&&(500==++r?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...e))}}),er("96kAF",function(e,t){C(e.exports,"checkChildrenDidChange",()=>function e(t,r){let n=t.children;for(let t=0;t<n.length;t++){let i=n[t],s=(255&i.uid)<<24|16777215&i._didChangeId;r.data[r.index]!==s&&(r.data[r.index]=s,r.didChange=!0),r.index++,i.children.length&&e(i,r)}return r.didChange})}),er("bMTFJ",function(e,t){C(e.exports,"onRenderMixin",()=>r);let r={_onRender:null,set onRender(func){let e=this.renderGroup;if(!func){this._onRender&&e?.removeOnRender(this),this._onRender=null;return}this._onRender||e?.addOnRender(this),this._onRender=func},get onRender(){return this._onRender}}}),er("8Eetq",function(e,t){C(e.exports,"sortMixin",()=>r);let r={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(value){if(this._zIndex===value)return;this._zIndex=value,this.depthOfChildModified()},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.renderGroup&&!this.isRenderGroupRoot&&(this.renderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(n))}};function n(e,t){return e._zIndex-t._zIndex}}),er("5gOfB",function(e,t){C(e.exports,"toLocalGlobalMixin",()=>s);var r=et("dNaJE"),n=et("2NXni"),i=et("dXx4G");let s={getGlobalPosition(e=new n.Point,t=!1){return this.parent?this.parent.toGlobal(this._position,e,t):(e.x=this._position.x,e.y=this._position.y),e},toGlobal(e,t,n=!1){if(!n){this.updateLocalTransform();let n=(0,i.updateTransformBackwards)(this,new r.Matrix);return n.append(this.localTransform),n.apply(e,t)}return this.worldTransform.apply(e,t)},toLocal(e,t,n,s){if(t&&(e=t.toGlobal(e,n,s)),!s){this.updateLocalTransform();let t=(0,i.updateTransformBackwards)(this,new r.Matrix);return t.append(this.localTransform),t.applyInverse(e,n)}return this.worldTransform.applyInverse(e,n)}}}),er("hmS23",function(e,t){C(e.exports,"RenderGroup",()=>i);var r=et("dNaJE"),n=et("vdXhX");class i{constructor(e){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this._children=[],this.worldTransform=new r.Matrix,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new n.InstructionSet,this._onRenderContainers=[],this.root=e,this.addChild(e)}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.onChildUpdate(e.root),this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){e.root.didChange&&this._removeChildFromUpdate(e.root);let t=this.renderGroupChildren.indexOf(e);t>-1&&this.renderGroupChildren.splice(t,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e!==this.root&&(this._children.push(e),e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e._onRender&&this.addOnRender(e)),e.renderGroup){if(e.renderGroup.root===e){this.addRenderGroupChild(e.renderGroup);return}}else e.renderGroup=this,e.didChange=!0;let t=e.children;e.isRenderGroupRoot||this.onChildUpdate(e);for(let e=0;e<t.length;e++)this.addChild(t[e])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&this.removeOnRender(e),e.renderGroup.root!==e){let t=e.children;for(let e=0;e<t.length;e++)this.removeChild(t[e]);e.didChange&&e.renderGroup._removeChildFromUpdate(e),e.renderGroup=null}else this._removeRenderGroupChild(e.renderGroup);let t=this._children.indexOf(e);t>-1&&this._children.splice(t,1)}onChildUpdate(e){let t=this.childrenToUpdate[e.relativeRenderGroupDepth];t||(t=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),t.list[t.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(e.didViewUpdate=!1,this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e))}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}_removeChildFromUpdate(e){let t=this.childrenToUpdate[e.relativeRenderGroupDepth];if(!t)return;let r=t.list.indexOf(e);r>-1&&t.list.splice(r,1),t.index--}get isRenderable(){return 7===this.root.localDisplayStatus&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender()}}}),er("vdXhX",function(e,t){C(e.exports,"InstructionSet",()=>n);var r=et("l80qL");class n{constructor(){this.uid=(0,r.uid)("instructionSet"),this.instructions=[],this.instructionSize=0}reset(){this.instructionSize=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}}),er("e84qN",function(e,t){C(e.exports,"assignWithIgnore",()=>r);function r(e,t,r={}){for(let n in t)r[n]||void 0===t[n]||(e[n]=t[n])}}),er("kARrF",function(e,t){C(e.exports,"addMaskBounds",()=>s);var r=et("ggeMF"),n=et("dXx4G");let i=new r.Bounds;function s(e,t,r){e.measurable=!0,(0,n.getGlobalBounds)(e,r,i),t.addBoundsMask(i),e.measurable=!1}}),er("kBq1a",function(e,t){C(e.exports,"addMaskLocalBounds",()=>s);var r=et("5pskN"),n=et("96ND8"),i=et("8CF4q");function s(e,t,s){let o=(0,n.boundsPool).get();e.measurable=!0;let a=(0,n.matrixPool).get().identity(),l=function e(t,r,n){return t?t!==r&&(e(t.parent,r,n),t.updateLocalTransform(),n.append(t.localTransform)):(0,i.warn)("Mask bounds, renderable is not inside the root container"),n}(e,s,a);(0,r.getLocalBounds)(e,o,l),e.measurable=!1,t.addBoundsMask(o),(0,n.matrixPool).return(a),(0,n.boundsPool).return(o)}}),er("vwyRu",function(e,t){C(e.exports,"ColorMask",()=>n);var r=et("eVz1R");class n{constructor(e){this.priority=0,this.pipe="colorMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return"number"==typeof e}}n.extension=r.ExtensionType.MaskEffect}),er("lcq2f",function(e,t){C(e.exports,"StencilMask",()=>o);var r=et("eVz1R"),n=et("lR3Ev"),i=et("kARrF"),s=et("kBq1a");class o{constructor(e){this.priority=0,this.pipe="stencilMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(e,t){(0,i.addMaskBounds)(this.mask,e,t)}addLocalBounds(e,t){(0,s.addMaskLocalBounds)(this.mask,e,t)}containsPoint(e,t){return t(this.mask,e)}destroy(){this.reset()}static test(e){return e instanceof n.Container}}o.extension=r.ExtensionType.MaskEffect}),er("2rfX3",function(e,t){C(e.exports,"CanvasSource",()=>s);var r=et("5m2Qn"),n=et("eVz1R"),i=et("9Ur0D");class s extends i.TextureSource{constructor(e){e.resource||(e.resource=(0,r.DOMAdapter).get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity;let t=e.resource;(this.pixelWidth!==t.width||this.pixelWidth!==t.height)&&this.resizeCanvas(),this.transparent=!!e.transparent}resizeCanvas(){this.autoDensity&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(e=this.width,t=this.height,r=this._resolution){let n=super.resize(e,t,r);return n&&this.resizeCanvas(),n}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}}s.extension=n.ExtensionType.TextureSource}),er("5m2Qn",function(e,t){C(e.exports,"DOMAdapter",()=>n);let r=et("1pH92").BrowserAdapter,n={get:()=>r,set(e){r=e}}}),er("1pH92",function(e,t){C(e.exports,"BrowserAdapter",()=>r);let r={createCanvas:(e,t)=>{let r=document.createElement("canvas");return r.width=e,r.height=t,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getWebGL2RenderingContext:()=>WebGL2RenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")}}),er("4XrO5",function(e,t){C(e.exports,"ImageSource",()=>o);var r=et("5m2Qn"),n=et("eVz1R"),i=et("8CF4q"),s=et("9Ur0D");class o extends s.TextureSource{constructor(e){if(e.resource&&globalThis.HTMLImageElement&&e.resource instanceof HTMLImageElement){let t=(0,r.DOMAdapter).get().createCanvas(e.resource.width,e.resource.height);t.getContext("2d").drawImage(e.resource,0,0),e.resource=t,(0,i.warn)("ImageSource: Image element passed, converting to canvas. Use CanvasSource instead.")}super(e),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(e){return globalThis.HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}}o.extension=n.ExtensionType.TextureSource}),er("c9SSH",function(e,t){C(e.exports,"VideoSource",()=>a);var r=et("eVz1R"),n=et("1WaK0"),i=et("aG1Od"),s=et("9Ur0D");let o=class e extends s.TextureSource{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...e.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==t.autoPlay,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==t.autoLoad&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){let e=n.Ticker.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;let e=this.resource,t=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(t.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await (0,i.detectVideoAlphaMode)(),this._load=new Promise((r,n)=>{this.isValid?r(this):(this._resolve=r,this._reject=n,void 0!==t.preloadTimeoutMs&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${t.preloadTimeoutMs}ms`))})),e.load())}),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){let e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){let e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();let e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&((0,n.Ticker).shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||((0,n.Ticker).shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&((0,n.Ticker).shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||globalThis.VideoFrame&&e instanceof VideoFrame}};o.extension=r.ExtensionType.TextureSource,o.defaultOptions={...s.TextureSource.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1},o.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let a=o}),er("1WaK0",function(e,t){C(e.exports,"Ticker",()=>s);var r=et("gu9S0"),n=et("aUStc");let i=class e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new n.TickerListener(null,null,1/0),this.deltaMS=1/e.targetFPMS,this.elapsedMS=1/e.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=r.UPDATE_PRIORITY.NORMAL){return this._addListener(new n.TickerListener(e,t,i))}addOnce(e,t,i=r.UPDATE_PRIORITY.NORMAL){return this._addListener(new n.TickerListener(e,t,i,!0))}_addListener(e){let t=this._head.next,r=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}else e.connect(r);return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r=r.match(e,t)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let r;if(t>this.lastTime){if((r=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){let e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*e.targetFPMS;let n=this._head,i=n.next;for(;i;)i=i.emit(this);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let r=Math.min(Math.max(0,Math.min(this.maxFPS,t))/1e3,e.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{let t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!e._shared){let t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared}static get system(){if(!e._system){let t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system}};i.targetFPMS=.06;let s=i}),er("gu9S0",function(e,t){C(e.exports,"UPDATE_PRIORITY",()=>n);var r,n=((r=n||{})[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r)}),er("aUStc",function(e,t){C(e.exports,"TickerListener",()=>r);class r{constructor(e,t=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=t,this.priority=r,this._once=n}match(e,t=null){return this._fn===e&&this._context===t}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));let t=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let t=this.next;return this.next=e?null:t,this.previous=null,t}}}),er("aG1Od",function(e,t){let r;async function n(){return r??(r=(async()=>{let e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";let t=await new Promise(e=>{let t=document.createElement("video");t.onloadeddata=()=>e(t),t.onerror=()=>e(null),t.autoplay=!1,t.crossOrigin="anonymous",t.preload="auto",t.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",t.load()});if(!t)return"premultiply-alpha-on-upload";let r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);let n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);let i=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,i),e.deleteFramebuffer(n),e.deleteTexture(r),e.getExtension("WEBGL_lose_context")?.loseContext(),i[0]<=i[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),r}C(e.exports,"detectVideoAlphaMode",()=>n)}),er("i4n4u",function(e,t){var r=et("gYSnF"),n=et("eVz1R"),i=et("9Ur0D"),s=et("5h88T");let o=[];(0,n.extensions).handleByList(n.ExtensionType.TextureSource,o),s.Texture.from=function(e,t=!1){return"string"==typeof e?(0,r.Cache).get(e):e instanceof i.TextureSource?new s.Texture({source:e}):function(e={},t=!1){let n=e&&e.resource,i=n?e.resource:e,a=n?e:{resource:e};if(!t&&(0,r.Cache).has(i))return(0,r.Cache).get(i);let l=new s.Texture({source:function(e={}){let t=e&&e.resource,r=t?e.resource:e,n=t?e:{resource:e};for(let e=0;e<o.length;e++){let t=o[e];if(t.test(r))return new t(n)}throw Error(`Could not find a source type for resource: ${n.resource}`)}(a)});return l.on("destroy",()=>{(0,r.Cache).has(i)&&(0,r.Cache).remove(i)}),t||(0,r.Cache).set(i,l),l}(e,t)}}),er("gYSnF",function(e,t){C(e.exports,"Cache",()=>i);var r=et("8CF4q"),n=et("lbclP");let i=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){let t=this._cache.get(e);return t||(0,r.warn)(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){let i;let s=(0,n.convertToList)(e);for(let e=0;e<this.parsers.length;e++){let r=this.parsers[e];if(r.test(t)){i=r.getCacheableAssets(s,t);break}}let o=new Map(Object.entries(i||{}));i||s.forEach(e=>{o.set(e,t)});let a=[...o.keys()],l={cacheKeys:a,keys:s};s.forEach(e=>{this._cacheMap.set(e,l)}),a.forEach(e=>{let n=i?i[e]:t;this._cache.has(e)&&this._cache.get(e)!==n&&(0,r.warn)("[Cache] already has key:",e),this._cache.set(e,o.get(e))})}remove(e){if(!this._cacheMap.has(e)){(0,r.warn)(`[Assets] Asset id ${e} was not found in the Cache`);return}let t=this._cacheMap.get(e);t.cacheKeys.forEach(e=>{this._cache.delete(e)}),t.keys.forEach(e=>{this._cacheMap.delete(e)})}get parsers(){return this._parsers}}}),er("lbclP",function(e,t){C(e.exports,"convertToList",()=>r);let r=(e,t,r=!1)=>(Array.isArray(e)||(e=[e]),t)?e.map(e=>"string"==typeof e||r?t(e):e):e}),er("ipkVP",function(e,t){var r=et("eVz1R"),n=et("bHBRz");(0,r.extensions).add(n.spritesheetAsset)}),er("bHBRz",function(e,t){C(e.exports,"spritesheetAsset",()=>c);var r=et("kuLtH"),n=et("Lmcdo"),i=et("kY7V1"),s=et("eVz1R"),o=et("5h88T"),a=et("kaDu9"),l=et("2v83S");let u=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"],c={extension:s.ExtensionType.Asset,cache:{test:e=>e instanceof l.Spritesheet,getCacheableAssets:(e,t)=>(function e(t,r,n){let i={};if(t.forEach(e=>{i[e]=r}),Object.keys(r.textures).forEach(e=>{i[e]=r.textures[e]}),!n){let n=(0,a.path).dirname(t[0]);r.linkedSheets.forEach((t,s)=>{Object.assign(i,e([`${n}/${r.data.meta.related_multi_packs[s]}`],t,!0))})}return i})(e,t,!1)},resolver:{test:e=>{let t=e.split("?")[0].split("."),r=t.pop(),n=t.pop();return"json"===r&&u.includes(n)},parse:e=>{let t=e.split(".");return{resolution:parseFloat(n.Resolver.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:s.ExtensionType.LoadParser,priority:r.LoaderParserPriority.Normal},testParse:async(e,t)=>".json"===(0,a.path).extname(t.src).toLowerCase()&&!!e.frames,async parse(e,t,r){let n;let{texture:s,imageFilename:u}=t?.data??{},c=(0,a.path).dirname(t.src);if(c&&c.lastIndexOf("/")!==c.length-1&&(c+="/"),s instanceof o.Texture)n=s;else{let s=(0,i.copySearchParams)(c+(u??e.meta.image),t.src);n=(await r.load([s]))[s]}let h=new l.Spritesheet(n.source,e);await h.parse();let f=e?.meta?.related_multi_packs;if(Array.isArray(f)){let e=[];for(let n of f){if("string"!=typeof n)continue;let s=c+n;t.data?.ignoreMultiPack||(s=(0,i.copySearchParams)(s,t.src),e.push(r.load({src:s,data:{ignoreMultiPack:!0}})))}let n=await Promise.all(e);h.linkedSheets=n,n.forEach(e=>{e.linkedSheets=[h].concat(h.linkedSheets.filter(t=>t!==e))})}return h},async unload(e,t,r){await r.unload(e.textureSource._sourceOrigin),e.destroy(!1)}}}}),er("kuLtH",function(e,t){C(e.exports,"LoaderParserPriority",()=>n);var r,n=((r=n||{})[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r)}),er("Lmcdo",function(e,t){C(e.exports,"Resolver",()=>a);var r=et("8CF4q"),n=et("kaDu9"),i=et("lbclP"),s=et("ahHFV"),o=et("6BHki");class a{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){"string"==typeof e?this._defaultSearchParams=e:this._defaultSearchParams=Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}getAlias(e){let{alias:t,src:r}=e;return(0,i.convertToList)(t||r,e=>"string"==typeof e?e:Array.isArray(e)?e.map(e=>e?.src??e):e?.src?e.src:e,!0)}addManifest(e){this._manifest&&(0,r.warn)("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(e,t){let r=[],n=t;Array.isArray(t)||(n=Object.entries(t).map(([e,t])=>"string"==typeof t||Array.isArray(t)?{alias:e,src:t}:{alias:e,...t})),n.forEach(t=>{let n;let i=t.src,s=t.alias;if("string"==typeof s){let t=this._createBundleAssetId(e,s);r.push(t),n=[s,t]}else{let t=s.map(t=>this._createBundleAssetId(e,t));r.push(...t),n=[...s,...t]}this.add({...t,alias:n,src:i})}),this._bundles[e]=r}add(e){let t;let n=[];Array.isArray(e)?n.push(...e):n.push(e),t=e=>{this.hasKey(e)&&(0,r.warn)(`[Resolver] already has key: ${e} overwriting`)},(0,i.convertToList)(n).forEach(e=>{let{src:r}=e,{data:n,format:o,loadParser:a}=e,l=(0,i.convertToList)(r).map(e=>"string"==typeof e?(0,s.createStringVariations)(e):Array.isArray(e)?e:[e]),u=this.getAlias(e);Array.isArray(u)?u.forEach(t):t(u);let c=[];l.forEach(e=>{e.forEach(e=>{let t={};if("object"!=typeof e){t.src=e;for(let r=0;r<this._parsers.length;r++){let n=this._parsers[r];if(n.test(e)){t=n.parse(e);break}}}else n=e.data??n,o=e.format??o,a=e.loadParser??a,t={...t,...e};if(!u)throw Error(`[Resolver] alias is undefined for this asset: ${t.src}`);t=this._buildResolvedAsset(t,{aliases:u,data:n,format:o,loadParser:a}),c.push(t)})}),u.forEach(e=>{this._assetMap[e]=c})})}resolveBundle(e){let t=(0,o.isSingleItem)(e);e=(0,i.convertToList)(e);let r={};return e.forEach(e=>{let t=this._bundles[e];if(t){let n=this.resolve(t),i={};for(let t in n){let r=n[t];i[this._extractAssetIdFromBundle(e,t)]=r}r[e]=i}}),t?r[e[0]]:r}resolveUrl(e){let t=this.resolve(e);if("string"!=typeof e){let e={};for(let r in t)e[r]=t[r].src;return e}return t.src}resolve(e){let t=(0,o.isSingleItem)(e);e=(0,i.convertToList)(e);let r={};return e.forEach(e=>{if(!this._resolverHash[e]){if(this._assetMap[e]){let t=this._assetMap[e],r=this._getPreferredOrder(t);r?.priority.forEach(e=>{r.params[e].forEach(r=>{let n=t.filter(t=>!!t[e]&&t[e]===r);n.length&&(t=n)})}),this._resolverHash[e]=t[0]}else this._resolverHash[e]=this._buildResolvedAsset({alias:[e],src:e},{})}r[e]=this._resolverHash[e]}),t?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){let t=e[0],r=this._preferredOrder.find(e=>e.params.format.includes(t.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;let t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}_buildResolvedAsset(e,t){let{aliases:r,data:i,loadParser:s,format:o}=t;return(this._basePath||this._rootPath)&&(e.src=(0,n.path).toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=r??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...i||{},...e.data},e.loadParser=s??e.loadParser,e.format=o??e.format??e.src.split(".").pop().split("?").shift().split("#").shift(),e}}a.RETINA_PREFIX=/@([0-9\.]+)x/}),er("kaDu9",function(e,t){C(e.exports,"path",()=>s);var r=et("5m2Qn");function n(e){if("string"!=typeof e)throw TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function i(e){return e.split("?")[0].split("#")[0]}let s={toPosix:e=>e.replace(RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/"),isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),isBlobUrl:e=>e.startsWith("blob:"),hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){n(e),e=this.toPosix(e);let t=/^file:\/\/\//.exec(e);if(t)return t[0];let r=/^[^/:]+:\/{0,2}/.exec(e);return r?r[0]:""},toAbsolute(e,t,o){if(n(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;let a=i(this.toPosix(t??(0,r.DOMAdapter).get().getBaseUrl())),l=i(this.toPosix(o??this.rootname(a)));return(e=this.toPosix(e)).startsWith("/")?s.join(l,e.slice(1)):this.isAbsolute(e)?e:this.join(a,e)},normalize(e){if(n(e),0===e.length)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;e=this.toPosix(e);let t="",r=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));let i=e.endsWith("/");return((e=function(e,t){let r="",n=0,i=-1,s=0,o=-1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else if(47===o)break;else o=47;if(47===o){if(i===a-1||1===s);else if(i!==a-1&&2===s){if(r.length<2||2!==n||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2)){if(r.length>2){let e=r.lastIndexOf("/");if(e!==r.length-1){-1===e?(r="",n=0):n=(r=r.slice(0,e)).length-1-r.lastIndexOf("/"),i=a,s=0;continue}}else if(2===r.length||1===r.length){r="",n=0,i=a,s=0;continue}}t&&(r.length>0?r+="/..":r="..",n=2)}else r.length>0?r+=`/${e.slice(i+1,a)}`:r=e.slice(i+1,a),n=a-i-1;i=a,s=0}else 46===o&&-1!==s?++s:s=-1}return r}(e,!1)).length>0&&i&&(e+="/"),r)?`/${e}`:t+e},isAbsolute(e){return n(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(...e){let t;if(0===e.length)return".";for(let r=0;r<e.length;++r){let i=e[r];if(n(i),i.length>0){if(void 0===t)t=i;else{let n=e[r-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}}return void 0===t?".":this.normalize(t)},dirname(e){if(n(e),0===e.length)return".";let t=(e=this.toPosix(e)).charCodeAt(0),r=47===t,i=-1,s=!0,o=this.getProtocol(e),a=e;e=e.slice(o.length);for(let r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!s){i=r;break}}else s=!1;return -1===i?r?"/":this.isUrl(a)?o+e:o:r&&1===i?"//":o+e.slice(0,i)},rootname(e){n(e);let t="";if(t=(e=this.toPosix(e)).startsWith("/")?"/":this.getProtocol(e),this.isUrl(e)){let r=e.indexOf("/",t.length);(t=-1!==r?e.slice(0,r):e).endsWith("/")||(t+="/")}return t},basename(e,t){let r;n(e),t&&n(t),e=i(this.toPosix(e));let s=0,o=-1,a=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let n=t.length-1,i=-1;for(r=e.length-1;r>=0;--r){let l=e.charCodeAt(r);if(47===l){if(!a){s=r+1;break}}else -1===i&&(a=!1,i=r+1),n>=0&&(l===t.charCodeAt(n)?-1==--n&&(o=r):(n=-1,o=i))}return s===o?o=i:-1===o&&(o=e.length),e.slice(s,o)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!a){s=r+1;break}}else -1===o&&(a=!1,o=r+1);return -1===o?"":e.slice(s,o)},extname(e){n(e),e=i(this.toPosix(e));let t=-1,r=0,s=-1,o=!0,a=0;for(let n=e.length-1;n>=0;--n){let i=e.charCodeAt(n);if(47===i){if(!o){r=n+1;break}continue}-1===s&&(o=!1,s=n+1),46===i?-1===t?t=n:1!==a&&(a=1):-1!==t&&(a=-1)}return -1===t||-1===s||0===a||1===a&&t===s-1&&t===r+1?"":e.slice(t,s)},parse(e){let t;n(e);let r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;let s=(e=i(this.toPosix(e))).charCodeAt(0),o=this.isAbsolute(e);r.root=this.rootname(e),t=o||this.hasProtocol(e)?1:0;let a=-1,l=0,u=-1,c=!0,h=e.length-1,f=0;for(;h>=t;--h){if(47===(s=e.charCodeAt(h))){if(!c){l=h+1;break}continue}-1===u&&(c=!1,u=h+1),46===s?-1===a?a=h:1!==f&&(f=1):-1!==a&&(f=-1)}return -1===a||-1===u||0===f||1===f&&a===u-1&&a===l+1?-1!==u&&(0===l&&o?r.base=r.name=e.slice(1,u):r.base=r.name=e.slice(l,u)):(0===l&&o?(r.name=e.slice(1,a),r.base=e.slice(1,u)):(r.name=e.slice(l,a),r.base=e.slice(l,u)),r.ext=e.slice(a,u)),r.dir=this.dirname(e),r},sep:"/",delimiter:":",joinExtensions:[".html"]}}),er("ahHFV",function(e,t){C(e.exports,"createStringVariations",()=>r);function r(e){let t=e.match(/\{(.*?)\}/g),r=[];if(t){let n=[];t.forEach(e=>{let t=e.substring(1,e.length-1).split(",");n.push(t)}),function e(t,r,n,i,s){let o=r[n];for(let a=0;a<o.length;a++){let l=o[a];n<r.length-1?e(t.replace(i[n],l),r,n+1,i,s):s.push(t.replace(i[n],l))}}(e,n,0,t,r)}else r.push(e);return r}}),er("6BHki",function(e,t){C(e.exports,"isSingleItem",()=>r);let r=e=>!Array.isArray(e)}),er("kY7V1",function(e,t){C(e.exports,"copySearchParams",()=>r);let r=(e,t)=>{let r=t.split("?")[1];return r&&(e+=`?${r}`),e}}),er("2v83S",function(e,t){C(e.exports,"Spritesheet",()=>s);var r=et("soqVu"),n=et("5h88T");let i=class e{constructor(e,t){this.linkedSheets=[],this._texture=e instanceof n.Texture?e:null,this.textureSource=e.source,this.textures={},this.animations={},this.data=t;let r=parseFloat(t.meta.scale);r?(this.resolution=r,e.source.resolution=this.resolution):this.resolution=e.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let i=t,s=e.BATCH_SIZE;for(;i-t<s&&i<this._frameKeys.length;){let e=this._frameKeys[i],t=this._frames[e],s=t.frame;if(s){let i=null,o=null,a=!1!==t.trimmed&&t.sourceSize?t.sourceSize:t.frame,l=new r.Rectangle(0,0,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution);i=t.rotated?new r.Rectangle(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new r.Rectangle(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==t.trimmed&&t.spriteSourceSize&&(o=new r.Rectangle(Math.floor(t.spriteSourceSize.x)/this.resolution,Math.floor(t.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[e]=new n.Texture({source:this.textureSource,frame:i,orig:l,trim:o,rotate:t.rotated?2:0,defaultAnchor:t.anchor,defaultBorders:t.borders,label:e.toString()})}i++}}_processAnimations(){let e=this.data.animations||{};for(let t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){let n=e[t][r];this.animations[t].push(this.textures[n])}}}_parseComplete(){let e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*e.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(let e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};i.BATCH_SIZE=1e3;let s=i}),er("hVAf0",function(e,t){C(e.exports,"AbstractRenderer",()=>h);var r=et("AHTcQ"),n=et("lR3Ev"),i=et("dczvg"),s=et("eX50w"),o=et("eoEUf"),a=et("lvLqH"),l=et("gpXaq");let u=["init","destroy","contextChange","resolutionChange","reset","renderEnd","renderStart","render","update","postrender","prerender"],c=class e extends w(l){constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name;let t=[...u,...e.runners??[]];this._addRunners(...t),this._addSystems(e.systems),this._addPipes(e.renderPipes,e.renderPipeAdaptors),this._unsafeEvalCheck()}async init(t={}){for(let e in this._systemsHash)t={...this._systemsHash[e].constructor.defaultOptions,...t};t={...e.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let e=0;e<this.runners.init.items.length;e++)await this.runners.init.items[e].init(t);this._initOptions=t}render(e,t){let i=e;if(i instanceof n.Container&&(i={container:i},t&&((0,s.deprecation)(s.v8_0_0,"passing a second argument is deprecated, please use render options instead"),i.target=t.renderTexture)),i.target||(i.target=this.view.renderTarget),i.target===this.view.renderTarget&&(this._lastObjectRendered=i.container,i.clearColor=this.background.colorRgba),i.clearColor){let e=Array.isArray(i.clearColor)&&4===i.clearColor.length;i.clearColor=e?i.clearColor:(0,r.Color).shared.setValue(i.clearColor).toArray()}i.transform||(i.container.updateLocalTransform(),i.transform=i.container.localTransform),this.runners.prerender.emit(i),this.runners.renderStart.emit(i),this.runners.render.emit(i),this.runners.renderEnd.emit(i),this.runners.postrender.emit(i)}resize(e,t,r){this.view.resize(e,t,r),this.emit("resize",this.view.screen.width,this.view.screen.height)}clear(e={}){e.target||(e.target=this.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=o.CLEAR.ALL);let{clear:t,clearColor:n,target:i}=e;(0,r.Color).shared.setValue(n??this.background.colorRgba),this.renderTarget.clear(i,t,(0,r.Color).shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(e=>{this.runners[e]=new a.SystemRunner(e)})}_addSystems(e){let t;for(t in e){let r=e[t];this._addSystem(r.value,r.name)}}_addSystem(e,t){let r=new e(this);if(this[t])throw Error(`Whoops! The name "${t}" is already in use`);for(let e in this[t]=r,this._systemsHash[t]=r,this.runners)this.runners[e].add(r);return this}_addPipes(e,t){let r=t.reduce((e,t)=>(e[t.name]=t.value,e),{});e.forEach(e=>{let t=e.value,n=e.name,i=r[n];this.renderPipes[n]=new t(this,i?new i:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!(0,i.unsafeEvalSupported)())throw Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}};c.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let h=c}),er("dczvg",function(e,t){let r;function n(){if("boolean"==typeof r)return r;try{let e=Function("param1","param2","param3","return param1[param2] === param3;");r=!0===e({a:"b"},"a","b")}catch(e){r=!1}return r}C(e.exports,"unsafeEvalSupported",()=>n)}),er("eoEUf",function(e,t){C(e.exports,"CLEAR",()=>n);var r,n=((r=n||{})[r.NONE=0]="NONE",r[r.COLOR=16384]="COLOR",r[r.STENCIL=1024]="STENCIL",r[r.DEPTH=256]="DEPTH",r[r.COLOR_DEPTH=16640]="COLOR_DEPTH",r[r.COLOR_STENCIL=17408]="COLOR_STENCIL",r[r.DEPTH_STENCIL=1280]="DEPTH_STENCIL",r[r.ALL=17664]="ALL",r)}),er("lvLqH",function(e,t){C(e.exports,"SystemRunner",()=>r);class r{constructor(e){this.items=[],this._name=e}emit(e,t,r,n,i,s,o,a){let{name:l,items:u}=this;for(let c=0,h=u.length;c<h;c++)u[c][l](e,t,r,n,i,s,o,a);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){let t=this.items.indexOf(e);return -1!==t&&this.items.splice(t,1),this}contains(e){return -1!==this.items.indexOf(e)}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}}),er("bruUF",function(e,t){var r=et("jdQ1F");e.exports=Promise.all([r("2HcEx"),r("7NZcv"),r("9grxE")]).then(()=>et("b9J29"))}),er("7N9qy",function(e,t){var r=et("jdQ1F");e.exports=Promise.all([r("2HcEx"),r("7NZcv"),r("iCVng")]).then(()=>et("e5SpK"))}),er("hTvsP",function(e,t){C(e.exports,"GraphicsContext",()=>g);var r=et("gpXaq"),n=et("AHTcQ"),i=et("dNaJE"),s=et("2NXni"),o=et("5h88T"),a=et("l80qL"),l=et("eX50w"),u=et("ggeMF"),c=et("awDzm"),h=et("hFJzr"),f=et("jwZTp");let d=new s.Point,p=new i.Matrix,m=class e extends w(r){constructor(){super(...arguments),this.uid=(0,a.uid)("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new c.GraphicsPath,this._transform=new i.Matrix,this._fillStyle={...e.defaultFillStyle},this._strokeStyle={...e.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new u.Bounds,this._boundsDirty=!0}clone(){let t=new e;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=(0,f.convertFillInputToFillStyle)(t,e.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=(0,f.convertFillInputToFillStyle)(t,e.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=(0,f.convertFillInputToFillStyle)(t,e.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=(0,f.convertFillInputToFillStyle)(t,e.defaultStrokeStyle),this}texture(e,t,r,i,s,o){return this.instructions.push({action:"texture",data:{image:e,dx:r||0,dy:i||0,dw:s||e.frame.width,dh:o||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:t?(0,n.Color).shared.setValue(t).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new c.GraphicsPath,this}fill(t,r){let n;let i=this.instructions[this.instructions.length-1];return(n=0===this._tick&&i&&"stroke"===i.action?i.data.path:this._activePath.clone())&&(null!=t&&(void 0!==r&&"number"==typeof t&&((0,l.deprecation)(l.v8_0_0,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:r}),this._fillStyle=(0,f.convertFillInputToFillStyle)(t,e.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:n}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0),this}_initNextPathLocation(){let{x:e,y:t}=this._activePath.getLastPoint(s.Point.shared);this._activePath.clear(),this._activePath.moveTo(e,t)}stroke(t){let r;let n=this.instructions[this.instructions.length-1];return(r=0===this._tick&&n&&"fill"===n.action?n.data.path:this._activePath.clone())&&(null!=t&&(this._strokeStyle=(0,f.convertFillInputToFillStyle)(t,e.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0),this}cut(){for(let e=0;e<2;e++){let t=this.instructions[this.instructions.length-1-e],r=this._activePath.clone();if(t&&("stroke"===t.action||"fill"===t.action)){if(t.data.hole)t.data.hole.addPath(r);else{t.data.hole=r;break}}}return this._initNextPathLocation(),this}arc(e,t,r,n,i,s){this._tick++;let o=this._transform;return this._activePath.arc(o.a*e+o.c*t+o.tx,o.b*e+o.d*t+o.ty,r,n,i,s),this}arcTo(e,t,r,n,i){this._tick++;let s=this._transform;return this._activePath.arcTo(s.a*e+s.c*t+s.tx,s.b*e+s.d*t+s.ty,s.a*r+s.c*n+s.tx,s.b*r+s.d*n+s.ty,i),this}arcToSvg(e,t,r,n,i,s,o){this._tick++;let a=this._transform;return this._activePath.arcToSvg(e,t,r,n,i,a.a*s+a.c*o+a.tx,a.b*s+a.d*o+a.ty),this}bezierCurveTo(e,t,r,n,i,s,o){this._tick++;let a=this._transform;return this._activePath.bezierCurveTo(a.a*e+a.c*t+a.tx,a.b*e+a.d*t+a.ty,a.a*r+a.c*n+a.tx,a.b*r+a.d*n+a.ty,a.a*i+a.c*s+a.tx,a.b*i+a.d*s+a.ty,o),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(e,t,r,n){return this._tick++,this._activePath.ellipse(e,t,r,n,this._transform.clone()),this}circle(e,t,r){return this._tick++,this._activePath.circle(e,t,r,this._transform.clone()),this}path(e){return this._tick++,this._activePath.addPath(e,this._transform.clone()),this}lineTo(e,t){this._tick++;let r=this._transform;return this._activePath.lineTo(r.a*e+r.c*t+r.tx,r.b*e+r.d*t+r.ty),this}moveTo(e,t){this._tick++;let r=this._transform,n=this._activePath.instructions,i=r.a*e+r.c*t+r.tx,s=r.b*e+r.d*t+r.ty;return 1===n.length&&"moveTo"===n[0].action?(n[0].data[0]=i,n[0].data[1]=s):this._activePath.moveTo(i,s),this}quadraticCurveTo(e,t,r,n,i){this._tick++;let s=this._transform;return this._activePath.quadraticCurveTo(s.a*e+s.c*t+s.tx,s.b*e+s.d*t+s.ty,s.a*r+s.c*n+s.tx,s.b*r+s.d*n+s.ty,i),this}rect(e,t,r,n){return this._tick++,this._activePath.rect(e,t,r,n,this._transform.clone()),this}roundRect(e,t,r,n,i){return this._tick++,this._activePath.roundRect(e,t,r,n,i,this._transform.clone()),this}poly(e,t){return this._tick++,this._activePath.poly(e,t,this._transform.clone()),this}regularPoly(e,t,r,n,i=0,s){return this._tick++,this._activePath.regularPoly(e,t,r,n,i,s),this}roundPoly(e,t,r,n,i,s){return this._tick++,this._activePath.roundPoly(e,t,r,n,i,s),this}roundShape(e,t,r,n){return this._tick++,this._activePath.roundShape(e,t,r,n),this}filletRect(e,t,r,n,i){return this._tick++,this._activePath.filletRect(e,t,r,n,i),this}chamferRect(e,t,r,n,i,s){return this._tick++,this._activePath.chamferRect(e,t,r,n,i,s),this}star(e,t,r,n,i=0,s=0){return this._tick++,this._activePath.star(e,t,r,n,i,s,this._transform.clone()),this}svg(e){return this._tick++,(0,h.SVGParser)(e,this),this}restore(){let e=this._stateStack.pop();return e&&(this._transform=e.transform,this._fillStyle=e.fillStyle,this._strokeStyle=e.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(e){return this._transform.rotate(e),this}scale(e,t=e){return this._transform.scale(e,t),this}setTransform(e,t,r,n,s,o){return e instanceof i.Matrix?this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty):this._transform.set(e,t,r,n,s,o),this}transform(e,t,r,n,s,o){return e instanceof i.Matrix?this._transform.append(e):(p.set(e,t,r,n,s,o),this._transform.append(p)),this}translate(e,t=e){return this._transform.translate(e,t),this}clear(){return this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;let e=this._bounds;e.clear();for(let t=0;t<this.instructions.length;t++){let r=this.instructions[t],n=r.action;if("fill"===n){let t=r.data;e.addBounds(t.path.bounds)}else if("texture"===n){let t=r.data;e.addFrame(t.dx,t.dy,t.dx+t.dw,t.dy+t.dh,t.transform)}if("stroke"===n){let t=r.data,n=t.style.width/2,i=t.path.bounds;e.addFrame(i.minX-n,i.minY-n,i.maxX+n,i.maxY+n)}}return e}containsPoint(e){if(!this.bounds.containsPoint(e.x,e.y))return!1;let t=this.instructions,r=!1;for(let n=0;n<t.length;n++){let i=t[n],s=i.data,o=s.path;if(!i.action||!o)continue;let a=s.style,l=o.shapePath.shapePrimitives;for(let t=0;t<l.length;t++){let n=l[t].shape;if(!a||!n)continue;let o=l[t].transform,u=o?o.applyInverse(e,d):e;r="fill"===i.action?n.contains(u.x,u.y):n.strokeContains(u.x,u.y,a.width);let c=s.hole;if(c){let e=c.shapePath?.shapePrimitives;if(e)for(let t=0;t<e.length;t++)e[t].shape.contains(u.x,u.y)&&(r=!1)}if(r)return!0}}return r}destroy(e=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),"boolean"==typeof e?e:e?.texture){let t="boolean"==typeof e?e:e?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(t),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(t)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};m.defaultFillStyle={color:16777215,alpha:1,texture:o.Texture.WHITE,matrix:null,fill:null},m.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:o.Texture.WHITE,matrix:null,fill:null};let g=m}),er("awDzm",function(e,t){C(e.exports,"GraphicsPath",()=>a);var r=et("2NXni"),n=et("l80qL"),i=et("8CF4q"),s=et("98ho4"),o=et("7rqBZ");class a{constructor(e){this.instructions=[],this.uid=(0,n.uid)("graphicsPath"),this._dirty=!0,"string"==typeof e?(0,s.SVGToGraphicsPath)(e,this):this.instructions=e?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new o.ShapePath(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,t){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,t]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,t,n,i,s){let o=this.instructions[this.instructions.length-1],a=this.getLastPoint(r.Point.shared),l=0,u=0;if(o&&"bezierCurveTo"===o.action){l=o.data[2],u=o.data[3];let e=a.x,t=a.y;l=e+(e-l),u=t+(t-u)}else l=a.x,u=a.y;return this.instructions.push({action:"bezierCurveTo",data:[l,u,e,t,n,i,s]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,t,n){let i=this.instructions[this.instructions.length-1],s=this.getLastPoint(r.Point.shared),o=0,a=0;if(i&&"quadraticCurveTo"===i.action){o=i.data[0],a=i.data[1];let e=s.x,t=s.y;o=e+(e-o),a=t+(t-a)}else o=s.x,a=s.y;return this.instructions.push({action:"quadraticCurveTo",data:[o,a,e,t,n]}),this._dirty=!0,this}rect(e,t,r,n,i){return this.instructions.push({action:"rect",data:[e,t,r,n,i]}),this._dirty=!0,this}circle(e,t,r,n){return this.instructions.push({action:"circle",data:[e,t,r,n]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(...e){return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(...e){return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(...e){return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(...e){return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(...e){return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(e,t,r,n,i,s,o){i=i||n/2;let a=-1*Math.PI/2+s,l=2*r,u=2*Math.PI/l,c=[];for(let r=0;r<l;r++){let s=r%2?i:n,o=r*u+a;c.push(e+s*Math.cos(o),t+s*Math.sin(o))}return this.poly(c,!0,o),this}clone(e=!1){let t=new a;if(e)for(let e=0;e<this.instructions.length;e++){let r=this.instructions[e];t.instructions.push({action:r.action,data:r.data.slice()})}else t.instructions=this.instructions.slice();return t}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;let t=e.a,r=e.b,n=e.c,s=e.d,o=e.tx,a=e.ty,u=0,c=0,h=0,f=0,d=0,p=0,m=0,g=0;for(let v=0;v<this.instructions.length;v++){let y=this.instructions[v],x=y.data;switch(y.action){case"moveTo":case"lineTo":u=x[0],c=x[1],x[0]=t*u+n*c+o,x[1]=r*u+s*c+a;break;case"bezierCurveTo":h=x[0],f=x[1],d=x[2],p=x[3],u=x[4],c=x[5],x[0]=t*h+n*f+o,x[1]=r*h+s*f+a,x[2]=t*d+n*p+o,x[3]=r*d+s*p+a,x[4]=t*u+n*c+o,x[5]=r*u+s*c+a;break;case"quadraticCurveTo":h=x[0],f=x[1],u=x[2],c=x[3],x[0]=t*h+n*f+o,x[1]=r*h+s*f+a,x[2]=t*u+n*c+o,x[3]=r*u+s*c+a;break;case"arcToSvg":u=x[5],c=x[6],m=x[0],g=x[1],x[0]=t*m+n*g,x[1]=r*m+s*g,x[5]=t*u+n*c+o,x[6]=r*u+s*c+a;break;case"circle":x[4]=l(x[3],e);break;case"rect":x[4]=l(x[4],e);break;case"ellipse":x[8]=l(x[8],e);break;case"roundRect":x[5]=l(x[5],e);break;case"addPath":x[0].transform(e);break;case"poly":x[2]=l(x[2],e);break;default:(0,i.warn)("unknown transform action",y.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(e){let t=this.instructions.length-1,r=this.instructions[t];if(!r)return e.x=0,e.y=0,e;for(;"closePath"===r.action;){if(--t<0)return e.x=0,e.y=0,e;r=this.instructions[t]}switch(r.action){case"moveTo":case"lineTo":e.x=r.data[0],e.y=r.data[1];break;case"quadraticCurveTo":e.x=r.data[2],e.y=r.data[3];break;case"bezierCurveTo":e.x=r.data[4],e.y=r.data[5];break;case"arc":case"arcToSvg":e.x=r.data[5],e.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(e)}return e}}function l(e,t){return e?e.prepend(t):t.clone()}}),er("98ho4",function(e,t){C(e.exports,"SVGToGraphicsPath",()=>i);var r=et("eJJJX"),n=et("8CF4q");function i(e,t){let i=w(r)(e),s=[],o=null,a=0,l=0;for(let e=0;e<i.length;e++){let r=i[e],u=r[0];switch(u){case"M":a=r[1],l=r[2],t.moveTo(a,l);break;case"m":a+=r[1],l+=r[2],t.moveTo(a,l);break;case"H":a=r[1],t.lineTo(a,l);break;case"h":a+=r[1],t.lineTo(a,l);break;case"V":l=r[1],t.lineTo(a,l);break;case"v":l+=r[1],t.lineTo(a,l);break;case"L":a=r[1],l=r[2],t.lineTo(a,l);break;case"l":a+=r[1],l+=r[2],t.lineTo(a,l);break;case"C":a=r[5],l=r[6],t.bezierCurveTo(r[1],r[2],r[3],r[4],a,l);break;case"c":t.bezierCurveTo(a+r[1],l+r[2],a+r[3],l+r[4],a+r[5],l+r[6]),a+=r[5],l+=r[6];break;case"S":a=r[3],l=r[4],t.bezierCurveToShort(r[1],r[2],a,l);break;case"s":t.bezierCurveToShort(a+r[1],l+r[2],a+r[3],l+r[4]),a+=r[3],l+=r[4];break;case"Q":a=r[3],l=r[4],t.quadraticCurveTo(r[1],r[2],a,l);break;case"q":t.quadraticCurveTo(a+r[1],l+r[2],a+r[3],l+r[4]),a+=r[3],l+=r[4];break;case"T":a=r[1],l=r[2],t.quadraticCurveToShort(a,l);break;case"t":a+=r[1],l+=r[2],t.quadraticCurveToShort(a,l);break;case"A":a=r[6],l=r[7],t.arcToSvg(r[1],r[2],r[3],r[4],r[5],a,l);break;case"a":a+=r[6],l+=r[7],t.arcToSvg(r[1],r[2],r[3],r[4],r[5],a,l);break;case"Z":case"z":t.closePath(),s.length>0&&((o=s.pop())?(a=o.startX,l=o.startY):(a=0,l=0)),o=null;break;default:(0,n.warn)(`Unknown SVG path command: ${u}`)}"Z"!==u&&"z"!==u&&null===o&&(o={startX:a,startY:l},s.push(o))}return t}}),er("eJJJX",function(e,t){e.exports=function(e){var t=[];return e.replace(n,function(e,n,s){var o,a=n.toLowerCase();for(s=(o=s.match(i))?o.map(Number):[],"m"==a&&s.length>2&&(t.push([n].concat(s.splice(0,2))),a="l",n="m"==n?"l":"L");;){if(s.length==r[a])return s.unshift(n),t.push(s);if(s.length<r[a])throw Error("malformed path data");t.push([n].concat(s.splice(0,r[a])))}}),t};var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},n=/([astvzqmhlc])([^astvzqmhlc]*)/ig,i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig}),er("7rqBZ",function(e,t){C(e.exports,"ShapePath",()=>m);var r=et("jaTjj"),n=et("asIJc"),i=et("67pKq"),s=et("soqVu"),o=et("guUt8"),a=et("ggeMF"),l=et("67FNK"),u=et("hYods"),c=et("dMnI7"),h=et("1DEaT"),f=et("j5RWP"),d=et("5fPVY");let p=new s.Rectangle;class m{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new a.Bounds,this._graphicsPath2D=e}moveTo(e,t){return this.startPoly(e,t),this}lineTo(e,t){this._ensurePoly();let r=this._currentPoly.points,n=r[r.length-2],i=r[r.length-1];return(n!==e||i!==t)&&r.push(e,t),this}arc(e,t,r,n,i,s){this._ensurePoly(!1);let o=this._currentPoly.points;return(0,c.buildArc)(o,e,t,r,n,i,s),this}arcTo(e,t,r,n,i){this._ensurePoly();let s=this._currentPoly.points;return(0,h.buildArcTo)(s,e,t,r,n,i),this}arcToSvg(e,t,r,n,i,s,o){let a=this._currentPoly.points;return(0,f.buildArcToSvg)(a,this._currentPoly.lastX,this._currentPoly.lastY,s,o,e,t,r,n,i),this}bezierCurveTo(e,t,r,n,i,s,o){this._ensurePoly();let a=this._currentPoly;return(0,l.buildAdaptiveBezier)(this._currentPoly.points,a.lastX,a.lastY,e,t,r,n,i,s,o),this}quadraticCurveTo(e,t,r,n,i){this._ensurePoly();let s=this._currentPoly;return(0,u.buildAdaptiveQuadratic)(this._currentPoly.points,s.lastX,s.lastY,e,t,r,n,i),this}closePath(){return this.endPoly(!0),this}addPath(e,t){this.endPoly(),t&&!t.isIdentity()&&(e=e.clone(!0)).transform(t);for(let t=0;t<e.instructions.length;t++){let r=e.instructions[t];this[r.action](...r.data)}return this}finish(e=!1){this.endPoly(e)}rect(e,t,r,n,i){return this.drawShape(new s.Rectangle(e,t,r,n),i),this}circle(e,t,n,i){return this.drawShape(new r.Circle(e,t,n),i),this}poly(e,t,r){let n=new i.Polygon(e);return n.closePath=t,this.drawShape(n,r),this}regularPoly(e,t,r,n,i=0,s){let o=-1*Math.PI/2+i,a=2*Math.PI/(n=Math.max(0|n,3)),l=[];for(let i=0;i<n;i++){let n=i*a+o;l.push(e+r*Math.cos(n),t+r*Math.sin(n))}return this.poly(l,!0,s),this}roundPoly(e,t,r,n,i,s=0,o){if(n=Math.max(0|n,3),i<=0)return this.regularPoly(e,t,r,n,s);i=Math.min(i,r*Math.sin(Math.PI/n)-.001);let a=-1*Math.PI/2+s,l=2*Math.PI/n,u=(n-2)*Math.PI/n/2;for(let s=0;s<n;s++){let n=s*l+a,c=e+r*Math.cos(n),h=t+r*Math.sin(n),f=n+Math.PI+u,d=n-Math.PI-u,p=c+i*Math.cos(f),m=h+i*Math.sin(f),g=c+i*Math.cos(d),v=h+i*Math.sin(d);0===s?this.moveTo(p,m):this.lineTo(p,m),this.quadraticCurveTo(c,h,g,v,o)}return this.closePath()}roundShape(e,t,r=!1,n){return e.length<3?this:(r?(0,d.roundedShapeQuadraticCurve)(this,e,t,n):(0,d.roundedShapeArc)(this,e,t),this.closePath())}filletRect(e,t,r,n,i){if(0===i)return this.rect(e,t,r,n);let s=Math.min(r,n)/2,o=Math.min(s,Math.max(-s,i)),a=e+r,l=t+n,u=o<0?-o:0,c=Math.abs(o);return this.moveTo(e,t+c).arcTo(e+u,t+u,e+c,t,c).lineTo(a-c,t).arcTo(a-u,t+u,a,t+c,c).lineTo(a,l-c).arcTo(a-u,l-u,e+r-c,l,c).lineTo(e+c,l).arcTo(e+u,l-u,e,l-c,c).closePath()}chamferRect(e,t,r,n,i,s){if(i<=0)return this.rect(e,t,r,n);let o=Math.min(i,Math.min(r,n)/2),a=e+r,l=t+n,u=[e+o,t,a-o,t,a,t+o,a,l-o,a-o,l,e+o,l,e,l-o,e,t+o];for(let e=u.length-1;e>=2;e-=2)u[e]===u[e-2]&&u[e-1]===u[e-3]&&u.splice(e-1,2);return this.poly(u,!0,s)}ellipse(e,t,r,i,s){return this.drawShape(new n.Ellipse(e,t,r,i),s),this}roundRect(e,t,r,n,i,s){return this.drawShape(new o.RoundedRectangle(e,t,r,n,i),s),this}drawShape(e,t){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:t}),this}startPoly(e,t){let r=this._currentPoly;return r&&this.endPoly(),(r=new i.Polygon).points.push(e,t),this._currentPoly=r,this}endPoly(e=!1){let t=this._currentPoly;return t&&t.points.length>2&&(t.closePath=e,this.shapePrimitives.push({shape:t})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new i.Polygon,e)){let e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let t=e.shape.x,r=e.shape.y;if(!e.transform.isIdentity()){let n=e.transform,i=t;t=n.a*t+n.c*r+n.tx,r=n.b*i+n.d*r+n.ty}this._currentPoly.points.push(t,r)}else this._currentPoly.points.push(0,0)}}buildPath(){let e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let t=0;t<e.instructions.length;t++){let r=e.instructions[t];this[r.action](...r.data)}this.finish()}get bounds(){let e=this._bounds;e.clear();let t=this.shapePrimitives;for(let r=0;r<t.length;r++){let n=t[r],i=n.shape.getBounds(p);n.transform?e.addRect(i,n.transform):e.addRect(i)}return e}}}),er("jaTjj",function(e,t){C(e.exports,"Circle",()=>n);var r=et("soqVu");class n{constructor(e=0,t=0,r=0){this.type="circle",this.x=e,this.y=t,this.radius=r}clone(){return new n(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;let r=this.radius*this.radius,n=this.x-e,i=this.y-t;return n*=n,i*=i,n+i<=r}strokeContains(e,t,r){if(0===this.radius)return!1;let n=this.x-e,i=this.y-t,s=this.radius,o=r/2,a=Math.sqrt(n*n+i*i);return a<s+o&&a>s-o}getBounds(e){return(e=e||new r.Rectangle).x=this.x-this.radius,e.y=this.y-this.radius,e.width=2*this.radius,e.height=2*this.radius,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}}),er("asIJc",function(e,t){C(e.exports,"Ellipse",()=>n);var r=et("soqVu");class n{constructor(e=0,t=0,r=0,n=0){this.type="ellipse",this.x=e,this.y=t,this.halfWidth=r,this.halfHeight=n}clone(){return new n(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,t){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(e-this.x)/this.halfWidth,n=(t-this.y)/this.halfHeight;return r*=r,n*=n,r+n<=1}strokeContains(e,t,r){let{halfWidth:n,halfHeight:i}=this;if(n<=0||i<=0)return!1;let s=r/2,o=n-s,a=i-s,l=n+s,u=i+s,c=e-this.x,h=t-this.y;return c*c/(o*o)+h*h/(a*a)>1&&c*c/(l*l)+h*h/(u*u)<=1}getBounds(){return new r.Rectangle(this.x-this.halfWidth,this.y-this.halfHeight,2*this.halfWidth,2*this.halfHeight)}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}}),er("67pKq",function(e,t){C(e.exports,"Polygon",()=>i);var r=et("3qFiz"),n=et("soqVu");class i{constructor(...e){this.type="polygon";let t=Array.isArray(e[0])?e[0]:e;if("number"!=typeof t[0]){let e=[];for(let r=0,n=t.length;r<n;r++)e.push(t[r].x,t[r].y);t=e}this.points=t,this.closePath=!0}clone(){let e=new i(this.points.slice());return e.closePath=this.closePath,e}contains(e,t){let r=!1,n=this.points.length/2;for(let i=0,s=n-1;i<n;s=i++){let n=this.points[2*i],o=this.points[2*i+1],a=this.points[2*s],l=this.points[2*s+1];o>t!=l>t&&e<(t-o)/(l-o)*(a-n)+n&&(r=!r)}return r}strokeContains(e,t,n){let i=n/2,s=i*i,{points:o}=this;for(let n=0;n<o.length;n+=2){let i=o[n],a=o[n+1],l=o[(n+2)%o.length],u=o[(n+3)%o.length];if((0,r.squaredDistanceToLineSegment)(e,t,i,a,l,u)<=s)return!0}return!1}getBounds(e){e=e||new n.Rectangle;let t=this.points,r=1/0,i=-1/0,s=1/0,o=-1/0;for(let e=0,n=t.length;e<n;e+=2){let n=t[e],a=t[e+1];r=n<r?n:r,i=n>i?n:i,s=a<s?a:s,o=a>o?a:o}return e.x=r,e.width=i-r,e.y=s,e.height=o-s,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((e,t)=>`${e}, ${t}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}}),er("3qFiz",function(e,t){C(e.exports,"squaredDistanceToLineSegment",()=>r);function r(e,t,r,n,i,s){let o,a;let l=i-r,u=s-n,c=l*l+u*u,h=-1;0!==c&&(h=((e-r)*l+(t-n)*u)/c),h<0?(o=r,a=n):h>1?(o=i,a=s):(o=r+h*l,a=n+h*u);let f=e-o,d=t-a;return f*f+d*d}}),er("guUt8",function(e,t){C(e.exports,"RoundedRectangle",()=>i);var r=et("soqVu");let n=(e,t,r,n,i,s)=>{let o=e-r,a=t-n,l=Math.sqrt(o*o+a*a);return l>=i-s&&l<=i+s};class i{constructor(e=0,t=0,r=0,n=0,i=20){this.type="roundedRectangle",this.x=e,this.y=t,this.width=r,this.height=n,this.radius=i}getBounds(e){return(e=e||new r.Rectangle).x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new i(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){let r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let n=e-(this.x+r),i=t-(this.y+r),s=r*r;if(n*n+i*i<=s||(n=e-(this.x+this.width-r))*n+i*i<=s||n*n+(i=t-(this.y+this.height-r))*i<=s||(n=e-(this.x+r))*n+i*i<=s)return!0}return!1}strokeContains(e,t,r){let{x:i,y:s,width:o,height:a,radius:l}=this,u=r/2,c=i+l,h=s+l,f=o-2*l,d=a-2*l,p=i+o,m=s+a;return(e>=i-u&&e<=i+u||e>=p-u&&e<=p+u)&&t>=h&&t<=h+d||(t>=s-u&&t<=s+u||t>=m-u&&t<=m+u)&&e>=c&&e<=c+f||e<c&&t<h&&n(e,t,c,h,l,u)||e>p-l&&t<h&&n(e,t,p-l,h,l,u)||e>p-l&&t>m-l&&n(e,t,p-l,m-l,l,u)||e<c&&t>m-l&&n(e,t,c,m-l,l,u)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}}),er("67FNK",function(e,t){C(e.exports,"buildAdaptiveBezier",()=>n);var r=et("bBCDe");function n(e,t,n,i,s,o,a,l,u,c){let h=(1-Math.min(.99,Math.max(0,c??r.GraphicsContextSystem.defaultOptions.bezierSmoothness)))/1;return function e(t,r,n,i,s,o,a,l,u,c,h){if(h>8)return;let f=(t+n)/2,d=(r+i)/2,p=(n+s)/2,m=(i+o)/2,g=(s+a)/2,v=(o+l)/2,y=(f+p)/2,x=(d+m)/2,b=(p+g)/2,_=(m+v)/2,S=(y+b)/2,C=(x+_)/2;if(h>0){let e=a-t,h=l-r,f=Math.abs((n-a)*h-(i-l)*e),d=Math.abs((s-a)*h-(o-l)*e);if(f>11920929e-14&&d>11920929e-14){if((f+d)*(f+d)<=c*(e*e+h*h)){u.push(S,C);return}}else if(f>11920929e-14){if(f*f<=c*(e*e+h*h)){u.push(S,C);return}}else if(d>11920929e-14){if(d*d<=c*(e*e+h*h)){u.push(S,C);return}}else if((e=S-(t+a)/2)*e+(h=C-(r+l)/2)*h<=c){u.push(S,C);return}}e(t,r,f,d,y,x,S,C,u,c,h+1),e(S,C,b,_,g,v,a,l,u,c,h+1)}(t,n,i,s,o,a,l,u,e,h*=h,0),e.push(l,u),e}}),er("bBCDe",function(e,t){C(e.exports,"GraphicsContextSystem",()=>f);var r=et("eVz1R"),n=et("h1qkv"),i=et("9q6W4"),s=et("gC5Pa"),o=et("vdXhX"),a=et("e98Fy"),l=et("03aVk");class u{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class c{constructor(){this.geometry=new n.BatchGeometry,this.instructions=new o.InstructionSet}init(){this.instructions.reset()}}let h=class e{constructor(){this._activeBatchers=[],this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._needsContextNeedsRebuild=[]}init(t){e.defaultOptions.bezierSmoothness=t?.bezierSmoothness??e.defaultOptions.bezierSmoothness}prerender(){this._returnActiveBatchers()}getContextRenderData(e){return this._graphicsDataContextHash[e.uid]||this._initContextRenderData(e)}updateGpuContext(e){let t=this._gpuContextHash[e.uid]||this._initContext(e);if(e.dirty){t?this._cleanGraphicsContextData(e):t=this._initContext(e),(0,l.buildContextBatches)(e,t);let r=e.batchMode;e.customShader||"no-batch"===r?t.isBatchable=!1:"auto"===r&&(t.isBatchable=t.geometryData.vertices.length<400),e.dirty=!1}return t}getGpuContext(e){return this._gpuContextHash[e.uid]||this._initContext(e)}_returnActiveBatchers(){for(let e=0;e<this._activeBatchers.length;e++)(0,a.BigPool).return(this._activeBatchers[e]);this._activeBatchers.length=0}_initContextRenderData(e){let t=(0,a.BigPool).get(c),{batches:r,geometryData:n}=this._gpuContextHash[e.uid],o=n.vertices.length,l=n.indices.length;for(let e=0;e<r.length;e++)r[e].applyTransform=!1;let u=(0,a.BigPool).get(s.Batcher);this._activeBatchers.push(u),u.ensureAttributeBuffer(o),u.ensureIndexBuffer(l),u.begin();for(let e=0;e<r.length;e++){let t=r[e];u.add(t)}u.finish(t.instructions);let h=t.geometry;h.indexBuffer.setDataWithSize(u.indexBuffer,u.indexSize,!0),h.buffers[0].setDataWithSize(u.attributeBuffer.float32View,u.attributeSize,!0);let f=u.batches;for(let e=0;e<f.length;e++){let t=f[e];t.bindGroup=(0,i.getTextureBatchBindGroup)(t.textures.textures,t.textures.count)}return this._graphicsDataContextHash[e.uid]=t,t}_initContext(e){let t=new u;return this._gpuContextHash[e.uid]=t,e.on("update",this.onGraphicsContextUpdate,this),e.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]}onGraphicsContextUpdate(e){this._needsContextNeedsRebuild.push(e)}onGraphicsContextDestroy(e){this._cleanGraphicsContextData(e),e.off("update",this.onGraphicsContextUpdate,this),e.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]=null}_cleanGraphicsContextData(e){let t=this._gpuContextHash[e.uid];!t.isBatchable&&this._graphicsDataContextHash[e.uid]&&((0,a.BigPool).return(this.getContextRenderData(e)),this._graphicsDataContextHash[e.uid]=null),t.batches&&t.batches.forEach(e=>{(0,a.BigPool).return(e)})}destroy(){for(let e of this._needsContextNeedsRebuild)this._gpuContextHash[e.uid]&&this.onGraphicsContextDestroy(e);this._needsContextNeedsRebuild.length=0}};h.extension={type:[r.ExtensionType.WebGLSystem,r.ExtensionType.WebGPUSystem,r.ExtensionType.CanvasSystem],name:"graphicsContext"},h.defaultOptions={bezierSmoothness:.5};let f=h}),er("h1qkv",function(e,t){C(e.exports,"BatchGeometry",()=>a);var r=et("2qhsM"),n=et("cnPar"),i=et("kFbJv");let s=new Float32Array(1),o=new Uint32Array(1);class a extends i.Geometry{constructor(){let e=new r.Buffer({data:s,label:"attribute-batch-buffer",usage:n.BufferUsage.VERTEX|n.BufferUsage.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:24,offset:0,location:1},aUV:{buffer:e,format:"float32x2",stride:24,offset:8,location:3},aColor:{buffer:e,format:"unorm8x4",stride:24,offset:16,location:0},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:24,offset:20,location:2}},indexBuffer:new r.Buffer({data:o,label:"index-batch-buffer",usage:n.BufferUsage.INDEX|n.BufferUsage.COPY_DST,shrinkToFit:!1})})}}}),er("2qhsM",function(e,t){C(e.exports,"Buffer",()=>s);var r=et("gpXaq"),n=et("l80qL"),i=et("cnPar");class s extends w(r){constructor(e){let{data:t,size:r}=e,{usage:i,label:s,shrinkToFit:o}=e;super(),this.uid=(0,n.uid)("buffer"),this._resourceType="buffer",this._resourceId=(0,n.uid)("resource"),this._touched=0,this._updateID=1,this.shrinkToFit=!0,t instanceof Array&&(t=new Float32Array(t)),this._data=t,r=r??t?.byteLength;let a=!!t;this.descriptor={size:r,usage:i,mappedAtCreation:a,label:s},this.shrinkToFit=o??!0}get data(){return this._data}set data(e){this.setDataWithSize(e,e.length,!0)}get static(){return!!(this.descriptor.usage&i.BufferUsage.STATIC)}set static(e){e?this.descriptor.usage|=i.BufferUsage.STATIC:this.descriptor.usage&=~i.BufferUsage.STATIC}setDataWithSize(e,t,r){if(this._updateID++,this._updateSize=t*e.BYTES_PER_ELEMENT,this._data===e){r&&this.emit("update",this);return}let i=this._data;if(this._data=e,i.length!==e.length){!this.shrinkToFit&&e.byteLength<i.byteLength?r&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=(0,n.uid)("resource"),this.emit("change",this));return}r&&this.emit("update",this)}update(e){this._updateSize=e??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.emit("destroy",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}}),er("cnPar",function(e,t){C(e.exports,"BufferUsage",()=>n);var r,n=((r=n||{})[r.MAP_READ=1]="MAP_READ",r[r.MAP_WRITE=2]="MAP_WRITE",r[r.COPY_SRC=4]="COPY_SRC",r[r.COPY_DST=8]="COPY_DST",r[r.INDEX=16]="INDEX",r[r.VERTEX=32]="VERTEX",r[r.UNIFORM=64]="UNIFORM",r[r.STORAGE=128]="STORAGE",r[r.INDIRECT=256]="INDIRECT",r[r.QUERY_RESOLVE=512]="QUERY_RESOLVE",r[r.STATIC=1024]="STATIC",r)}),er("kFbJv",function(e,t){C(e.exports,"Geometry",()=>l);var r=et("gpXaq"),n=et("ggeMF"),i=et("l80qL"),s=et("2qhsM"),o=et("h4RvW"),a=et("6RtYG");class l extends w(r){constructor(e){let{attributes:t,indexBuffer:r,topology:a}=e;for(let r in super(),this.uid=(0,i.uid)("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new n.Bounds,this._boundsDirty=!0,this.attributes=t,this.buffers=[],this.instanceCount=e.instanceCount||1,t){var l;let e=t[r]=(((l=t[r])instanceof s.Buffer||Array.isArray(l)||l.BYTES_PER_ELEMENT)&&(l={buffer:l}),l.buffer=(0,o.ensureIsBuffer)(l.buffer,!1),l);-1===this.buffers.indexOf(e.buffer)&&(this.buffers.push(e.buffer),e.buffer.on("update",this.onBufferUpdate,this),e.buffer.on("change",this.onBufferUpdate,this))}r&&(this.indexBuffer=(0,o.ensureIsBuffer)(r,!0),this.buffers.push(this.indexBuffer)),this.topology=a||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(let e in this.attributes){let t=this.attributes[e];return t.buffer.data.length/(t.stride/4||t.size)}return 0}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,(0,a.getGeometryBounds)(this,"aPosition",this._bounds)):this._bounds}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach(e=>e.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}}),er("h4RvW",function(e,t){C(e.exports,"ensureIsBuffer",()=>i);var r=et("2qhsM"),n=et("cnPar");function i(e,t){if(!(e instanceof r.Buffer)){let i=t?n.BufferUsage.INDEX:n.BufferUsage.VERTEX;e instanceof Array&&(t?(e=new Uint32Array(e),i=n.BufferUsage.INDEX|n.BufferUsage.COPY_DST):(e=new Float32Array(e),i=n.BufferUsage.VERTEX|n.BufferUsage.COPY_DST)),e=new r.Buffer({data:e,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:i})}return e}}),er("6RtYG",function(e,t){C(e.exports,"getGeometryBounds",()=>r);function r(e,t,r){let n=e.getAttribute(t);if(!n)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;let i=n.buffer.data,s=1/0,o=1/0,a=-1/0,l=-1/0,u=i.BYTES_PER_ELEMENT,c=(n.offset||0)/u,h=(n.stride||8)/u;for(let e=c;e<i.length;e+=h){let t=i[e],r=i[e+1];t>a&&(a=t),r>l&&(l=r),t<s&&(s=t),r<o&&(o=r)}return r.minX=s,r.minY=o,r.maxX=a,r.maxY=l,r}}),er("9q6W4",function(e,t){C(e.exports,"getTextureBatchBindGroup",()=>o);var r=et("86NKO"),n=et("5h88T"),i=et("fIcRj");let s={};function o(e,t){let o=0;for(let r=0;r<t;r++)o=31*o+e[r].uid>>>0;return s[o]||function(e,t){let o={},a=0;for(let t=0;t<i.MAX_TEXTURES;t++){let r=t<e.length?e[t]:n.Texture.EMPTY.source;o[a++]=r.source,o[a++]=r.style}let l=new r.BindGroup(o);return s[t]=l,l}(e,o)}}),er("86NKO",function(e,t){C(e.exports,"BindGroup",()=>r);class r{constructor(e){this.resources=Object.create(null),this._dirty=!0;let t=0;for(let r in e){let n=e[r];this.setResource(n,t++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;let e=[],t=0;for(let r in this.resources)e[t++]=this.resources[r]._resourceId;this._key=e.join("|")}setResource(e,t){let r=this.resources[t];e!==r&&(r&&e.off?.("change",this.onResourceChange,this),e.on?.("change",this.onResourceChange,this),this.resources[t]=e,this._dirty=!0)}getResource(e){return this.resources[e]}_touch(e){let t=this.resources;for(let r in t)t[r]._touched=e}destroy(){let e=this.resources;for(let t in e){let r=e[t];r.off?.("change",this.onResourceChange,this)}this.resources=null}onResourceChange(){this._dirty=!0,this._updateKey()}}}),er("fIcRj",function(e,t){C(e.exports,"MAX_TEXTURES",()=>r);let r=16}),er("gC5Pa",function(e,t){C(e.exports,"Batcher",()=>h);var r=et("l80qL"),n=et("1bOZ3"),i=et("yT1Ie"),s=et("gNQm7"),o=et("68TF0"),a=et("fIcRj");class l{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.blendMode="normal",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}let u=0,c=class e{constructor(t={}){this.uid=(0,r.uid)("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._vertexSize=6,this._elements=[],this._batchPool=[],this._batchPoolIndex=0,this._textureBatchPool=[],this._textureBatchPoolIndex=0;let{vertexSize:i,indexSize:s}=t={...e.defaultOptions,...t};this.attributeBuffer=new n.ViewableBuffer(i*this._vertexSize*4),this.indexBuffer=new Uint16Array(s)}begin(){this.batchIndex=0,this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0,this._batchPoolIndex=0,this._textureBatchPoolIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e.indexStart=this.indexSize,e.location=this.attributeSize,e.batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.vertexSize*this._vertexSize}checkAndUpdateTexture(e,t){let r=e.batch.textures.ids[t._source.uid];return(!!r||0===r)&&(e.textureId=r,e.texture=t,!0)}updateElement(e){this.dirty=!0,e.packAttributes(this.attributeBuffer.float32View,this.attributeBuffer.uint32View,e.location,e.textureId)}break(e){let t=this._elements,r=this._textureBatchPool[this._textureBatchPoolIndex++]||new o.BatchTextureArray;if(r.clear(),!t[this.elementStart])return;let n=t[this.elementStart],i=(0,s.getAdjustedBlendModeBlend)(n.blendMode,n.texture._source);4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);let c=this.attributeBuffer.float32View,h=this.attributeBuffer.uint32View,f=this.indexBuffer,d=this._batchIndexSize,p=this._batchIndexStart,m="startBatch",g=this._batchPool[this._batchPoolIndex++]||new l;for(let n=this.elementStart;n<this.elementSize;++n){let v=t[n];t[n]=null;let y=v.texture._source,x=(0,s.getAdjustedBlendModeBlend)(v.blendMode,y),b=i!==x;if(y._batchTick===u&&!b){v.textureId=y._textureBindLocation,d+=v.indexSize,v.packAttributes(c,h,v.location,v.textureId),v.packIndex(f,v.indexStart,v.location/this._vertexSize),v.batch=g;continue}y._batchTick=u,(r.count>=a.MAX_TEXTURES||b)&&(this._finishBatch(g,p,d-p,r,i,e,m),m="renderBatch",p=d,i=x,(r=this._textureBatchPool[this._textureBatchPoolIndex++]||new o.BatchTextureArray).clear(),g=this._batchPool[this._batchPoolIndex++]||new l,++u),v.textureId=y._textureBindLocation=r.count,r.ids[y.uid]=r.count,r.textures[r.count++]=y,v.batch=g,d+=v.indexSize,v.packAttributes(c,h,v.location,v.textureId),v.packIndex(f,v.indexStart,v.location/this._vertexSize)}r.count>0&&(this._finishBatch(g,p,d-p,r,i,e,m),p=d,++u),this.elementStart=this.elementSize,this._batchIndexStart=p,this._batchIndexSize=d}_finishBatch(e,t,r,n,i,s,o){e.gpuBindGroup=null,e.action=o,e.batcher=this,e.textures=n,e.blendMode=i,e.start=t,e.size=r,++u,s.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){4*e<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*e)}ensureIndexBuffer(e){e<=this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){let t=Math.max(e,2*this.attributeBuffer.size),r=new n.ViewableBuffer(t);(0,i.fastCopy)(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(e){let t=this.indexBuffer,r=Math.max(e,1.5*t.length);r+=r%2;let n=r>65535?new Uint32Array(r):new Uint16Array(r);if(n.BYTES_PER_ELEMENT!==t.BYTES_PER_ELEMENT)for(let e=0;e<t.length;e++)n[e]=t[e];else(0,i.fastCopy)(t.buffer,n.buffer);this.indexBuffer=n}destroy(){for(let e=0;e<this.batches.length;e++)this.batches[e].destroy();this.batches=null;for(let e=0;e<this._elements.length;e++)this._elements[e].batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};c.defaultOptions={vertexSize:4,indexSize:6};let h=c}),er("1bOZ3",function(e,t){C(e.exports,"ViewableBuffer",()=>r);class r{constructor(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw Error(`${e} isn't a valid view type`)}}}}),er("yT1Ie",function(e,t){C(e.exports,"fastCopy",()=>r);function r(e,t){let r=e.byteLength/8|0,n=new Float64Array(e,0,r);new Float64Array(t,0,r).set(n);let i=e.byteLength-8*r;if(i>0){let n=new Uint8Array(e,8*r,i);new Uint8Array(t,8*r,i).set(n)}}}),er("gNQm7",function(e,t){C(e.exports,"getAdjustedBlendModeBlend",()=>n);var r=et("8Jr8b");function n(e,t){return"no-premultiply-alpha"===t.alphaMode&&r.BLEND_TO_NPM[e]||e}}),er("8Jr8b",function(e,t){C(e.exports,"BLEND_TO_NPM",()=>r),C(e.exports,"STENCIL_MODES",()=>i);let r={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var n,i=((n=i||{})[n.DISABLED=0]="DISABLED",n[n.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",n[n.MASK_ACTIVE=2]="MASK_ACTIVE",n[n.RENDERING_MASK_REMOVE=3]="RENDERING_MASK_REMOVE",n[n.NONE=4]="NONE",n)}),er("68TF0",function(e,t){C(e.exports,"BatchTextureArray",()=>r);class r{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){let t=this.textures[e];this.textures[e]=null,this.ids[t.uid]=null}this.count=0}}}),er("03aVk",function(e,t){C(e.exports,"buildContextBatches",()=>g);var r=et("soqVu"),n=et("cvBir"),i=et("5Mobi"),s=et("5h88T"),o=et("e98Fy"),a=et("7bQyz"),l=et("lkR0B"),u=et("dspZV"),c=et("6AePw"),h=et("3P3MX"),f=et("5gUNA"),d=et("7KshX");let p={rectangle:h.buildRectangle,polygon:c.buildPolygon,triangle:f.buildTriangle,circle:l.buildCircle,ellipse:l.buildCircle,roundedRectangle:l.buildCircle},m=new r.Rectangle;function g(e,t){let{geometryData:r,batches:n}=t;n.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let t=0;t<e.instructions.length;t++){let s=e.instructions[t];if("texture"===s.action)(function(e,t,r){let{vertices:n,uvs:s,indices:l}=r,u=l.length,c=n.length/2,h=[],f=p.rectangle,d=e.image;m.x=e.dx,m.y=e.dy,m.width=e.dw,m.height=e.dh;let g=e.transform;f.build(m,h),g&&(0,i.transformVertices)(h,g),f.triangulate(h,n,2,c,l,u);let v=d.uvs;s.push(v.x0,v.y0,v.x1,v.y1,v.x3,v.y3,v.x2,v.y2);let y=(0,o.BigPool).get(a.BatchableGraphics);y.indexOffset=u,y.indexSize=l.length-u,y.vertexOffset=c,y.vertexSize=n.length/2-c,y.color=e.style,y.alpha=e.alpha,y.texture=d,y.geometryData=r,t.push(y)})(s.data,n,r);else if("fill"===s.action||"stroke"===s.action){let e="stroke"===s.action,t=s.data.path.shapePath,i=s.data.style,o=s.data.hole;e&&o&&v(o.shapePath,i,null,!0,n,r),v(t,i,o,e,n,r)}}}function v(e,t,r,l,c,h){let{vertices:f,uvs:m,indices:g}=h,v=e.shapePrimitives.length-1;e.shapePrimitives.forEach(({shape:e,transform:y},x)=>{let b=g.length,_=f.length/2,S=[],C=p[e.type];if(C.build(e,S),y&&(0,i.transformVertices)(S,y),l){let r=e.closePath??!0;(0,u.buildLine)(S,t,!1,r,f,2,_,g,b)}else if(r&&v===x){0!==v&&console.warn("[Pixi Graphics] only the last shape have be cut out");let e=[],t=S.slice();(function(e){if(!e)return[];let t=e.shapePrimitives,r=[];for(let e=0;e<t.length;e++){let n=t[e].shape,i=[];p[n.type].build(n,i),r.push(i)}return r})(r.shapePath).forEach(r=>{e.push(t.length/2),t.push(...r)}),(0,d.triangulateWithHoles)(t,e,f,2,_,g,b)}else C.triangulate(S,f,2,_,g,b);let w=m.length/2,T=t.texture;if(T!==s.Texture.WHITE){let e=t.matrix;y&&e.append(y.clone().invert()),(0,n.buildUvs)(f,2,_,m,w,2,f.length/2-_,e)}else(0,n.buildSimpleUvs)(m,w,2,f.length/2-_);let P=(0,o.BigPool).get(a.BatchableGraphics);P.indexOffset=b,P.indexSize=g.length-b,P.vertexOffset=_,P.vertexSize=f.length/2-_,P.color=t.color,P.alpha=t.alpha,P.texture=T,P.geometryData=h,c.push(P)})}}),er("cvBir",function(e,t){function r(e,t,r,n,i,s,o,a=null){let l=0;r*=t,i*=s;let u=a.a,c=a.b,h=a.c,f=a.d,d=a.tx,p=a.ty;for(;l<o;){let o=e[r],a=e[r+1];n[i]=u*o+h*a+d,n[i+1]=c*o+f*a+p,i+=s,r+=t,l++}}function n(e,t,r,n){let i=0;for(t*=r;i<n;)e[t]=0,e[t+1]=0,t+=r,i++}C(e.exports,"buildUvs",()=>r),C(e.exports,"buildSimpleUvs",()=>n)}),er("5Mobi",function(e,t){C(e.exports,"transformVertices",()=>r);function r(e,t,r,n,i){let s=t.a,o=t.b,a=t.c,l=t.d,u=t.tx,c=t.ty;r=r||0,n=n||2,i=i||e.length/n-r;let h=r*n;for(let t=0;t<i;t++){let t=e[h],r=e[h+1];e[h]=s*t+a*r+u,e[h+1]=o*t+l*r+c,h+=n}}}),er("7bQyz",function(e,t){C(e.exports,"BatchableGraphics",()=>n);var r=et("bLQN7");class n{constructor(){this.batcher=null,this.batch=null,this.applyTransform=!0,this.roundPixels=0}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}packIndex(e,t,r){let n=this.geometryData.indices;for(let i=0;i<this.indexSize;i++)e[t++]=n[i+this.indexOffset]+r-this.vertexOffset}packAttributes(e,t,n,i){let s=this.geometryData,o=this.renderable,a=s.vertices,l=s.uvs,u=2*this.vertexOffset,c=(this.vertexOffset+this.vertexSize)*2,h=this.color,f=h>>16|65280&h|(255&h)<<16;if(this.applyTransform){let s=(0,r.mixColors)(f,o.groupColor)+(this.alpha*o.groupAlpha*255<<24),h=o.groupTransform,d=i<<16|65535&this.roundPixels,p=h.a,m=h.b,g=h.c,v=h.d,y=h.tx,x=h.ty;for(let r=u;r<c;r+=2){let i=a[r],o=a[r+1];e[n]=p*i+g*o+y,e[n+1]=m*i+v*o+x,e[n+2]=l[r],e[n+3]=l[r+1],t[n+4]=s,t[n+5]=d,n+=6}}else{let r=f+(255*this.alpha<<24);for(let s=u;s<c;s+=2)e[n]=a[s],e[n+1]=a[s+1],e[n+2]=l[s],e[n+3]=l[s+1],t[n+4]=r,t[n+5]=i<<16,n+=6}}get vertSize(){return this.vertexSize}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.vertexOffset=this.vertexOffset,e.vertexSize=this.vertexSize,e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData}reset(){this.applyTransform=!0}}}),er("bLQN7",function(e,t){C(e.exports,"mixColors",()=>n);var r=et("knTXf");function n(e,t){return 16777215===e||16777215===t?e+t-16777215:(0,r.mixHexColors)(e,t,.5)}}),er("knTXf",function(e,t){C(e.exports,"mixHexColors",()=>r);function r(e,t,r){let n=e>>16&255,i=e>>8&255,s=255&e;return(n+((t>>16&255)-n)*r<<16)+(i+((t>>8&255)-i)*r<<8)+(s+((255&t)-s)*r)}}),er("lkR0B",function(e,t){C(e.exports,"buildCircle",()=>r);let r={build(e,t){let r,n,i,s,o,a;if("circle"===e.type)r=e.x,n=e.y,o=a=e.radius,i=s=0;else if("ellipse"===e.type)r=e.x,n=e.y,o=e.halfWidth,a=e.halfHeight,i=s=0;else{let t=e.width/2,l=e.height/2;r=e.x+t,n=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(t,l))),i=t-o,s=l-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return t;let l=Math.ceil(2.3*Math.sqrt(o+a)),u=8*l+(i?4:0)+(s?4:0);if(0===u)return t;if(0===l)return t[0]=t[6]=r+i,t[1]=t[3]=n+s,t[2]=t[4]=r-i,t[5]=t[7]=n-s,t;let c=0,h=4*l+(i?2:0)+2,f=h,d=u,p=i+o,m=s,g=r+p,v=r-p,y=n+m;if(t[c++]=g,t[c++]=y,t[--h]=y,t[--h]=v,s){let e=n-m;t[f++]=v,t[f++]=e,t[--d]=e,t[--d]=g}for(let e=1;e<l;e++){let u=Math.PI/2*(e/l),p=i+Math.cos(u)*o,m=s+Math.sin(u)*a,g=r+p,v=r-p,y=n+m,x=n-m;t[c++]=g,t[c++]=y,t[--h]=y,t[--h]=v,t[f++]=v,t[f++]=x,t[--d]=x,t[--d]=g}p=i,m=s+a,g=r+p,v=r-p,y=n+m;let x=n-m;return t[c++]=g,t[c++]=y,t[--d]=x,t[--d]=g,i&&(t[c++]=v,t[c++]=y,t[--d]=x,t[--d]=v),t},triangulate(e,t,r,n,i,s){if(0===e.length)return;let o=0,a=0;for(let t=0;t<e.length;t+=2)o+=e[t],a+=e[t+1];o/=e.length/2,a/=e.length/2;let l=n;t[l*r]=o,t[l*r+1]=a;let u=l++;for(let n=0;n<e.length;n+=2)t[l*r]=e[n],t[l*r+1]=e[n+1],n>0&&(i[s++]=l,i[s++]=u,i[s++]=l-1),l++;i[s++]=u+1,i[s++]=u,i[s++]=l-1}}}),er("dspZV",function(e,t){C(e.exports,"buildLine",()=>a);var r=et("2NXni"),n=et("3LOun"),i=et("4G5QW");function s(e,t,r,n,i,s,o,a){let l,u;o?(l=n,u=-r):(l=-n,u=r);let c=e-r*i+l,h=t-n*i+u,f=e+r*s+l,d=t+n*s+u;return a.push(c,h),a.push(f,d),2}function o(e,t,r,n,i,s,o,a){let l=r-e,u=n-t,c=Math.atan2(l,u),h=Math.atan2(i-e,s-t);a&&c<h?c+=2*Math.PI:!a&&c>h&&(h+=2*Math.PI);let f=c,d=h-c,p=Math.sqrt(l*l+u*u),m=(15*Math.abs(d)*Math.sqrt(p)/Math.PI>>0)+1,g=d/m;if(f+=g,a){o.push(e,t),o.push(r,n);for(let r=1,n=f;r<m;r++,n+=g)o.push(e,t),o.push(e+Math.sin(n)*p,t+Math.cos(n)*p);o.push(e,t),o.push(i,s)}else{o.push(r,n),o.push(e,t);for(let r=1,n=f;r<m;r++,n+=g)o.push(e+Math.sin(n)*p,t+Math.cos(n)*p),o.push(e,t);o.push(i,s),o.push(e,t)}return 2*m}function a(e,t,a,l,u,c,h,f,d){let p=n.closePointEps;if(0===e.length)return;let m=t.alignment;if(.5!==t.alignment){let t=(0,i.getOrientationOfPoints)(e);a&&(t*=-1),m=(m-.5)*t+.5}let g=new r.Point(e[0],e[1]),v=new r.Point(e[e.length-2],e[e.length-1]),y=Math.abs(g.x-v.x)<p&&Math.abs(g.y-v.y)<p;if(l){e=e.slice(),y&&(e.pop(),e.pop(),v.set(e[e.length-2],e[e.length-1]));let t=(g.x+v.x)*.5,r=(v.y+g.y)*.5;e.unshift(t,r),e.push(t,r)}let x=e.length/2,b=e.length,_=u.length/2,S=t.width/2,C=S*S,w=t.miterLimit*t.miterLimit,T=e[0],P=e[1],A=e[2],k=e[3],M=0,R=0,I=-(P-k),E=T-A,O=0,z=0,F=Math.sqrt(I*I+E*E);I/=F,E/=F,I*=S,E*=S;let U=m,D=(1-U)*2,B=2*U;l||("round"===t.cap?b+=o(T-I*(D-B)*.5,P-E*(D-B)*.5,T-I*D,P-E*D,T+I*B,P+E*B,u,!0)+2:"square"===t.cap&&(b+=s(T,P,I,E,D,B,!0,u))),u.push(T-I*D,P-E*D),u.push(T+I*B,P+E*B);for(let r=1;r<x-1;++r){T=e[(r-1)*2],P=e[(r-1)*2+1],A=e[2*r],k=e[2*r+1],M=e[(r+1)*2],R=e[(r+1)*2+1],F=Math.sqrt((I=-(P-k))*I+(E=T-A)*E),I/=F,E/=F,I*=S,E*=S,F=Math.sqrt((O=-(k-R))*O+(z=A-M)*z),O/=F,z/=F,O*=S,z*=S;let n=A-T,i=P-k,s=A-M,a=R-k,l=n*s+i*a,c=i*s-a*n,h=c<0;if(Math.abs(c)<.001*Math.abs(l)){u.push(A-I*D,k-E*D),u.push(A+I*B,k+E*B),l>=0&&("round"===t.join?b+=o(A,k,A-I*D,k-E*D,A-O*D,k-z*D,u,!1)+4:b+=2,u.push(A-O*B,k-z*B),u.push(A+O*D,k+z*D));continue}let f=(-I+T)*(-E+k)-(-I+A)*(-E+P),d=(-O+M)*(-z+k)-(-O+A)*(-z+R),p=(n*d-s*f)/c,m=(a*f-i*d)/c,g=(p-A)*(p-A)+(m-k)*(m-k),v=A+(p-A)*D,y=k+(m-k)*D,x=A-(p-A)*B,_=k-(m-k)*B,U=h?D:B;g<=Math.min(n*n+i*i,s*s+a*a)+U*U*C?"bevel"===t.join||g/C>w?(h?(u.push(v,y),u.push(A+I*B,k+E*B),u.push(v,y),u.push(A+O*B,k+z*B)):(u.push(A-I*D,k-E*D),u.push(x,_),u.push(A-O*D,k-z*D),u.push(x,_)),b+=2):"round"===t.join?h?(u.push(v,y),u.push(A+I*B,k+E*B),b+=o(A,k,A+I*B,k+E*B,A+O*B,k+z*B,u,!0)+4,u.push(v,y),u.push(A+O*B,k+z*B)):(u.push(A-I*D,k-E*D),u.push(x,_),b+=o(A,k,A-I*D,k-E*D,A-O*D,k-z*D,u,!1)+4,u.push(A-O*D,k-z*D),u.push(x,_)):(u.push(v,y),u.push(x,_)):(u.push(A-I*D,k-E*D),u.push(A+I*B,k+E*B),"round"===t.join?h?b+=o(A,k,A+I*B,k+E*B,A+O*B,k+z*B,u,!0)+2:b+=o(A,k,A-I*D,k-E*D,A-O*D,k-z*D,u,!1)+2:"miter"===t.join&&g/C<=w&&(h?(u.push(x,_),u.push(x,_)):(u.push(v,y),u.push(v,y)),b+=2),u.push(A-O*D,k-z*D),u.push(A+O*B,k+z*B),b+=2)}T=e[(x-2)*2],P=e[(x-2)*2+1],A=e[(x-1)*2],F=Math.sqrt((I=-(P-(k=e[(x-1)*2+1])))*I+(E=T-A)*E),I/=F,E/=F,I*=S,E*=S,u.push(A-I*D,k-E*D),u.push(A+I*B,k+E*B),l||("round"===t.cap?b+=o(A-I*(D-B)*.5,k-E*(D-B)*.5,A-I*D,k-E*D,A+I*B,k+E*B,u,!1)+2:"square"===t.cap&&(b+=s(A,k,I,E,D,B,!1,u)));let L=n.curveEps*n.curveEps;for(let e=_;e<b+_-2;++e)T=u[2*e],P=u[2*e+1],A=u[(e+1)*2],k=u[(e+1)*2+1],M=u[(e+2)*2],Math.abs(T*(k-(R=u[(e+2)*2+1]))+A*(R-P)+M*(P-k))<L||f.push(e,e+1,e+2)}}),er("3LOun",function(e,t){C(e.exports,"closePointEps",()=>r),C(e.exports,"curveEps",()=>n);let r=1e-4,n=1e-4}),er("4G5QW",function(e,t){C(e.exports,"getOrientationOfPoints",()=>r);function r(e){let t=e.length;if(t<6)return 1;let r=0;for(let n=0,i=e[t-2],s=e[t-1];n<t;n+=2){let t=e[n],o=e[n+1];r+=(t-i)*(o+s),i=t,s=o}return r<0?-1:1}}),er("6AePw",function(e,t){C(e.exports,"buildPolygon",()=>i);var r=et("7KshX");let n=[],i={build(e,t){for(let r=0;r<e.points.length;r++)t[r]=e.points[r];return t},triangulate(e,t,i,s,o,a){(0,r.triangulateWithHoles)(e,n,t,i,s,o,a)}}}),er("7KshX",function(e,t){C(e.exports,"triangulateWithHoles",()=>n);var r=et("eH7tg");function n(e,t,n,i,s,o,a){let l=w(r)(e,t,2);if(!l)return;for(let e=0;e<l.length;e+=3)o[a++]=l[e]+s,o[a++]=l[e+1]+s,o[a++]=l[e+2]+s;let u=s*i;for(let t=0;t<e.length;t+=2)n[u]=e[t],n[u+1]=e[t+1],u+=i}}),er("eH7tg",function(e,t){function r(e,t,r){r=r||2;var h,f,m,v,y,x,b,_=t&&t.length,S=_?t[0]*r:e.length,C=n(e,0,S,r,!0),w=[];if(!C||C.next===C.prev)return w;if(_&&(C=function(e,t,r,o){var u,c,h,f,m,g=[];for(u=0,c=t.length;u<c;u++)h=t[u]*o,f=u<c-1?t[u+1]*o:e.length,(m=n(e,h,f,o,!1))===m.next&&(m.steiner=!0),g.push(function(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e)return r}(m));for(g.sort(s),u=0;u<g.length;u++)r=function(e,t){var r=function(e,t){var r,n,i,s=t,o=e.x,u=e.y,c=-1/0;do{if(u<=s.y&&u>=s.next.y&&s.next.y!==s.y){var h=s.x+(u-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(h<=o&&h>c&&(c=h,i=s.x<s.next.x?s:s.next,h===o))return i}s=s.next}while(s!==t)if(!i)return null;var f,p=i,m=i.x,g=i.y,v=1/0;s=i;do o>=s.x&&s.x>=m&&o!==s.x&&a(u<g?o:c,u,m,g,u<g?c:o,u,s.x,s.y)&&(f=Math.abs(u-s.y)/(o-s.x),d(s,e)&&(f<v||f===v&&(s.x>i.x||s.x===i.x&&(r=i,n=s,0>l(r.prev,r,n.prev)&&0>l(n.next,r,r.next))))&&(i=s,v=f)),s=s.next;while(s!==p)return i}(e,t);if(!r)return t;var n=p(r,e);return i(n,n.next),i(r,r.next)}(g[u],r);return r}(e,t,C,r)),e.length>80*r){h=m=e[0],f=v=e[1];for(var T=r;T<S;T+=r)y=e[T],x=e[T+1],y<h&&(h=y),x<f&&(f=x),y>m&&(m=y),x>v&&(v=x);b=0!==(b=Math.max(m-h,v-f))?32767/b:0}return function e(t,r,n,s,h,f,m){if(t){!m&&f&&function(e,t,r,n){var i=e;do 0===i.z&&(i.z=o(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e)i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,s,o,a,l,u=1;do{for(r=e,e=null,s=null,o=0;r;){for(o++,n=r,a=0,t=0;t<u&&(a++,n=n.nextZ);t++);for(l=u;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=n}s.nextZ=null,u*=2}while(o>1)}(i)}(t,s,h,f);for(var v,y,x=t;t.prev!==t.next;){if(v=t.prev,y=t.next,f?function(e,t,r,n){var i=e.prev,s=e.next;if(l(i,e,s)>=0)return!1;for(var u=i.x,c=e.x,h=s.x,f=i.y,d=e.y,p=s.y,m=u<c?u<h?u:h:c<h?c:h,g=f<d?f<p?f:p:d<p?d:p,v=u>c?u>h?u:h:c>h?c:h,y=f>d?f>p?f:p:d>p?d:p,x=o(m,g,t,r,n),b=o(v,y,t,r,n),_=e.prevZ,S=e.nextZ;_&&_.z>=x&&S&&S.z<=b;){if(_.x>=m&&_.x<=v&&_.y>=g&&_.y<=y&&_!==i&&_!==s&&a(u,f,c,d,h,p,_.x,_.y)&&l(_.prev,_,_.next)>=0||(_=_.prevZ,S.x>=m&&S.x<=v&&S.y>=g&&S.y<=y&&S!==i&&S!==s&&a(u,f,c,d,h,p,S.x,S.y)&&l(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;_&&_.z>=x;){if(_.x>=m&&_.x<=v&&_.y>=g&&_.y<=y&&_!==i&&_!==s&&a(u,f,c,d,h,p,_.x,_.y)&&l(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;S&&S.z<=b;){if(S.x>=m&&S.x<=v&&S.y>=g&&S.y<=y&&S!==i&&S!==s&&a(u,f,c,d,h,p,S.x,S.y)&&l(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}(t,s,h,f):function(e){var t=e.prev,r=e.next;if(l(t,e,r)>=0)return!1;for(var n=t.x,i=e.x,s=r.x,o=t.y,u=e.y,c=r.y,h=n<i?n<s?n:s:i<s?i:s,f=o<u?o<c?o:c:u<c?u:c,d=n>i?n>s?n:s:i>s?i:s,p=o>u?o>c?o:c:u>c?u:c,m=r.next;m!==t;){if(m.x>=h&&m.x<=d&&m.y>=f&&m.y<=p&&a(n,o,i,u,s,c,m.x,m.y)&&l(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}(t)){r.push(v.i/n|0),r.push(t.i/n|0),r.push(y.i/n|0),g(t),t=y.next,x=y.next;continue}if((t=y)===x){m?1===m?e(t=function(e,t,r){var n=e;do{var s=n.prev,o=n.next.next;!u(s,o)&&c(s,n,n.next,o)&&d(s,o)&&d(o,s)&&(t.push(s.i/r|0),t.push(n.i/r|0),t.push(o.i/r|0),g(n),g(n.next),n=e=o),n=n.next}while(n!==e)return i(n)}(i(t),r,n),r,n,s,h,f,2):2===m&&function(t,r,n,s,o,a){var h=t;do{for(var f,m,g=h.next.next;g!==h.prev;){if(h.i!==g.i&&(f=h,m=g,f.next.i!==m.i&&f.prev.i!==m.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&c(r,r.next,e,t))return!0;r=r.next}while(r!==e)return!1}(f,m)&&(d(f,m)&&d(m,f)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e)return n}(f,m)&&(l(f.prev,f,m.prev)||l(f,m.prev,m))||u(f,m)&&l(f.prev,f,f.next)>0&&l(m.prev,m,m.next)>0))){var v=p(h,g);h=i(h,h.next),v=i(v,v.next),e(h,r,n,s,o,a,0),e(v,r,n,s,o,a,0);return}g=g.next}h=h.next}while(h!==t)}(t,r,n,s,h,f):e(i(t),r,n,s,h,f,1);break}}}}(C,w,r,h,f,b,0),w}function n(e,t,r,n,i){var s,o;if(i===y(e,t,r,n)>0)for(s=t;s<r;s+=n)o=m(s,e[s],e[s+1],o);else for(s=r-n;s>=t;s-=n)o=m(s,e[s],e[s+1],o);return o&&u(o,o.next)&&(g(o),o=o.next),o}function i(e,t){if(!e)return e;t||(t=e);var r,n=e;do if(r=!1,!n.steiner&&(u(n,n.next)||0===l(n.prev,n,n.next))){if(g(n),(n=t=n.prev)===n.next)break;r=!0}else n=n.next;while(r||n!==t)return t}function s(e,t){return e.x-t.x}function o(e,t,r,n,i){return(e=((e=((e=((e=((e=(e-r)*i|0)|e<<8)&16711935)|e<<4)&252645135)|e<<2)&858993459)|e<<1)&1431655765)|(t=((t=((t=((t=((t=(t-n)*i|0)|t<<8)&16711935)|t<<4)&252645135)|t<<2)&858993459)|t<<1)&1431655765)<<1}function a(e,t,r,n,i,s,o,a){return(i-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(n-a)>=(r-o)*(t-a)&&(r-o)*(s-a)>=(i-o)*(n-a)}function l(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function u(e,t){return e.x===t.x&&e.y===t.y}function c(e,t,r,n){var i=f(l(e,t,r)),s=f(l(e,t,n)),o=f(l(r,n,e)),a=f(l(r,n,t));return!!(i!==s&&o!==a||0===i&&h(e,r,t)||0===s&&h(e,n,t)||0===o&&h(r,e,n)||0===a&&h(r,t,n))}function h(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function f(e){return e>0?1:e<0?-1:0}function d(e,t){return 0>l(e.prev,e,e.next)?l(e,t,e.next)>=0&&l(e,e.prev,t)>=0:0>l(e,t,e.prev)||0>l(e,e.next,t)}function p(e,t){var r=new v(e.i,e.x,e.y),n=new v(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function m(e,t,r,n){var i=new v(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function g(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function v(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function y(e,t,r,n){for(var i=0,s=t,o=r-n;s<r;s+=n)i+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return i}e.exports=r,e.exports.default=r,r.deviation=function(e,t,r,n){var i=t&&t.length,s=i?t[0]*r:e.length,o=Math.abs(y(e,0,s,r));if(i)for(var a=0,l=t.length;a<l;a++){var u=t[a]*r,c=a<l-1?t[a+1]*r:e.length;o-=Math.abs(y(e,u,c,r))}var h=0;for(a=0;a<n.length;a+=3){var f=n[a]*r,d=n[a+1]*r,p=n[a+2]*r;h+=Math.abs((e[f]-e[p])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[p+1]-e[f+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},r.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var s=0;s<e[i].length;s++)for(var o=0;o<t;o++)r.vertices.push(e[i][s][o]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r}}),er("3P3MX",function(e,t){C(e.exports,"buildRectangle",()=>r);let r={build(e,t){let r=e.x,n=e.y,i=e.width,s=e.height;return i>=0&&s>=0&&(t[0]=r,t[1]=n,t[2]=r+i,t[3]=n,t[4]=r+i,t[5]=n+s,t[6]=r,t[7]=n+s),t},triangulate(e,t,r,n,i,s){let o=0;t[(n*=r)+o]=e[0],t[n+o+1]=e[1],o+=r,t[n+o]=e[2],t[n+o+1]=e[3],o+=r,t[n+o]=e[6],t[n+o+1]=e[7],o+=r,t[n+o]=e[4],t[n+o+1]=e[5],o+=r;let a=n/r;i[s++]=a,i[s++]=a+1,i[s++]=a+2,i[s++]=a+1,i[s++]=a+3,i[s++]=a+2}}}),er("5gUNA",function(e,t){C(e.exports,"buildTriangle",()=>r);let r={build:(e,t)=>(t[0]=e.x,t[1]=e.y,t[2]=e.x2,t[3]=e.y2,t[4]=e.x3,t[5]=e.y3,t),triangulate(e,t,r,n,i,s){let o=0;t[(n*=r)+o]=e[0],t[n+o+1]=e[1],o+=r,t[n+o]=e[2],t[n+o+1]=e[3],o+=r,t[n+o]=e[4],t[n+o+1]=e[5];let a=n/r;i[s++]=a,i[s++]=a+1,i[s++]=a+2}}}),er("hYods",function(e,t){C(e.exports,"buildAdaptiveQuadratic",()=>n);var r=et("bBCDe");function n(e,t,n,i,s,o,a,l){let u=(1-Math.min(.99,Math.max(0,l??r.GraphicsContextSystem.defaultOptions.bezierSmoothness)))/1;return function e(t,r,n,i,s,o,a,l,u){if(u>8)return;let c=(r+i)/2,h=(n+s)/2,f=(i+o)/2,d=(s+a)/2,p=(c+f)/2,m=(h+d)/2,g=o-r,v=a-n,y=Math.abs((i-o)*v-(s-a)*g);if(y>11920929e-14){if(y*y<=l*(g*g+v*v)){t.push(p,m);return}}else if((g=p-(r+o)/2)*g+(v=m-(n+a)/2)*v<=l){t.push(p,m);return}e(t,r,n,c,h,p,m,l,u+1),e(t,p,m,f,d,o,a,l,u+1)}(e,t,n,i,s,o,a,u*=u,0),e.push(o,a),e}}),er("dMnI7",function(e,t){C(e.exports,"buildArc",()=>r);function r(e,t,r,n,i,s,o,a){let l=Math.abs(i-s);!o&&i>s?l=2*Math.PI-l:o&&s>i&&(l=2*Math.PI-l),a=Math.max(a=a||Math.max(6,Math.floor(6*Math.pow(n,1/3)*(l/Math.PI))),3);let u=l/a,c=i;u*=o?-1:1;for(let i=0;i<a+1;i++){let i=t+Math.cos(c)*n,s=r+Math.sin(c)*n;e.push(i,s),c+=u}}}),er("1DEaT",function(e,t){C(e.exports,"buildArcTo",()=>n);var r=et("dMnI7");function n(e,t,n,i,s,o){let a=e[e.length-2],l=e[e.length-1]-n,u=a-t,c=s-n,h=i-t,f=Math.abs(l*h-u*c);if(f<1e-8||0===o){(e[e.length-2]!==t||e[e.length-1]!==n)&&e.push(t,n);return}let d=l*l+u*u,p=c*c+h*h,m=l*c+u*h,g=o*Math.sqrt(d)/f,v=o*Math.sqrt(p)/f,y=g*m/d,x=v*m/p,b=g*h+v*u,_=g*c+v*l;(0,r.buildArc)(e,b+t,_+n,o,Math.atan2(l*(v+y)-_,u*(v+y)-b),Math.atan2(c*(g+x)-_,h*(g+x)-b),u*c>h*l)}}),er("j5RWP",function(e,t){C(e.exports,"buildArcToSvg",()=>l);var r=et("67FNK");let n=2*Math.PI,i={centerX:0,centerY:0,ang1:0,ang2:0},s=({x:e,y:t},r,n,i,s,o,a,l)=>{let u=i*(e*=r)-s*(t*=n),c=s*e+i*t;return l.x=u+o,l.y=c+a,l},o=(e,t,r,n)=>{let i=e*r+t*n;return i>1&&(i=1),i<-1&&(i=-1),(e*n-t*r<0?-1:1)*Math.acos(i)},a=(e,t,r,i,s,a,l,u,c,h,f,d,p)=>{let m=Math.pow(s,2),g=Math.pow(a,2),v=Math.pow(f,2),y=Math.pow(d,2),x=m*g-m*y-g*v;x<0&&(x=0),x/=m*y+g*v;let b=(x=Math.sqrt(x)*(l===u?-1:1))*s/a*d,_=-(x*a)/s*f,S=(f-b)/s,C=(d-_)/a,w=o(1,0,S,C),T=o(S,C,(-f-b)/s,(-d-_)/a);0===u&&T>0&&(T-=n),1===u&&T<0&&(T+=n),p.centerX=h*b-c*_+(e+r)/2,p.centerY=c*b+h*_+(t+i)/2,p.ang1=w,p.ang2=T};function l(e,t,o,l,u,c,h,f=0,d=0,p=0){if(0===c||0===h)return;let m=Math.sin(f*n/360),g=Math.cos(f*n/360),v=g*(t-l)/2+m*(o-u)/2,y=-m*(t-l)/2+g*(o-u)/2;if(0===v&&0===y)return;let x=Math.pow(v,2)/Math.pow(c=Math.abs(c),2)+Math.pow(y,2)/Math.pow(h=Math.abs(h),2);x>1&&(c*=Math.sqrt(x),h*=Math.sqrt(x)),a(t,o,l,u,c,h,d,p,m,g,v,y,i);let{ang1:b,ang2:_}=i,{centerX:S,centerY:C}=i,w=Math.abs(_)/(n/4);1e-7>Math.abs(1-w)&&(w=1);let T=Math.max(Math.ceil(w),1);_/=T;let P=e[e.length-2],A=e[e.length-1],k={x:0,y:0};for(let t=0;t<T;t++){let t=function(e,t){let r=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:4/3*Math.tan(t/4),n=Math.cos(e),i=Math.sin(e),s=Math.cos(e+t),o=Math.sin(e+t);return[{x:n-i*r,y:i+n*r},{x:s+o*r,y:o-s*r},{x:s,y:o}]}(b,_),{x:n,y:i}=s(t[0],c,h,g,m,S,C,k),{x:o,y:a}=s(t[1],c,h,g,m,S,C,k),{x:l,y:u}=s(t[2],c,h,g,m,S,C,k);(0,r.buildAdaptiveBezier)(e,P,A,n,i,o,a,l,u),P=l,A=u,b+=_}}}),er("5fPVY",function(e,t){function r(e,t,r){let n=(e,t)=>{let r=t.x-e.x,n=t.y-e.y,i=Math.sqrt(r*r+n*n);return{len:i,nx:r/i,ny:n/i}},i=(t,r)=>{0===t?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)},s=t[t.length-1];for(let o=0;o<t.length;o++){let a;let l=t[o%t.length],u=l.radius??r;if(u<=0){i(o,l),s=l;continue}let c=t[(o+1)%t.length],h=n(l,s),f=n(l,c);if(h.len<1e-4||f.len<1e-4){i(o,l),s=l;continue}let d=Math.asin(h.nx*f.ny-h.ny*f.nx),p=1,m=!1;h.nx*f.nx- -(h.ny*f.ny)<0?d<0?d=Math.PI+d:(d=Math.PI-d,p=-1,m=!0):d>0&&(p=-1,m=!0);let g=d/2,v=Math.abs(Math.cos(g)*u/Math.sin(g));a=v>Math.min(h.len/2,f.len/2)?Math.abs((v=Math.min(h.len/2,f.len/2))*Math.sin(g)/Math.cos(g)):u;let y=l.x+f.nx*v+-f.ny*a*p,x=l.y+f.ny*v+f.nx*a*p,b=Math.atan2(h.ny,h.nx)+Math.PI/2*p,_=Math.atan2(f.ny,f.nx)-Math.PI/2*p;0===o&&e.moveTo(y+Math.cos(b)*a,x+Math.sin(b)*a),e.arc(y,x,a,b,_,m),s=l}}function n(e,t,r,n){let i=(e,t)=>Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2),s=(e,t,r)=>({x:e.x+(t.x-e.x)*r,y:e.y+(t.y-e.y)*r}),o=t.length;for(let a=0;a<o;a++){let l,u;let c=t[(a+1)%o],h=c.radius??r;if(h<=0){0===a?e.moveTo(c.x,c.y):e.lineTo(c.x,c.y);continue}let f=t[a],d=t[(a+2)%o],p=i(f,c);l=p<1e-4?c:s(c,f,Math.min(p/2,h)/p);let m=i(d,c);u=m<1e-4?c:s(c,d,Math.min(m/2,h)/m),0===a?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y),e.quadraticCurveTo(c.x,c.y,u.x,u.y,n)}}C(e.exports,"roundedShapeArc",()=>r),C(e.exports,"roundedShapeQuadraticCurve",()=>n)}),er("hFJzr",function(e,t){C(e.exports,"SVGParser",()=>i);var r=et("AHTcQ"),n=et("awDzm");function i(e,t){if("string"==typeof e){let t=document.createElement("div");t.innerHTML=e.trim(),e=t.querySelector("svg")}return function e(t,i,o,a){let l,u,c,h,f,d,p,m,g,v,y,x,b,_,S,C;let w=t.children,{fillStyle:T,strokeStyle:P}=function(e){let t=e.getAttribute("style"),n={},i={},o=!1,a=!1;if(t){let e=t.split(";");for(let t=0;t<e.length;t++){let[s,l]=e[t].split(":");switch(s){case"stroke":"none"!==l&&(n.color=(0,r.Color).shared.setValue(l).toNumber(),a=!0);break;case"stroke-width":n.width=Number(l);break;case"fill":"none"!==l&&(o=!0,i.color=(0,r.Color).shared.setValue(l).toNumber());break;case"fill-opacity":i.alpha=Number(l);break;case"stroke-opacity":n.alpha=Number(l);break;case"opacity":i.alpha=Number(l),n.alpha=Number(l)}}}else{let t=e.getAttribute("stroke");t&&"none"!==t&&(a=!0,n.color=(0,r.Color).shared.setValue(t).toNumber(),n.width=s(e,"stroke-width",1));let l=e.getAttribute("fill");l&&"none"!==l&&(o=!0,i.color=(0,r.Color).shared.setValue(l).toNumber())}return{strokeStyle:a?n:null,fillStyle:o?i:null}}(t);switch(T&&o?o={...o,...T}:T&&(o=T),P&&a?a={...a,...P}:P&&(a=P),i.context.fillStyle=o,i.context.strokeStyle=a,t.nodeName.toLowerCase()){case"path":b=t.getAttribute("d"),_=new n.GraphicsPath(b),i.context.path(_),o&&i.context.fill(),a&&i.context.stroke();break;case"circle":p=s(t,"cx",0),m=s(t,"cy",0),g=s(t,"r",0),i.context.ellipse(p,m,g,g),o&&i.context.fill(),a&&i.context.stroke();break;case"rect":l=s(t,"x",0),u=s(t,"y",0),S=s(t,"width",0),C=s(t,"height",0),v=s(t,"rx",0),y=s(t,"ry",0),v||y?i.context.roundRect(l,u,S,C,v||y):i.context.rect(l,u,S,C),o&&i.context.fill(),a&&i.context.stroke();break;case"ellipse":p=s(t,"cx",0),m=s(t,"cy",0),v=s(t,"rx",0),y=s(t,"ry",0),i.context.beginPath(),i.context.ellipse(p,m,v,y),o&&i.context.fill(),a&&i.context.stroke();break;case"line":c=s(t,"x1",0),h=s(t,"y1",0),f=s(t,"x2",0),d=s(t,"y2",0),i.context.beginPath(),i.context.moveTo(c,h),i.context.lineTo(f,d),a&&i.context.stroke();break;case"polygon":x=t.getAttribute("points").match(/\d+/g).map(e=>parseInt(e,10)),i.context.poly(x,!0),o&&i.context.fill(),a&&i.context.stroke();break;case"polyline":x=t.getAttribute("points").match(/\d+/g).map(e=>parseInt(e,10)),i.context.poly(x,!1),a&&i.context.stroke();break;case"g":case"svg":break;default:console.info(`[SVG parser] <${t.nodeName}> elements unsupported`)}for(let t=0;t<w.length;t++)e(w[t],i,o,a)}(e,{context:t,path:new n.GraphicsPath},null,null),t}function s(e,t,r){let n=e.getAttribute(t);return n?Number(n):r}}),er("jwZTp",function(e,t){C(e.exports,"convertFillInputToFillStyle",()=>a);var r=et("AHTcQ"),n=et("dNaJE"),i=et("5h88T"),s=et("j8pAr"),o=et("hZTCO");function a(e,t){let a,l;if(null==e)return null;if(e?.fill?(l=e.fill,a={...t,...e}):(l=e,a=t),(0,r.Color).isColorLike(l)){let e=(0,r.Color).shared.setValue(l??0);return{...a,color:e.toNumber(),alpha:1===e.alpha?a.alpha:e.alpha,texture:i.Texture.WHITE}}if(l instanceof o.FillPattern){let e=l;return{...a,color:16777215,texture:e.texture,matrix:e.transform,fill:a.fill??null}}if(l instanceof s.FillGradient){let e=l;return e.buildLinearGradient(),{...a,color:16777215,texture:e.texture,matrix:e.transform}}let u={...t,...e};if(u.texture){if(u.texture!==i.Texture.WHITE){let e=u.matrix?.invert()||new n.Matrix;e.scale(1/u.texture.frame.width,1/u.texture.frame.height),u.matrix=e}let e=u.texture.source.style;"clamp-to-edge"===e.addressMode&&(e.addressMode="repeat")}let c=(0,r.Color).shared.setValue(u.color);return u.alpha*=c.alpha,u.color=c.toNumber(),u.matrix=u.matrix?u.matrix.clone():null,u}}),er("j8pAr",function(e,t){C(e.exports,"FillGradient",()=>u);var r=et("AHTcQ"),n=et("5m2Qn"),i=et("dNaJE"),s=et("4XrO5"),o=et("5h88T"),a=et("l80qL");let l=class e{constructor(e,t,r,n){this.uid=(0,a.uid)("fillGradient"),this.type="linear",this.gradientStops=[],this.x0=e,this.y0=t,this.x1=r,this.y1=n}addColorStop(e,t){return this.gradientStops.push({offset:e,color:(0,r.Color).shared.setValue(t).toHex()}),this}buildLinearGradient(){let t=e.defaultTextureSize,{gradientStops:r}=this,a=(0,n.DOMAdapter).get().createCanvas();a.width=t,a.height=t;let l=a.getContext("2d"),u=l.createLinearGradient(0,0,e.defaultTextureSize,1);for(let e=0;e<r.length;e++){let t=r[e];u.addColorStop(t.offset,t.color)}l.fillStyle=u,l.fillRect(0,0,t,t),this.texture=new o.Texture({source:new s.ImageSource({resource:a,addressModeU:"clamp-to-edge",addressModeV:"repeat"})});let{x0:c,y0:h,x1:f,y1:d}=this,p=new i.Matrix,m=f-c,g=d-h;p.translate(-c,-h),p.scale(1/t,1/t),p.rotate(-Math.atan2(g,m)),p.scale(256/Math.sqrt(m*m+g*g),1),this.transform=p}};l.defaultTextureSize=256;let u=l}),er("hZTCO",function(e,t){C(e.exports,"FillPattern",()=>s);var r=et("dNaJE"),n=et("l80qL");let i={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class s{constructor(e,t){this.uid=(0,n.uid)("fillPattern"),this.transform=new r.Matrix,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),t&&(e.source.style.addressModeU=i[t].addressModeU,e.source.style.addressModeV=i[t].addressModeV)}setTransform(e){let t=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/t.frame.width,1/t.frame.height)}}}),er("2AaNu",function(e,t){C(e.exports,"GlProgram",()=>h);var r=et("2aTkI"),n=et("76Gha"),i=et("6chrV"),s=et("9uh5G"),o=et("5ThHq"),a=et("2smQn");let l={stripVersion:et("cuCqf").stripVersion,ensurePrecision:s.ensurePrecision,addProgramDefines:i.addProgramDefines,setProgramName:a.setProgramName,insertVersion:o.insertVersion},u=Object.create(null),c=class e{constructor(t){let i=-1!==(t={...e.defaultOptions,...t}).fragment.indexOf("#version 300 es"),s={stripVersion:i,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:(0,n.getMaxFragmentPrecision)()},setProgramName:{name:t.name},addProgramDefines:i,insertVersion:i},o=t.fragment,a=t.vertex;Object.keys(l).forEach(e=>{let t=s[e];o=l[e](o,t,!0),a=l[e](a,t,!1)}),this.fragment=o,this.vertex=a,this._key=(0,r.createIdFromString)(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(t){let r=`${t.vertex}:${t.fragment}`;return u[r]||(u[r]=new e(t)),u[r]}};c.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let h=c}),er("2aTkI",function(e,t){C(e.exports,"createIdFromString",()=>i);let r=Object.create(null),n=Object.create(null);function i(e,t){let i=n[e];return void 0===i&&(void 0===r[t]&&(r[t]=1),n[e]=i=r[t]++),i}}),er("76Gha",function(e,t){let r;C(e.exports,"getMaxFragmentPrecision",()=>i);var n=et("towXg");function i(){if(!r){r="mediump";let e=(0,n.getTestContext)();e&&e.getShaderPrecisionFormat&&(r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?"highp":"mediump")}return r}}),er("towXg",function(e,t){let r;C(e.exports,"getTestContext",()=>i);var n=et("5m2Qn");function i(){return(!r||r?.isContextLost())&&(r=(0,n.DOMAdapter).get().createCanvas().getContext("webgl",{})),r}}),er("6chrV",function(e,t){C(e.exports,"addProgramDefines",()=>r);function r(e,t,r){return t?e:r?(e=e.replace("out vec4 finalColor;",""),`
        
        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${e}
        `):`
        
        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${e}
        `}}),er("9uh5G",function(e,t){C(e.exports,"ensurePrecision",()=>r);function r(e,t,r){let n=r?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if("precision"!==e.substring(0,9)){let i=r?t.requestedFragmentPrecision:t.requestedVertexPrecision;return"highp"===i&&"highp"!==n&&(i="mediump"),`precision ${i} float;
${e}`}return"highp"!==n&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}}),er("5ThHq",function(e,t){C(e.exports,"insertVersion",()=>r);function r(e,t){return t?`#version 300 es
${e}`:e}}),er("2smQn",function(e,t){C(e.exports,"setProgramName",()=>i);let r={},n={};function i(e,{name:t="pixi-program"},i=!0){t=t.replace(/\s+/g,"-")+(i?"-fragment":"-vertex");let s=i?r:n;if(s[t]?(s[t]++,t+=`-${s[t]}`):s[t]=1,-1!==e.indexOf("#define SHADER_NAME"))return e;let o=`#define SHADER_NAME ${t}`;return`${o}
${e}`}}),er("cuCqf",function(e,t){C(e.exports,"stripVersion",()=>r);function r(e,t){return t?e.replace("#version 300 es",""):e}}),er("9IRF4",function(e,t){C(e.exports,"GpuProgram",()=>u);var r=et("2aTkI"),n=et("2liBL"),i=et("fPdyx"),s=et("9BwwY"),o=et("iHjNs"),a=et("4ZXFu");let l=Object.create(null);class u{constructor(e){this._layoutKey=0;let{fragment:t,vertex:r,layout:n,gpuLayout:l,name:u}=e;if(this.name=u,this.fragment=t,this.vertex=r,t.source===r.source){let e=(0,i.extractStructAndGroups)(t.source);this.structsAndGroups=e}else{let e=(0,i.extractStructAndGroups)(r.source),n=(0,i.extractStructAndGroups)(t.source);this.structsAndGroups=(0,a.removeStructAndGroupDuplicates)(e,n)}this.layout=n??(0,o.generateLayoutHash)(this.structsAndGroups),this.gpuLayout=l??(0,s.generateGpuLayoutGroups)(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){let{vertex:e,fragment:t}=this,n=e.source+t.source+e.entryPoint+t.entryPoint;this._layoutKey=(0,r.createIdFromString)(n,"program")}get attributeData(){return this._attributeData??(this._attributeData=(0,n.extractAttributesFromGpuProgram)(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(e){let t=`${e.vertex.source}:${e.fragment.source}:${e.fragment.entryPoint}:${e.vertex.entryPoint}`;return l[t]||(l[t]=new u(e)),l[t]}}}),er("2liBL",function(e,t){C(e.exports,"extractAttributesFromGpuProgram",()=>i);var r=et("97JA6");let n={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function i({source:e,entryPoint:t}){let i={},s=e.indexOf(`fn ${t}`);if(-1!==s){let t=e.indexOf("->",s);if(-1!==t){let o;let a=e.substring(s,t),l=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;for(;null!==(o=l.exec(a));){let e=n[o[3]]??"float32";i[o[2]]={location:parseInt(o[1],10),format:e,stride:(0,r.getAttributeInfoFromFormat)(e).stride,offset:0,instance:!1,start:0}}}}return i}}),er("97JA6",function(e,t){C(e.exports,"getAttributeInfoFromFormat",()=>n);let r={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function n(e){return r[e]??r.float32}}),er("fPdyx",function(e,t){C(e.exports,"extractStructAndGroups",()=>r);function r(e){let t=/@group\((\d+)\)/,r=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,i=/:\s*(\w+)/,s=/(\w+)\s*:\s*([\w\<\>]+)/g,o=/struct\s+(\w+)/,a=e.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g)?.map(e=>({group:parseInt(e.match(t)[1],10),binding:parseInt(e.match(r)[1],10),name:e.match(n)[2],isUniform:"<uniform>"===e.match(n)[1],type:e.match(i)[1]}));if(!a)return{groups:[],structs:[]};let l=e.match(/struct\s+(\w+)\s*{([^}]+)}/g)?.map(e=>{let t=e.match(o)[1],r=e.match(s).reduce((e,t)=>{let[r,n]=t.split(":");return e[r.trim()]=n.trim(),e},{});return r?{name:t,members:r}:null}).filter(({name:e})=>a.some(t=>t.type===e))??[];return{groups:a,structs:l}}}),er("9BwwY",function(e,t){C(e.exports,"generateGpuLayoutGroups",()=>n);var r=et("6ONS2");function n({groups:e}){let t=[];for(let n=0;n<e.length;n++){let i=e[n];t[i.group]||(t[i.group]=[]),i.isUniform?t[i.group].push({binding:i.binding,visibility:r.ShaderStage.VERTEX|r.ShaderStage.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===i.type?t[i.group].push({binding:i.binding,visibility:r.ShaderStage.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===i.type&&t[i.group].push({binding:i.binding,visibility:r.ShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}}),er("6ONS2",function(e,t){C(e.exports,"ShaderStage",()=>n);var r,n=((r=n||{})[r.VERTEX=1]="VERTEX",r[r.FRAGMENT=2]="FRAGMENT",r[r.COMPUTE=4]="COMPUTE",r)}),er("iHjNs",function(e,t){C(e.exports,"generateLayoutHash",()=>r);function r({groups:e}){let t=[];for(let r=0;r<e.length;r++){let n=e[r];t[n.group]||(t[n.group]={}),t[n.group][n.name]=n.binding}return t}}),er("4ZXFu",function(e,t){C(e.exports,"removeStructAndGroupDuplicates",()=>r);function r(e,t){let r=new Set,n=new Set;return{structs:[...e.structs,...t.structs].filter(e=>!r.has(e.name)&&(r.add(e.name),!0)),groups:[...e.groups,...t.groups].filter(e=>{let t=`${e.name}-${e.binding}`;return!n.has(t)&&(n.add(t),!0)})}}}),er("lJEsO",function(e,t){C(e.exports,"UniformGroup",()=>o);var r=et("l80qL"),n=et("2aTkI"),i=et("kJ1OQ");let s=class e{constructor(t,s){this._touched=0,this.uid=(0,r.uid)("uniform"),this._resourceType="uniformGroup",this._resourceId=(0,r.uid)("resource"),this.isUniformGroup=!0,this._dirtyId=0,s={...e.defaultOptions,...s},this.uniformStructures=t;let o={};for(let e in t){let r=t[e];r.name=e,r.size=r.size??1,r.value??(r.value=(0,i.getDefaultUniformValue)(r.type,r.size)),o[e]=r.value}this.uniforms=o,this._dirtyId=1,this.ubo=s.ubo,this.isStatic=s.isStatic,this._signature=(0,n.createIdFromString)(Object.keys(o).map(e=>`${e}-${t[e].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};s.defaultOptions={ubo:!1,isStatic:!1};let o=s}),er("kJ1OQ",function(e,t){C(e.exports,"getDefaultUniformValue",()=>r);function r(e,t){switch(e){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}}),er("hskgj",function(e,t){C(e.exports,"Filter",()=>a);var r=et("2AaNu"),n=et("9IRF4"),i=et("7cNGO"),s=et("4rJn2");let o=class e extends i.Shader{constructor(t){super(t={...e.defaultOptions,...t}),this.enabled=!0,this._state=(0,s.State).for2d(),this.padding=t.padding,"boolean"==typeof t.antialias?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.addResource("uTexture",0,1)}apply(e,t,r,n){e.applyFilter(this,t,r,n)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(t){let i,s;let{gpu:o,gl:a,...l}=t;return o&&(i=(0,n.GpuProgram).from(o)),a&&(s=(0,r.GlProgram).from(a)),new e({gpuProgram:i,glProgram:s,...l})}};o.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1};let a=o}),er("7cNGO",function(e,t){C(e.exports,"Shader",()=>l);var r=et("gpXaq"),n=et("2AaNu"),i=et("86NKO"),s=et("9IRF4"),o=et("dgEnR"),a=et("lJEsO");class l extends w(r){constructor(e){super(),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:t,glProgram:r,groups:n,resources:s,compatibleRenderers:l,groupMap:u}=e;this.gpuProgram=t,this.glProgram=r,void 0===l&&(l=0,t&&(l|=o.RendererType.WEBGPU),r&&(l|=o.RendererType.WEBGL)),this.compatibleRenderers=l;let c={};if(s||n||(s={}),s&&n)throw Error("[Shader] Cannot have both resources and groups");if(t||!n||u){if(!t&&n&&u)for(let e in u)for(let t in u[e]){let r=u[e][t];c[r]={group:e,binding:t,name:r}}else if(t&&n&&!u){let e=t.structsAndGroups.groups;u={},e.forEach(e=>{u[e.group]=u[e.group]||{},u[e.group][e.binding]=e.name,c[e.name]=e})}else if(s){if(t){let e=t.structsAndGroups.groups;u={},e.forEach(e=>{u[e.group]=u[e.group]||{},u[e.group][e.binding]=e.name,c[e.name]=e})}else{u={},n={99:new i.BindGroup},this._ownedBindGroups.push(n[99]);let e=0;for(let t in s)c[t]={group:99,binding:e,name:t},u[99]=u[99]||{},u[99][e]=t,e++}for(let e in n={},s){let t=s[e];t.source||t._resourceType||(t=new a.UniformGroup(t));let r=c[e];r&&(n[r.group]||(n[r.group]=new i.BindGroup,this._ownedBindGroups.push(n[r.group])),n[r.group].setResource(t,r.binding))}}}else throw Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");this.groups=n,this._uniformBindMap=u,this.resources=this._buildResourceAccessor(n,c)}addResource(e,t,r){var n,s;(n=this._uniformBindMap)[t]||(n[t]={}),(s=this._uniformBindMap[t])[r]||(s[r]=e),this.groups[t]||(this.groups[t]=new i.BindGroup,this._ownedBindGroups.push(this.groups[t]))}_buildResourceAccessor(e,t){let r={};for(let n in t){let i=t[n];Object.defineProperty(r,i.name,{get:()=>e[i.group].getResource(i.binding),set(t){e[i.group].setResource(t,i.binding)}})}return r}destroy(e=!1){this.emit("destroy",this),e&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(e=>{e.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(e){let t,r;let{gpu:i,gl:o,...a}=e;return i&&(t=(0,s.GpuProgram).from(i)),o&&(r=(0,n.GlProgram).from(o)),new l({gpuProgram:t,glProgram:r,...a})}}}),er("dgEnR",function(e,t){C(e.exports,"RendererType",()=>n);var r,n=((r=n||{})[r.WEBGL=1]="WEBGL",r[r.WEBGPU=2]="WEBGPU",r[r.BOTH=3]="BOTH",r)}),er("4rJn2",function(e,t){C(e.exports,"State",()=>i);let r={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8},n=class e{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}set cullMode(e){if("none"===e){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace="front"===e}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend="none"!==e,this._blendMode=e,this._blendModeId=r[e]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let t=new e;return t.depthTest=!1,t.blend=!0,t}};n.default2d=n.for2d();let i=n}),er("7U2uj",function(e,t){C(e.exports,"TexturePool",()=>o);var r=et("domwE"),n=et("9Ur0D"),i=et("5h88T");let s=0,o=new class{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1}createTexture(e,t,r){let o=new n.TextureSource({...this.textureOptions,width:e,height:t,resolution:1,antialias:r,autoGarbageCollect:!0});return new i.Texture({source:o,label:`texturePool_${s++}`})}getOptimalTexture(e,t,n=1,i){let s=Math.ceil(e*n-1e-6),o=Math.ceil(t*n-1e-6),a=((s=(0,r.nextPow2)(s))<<17)+((o=(0,r.nextPow2)(o))<<1)+(i?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(s,o,i)),l.source._resolution=n,l.source.width=s/n,l.source.height=o/n,l.source.pixelWidth=s,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=e,l.frame.height=t,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(e,t=!1){let r=e.source;return this.getOptimalTexture(e.width,e.height,r._resolution,t)}returnTexture(e){let t=this._poolKeyHash[e.uid];this._texturePool[t].push(e)}clear(e){if(e=!1!==e)for(let e in this._texturePool){let t=this._texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this._texturePool={}}}}),er("C9JRY",function(e,t){C(e.exports,"Graphics",()=>s);var r=et("eX50w"),n=et("lR3Ev"),i=et("hTvsP");class s extends n.Container{constructor(e){e instanceof i.GraphicsContext&&(e={context:e});let{context:t,roundPixels:r,...n}=e||{};super({label:"Graphics",...n}),this.canBundle=!0,this.renderPipeId="graphics",this._roundPixels=0,t?this._context=t:this._context=this._ownedContext=new i.GraphicsContext,this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=r??!1}set context(e){e!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=e,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}addBounds(e){e.addBounds(this._context.bounds)}containsPoint(e){return this._context.containsPoint(e)}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}onViewUpdate(){this._didChangeId+=4096,this._didGraphicsUpdate=!0,!this.didViewUpdate&&(this.didViewUpdate=!0,this.renderGroup&&this.renderGroup.onChildViewUpdate(this))}destroy(e){this._ownedContext&&!e?this._ownedContext.destroy(e):(!0===e||e?.context===!0)&&this._context.destroy(e),this._ownedContext=null,this._context=null,super.destroy(e)}_callContextMethod(e,t){return this.context[e](...t),this}setFillStyle(...e){return this._callContextMethod("setFillStyle",e)}setStrokeStyle(...e){return this._callContextMethod("setStrokeStyle",e)}fill(...e){return this._callContextMethod("fill",e)}stroke(...e){return this._callContextMethod("stroke",e)}texture(...e){return this._callContextMethod("texture",e)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...e){return this._callContextMethod("arc",e)}arcTo(...e){return this._callContextMethod("arcTo",e)}arcToSvg(...e){return this._callContextMethod("arcToSvg",e)}bezierCurveTo(...e){return this._callContextMethod("bezierCurveTo",e)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...e){return this._callContextMethod("ellipse",e)}circle(...e){return this._callContextMethod("circle",e)}path(...e){return this._callContextMethod("path",e)}lineTo(...e){return this._callContextMethod("lineTo",e)}moveTo(...e){return this._callContextMethod("moveTo",e)}quadraticCurveTo(...e){return this._callContextMethod("quadraticCurveTo",e)}rect(...e){return this._callContextMethod("rect",e)}roundRect(...e){return this._callContextMethod("roundRect",e)}poly(...e){return this._callContextMethod("poly",e)}regularPoly(...e){return this._callContextMethod("regularPoly",e)}roundPoly(...e){return this._callContextMethod("roundPoly",e)}roundShape(...e){return this._callContextMethod("roundShape",e)}filletRect(...e){return this._callContextMethod("filletRect",e)}chamferRect(...e){return this._callContextMethod("chamferRect",e)}star(...e){return this._callContextMethod("star",e)}svg(...e){return this._callContextMethod("svg",e)}restore(...e){return this._callContextMethod("restore",e)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...e){return this._callContextMethod("rotate",e)}scaleTransform(...e){return this._callContextMethod("scale",e)}setTransform(...e){return this._callContextMethod("setTransform",e)}transform(...e){return this._callContextMethod("transform",e)}translateTransform(...e){return this._callContextMethod("translate",e)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(e){this._context.fillStyle=e}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(e){this._context.strokeStyle=e}clone(e=!1){return e?new s(this._context.clone()):(this._ownedContext=null,new s(this._context))}lineStyle(e,t,n){(0,r.deprecation)(r.v8_0_0,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");let i={};return e&&(i.width=e),t&&(i.color=t),n&&(i.alpha=n),this.context.strokeStyle=i,this}beginFill(e,t){(0,r.deprecation)(r.v8_0_0,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");let n={};return e&&(n.color=e),t&&(n.alpha=t),this.context.fillStyle=n,this}endFill(){(0,r.deprecation)(r.v8_0_0,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();let e=this.context.strokeStyle;return(e.width!==i.GraphicsContext.defaultStrokeStyle.width||e.color!==i.GraphicsContext.defaultStrokeStyle.color||e.alpha!==i.GraphicsContext.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...e){return(0,r.deprecation)(r.v8_0_0,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",e)}drawEllipse(...e){return(0,r.deprecation)(r.v8_0_0,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",e)}drawPolygon(...e){return(0,r.deprecation)(r.v8_0_0,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",e)}drawRect(...e){return(0,r.deprecation)(r.v8_0_0,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",e)}drawRoundedRect(...e){return(0,r.deprecation)(r.v8_0_0,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",e)}drawStar(...e){return(0,r.deprecation)(r.v8_0_0,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",e)}}});var en=et("eVz1R");const ei={extension:{type:en.ExtensionType.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await et("gkJjD")}};var en=et("eVz1R");const es={extension:{type:en.ExtensionType.Environment,name:"webworker",priority:0},test:()=>"undefined"!=typeof self&&void 0!==self.WorkerGlobalScope,load:async()=>{await et("1Rc9a")}};var en=et("eVz1R");et("28YnR"),et("ipkVP");var en=(et("eVz1R"),et("eVz1R"));const eo=[];async function ea(e){if(e)for(let e=0;e<eo.length;e++){let t=eo[e];if(t.value.test()){await t.value.load();return}}}(0,en.extensions).handleByNamedList(en.ExtensionType.Environment,eo);var el=et("5m2Qn"),eu=et("hVAf0"),el=et("5m2Qn");async function ec(e={}){return void 0!==t?t:t=await (async()=>{if(!(0,el.DOMAdapter).get().getNavigator().gpu)return!1;try{let t=await navigator.gpu.requestAdapter(e);return await t.requestDevice(),!0}catch(e){return!1}})()}var eu=et("hVAf0");const eh=["webgpu","webgl","canvas"];async function ef(t){let r,n=[];t.preference?(n.push(t.preference),eh.forEach(e=>{e!==t.preference&&n.push(e)})):n=eh.slice(),await ea(t.manageImports??!0);let i={};for(let s=0;s<n.length;s++){let o=n[s];if("webgpu"===o&&await ec()){let{WebGPURenderer:e}=await et("bruUF");r=e,i={...t,...t.webgpu};break}if("webgl"===o&&function(t){return void 0!==e?e:e=(()=>{let e={stencil:!0,failIfMajorPerformanceCaveat:t??eu.AbstractRenderer.defaultOptions.failIfMajorPerformanceCaveat};try{if(!(0,el.DOMAdapter).get().getWebGLRenderingContext())return!1;let t=(0,el.DOMAdapter).get().createCanvas().getContext("webgl",e),r=!!t?.getContextAttributes()?.stencil;if(t){let e=t.getExtension("WEBGL_lose_context");e&&e.loseContext()}return t=null,r}catch(e){return!1}})()}(t.failIfMajorPerformanceCaveat??eu.AbstractRenderer.defaultOptions.failIfMajorPerformanceCaveat)){let{WebGLRenderer:e}=await et("7N9qy");r=e,i={...t,...t.webgl};break}if("canvas"===o){i={...t};break}}delete i.webgpu,delete i.webgl;let s=new r;return await s.init(i),s}var ed=et("lR3Ev"),ep=et("eX50w");const em=class e{constructor(...e){this.stage=new ed.Container,void 0!==e[0]&&(0,ep.deprecation)(ep.v8_0_0,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await ef(t),e._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return(0,ep.deprecation)(ep.v8_0_0,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,r=!1){let n=e._plugins.slice(0);n.reverse(),n.forEach(e=>{e.destroy.call(this)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(t),this.renderer=null}};em._plugins=[],(0,en.extensions).handleByList(en.ExtensionType.Application,em._plugins);var en=et("eVz1R"),eg=et("8CF4q");class ev{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<t;r++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}var ey=et("gYSnF"),en=et("eVz1R"),ex=et("5h88T");const eb={extension:en.ExtensionType.CacheParser,test:e=>Array.isArray(e)&&e.every(e=>e instanceof ex.Texture),getCacheableAssets:(e,t)=>{let r={};return e.forEach(e=>{t.forEach((t,n)=>{r[e+(0===n?"":n+1)]=t})}),r}};var en=et("eVz1R");async function e_(e){if("Image"in globalThis)return new Promise(t=>{let r=new Image;r.onload=()=>{t(!0)},r.onerror=()=>{t(!1)},r.src=e});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let t=await (await fetch(e)).blob();await createImageBitmap(t)}catch(e){return!1}return!0}return!1}const eS={extension:{type:en.ExtensionType.DetectionParser,priority:1},test:async()=>e_("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter(e=>"avif"!==e)};var en=et("eVz1R");const eC=["png","jpg","jpeg"],ew={extension:{type:en.ExtensionType.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...eC],remove:async e=>e.filter(e=>!eC.includes(e))};var en=et("eVz1R");const eT="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function eP(e){return!eT&&""!==document.createElement("video").canPlayType(e)}const eA={extension:{type:en.ExtensionType.DetectionParser,priority:0},test:async()=>eP("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter(e=>"mp4"!==e&&"m4v"!==e)};var en=et("eVz1R");const ek={extension:{type:en.ExtensionType.DetectionParser,priority:0},test:async()=>eP("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter(e=>"ogv"!==e)};var en=et("eVz1R");const eM={extension:{type:en.ExtensionType.DetectionParser,priority:0},test:async()=>eP("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter(e=>"webm"!==e)};var en=et("eVz1R");const eR={extension:{type:en.ExtensionType.DetectionParser,priority:0},test:async()=>e_("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter(e=>"webp"!==e)};var eg=et("8CF4q"),eI=et("kaDu9"),eE=et("lbclP"),eO=et("6BHki");class ez{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,r)=>(this._parsersValidated=!1,e[t]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){let r={promise:null,parser:null};return r.promise=(async()=>{let n=null,i=null;if(!t.loadParser||(i=this._parserHash[t.loadParser])||(0,eg.warn)(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`),!i){for(let r=0;r<this.parsers.length;r++){let n=this.parsers[r];if(n.load&&n.test?.(e,t,this)){i=n;break}}if(!i)return(0,eg.warn)(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await i.load(e,t,this),r.parser=i;for(let e=0;e<this.parsers.length;e++){let i=this.parsers[e];i.parse&&i.parse&&await i.testParse?.(n,t,this)&&(n=await i.parse(n,t,this)||n,r.parser=i)}return n})(),r}async load(e,t){this._parsersValidated||this._validateParsers();let r=0,n={},i=(0,eO.isSingleItem)(e),s=(0,eE.convertToList)(e,e=>({alias:[e],src:e})),o=s.length,a=s.map(async e=>{let i=(0,eI.path).toAbsolute(e.src);if(!n[e.src])try{this.promiseCache[i]||(this.promiseCache[i]=this._getLoadPromiseAndParser(i,e)),n[e.src]=await this.promiseCache[i].promise,t&&t(++r/o)}catch(t){throw delete this.promiseCache[i],delete n[e.src],Error(`[Loader.load] Failed to load ${i}.
${t}`)}});return await Promise.all(a),i?n[s[0].src]:n}async unload(e){let t=(0,eE.convertToList)(e,e=>({alias:[e],src:e})).map(async e=>{let t=(0,eI.path).toAbsolute(e.src),r=this.promiseCache[t];if(r){let n=await r.promise;delete this.promiseCache[t],await r.parser?.unload?.(n,e,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(t.name?e[t.name]&&(0,eg.warn)(`[Assets] loadParser name conflict "${t.name}"`):(0,eg.warn)("[Assets] loadParser should have a name"),{...e,[t.name]:t}),{})}}var el=et("5m2Qn"),en=et("eVz1R");function eF(e,t){if(Array.isArray(t)){for(let r of t)if(e.startsWith(`data:${r}`))return!0;return!1}return e.startsWith(`data:${t}`)}var eI=et("kaDu9");function eU(e,t){let r=e.split("?")[0],n=(0,eI.path).extname(r).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}var eD=et("kuLtH");const eB={extension:{type:en.ExtensionType.LoadParser,priority:eD.LoaderParserPriority.Low},name:"loadJson",test:e=>eF(e,"application/json")||eU(e,".json"),async load(e){let t=await (0,el.DOMAdapter).get().fetch(e);return await t.json()}};var el=et("5m2Qn"),en=et("eVz1R"),eD=et("kuLtH");const eL={name:"loadTxt",extension:{type:en.ExtensionType.LoadParser,priority:eD.LoaderParserPriority.Low},test:e=>eF(e,"text/plain")||eU(e,".txt"),async load(e){let t=await (0,el.DOMAdapter).get().fetch(e);return await t.text()}};var el=et("5m2Qn"),en=et("eVz1R"),eg=et("8CF4q"),eI=et("kaDu9"),ey=et("gYSnF"),eD=et("kuLtH");const eG=["normal","bold","100","200","300","400","500","600","700","800","900"],ej=[".ttf",".otf",".woff",".woff2"],eN=["font/ttf","font/otf","font/woff","font/woff2"],eV=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,eX=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/,eY={extension:{type:en.ExtensionType.LoadParser,priority:eD.LoaderParserPriority.Low},name:"loadWebFont",test:e=>eF(e,eN)||eU(e,ej),async load(e,t){let r=(0,el.DOMAdapter).get().getFontFaceSet();if(r){let n=[],i=t.data?.family??function(e){let t=(0,eI.path).extname(e),r=(0,eI.path).basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)),n=r.length>0;for(let e of r)if(!e.match(eV)){n=!1;break}let i=r.join(" ");return n||(i=`"${i.replace(/[\\"]/g,"\\$&")}"`),i}(e),s=t.data?.weights?.filter(e=>eG.includes(e))??["normal"],o=t.data??{};for(let t=0;t<s.length;t++){let a=s[t],l=new FontFace(i,`url(${eX.test(e)?e:encodeURI(e)})`,{...o,weight:a});await l.load(),r.add(l),n.push(l)}return(0,ey.Cache).set(`${i}-and-url`,{url:e,fontFaces:n}),1===n.length?n[0]:n}return(0,eg.warn)("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(e=>{(0,ey.Cache).remove(e.family),(0,el.DOMAdapter).get().getFontFaceSet().delete(e)})}};var el=et("5m2Qn"),en=et("eVz1R"),eH=et("4XrO5"),eW=et("hTvsP"),eq=et("Lmcdo");function e$(e,t=1){let r=eq.Resolver.RETINA_PREFIX?.exec(e);return r?parseFloat(r[1]):t}var eD=et("kuLtH"),ex=et("5h88T"),eg=et("8CF4q"),ey=et("gYSnF");function eK(e,t,r){e.label=r,e._sourceOrigin=r;let n=new ex.Texture({source:e,label:r}),i=()=>{delete t.promiseCache[r],(0,ey.Cache).has(r)&&(0,ey.Cache).remove(r)};return n.source.once("destroy",()=>{t.promiseCache[r]&&((0,eg.warn)("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),i())}),n.once("destroy",()=>{e.destroyed||((0,eg.warn)("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),i())}),n}const eQ={extension:{type:en.ExtensionType.LoadParser,priority:eD.LoaderParserPriority.Low},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test:e=>eF(e,"image/svg+xml")||eU(e,".svg"),async load(e,t,r){return t.data.parseAsGraphicsContext??this.config.parseAsGraphicsContext?eZ(e):eJ(e,t,r,this.config.crossOrigin)},unload(e){e.destroy(!0)}};async function eJ(e,t,r,n){let i=await (0,el.DOMAdapter).get().fetch(e),s=await i.blob(),o=URL.createObjectURL(s),a=new Image;a.src=o,a.crossOrigin=n,await a.decode(),URL.revokeObjectURL(o);let l=document.createElement("canvas"),u=l.getContext("2d"),c=t.data?.resolution||e$(e),h=t.data?.width??a.width,f=t.data?.height??a.height;l.width=h*c,l.height=f*c,u.drawImage(a,0,0,h*c,f*c);let{parseAsGraphicsContext:d,...p}=t.data;return eK(new eH.ImageSource({resource:l,alphaMode:"premultiply-alpha-on-upload",resolution:c,...p}),r,e)}async function eZ(e){let t=await (0,el.DOMAdapter).get().fetch(e),r=await t.text(),n=new eW.GraphicsContext;return n.svg(r),n}var el=et("5m2Qn"),en=et("eVz1R"),eH=et("4XrO5");let e0=null;class e2{constructor(){e0||(e0=URL.createObjectURL(new Blob(['(function () {\n    \'use strict\';\n\n    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n    async function checkImageBitmap() {\n      try {\n        if (typeof createImageBitmap !== "function")\n          return false;\n        const response = await fetch(WHITE_PNG);\n        const imageBlob = await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n        return imageBitmap.width === 1 && imageBitmap.height === 1;\n      } catch (e) {\n        return false;\n      }\n    }\n    void checkImageBitmap().then((result) => {\n      self.postMessage(result);\n    });\n\n})();\n'],{type:"application/javascript"}))),this.worker=new Worker(e0)}}e2.revokeObjectURL=function(){e0&&(URL.revokeObjectURL(e0),e0=null)};let e1=null;class e3{constructor(){e1||(e1=URL.createObjectURL(new Blob(["(function () {\n    'use strict';\n\n    async function loadImageBitmap(url) {\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n      }\n      const imageBlob = await response.blob();\n      const imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap;\n    }\n    self.onmessage = async (event) => {\n      try {\n        const imageBitmap = await loadImageBitmap(event.data.data[0]);\n        self.postMessage({\n          data: imageBitmap,\n          uuid: event.data.uuid,\n          id: event.data.id\n        }, [imageBitmap]);\n      } catch (e) {\n        self.postMessage({\n          error: e,\n          uuid: event.data.uuid,\n          id: event.data.id\n        });\n      }\n    };\n\n})();\n"],{type:"application/javascript"}))),this.worker=new Worker(e1)}}e3.revokeObjectURL=function(){e1&&(URL.revokeObjectURL(e1),e1=null)};let e4=0;const e5=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(e=>{let{worker:t}=new e2;t.addEventListener("message",r=>{t.terminate(),e2.revokeObjectURL(),e(r.data)})})),this._isImageBitmapSupported}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){void 0===r&&(r=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<r&&(this._createdWorkers++,(e=new e3().worker).addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){void 0!==e.error?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();let r=new Promise((r,n)=>{this._queue.push({id:e,arguments:t,resolve:r,reject:n})});return this._next(),r}_next(){if(!this._queue.length)return;let e=this._getWorker();if(!e)return;let t=this._queue.pop(),r=t.id;this._resolveHash[e4]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:e4++,id:r})}};var eD=et("kuLtH");const e6=[".jpeg",".jpg",".png",".webp",".avif"],e8=["image/jpeg","image/png","image/webp","image/avif"];async function e9(e){let t=await (0,el.DOMAdapter).get().fetch(e);if(!t.ok)throw Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);let r=await t.blob();return await createImageBitmap(r)}const e7={name:"loadTextures",extension:{type:en.ExtensionType.LoadParser,priority:eD.LoaderParserPriority.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>eF(e,e8)||eU(e,e6),async load(e,t,r){let n=null;return n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await e5.isImageBitmapSupported()?await e5.loadImageBitmap(e):await e9(e):await new Promise(t=>{(n=new Image).crossOrigin=this.config.crossOrigin,n.src=e,n.complete?t(n):n.onload=()=>{t(n)}}),eK(new eH.ImageSource({resource:n,alphaMode:"premultiply-alpha-on-upload",resolution:t.data?.resolution||e$(e),...t.data}),r,e)},unload(e){e.destroy(!0)}};var en=et("eVz1R"),te=et("c9SSH"),tt=et("aG1Od");const tr=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],tn=tr.map(e=>`video/${e.substring(1)}`),ti={name:"loadVideo",extension:{type:en.ExtensionType.LoadParser},config:null,test(e){let t=eF(e,tn),r=eU(e,tr);return t||r},async load(e,t,r){var n;let i;let s={...te.VideoSource.defaultOptions,resolution:t.data?.resolution||e$(e),alphaMode:t.data?.alphaMode||await (0,tt.detectVideoAlphaMode)(),...t.data},o=document.createElement("video"),a={preload:!1!==s.autoLoad?"auto":void 0,"webkit-playsinline":!1!==s.playsinline?"":void 0,playsinline:!1!==s.playsinline?"":void 0,muted:!0===s.muted?"":void 0,loop:!0===s.loop?"":void 0,autoplay:!1!==s.autoPlay?"":void 0};Object.keys(a).forEach(e=>{let t=a[e];void 0!==t&&o.setAttribute(e,t)}),!0===s.muted&&(o.muted=!0),void 0!==(n=s.crossorigin)||e.startsWith("data:")?!1!==n&&(o.crossOrigin="string"==typeof n?n:"anonymous"):o.crossOrigin=function(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location;let r=new URL(e,document.baseURI);return r.hostname!==t.hostname||r.port!==t.port||r.protocol!==t.protocol?"anonymous":""}(e);let l=document.createElement("source");if(e.startsWith("data:"))i=e.slice(5,e.indexOf(";"));else if(!e.startsWith("blob:")){let t=e.split("?")[0].slice(e.lastIndexOf(".")+1).toLowerCase();i=te.VideoSource.MIME_TYPES[t]||`video/${t}`}return l.src=e,i&&(l.type=i),new Promise(n=>{let i=async()=>{let a=new te.VideoSource({...s,resource:o});o.removeEventListener("canplay",i),t.data.preload&&await new Promise((e,t)=>{function r(){i(),e()}function n(e){i(),t(e)}function i(){o.removeEventListener("canplaythrough",r),o.removeEventListener("error",n)}o.addEventListener("canplaythrough",r),o.addEventListener("error",n),o.load()}),n(eK(a,r,e))};o.addEventListener("canplay",i),o.appendChild(l)})},unload(e){e.destroy(!0)}};var en=et("eVz1R"),eq=et("Lmcdo"),en=et("eVz1R"),eq=et("Lmcdo");const ts={extension:en.ExtensionType.ResolveParser,test:e7.test,parse:e=>({resolution:parseFloat(eq.Resolver.RETINA_PREFIX.exec(e)?.[1]??"1"),format:e.split(".").pop(),src:e})},to={extension:en.ExtensionType.ResolveParser,test:e=>(0,eq.Resolver).RETINA_PREFIX.test(e)&&e.endsWith(".json"),parse:ts.parse};var eq=et("Lmcdo"),eE=et("lbclP"),eO=et("6BHki");const ta=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new eq.Resolver,this.loader=new ez,this.cache=ey.Cache,this._backgroundLoader=new ev(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){(0,eg.warn)("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;"string"==typeof t&&(t=await this.load(t)),this.resolver.addManifest(t)}let t=e.texturePreference?.resolution??1,r=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:"number"==typeof t?[t]:t}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,t){this._initialized||await this.init();let r=(0,eO.isSingleItem)(e),n=(0,eE.convertToList)(e).map(e=>{if("string"!=typeof e){let t=this.resolver.getAlias(e);return t.some(e=>!this.resolver.hasKey(e))&&this.add(e),Array.isArray(t)?t[0]:t}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e}),i=this.resolver.resolve(n),s=await this._mapLoadToResolve(i,t);return r?s[n[0]]:s}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let r=!1;"string"==typeof e&&(r=!0,e=[e]);let n=this.resolver.resolveBundle(e),i={},s=Object.keys(n),o=0,a=0,l=()=>{t?.(++o/a)},u=s.map(e=>{let t=n[e];return a+=Object.keys(t).length,this._mapLoadToResolve(t,l).then(t=>{i[e]=t})});return await Promise.all(u),r?i[e[0]]:i}async backgroundLoad(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);let t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]),Object.values(this.resolver.resolveBundle(e)).forEach(e=>{this._backgroundLoader.add(Object.values(e))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return(0,ey.Cache).get(e);let t={};for(let r=0;r<e.length;r++)t[r]=(0,ey.Cache).get(e[r]);return t}async _mapLoadToResolve(e,t){let r=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;let n=await this.loader.load(r,t);this._backgroundLoader.active=!0;let i={};return r.forEach(e=>{let t=n[e.src],r=[e.src];e.alias&&r.push(...e.alias),r.forEach(e=>{i[e]=t}),(0,ey.Cache).set(r,t)}),i}async unload(e){this._initialized||await this.init();let t=(0,eE.convertToList)(e).map(e=>"string"!=typeof e?e.src:e),r=this.resolver.resolve(t);await this._unloadFromResolved(r)}async unloadBundle(e){this._initialized||await this.init(),e=(0,eE.convertToList)(e);let t=this.resolver.resolveBundle(e),r=Object.keys(t).map(e=>this._unloadFromResolved(t[e]));await Promise.all(r)}async _unloadFromResolved(e){let t=Object.values(e);t.forEach(e=>{(0,ey.Cache).remove(e.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];for(let r of(e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]),e.detections))e.skipDetections||await r.test()?t=await r.add(t):e.skipDetections||(t=await r.remove(t));return t=t.filter((e,r)=>t.indexOf(e)===r)}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(t=>t in e).forEach(r=>{t.config[r]=e[r]})})}};(0,en.extensions).handleByList(en.ExtensionType.LoadParser,ta.loader.parsers).handleByList(en.ExtensionType.ResolveParser,ta.resolver.parsers).handleByList(en.ExtensionType.CacheParser,ta.cache.parsers).handleByList(en.ExtensionType.DetectionParser,ta.detections),(0,en.extensions).add(eb,ew,eS,eR,eA,ek,eM,eB,eL,eY,eQ,e7,ti,ts,to);const tl={loader:en.ExtensionType.LoadParser,resolver:en.ExtensionType.ResolveParser,cache:en.ExtensionType.CacheParser,detection:en.ExtensionType.DetectionParser};(0,en.extensions).handle(en.ExtensionType.Asset,e=>{let t=e.ref;Object.entries(tl).filter(([e])=>!!t[e]).forEach(([e,r])=>(0,en.extensions).add(Object.assign(t[e],{extension:t[e].extension??r})))},e=>{let t=e.ref;Object.keys(tl).filter(e=>!!t[e]).forEach(e=>(0,en.extensions).remove(t[e]))});var tu=et("AHTcQ"),tc=et("2AaNu"),th=et("9IRF4"),tf=et("lJEsO"),td=et("hskgj"),tp="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct AlphaUniforms {\n  uAlpha:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n \n    var sample = textureSample(uTexture, uSampler, uv);\n    \n    return sample * alphaUniforms.uAlpha;\n}";const tm=class e extends td.Filter{constructor(t){t={...e.defaultOptions,...t};let r=(0,th.GpuProgram).from({vertex:{source:tp,entryPoint:"mainVertex"},fragment:{source:tp,entryPoint:"mainFragment"}}),n=(0,tc.GlProgram).from({vertex:"in vec2 aPosition;\nout vec2 vTextureCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",fragment:"\nin vec2 vTextureCoord;\n\nout vec4 finalColor;\n\nuniform float uAlpha;\nuniform sampler2D uTexture;\n\nvoid main()\n{\n    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;\n}\n",name:"alpha-filter"}),{alpha:i,...s}=t;super({...s,gpuProgram:r,glProgram:n,resources:{alphaUniforms:new tf.UniformGroup({uAlpha:{value:i,type:"f32"}})}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};tm.defaultOptions={alpha:1};let tg=tm;var tv=et("7U2uj"),ty=et("dgEnR"),ep=et("eX50w"),td=et("hskgj"),tv=et("7U2uj"),ty=et("dgEnR"),td=et("hskgj"),tc=et("2AaNu");const tx={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},tb=`
    in vec2 aPosition;

    uniform float uStrength;

    out vec2 vBlurTexCoords[%size%];

    uniform vec4 uInputSize;
    uniform vec4 uOutputFrame;
    uniform vec4 uOutputTexture;

    vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

    vec2 filterTextureCoord( void )
    {
        return aPosition * (uOutputFrame.zw * uInputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        float pixelStrength = uInputSize.%dimension% * uStrength;

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;var th=et("9IRF4");const t_=class e extends td.Filter{constructor(t){super({glProgram:function(e,t){let r=function(e,t){let r;let n=Math.ceil(e/2),i=tb,s="";r=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * pixelStrength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * pixelStrength);";for(let t=0;t<e;t++){let e=r.replace("%index%",t.toString());s+=(e=e.replace("%sampleIndex%",`${t-(n-1)}.0`))+"\n"}return(i=(i=i.replace("%blur%",s)).replace("%size%",e.toString())).replace("%dimension%",t?"z":"w")}(t,e),n=function(e){let t;let r=tx[e],n=r.length,i="in vec2 vBlurTexCoords[%size%];\nuniform sampler2D uTexture;\nout vec4 finalColor;\nvoid main(void)\n{\n    finalColor = vec4(0.0);\n    %blur%\n}",s="";for(let i=0;i<e;i++){let o="finalColor += texture(uTexture, vBlurTexCoords[%index%]) * %value%;".replace("%index%",i.toString());t=i,i>=n&&(t=e-i-1),s+=(o=o.replace("%value%",r[t].toString()))+"\n"}return(i=i.replace("%blur%",s)).replace("%size%",e.toString())}(t);return(0,tc.GlProgram).from({vertex:r,fragment:n,name:`blur-${e?"horizontal":"vertical"}-pass-filter`})}((t={...e.defaultOptions,...t}).horizontal,t.kernelSize),gpuProgram:function(e,t){let r=tx[t],n=r.length,i=[],s=[],o=[];for(let a=0;a<t;a++){i[a]=`@location(${a}) offset${a}: vec2<f32>,`,e?s[a]=`filteredCord + vec2(${a-n+1} * strength, 0.0),`:s[a]=`filteredCord + vec2(0.0, ${a-n+1} * strength),`;let l=r[a<n?a:t-a-1].toString();o[a]=`finalColor += textureSample(uTexture, uSampler, offset${a}) * ${l};`}let a=i.join("\n"),l=s.join("\n"),u=o.join("\n"),c="\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct BlurUniforms {\n  uStrength:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> blurUniforms : BlurUniforms;\n\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    %blur-struct%\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n\n  let filteredCord = filterTextureCoord(aPosition);\n\n  let strength = gfu.uInputSize.w * blurUniforms.uStrength;\n\n  return VSOutput(\n   filterVertexPosition(aPosition),\n    %blur-vertex-out%\n  );\n}\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  %blur-fragment-in%\n) -> @location(0) vec4<f32> {\n\n    var   finalColor = vec4(0.0);\n\n    %blur-sampling%\n\n    return finalColor;\n}".replace("%blur-struct%",a).replace("%blur-vertex-out%",l).replace("%blur-fragment-in%",a).replace("%blur-sampling%",u);return(0,th.GpuProgram).from({vertex:{source:c,entryPoint:"mainVertex"},fragment:{source:c,entryPoint:"mainFragment"}})}(t.horizontal,t.kernelSize),resources:{blurUniforms:{uStrength:{value:0,type:"f32"}}},...t}),this.horizontal=t.horizontal,this._quality=0,this.quality=t.quality,this.blur=t.strength,this._uniforms=this.resources.blurUniforms.uniforms}apply(e,t,r,n){if(this._uniforms.uStrength=this.strength/this.passes,1===this.passes)e.applyFilter(this,t,r,n);else{let i=(0,tv.TexturePool).getSameSizeTexture(t),s=t,o=i;this._state.blend=!1;for(let t=0;t<this.passes-1;t++){e.applyFilter(this,s,o,e.renderer.type===ty.RendererType.WEBGPU);let t=o;o=s,s=t}this._state.blend=!0,e.applyFilter(this,s,r,n),(0,tv.TexturePool).returnTexture(i)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}};t_.defaultOptions={strength:8,quality:4,kernelSize:5};class tS extends td.Filter{constructor(...e){let t=e[0]??{};"number"==typeof t&&((0,ep.deprecation)(ep.v8_0_0,"BlurFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }"),t={strength:t},e[1]&&(t.quality=e[1]),e[2]&&(t.resolution=e[2]),e[3]&&(t.kernelSize=e[3]));let{strength:r,quality:n,...i}=t={...t_.defaultOptions,...t};super({...i,compatibleRenderers:ty.RendererType.BOTH,resources:{}}),this._repeatEdgePixels=!1,this.blurXFilter=new t_({horizontal:!1,...t}),this.blurYFilter=new t_({horizontal:!0,...t}),this.quality=n,this.blur=r,this.repeatEdgePixels=!1}apply(e,t,r,n){let i=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(i&&s){let i=(0,tv.TexturePool).getSameSizeTexture(t);this.blurXFilter.apply(e,t,i,!0),this.blurYFilter.apply(e,i,r,n),(0,tv.TexturePool).returnTexture(i)}else s?this.blurYFilter.apply(e,t,r,n):this.blurXFilter.apply(e,t,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.blur),Math.abs(this.blurYFilter.blur))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}tS.defaultOptions={strength:8,quality:4,kernelSize:5};var td=et("hskgj"),tC=et("gIu8o"),tw=et("ep73P");et("2NXni");var tc=et("2AaNu"),th=et("9IRF4"),eH=et("4XrO5"),tT=et("9Ur0D"),ex=et("5h88T"),tv=et("7U2uj");et("i4n4u");var ed=et("lR3Ev"),tP=et("C9JRY"),tA=et("9Qy7u");et("gpXaq");var ep=et("eX50w");et("eH7tg"),(0,en.extensions).add(ei,es);class tk{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){let e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){let e=[];for(let t of this._parts)e.push(t);return function(e){let t=0;for(let r of e)t+=r.byteLength;let r=new Uint8Array(t),n=0;for(let t of e){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);r.set(e,n),n+=t.byteLength}return r}(e).buffer}}function tM(e){return new tI(e).unpack()}function tR(e){let t=new tE,r=t.pack(e);return r instanceof Promise?r.then(()=>t.getBuffer()):t.getBuffer()}class tI{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){let e;let t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}}unpack_uint8(){let e=255&this.dataView[this.index];return this.index++,e}unpack_uint16(){let e=this.read(2),t=(255&e[0])*256+(255&e[1]);return this.index+=2,t}unpack_uint32(){let e=this.read(4),t=((256*e[0]+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){let e=this.read(8),t=((((((256*e[0]+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){let e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){let e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){let e=this.unpack_uint32();return e<2147483648?e:e-4294967296}unpack_int64(){let e=this.unpack_uint64();return e<0x7fffffffffffffff?e:e-18446744073709552e3}unpack_raw(e){if(this.length<this.index+e)throw Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);let t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){let t,r;let n=this.read(e),i=0,s="";for(;i<e;)(t=n[i])<160?(r=t,i++):(192^t)<32?(r=(31&t)<<6|63&n[i+1],i+=2):(224^t)<16?(r=(15&t)<<12|(63&n[i+1])<<6|63&n[i+2],i+=3):(r=(7&t)<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3],i+=4),s+=String.fromCodePoint(r);return this.index+=e,s}unpack_array(e){let t=Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){let t={};for(let r=0;r<e;r++)t[this.unpack()]=this.unpack();return t}unpack_float(){let e=this.unpack_uint32();return(0==e>>31?1:-1)*(8388607&e|8388608)*2**((e>>23&255)-127-23)}unpack_double(){let e=this.unpack_uint32(),t=this.unpack_uint32(),r=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*2**(r-20)+t*2**(r-52))}read(e){let t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw Error("BinaryPackFailure: read index out of range")}}class tE{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if("string"==typeof e)this.pack_string(e);else if("number"==typeof e)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==typeof e)!0===e?this._bufferBuilder.append(195):!1===e&&this._bufferBuilder.append(194);else if(void 0===e)this._bufferBuilder.append(192);else if("object"==typeof e){if(null===e)this._bufferBuilder.append(192);else{let t=e.constructor;if(e instanceof Array){let t=this.pack_array(e);if(t instanceof Promise)return t.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e)this.pack_bin(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));else if(e instanceof Date)this.pack_string(e.toString());else if(e instanceof Blob)return e.arrayBuffer().then(e=>{this.pack_bin(new Uint8Array(e)),this._bufferBuilder.flush()});else if(t==Object||t.toString().startsWith("class")){let t=this.pack_object(e);if(t instanceof Promise)return t.then(()=>this._bufferBuilder.flush())}else throw Error(`Type "${t.toString()}" not yet supported`)}}else throw Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){let t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){let t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){let t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw Error("Invalid length");let r=n=>{if(n<t){let t=this.pack(e[n]);return t instanceof Promise?t.then(()=>r(n+1)):r(n+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(255&e);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x7fffffffffffffff)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);let r=Math.floor(Math.log(e)/Math.LN2),n=Math.floor((e/2**r-1)*4503599627370496),i=t<<31|r+1023<<20|n/4294967296&1048575;this._bufferBuilder.append(203),this.pack_int32(i),this.pack_int32(n%4294967296)}pack_object(e){let t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw Error("Invalid length");let n=r=>{if(r<t.length){let i=t[r];if(e.hasOwnProperty(i)){this.pack(i);let t=this.pack(e[i]);if(t instanceof Promise)return t.then(()=>n(r+1))}return n(r+1)}};return n(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(255&e)}pack_uint32(e){let t=4294967295&e;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t)}pack_uint64(e){let t=e/4294967296,r=e%4294967296;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t),this._bufferBuilder.append((4278190080&r)>>>24),this._bufferBuilder.append((16711680&r)>>>16),this._bufferBuilder.append((65280&r)>>>8),this._bufferBuilder.append(255&r)}pack_int8(e){this._bufferBuilder.append(255&e)}pack_int16(e){this._bufferBuilder.append((65280&e)>>8),this._bufferBuilder.append(255&e)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((16711680&e)>>>16),this._bufferBuilder.append((65280&e)>>>8),this._bufferBuilder.append(255&e)}pack_int64(e){let t=Math.floor(e/4294967296),r=e%4294967296;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t),this._bufferBuilder.append((4278190080&r)>>>24),this._bufferBuilder.append((16711680&r)>>>16),this._bufferBuilder.append((65280&r)>>>8),this._bufferBuilder.append(255&r)}constructor(){this._bufferBuilder=new tk,this._textEncoder=new TextEncoder}}let tO=!0,tz=!0;function tF(e,t,r){let n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function tU(e,t,r){if(!e.RTCPeerConnection)return;let n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);let s=e=>{let t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,s),i.apply(this,[e,s])};let s=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(r))return s.apply(this,arguments);let n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function tD(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(tO=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function tB(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(tz=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function tL(){"object"!=typeof window||tO||"undefined"==typeof console||"function"!=typeof console.log||console.log.apply(console,arguments)}function tG(e,t){tz&&console.warn(e+" is deprecated, please use "+t+" instead.")}function tj(e){return"[object Object]"===Object.prototype.toString.call(e)}function tN(e,t,r){let n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;let s=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(t=>{e.forEach(r=>{r.type===n&&r.trackId===t.id&&function e(t,r,n){!r||n.has(r.id)||(n.set(r.id,r),Object.keys(r).forEach(i=>{i.endsWith("Id")?e(t,t.get(r[i]),n):i.endsWith("Ids")&&r[i].forEach(r=>{e(t,t.get(r),n)})}))}(e,r,i)})}),i}var tV={};function tX(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach(r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;let n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);let i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[i("min",r)]=n.ideal,t.optional.push(e),(e={})[i("max",r)]=n.ideal):e[i("",r)]=n.ideal,t.optional.push(e)}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});let o=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!o)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:("user"===s.exact||"user"===s.ideal)&&(t=["front"]),t)return r.mediaDevices.enumerateDevices().then(r=>{let o=(r=r.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!o&&r.length&&t.includes("back")&&(o=r[r.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=n(e.video),tL("chrome: "+JSON.stringify(e)),i(e)})}e.video=n(e.video)}return tL("chrome: "+JSON.stringify(e)),i(e)},s=function(e){return t.version>=64?e:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(e,t,n){i(e,e=>{r.webkitGetUserMedia(e,t,e=>{n&&n(s(e))})})}).bind(r),r.mediaDevices.getUserMedia){let e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(s(e))))}}}function tY(e,t){if((!e.navigator.mediaDevices||!("getDisplayMedia"in e.navigator.mediaDevices))&&e.navigator.mediaDevices){if("function"!=typeof t){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(t=>{let n=r.video&&r.video.width,i=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)})}}}function tH(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function tW(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)tU(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.track.id):{track:r.track};let i=new Event("track");i.track=r.track,i.receiver=n,i.transceiver={receiver:n},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.id):{track:r};let i=new Event("track");i.track=r,i.receiver=n,i.transceiver={receiver:n},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function tq(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};let n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{let t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function t$(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,r,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0==arguments.length||"function"!=typeof e))return t.apply(this,[]);let i=function(e){let t={};return e.result().forEach(e=>{let r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};return arguments.length>=2?t.apply(this,[function(e){r(s(i(e)))},e]):new Promise((e,r)=>{t.apply(this,[function(t){e(s(i(t)))},r])}).then(r,n)}}function tK(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>tN(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),tU(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>tN(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,r;let n=arguments[0];return(this.getSenders().forEach(t=>{t.track===n&&(e?r=!0:e=t)}),this.getReceivers().forEach(e=>(e.track===n&&(t?r=!0:t=e),e.track===n)),r||e&&t)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function tQ(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let t=this.getSenders();r.apply(this,arguments);let n=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(n)};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{let r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function tJ(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return tQ(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){let r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}n.apply(this,[t])};let i=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){let e=arguments,t=arguments.length&&"function"==typeof arguments[0];return t?r.apply(this,[t=>{let r=s(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(e=>s(this,e))}})[t]});let o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t;let r;return arguments.length&&arguments[0].type&&(arguments[0]=(e=this,t=arguments[0],r=t.sdp,Object.keys(e._reverseStreams||[]).forEach(t=>{let n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r}))),o.apply(this,arguments)};let a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){let t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(r=>{this._streams[r].getTracks().find(t=>e.track===t)&&(t=this._streams[r])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function tZ(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}})[t]})}function t0(e,t){tU(e,"negotiationneeded",e=>{let r=e.target;if(!(t.version<72)&&(!r.getConfiguration||"plan-b"!==r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e})}C(tV,"shimMediaStream",()=>tH),C(tV,"shimOnTrack",()=>tW),C(tV,"shimGetSendersWithDtmf",()=>tq),C(tV,"shimGetStats",()=>t$),C(tV,"shimSenderReceiverGetStats",()=>tK),C(tV,"shimAddTrackRemoveTrackWithNative",()=>tQ),C(tV,"shimAddTrackRemoveTrack",()=>tJ),C(tV,"shimPeerConnection",()=>tZ),C(tV,"fixNegotiationNeeded",()=>t0),C(tV,"shimGetUserMedia",()=>tX),C(tV,"shimGetDisplayMedia",()=>tY);var t2={};function t1(e,t){let r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){tG("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(e((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},n&&n.prototype.getSettings){let t=n.prototype.getSettings;n.prototype.getSettings=function(){let r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(n&&n.prototype.applyConstraints){let t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(e(r=JSON.parse(JSON.stringify(r)),"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function t3(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function t4(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function t5(e,t){if("object"!=typeof e||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}})[t]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,i,s]=arguments;return n.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(i,s)}}function t6(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function t8(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),tU(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function t9(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){tG("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function t7(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function re(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);let r=(e=[...e]).length>0;r&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let n=t.apply(this,arguments);if(r){let{sender:t}=n,r=t.getParameters();"encodings"in r&&(1!==r.encodings.length||0!==Object.keys(r.encodings[0]).length)||(r.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(r).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return n})}function rt(e){if(!("object"==typeof e&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function rr(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function rn(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}C(t2,"shimOnTrack",()=>t4),C(t2,"shimPeerConnection",()=>t5),C(t2,"shimSenderGetStats",()=>t6),C(t2,"shimReceiverGetStats",()=>t8),C(t2,"shimRemoveStream",()=>t9),C(t2,"shimRTCDataChannel",()=>t7),C(t2,"shimAddTransceiver",()=>re),C(t2,"shimGetParameters",()=>rt),C(t2,"shimCreateOffer",()=>rr),C(t2,"shimCreateAnswer",()=>rn),C(t2,"shimGetUserMedia",()=>t1),C(t2,"shimGetDisplayMedia",()=>t3);var ri={};function rs(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(r=>t.call(this,r,e)),e.getVideoTracks().forEach(r=>t.call(this,r,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let r=e.getTracks();this.getSenders().forEach(e=>{r.includes(e.track)&&this.removeTrack(e)})})}}function ro(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);let t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let r=new Event("addstream");r.stream=t,e.dispatchEvent(r)})}),t.apply(e,arguments)}}}function ra(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){let n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){let r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};let a=function(e,t,r){let n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,r){let n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,r){let n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=a}function rl(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(ru(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}).bind(t))}function ru(e){return e&&void 0!==e.video?Object.assign({},e,{video:function e(t){return tj(t)?Object.keys(t).reduce(function(r,n){let i=tj(t[n]),s=i?e(t[n]):t[n],o=i&&!Object.keys(s).length;return void 0===s||o?r:Object.assign(r,{[n]:s})},{}):t}(e.video)}):e}function rc(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){let t=[];for(let r=0;r<e.iceServers.length;r++){let n=e.iceServers[r];void 0===n.urls&&n.url?(tG("RTCIceServer.url","RTCIceServer.urls"),(n=JSON.parse(JSON.stringify(n))).urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function rh(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rf(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let r=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function rd(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}C(ri,"shimLocalStreamsAPI",()=>rs),C(ri,"shimRemoteStreamsAPI",()=>ro),C(ri,"shimCallbacksAPI",()=>ra),C(ri,"shimGetUserMedia",()=>rl),C(ri,"shimConstraints",()=>ru),C(ri,"shimRTCIceServerUrls",()=>rc),C(ri,"shimTrackEventTransceiver",()=>rh),C(ri,"shimCreateOfferLegacy",()=>rf),C(ri,"shimAudioContext",()=>rd);var rp={};C(rp,"shimRTCIceCandidate",()=>rv),C(rp,"shimRTCIceCandidateRelayProtocol",()=>ry),C(rp,"shimMaxMessageSize",()=>rx),C(rp,"shimSendThrowTypeError",()=>rb),C(rp,"shimConnectionState",()=>r_),C(rp,"removeExtmapAllowMixed",()=>rS),C(rp,"shimAddIceCandidateNullOrEmpty",()=>rC),C(rp,"shimParameterlessSetLocalDescription",()=>rw);var rm={};const rg={};function rv(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){let r=new t(e),n=w(rm).parseCandidate(e.candidate);for(let e in n)e in r||Object.defineProperty(r,e,{value:n[e]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,tU(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function ry(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||tU(e,"icecandidate",e=>{if(e.candidate){let t=w(rm).parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[t.priority>>24])}return e})}function rx(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let r=function(e){if(!e||!e.sdp)return!1;let t=w(rm).splitSections(e.sdp);return t.shift(),t.some(e=>{let t=w(rm).parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},n=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return -1;let r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},s=function(e,r){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);let i=w(rm).matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substring(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let e;let t=n(arguments[0]),r=i(t),o=s(arguments[0],t);e=0===r&&0===o?Number.POSITIVE_INFINITY:0===r||0===o?Math.max(r,o):Math.min(r,o);let a={};Object.defineProperty(a,"maxMessageSize",{get:()=>e}),this._sctp=a}return o.apply(this,arguments)}}function rb(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let r=e.send;e.send=function(){let n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=r.apply(this,arguments);return t(e,this),e},tU(e,"datachannel",e=>(t(e.channel,e.target),e))}function r_(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{let r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function rS(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let r=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function rC(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function rw(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(!(e={type:e.type,sdp:e.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?r.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>r.apply(this,[e]))})}rg.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},rg.localCName=rg.generateIdentifier(),rg.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},rg.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},rg.getDescription=function(e){let t=rg.splitSections(e);return t&&t[0]},rg.getMediaSections=function(e){let t=rg.splitSections(e);return t.shift(),t},rg.matchPrefix=function(e,t){return rg.splitLines(e).filter(e=>0===e.indexOf(t))},rg.parseCandidate=function(e){let t;let r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1],10);break;case"tcptype":r.tcpType=t[e+1];break;case"ufrag":r.ufrag=t[e+1],r.usernameFragment=t[e+1];break;default:void 0===r[t[e]]&&(r[t[e]]=t[e+1])}return r},rg.writeCandidate=function(e){let t=[];t.push(e.foundation);let r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},rg.parseIceOptions=function(e){return e.substring(14).split(" ")},rg.parseRtpMap=function(e){let t=e.substring(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},rg.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},rg.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},rg.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},rg.parseFmtp=function(e){let t;let r={},n=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<n.length;e++)r[(t=n[e].trim().split("="))[0].trim()]=t[1];return r},rg.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let n=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},rg.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},rg.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},rg.parseSsrcMedia=function(e){let t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substring(t+1,n),r.value=e.substring(n+1)):r.attribute=e.substring(t+1),r},rg.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},rg.getMid=function(e){let t=rg.matchPrefix(e,"a=mid:")[0];if(t)return t.substring(6)},rg.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},rg.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:rg.matchPrefix(e+t,"a=fingerprint:").map(rg.parseFingerprint)}},rg.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},rg.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},rg.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?rg.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},rg.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},rg.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},rg.getCryptoParameters=function(e,t){return rg.matchPrefix(e+t,"a=crypto:").map(rg.parseCryptoLine)},rg.getIceParameters=function(e,t){let r=rg.matchPrefix(e+t,"a=ice-ufrag:")[0],n=rg.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substring(12),password:n.substring(10)}:null},rg.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},rg.parseRtpParameters=function(e){let t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=rg.splitLines(e)[0].split(" ");t.profile=r[2];for(let n=3;n<r.length;n++){let i=r[n],s=rg.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){let r=rg.parseRtpMap(s),n=rg.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=n.length?rg.parseFmtp(n[0]):{},r.rtcpFeedback=rg.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(rg.parseRtcpFb),t.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(r.name.toUpperCase())}}}rg.matchPrefix(e,"a=extmap:").forEach(e=>{t.headerExtensions.push(rg.parseExtmap(e))});let n=rg.matchPrefix(e,"a=rtcp-fb:* ").map(rg.parseRtcpFb);return t.codecs.forEach(e=>{n.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),t},rg.writeRtpDescription=function(e,t){let r="";r+="m="+e+" "+(t.codecs.length>0?"9":"0")+" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" "+t.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(e=>{r+=rg.writeRtpMap(e)+rg.writeFmtp(e)+rg.writeRtcpFb(e)});let n=0;return t.codecs.forEach(e=>{e.maxptime>n&&(n=e.maxptime)}),n>0&&(r+="a=maxptime:"+n+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(e=>{r+=rg.writeExtmap(e)}),r},rg.parseRtpEncodingParameters=function(e){let t;let r=[],n=rg.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),s=-1!==n.fecMechanisms.indexOf("ULPFEC"),o=rg.matchPrefix(e,"a=ssrc:").map(e=>rg.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),a=o.length>0&&o[0].ssrc,l=rg.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===a&&(t=l[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let n={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&t&&(n.rtx={ssrc:t}),r.push(n),i&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&a&&r.push({ssrc:a});let u=rg.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?950*parseInt(u[0].substring(5),10)-16e3:void 0,r.forEach(e=>{e.maxBitrate=u})),r},rg.parseRtcpParameters=function(e){let t={},r=rg.matchPrefix(e,"a=ssrc:").map(e=>rg.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);let n=rg.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=0===n.length;let i=rg.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},rg.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},rg.parseMsid=function(e){let t;let r=rg.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substring(7).split(" "))[0],track:t[1]};let n=rg.matchPrefix(e,"a=ssrc:").map(e=>rg.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);if(n.length>0)return{stream:(t=n[0].value.split(" "))[0],track:t[1]}},rg.parseSctpDescription=function(e){let t;let r=rg.parseMLine(e),n=rg.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=parseInt(n[0].substring(19),10)),isNaN(t)&&(t=65536);let i=rg.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substring(12),10),protocol:r.fmt,maxMessageSize:t};let s=rg.matchPrefix(e,"a=sctpmap:");if(s.length>0){let e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:t}}},rg.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},rg.generateSessionId=function(){return Math.random().toString().substr(2,22)},rg.writeSessionBoilerplate=function(e,t,r){return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||rg.generateSessionId())+" "+(void 0!==t?t:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},rg.getDirection=function(e,t){let r=rg.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return t?rg.getDirection(t):"sendrecv"},rg.getKind=function(e){return rg.splitLines(e)[0].split(" ")[0].substring(2)},rg.isRejected=function(e){return"0"===e.split(" ",2)[1]},rg.parseMLine=function(e){let t=rg.splitLines(e)[0].substring(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},rg.parseOLine=function(e){let t=rg.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},rg.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let t=rg.splitLines(e);for(let e=0;e<t.length;e++)if(t[e].length<2||"="!==t[e].charAt(1))return!1;return!0},rm=rg;const rT=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let r=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;let{navigator:r}=e;return r.mozGetUserMedia?(t.browser="firefox",t.version=tF(r.userAgent,/Firefox\/(\d+)\./,1)):r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection?(t.browser="chrome",t.version=tF(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./)?(t.browser="safari",t.version=tF(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype):t.browser="Not a supported browser.",t}(e),n={browserDetails:r,commonShim:rp,extractVersion:tF,disableLog:tD,disableWarnings:tB,sdp:rm};switch(r.browser){case"chrome":if(!tV||!tV.shimPeerConnection||!t.shimChrome){tL("Chrome shim is not included in this adapter release.");break}if(null===r.version){tL("Chrome shim can not determine version, not shimming.");break}tL("adapter.js shimming chrome."),n.browserShim=tV,rC(e,r),rw(e,r),tV.shimGetUserMedia(e,r),tV.shimMediaStream(e,r),tV.shimPeerConnection(e,r),tV.shimOnTrack(e,r),tV.shimAddTrackRemoveTrack(e,r),tV.shimGetSendersWithDtmf(e,r),tV.shimGetStats(e,r),tV.shimSenderReceiverGetStats(e,r),tV.fixNegotiationNeeded(e,r),rv(e,r),ry(e,r),r_(e,r),rx(e,r),rb(e,r),rS(e,r);break;case"firefox":if(!t2||!t2.shimPeerConnection||!t.shimFirefox){tL("Firefox shim is not included in this adapter release.");break}tL("adapter.js shimming firefox."),n.browserShim=t2,rC(e,r),rw(e,r),t2.shimGetUserMedia(e,r),t2.shimPeerConnection(e,r),t2.shimOnTrack(e,r),t2.shimRemoveStream(e,r),t2.shimSenderGetStats(e,r),t2.shimReceiverGetStats(e,r),t2.shimRTCDataChannel(e,r),t2.shimAddTransceiver(e,r),t2.shimGetParameters(e,r),t2.shimCreateOffer(e,r),t2.shimCreateAnswer(e,r),rv(e,r),r_(e,r),rx(e,r),rb(e,r);break;case"safari":if(!ri||!t.shimSafari){tL("Safari shim is not included in this adapter release.");break}tL("adapter.js shimming safari."),n.browserShim=ri,rC(e,r),rw(e,r),ri.shimRTCIceServerUrls(e,r),ri.shimCreateOfferLegacy(e,r),ri.shimCallbacksAPI(e,r),ri.shimLocalStreamsAPI(e,r),ri.shimRemoteStreamsAPI(e,r),ri.shimTrackEventTransceiver(e,r),ri.shimGetUserMedia(e,r),ri.shimAudioContext(e,r),rv(e,r),ry(e,r),rx(e,r),rb(e,r),rS(e,r);break;default:tL("Unsupported browser!")}return n}({window:"undefined"==typeof window?void 0:window});var rP={},rA=rP.Buffer;try{n=new TextDecoder}catch(e){}let rk=0;const rM=[],rR={};let rI=rM,rE=0,rO={},rz=0,rF=0,rU=[],rD=[],rB={useRecords:!1,mapsAsObjects:!0},rL=!1,rG=2;try{Function("")}catch(e){rG=1/0}class rj{constructor(e){if(e&&((e.keyMap||e._keyMap)&&!e.useRecords&&(e.useRecords=!1,e.mapsAsObjects=!0),!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap))for(let[t,r]of(this.mapKey=new Map,Object.entries(e.keyMap)))this.mapKey.set(r,t);Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[r,n]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,n);return t}decodeKeys(e){if(!this._keyMap||"Map"!=e.constructor.name)return e;if(!this._mapKey)for(let[e,t]of(this._mapKey=new Map,Object.entries(this._keyMap)))this._mapKey.set(t,e);let t={};return e.forEach((e,r)=>t[rH(this._mapKey.has(r)?this._mapKey.get(r):r)]=e),t}mapDecode(e,t){let r=this.decode(e);return this._keyMap&&"Array"===r.constructor.name?r.map(e=>this.decodeKeys(e)):r}decode(e,t){if(i)return ne(()=>(nt(),this?this.decode(e,t):rj.prototype.decode.call(rB,e,t)));s=t>-1?t:e.length,rk=0,rE=0,rF=0,a=null,rI=rM,l=null,i=e;try{h=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(i=null,e instanceof Uint8Array)throw t;throw Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}return this instanceof rj?(rO=this,c=this.sharedValues&&(this.pack?Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures?o=this.structures:(!o||o.length>0)&&(o=[])):(rO=rB,(!o||o.length>0)&&(o=[]),c=null),rN()}decodeMultiple(e,t){let r,n=0;try{let i=e.length;rL=!0;let s=this?this.decode(e,i):nn.decode(e,i);if(t){if(!1===t(s))return;for(;rk<i;)if(n=rk,!1===t(rN()))return}else{for(r=[s];rk<i;)n=rk,r.push(rN());return r}}catch(e){throw e.lastPosition=n,e.values=r,e}finally{rL=!1,nt()}}}function rN(){try{let e=rV();if(l){if(rk>=l.postBundlePosition){let e=Error("Unexpected bundle position");throw e.incomplete=!0,e}rk=l.postBundlePosition,l=null}if(rk==s)o=null,i=null,u&&(u=null);else if(rk>s){let e=Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}else if(!rL)throw Error("Data read, but end of buffer not reached");return e}catch(e){throw nt(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function rV(){let e=i[rk++],t=e>>5;if((e&=31)>23)switch(e){case 24:e=i[rk++];break;case 25:if(7==t)return function(){let e=i[rk++],t=i[rk++],r=(127&e)>>2;if(31===r)return t||3&e?NaN:128&e?-1/0:1/0;if(0===r){let r=((3&e)<<8|t)/16777216;return 128&e?-r:r}return rJ[3]=128&e|(r>>1)+56,rJ[2]=(7&e)<<5|t>>3,rJ[1]=t<<5,rJ[0]=0,rQ[0]}();e=h.getUint16(rk),rk+=2;break;case 26:if(7==t){let e=h.getFloat32(rk);if(rO.useFloat32>2){let t=nr[(127&i[rk])<<1|i[rk+1]>>7];return rk+=4,(t*e+(e>0?.5:-.5)>>0)/t}return rk+=4,e}e=h.getUint32(rk),rk+=4;break;case 27:if(7==t){let e=h.getFloat64(rk);return rk+=8,e}if(t>1){if(h.getUint32(rk)>0)throw Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");e=h.getUint32(rk+4)}else e=rO.int64AsNumber?4294967296*h.getUint32(rk)+h.getUint32(rk+4):h.getBigUint64(rk);rk+=8;break;case 31:switch(t){case 2:case 3:throw Error("Indefinite length not supported for byte or text strings");case 4:let r=[],n,u=0;for(;(n=rV())!=rR;)r[u++]=n;return 4==t?r:3==t?r.join(""):rA.concat(r);case 5:let d;if(rO.mapsAsObjects){let e={};if(rO.keyMap)for(;(d=rV())!=rR;)e[rH(rO.decodeKey(d))]=rV();else for(;(d=rV())!=rR;)e[rH(d)]=rV();return e}{f&&(rO.mapsAsObjects=!0,f=!1);let e=new Map;if(rO.keyMap)for(;(d=rV())!=rR;)e.set(rO.decodeKey(d),rV());else for(;(d=rV())!=rR;)e.set(d,rV());return e}case 7:return rR;default:throw Error("Invalid major type for indefinite length "+t)}default:throw Error("Unknown token "+e)}switch(t){case 0:return e;case 1:return~e;case 2:var p;return p=e,rO.copyBuffers?Uint8Array.prototype.slice.call(i,rk,rk+=p):i.subarray(rk,rk+=p);case 3:if(rF>=rk)return a.slice(rk-rz,(rk+=e)-rz);if(0==rF&&s<140&&e<32){let t=e<16?rK(e):function(e){let t=rk,r=Array(e);for(let n=0;n<e;n++){let e=i[rk++];if((128&e)>0){rk=t;return}r[n]=e}return r$.apply(String,r)}(e);if(null!=t)return t}return rW(e);case 4:let m=Array(e);for(let t=0;t<e;t++)m[t]=rV();return m;case 5:if(rO.mapsAsObjects){let t={};if(rO.keyMap)for(let r=0;r<e;r++)t[rH(rO.decodeKey(rV()))]=rV();else for(let r=0;r<e;r++)t[rH(rV())]=rV();return t}{f&&(rO.mapsAsObjects=!0,f=!1);let t=new Map;if(rO.keyMap)for(let r=0;r<e;r++)t.set(rO.decodeKey(rV()),rV());else for(let r=0;r<e;r++)t.set(rV(),rV());return t}case 6:if(e>=57337){let t=o[8191&e];if(t)return t.read||(t.read=rY(t)),t.read();if(e<65536){if(57343==e){let e=r9(),t=rV(),r=rV();r0(t,r);let n={};if(rO.keyMap)for(let t=2;t<e;t++)n[rH(rO.decodeKey(r[t-2]))]=rV();else for(let t=2;t<e;t++)n[rH(r[t-2])]=rV();return n}if(57342==e){let e=r9(),t=rV();for(let r=2;r<e;r++)r0(t++,rV());return rV()}if(57337==e)return function(){let e=r9(),t=rk+rV();for(let t=2;t<e;t++){let e=r9();rk+=e}let r=rk;return rk=t,(l=[rq(r9()),rq(r9())]).position0=0,l.position1=0,l.postBundlePosition=rk,rk=r,rV()}();if(rO.getShared&&(r7(),t=o[8191&e]))return t.read||(t.read=rY(t)),t.read()}}let g=rU[e];if(g){if(g.handlesRead)return g(rV);return g(rV())}{let t=rV();for(let r=0;r<rD.length;r++){let n=rD[r](e,t);if(void 0!==n)return n}return new rZ(t,e)}case 7:switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:let v=(c||r4())[e];if(void 0!==v)return v;throw Error("Unknown token "+e)}default:if(isNaN(e)){let e=Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}throw Error("Unknown CBOR token "+e)}}const rX=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function rY(e){return e.slowReads=0,function(){let e=i[rk++];if((e&=31)>23)switch(e){case 24:e=i[rk++];break;case 25:e=h.getUint16(rk),rk+=2;break;case 26:e=h.getUint32(rk),rk+=4;break;default:throw Error("Expected array header, but got "+i[rk-1])}let t=this.compiledReader;for(;t;){if(t.propertyCount===e)return t(rV);t=t.next}if(this.slowReads++>=rG){let r=this.length==e?this:this.slice(0,e);return t=rO.keyMap?Function("r","return {"+r.map(e=>rO.decodeKey(e)).map(e=>rX.test(e)?rH(e)+":r()":"["+JSON.stringify(e)+"]:r()").join(",")+"}"):Function("r","return {"+r.map(e=>rX.test(e)?rH(e)+":r()":"["+JSON.stringify(e)+"]:r()").join(",")+"}"),this.compiledReader&&(t.next=this.compiledReader),t.propertyCount=e,this.compiledReader=t,t(rV)}let r={};if(rO.keyMap)for(let t=0;t<e;t++)r[rH(rO.decodeKey(this[t]))]=rV();else for(let t=0;t<e;t++)r[rH(this[t])]=rV();return r}}function rH(e){return"__proto__"===e?"__proto_":e}let rW=rq;function rq(e){let t;if(e<16&&(t=rK(e)))return t;if(e>64&&n)return n.decode(i.subarray(rk,rk+=e));let r=rk+e,s=[];for(t="";rk<r;){let e=i[rk++];if((128&e)==0)s.push(e);else if((224&e)==192){let t=63&i[rk++];s.push((31&e)<<6|t)}else if((240&e)==224){let t=63&i[rk++],r=63&i[rk++];s.push((31&e)<<12|t<<6|r)}else if((248&e)==240){let t=(7&e)<<18|(63&i[rk++])<<12|(63&i[rk++])<<6|63&i[rk++];t>65535&&(t-=65536,s.push(t>>>10&1023|55296),t=56320|1023&t),s.push(t)}else s.push(e);s.length>=4096&&(t+=r$.apply(String,s),s.length=0)}return s.length>0&&(t+=r$.apply(String,s)),t}let r$=String.fromCharCode;function rK(e){if(e<4){if(e<2){if(0===e)return"";{let e=i[rk++];if((128&e)>1){rk-=1;return}return r$(e)}}{let t=i[rk++],r=i[rk++];if((128&t)>0||(128&r)>0){rk-=2;return}if(e<3)return r$(t,r);let n=i[rk++];if((128&n)>0){rk-=3;return}return r$(t,r,n)}}{let t=i[rk++],r=i[rk++],n=i[rk++],s=i[rk++];if((128&t)>0||(128&r)>0||(128&n)>0||(128&s)>0){rk-=4;return}if(e<6){if(4===e)return r$(t,r,n,s);{let e=i[rk++];if((128&e)>0){rk-=5;return}return r$(t,r,n,s,e)}}if(e<8){let o=i[rk++],a=i[rk++];if((128&o)>0||(128&a)>0){rk-=6;return}if(e<7)return r$(t,r,n,s,o,a);let l=i[rk++];if((128&l)>0){rk-=7;return}return r$(t,r,n,s,o,a,l)}{let o=i[rk++],a=i[rk++],l=i[rk++],u=i[rk++];if((128&o)>0||(128&a)>0||(128&l)>0||(128&u)>0){rk-=8;return}if(e<10){if(8===e)return r$(t,r,n,s,o,a,l,u);{let e=i[rk++];if((128&e)>0){rk-=9;return}return r$(t,r,n,s,o,a,l,u,e)}}if(e<12){let c=i[rk++],h=i[rk++];if((128&c)>0||(128&h)>0){rk-=10;return}if(e<11)return r$(t,r,n,s,o,a,l,u,c,h);let f=i[rk++];if((128&f)>0){rk-=11;return}return r$(t,r,n,s,o,a,l,u,c,h,f)}{let c=i[rk++],h=i[rk++],f=i[rk++],d=i[rk++];if((128&c)>0||(128&h)>0||(128&f)>0||(128&d)>0){rk-=12;return}if(e<14){if(12===e)return r$(t,r,n,s,o,a,l,u,c,h,f,d);{let e=i[rk++];if((128&e)>0){rk-=13;return}return r$(t,r,n,s,o,a,l,u,c,h,f,d,e)}}{let p=i[rk++],m=i[rk++];if((128&p)>0||(128&m)>0){rk-=14;return}if(e<15)return r$(t,r,n,s,o,a,l,u,c,h,f,d,p,m);let g=i[rk++];if((128&g)>0){rk-=15;return}return r$(t,r,n,s,o,a,l,u,c,h,f,d,p,m,g)}}}}}let rQ=new Float32Array(1),rJ=new Uint8Array(rQ.buffer,0,4);class rZ{constructor(e,t){this.value=e,this.tag=t}}rU[0]=e=>new Date(e),rU[1]=e=>new Date(Math.round(1e3*e)),rU[2]=e=>{let t=BigInt(0);for(let r=0,n=e.byteLength;r<n;r++)t=BigInt(e[r])+t<<BigInt(8);return t},rU[3]=e=>BigInt(-1)-rU[2](e),rU[4]=e=>+(e[1]+"e"+e[0]),rU[5]=e=>e[1]*Math.exp(e[0]*Math.log(2));const r0=(e,t)=>{let r=o[e-=57344];r&&r.isShared&&((o.restoreStructures||(o.restoreStructures=[]))[e]=r),o[e]=t,t.read=rY(t)};rU[105]=e=>{let t=e.length,r=e[1];r0(e[0],r);let n={};for(let i=2;i<t;i++)n[rH(r[i-2])]=e[i];return n},rU[14]=e=>l?l[0].slice(l.position0,l.position0+=e):new rZ(e,14),rU[15]=e=>l?l[1].slice(l.position1,l.position1+=e):new rZ(e,15);let r2={Error:Error,RegExp:RegExp};rU[27]=e=>(r2[e[0]]||Error)(e[1],e[2]);const r1=e=>{if(132!=i[rk++])throw Error("Packed values structure must be followed by a 4 element array");let t=e();return(c=c?t.concat(c.slice(t.length)):t).prefixes=e(),c.suffixes=e(),e()};function r3(e,t){return"string"==typeof e?e+t:e instanceof Array?e.concat(t):Object.assign({},e,t)}function r4(){if(!c){if(rO.getShared)r7();else throw Error("No packed values available")}return c}r1.handlesRead=!0,rU[51]=r1,rU[6]=e=>{if(!c){if(!rO.getShared)return new rZ(e,6);r7()}if("number"==typeof e)return c[16+(e>=0?2*e:-2*e-1)];throw Error("No support for non-integer packed references yet")},rU[28]=e=>{let t;u||((u=new Map).id=0);let r=u.id++,n={target:t=i[rk]>>5==4?[]:{}};u.set(r,n);let s=e();return n.used?Object.assign(t,s):(n.target=s,s)},rU[28].handlesRead=!0,rU[29]=e=>{let t=u.get(e);return t.used=!0,t.target},rU[258]=e=>new Set(e),(rU[259]=e=>(rO.mapsAsObjects&&(rO.mapsAsObjects=!1,f=!0),e())).handlesRead=!0,rD.push((e,t)=>e>=225&&e<=255?r3(r4().prefixes[e-224],t):e>=28704&&e<=32767?r3(r4().prefixes[e-28672],t):e>=1879052288&&e<=2147483647?r3(r4().prefixes[e-1879048192],t):e>=216&&e<=223?r3(t,r4().suffixes[e-216]):e>=27647&&e<=28671?r3(t,r4().suffixes[e-27639]):e>=1811940352&&e<=1879048191?r3(t,r4().suffixes[e-1811939328]):1399353956==e?{packedValues:c,structures:o.slice(0),version:t}:55799==e?t:void 0);const r5=1==new Uint8Array(new Uint16Array([1]).buffer)[0],r6=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],r8=[64,68,69,70,71,72,77,78,79,85,86];for(let e=0;e<r6.length;e++)!function(e,t){let r,n="get"+e.name.slice(0,-5);"function"==typeof e?r=e.BYTES_PER_ELEMENT:e=null;for(let i=0;i<2;i++){if(!i&&1==r)continue;let s=2==r?1:4==r?2:3;rU[i?t:t-4]=1==r||i==r5?r=>{if(!e)throw Error("Could not find typed array for code "+t);return new e(Uint8Array.prototype.slice.call(r,0).buffer)}:r=>{if(!e)throw Error("Could not find typed array for code "+t);let o=new DataView(r.buffer,r.byteOffset,r.byteLength),a=r.length>>s,l=new e(a),u=o[n];for(let e=0;e<a;e++)l[e]=u.call(o,e<<s,i);return l}}}(r6[e],r8[e]);function r9(){let e=31&i[rk++];if(e>23)switch(e){case 24:e=i[rk++];break;case 25:e=h.getUint16(rk),rk+=2;break;case 26:e=h.getUint32(rk),rk+=4}return e}function r7(){if(rO.getShared){let e=ne(()=>(i=null,rO.getShared()))||{},t=e.structures||[];rO.sharedVersion=e.version,c=rO.sharedValues=e.packedValues,!0===o?rO.structures=o=t:o.splice.apply(o,[0,t.length].concat(t))}}function ne(e){let t=s,r=rk,n=rE,c=rz,f=rF,d=a,p=rI,m=u,g=l,v=new Uint8Array(i.slice(0,s)),y=o,x=rO,b=rL,_=e();return s=t,rk=r,rE=n,rz=c,rF=f,a=d,rI=p,u=m,l=g,i=v,rL=b,o=y,rO=x,h=new DataView(i.buffer,i.byteOffset,i.byteLength),_}function nt(){i=null,u=null,o=null}const nr=Array(147);for(let e=0;e<256;e++)nr[e]=+("1e"+Math.floor(45.15-.30103*e));let nn=new rj({useRecords:!1});nn.decode,nn.decodeMultiple;try{d=new TextEncoder}catch(e){}const ni="object"==typeof globalThis&&globalThis.Buffer,ns=void 0!==ni,no=ns?ni.allocUnsafeSlow:Uint8Array,na=ns?ni:Uint8Array,nl=ns?4294967296:2144337920;let nu=0,nc=null;const nh=/[\u0080-\uFFFF]/,nf=Symbol("record-id");function nd(e,t){e<24?v[nu++]=t|e:e<256?(v[nu++]=24|t,v[nu++]=e):e<65536?(v[nu++]=25|t,v[nu++]=e>>8,v[nu++]=255&e):(v[nu++]=26|t,y.setUint32(nu,e),nu+=4)}class np{constructor(e,t,r){this.structures=e,this.packedValues=t,this.version=r}}function nm(e){e<24?v[nu++]=128|e:e<256?(v[nu++]=152,v[nu++]=e):e<65536?(v[nu++]=153,v[nu++]=e>>8,v[nu++]=255&e):(v[nu++]=154,y.setUint32(nu,e),nu+=4)}const ng="undefined"==typeof Blob?function(){}:Blob;function nv(e){if(e instanceof ng)return!0;let t=e[Symbol.toStringTag];return"Blob"===t||"File"===t}const ny=1==new Uint8Array(new Uint16Array([1]).buffer)[0];function nx(e,t){return!ny&&t>1&&(e-=4),{tag:e,encode:function(e,t){let r=e.byteLength,n=e.byteOffset||0,i=e.buffer||e;t(ns?ni.from(i,n,r):new Uint8Array(i,n,r))}}}function nb(e,t){let r=e.byteLength;r<24?v[nu++]=64+r:r<256?(v[nu++]=88,v[nu++]=r):r<65536?(v[nu++]=89,v[nu++]=r>>8,v[nu++]=255&r):(v[nu++]=90,y.setUint32(nu,r),nu+=4),nu+r>=v.length&&t(nu+r),v.set(e.buffer?e:new Uint8Array(e),nu),nu+=r}function n_(e,t){y.setUint32(nc.position+e,nu-nc.position-e+1);let r=nc;nc=null,t(r[0]),t(r[1])}m=[Date,Set,Error,RegExp,rZ,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?function(){}:BigInt64Array,Float32Array,Float64Array,np],p=[{tag:1,encode(e,t){let r=e.getTime()/1e3;(this.useTimestamp32||0===e.getMilliseconds())&&r>=0&&r<4294967296?(v[nu++]=26,y.setUint32(nu,r),nu+=4):(v[nu++]=251,y.setFloat64(nu,r),nu+=8)}},{tag:258,encode(e,t){t(Array.from(e))}},{tag:27,encode(e,t){t([e.name,e.message])}},{tag:27,encode(e,t){t(["RegExp",e.source,e.flags])}},{getTag:e=>e.tag,encode(e,t){t(e.value)}},{encode(e,t,r){nb(e,r)}},{getTag(e){if(e.constructor===Uint8Array&&(this.tagUint8Array||ns&&!1!==this.tagUint8Array))return 64},encode(e,t,r){nb(e,r)}},nx(68,1),nx(69,2),nx(70,4),nx(71,8),nx(72,1),nx(77,2),nx(78,4),nx(79,8),nx(85,4),nx(86,8),{encode(e,t){let r=e.packedValues||[],n=e.structures||[];if(r.values.length>0){v[nu++]=216,v[nu++]=51,nm(4);let e=r.values;t(e),nm(0),nm(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let t=0,r=e.length;t<r;t++)packedObjectMap[e[t]]=t}if(n){y.setUint32(nu,3655335424),nu+=3;let r=n.slice(0);r.unshift(57344),r.push(new rZ(e.version,1399353956)),t(r)}else t(new rZ(e.version,1399353956))}}];let nS=new class extends rj{constructor(e){let t,r,n,i,s,o;super(e),this.offset=0,e=e||{};let a=na.prototype.utf8Write?function(e,t,r){return v.utf8Write(e,t,r)}:!!d&&!!d.encodeInto&&function(e,t){return d.encodeInto(e,v.subarray(t)).written},l=this,u=e.structures||e.saveStructures,c=e.maxSharedStructures;if(null==c&&(c=u?128:0),c>8190)throw Error("Maximum maxSharedStructure is 8190");let h=e.sequential;h&&(c=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let f,b,_=e.sharedValues;if(_){o=Object.create(null);for(let e=0,t=_.length;e<t;e++)o[_[e]]=e}let S=[],C=0,w=0;this.mapEncode=function(e,t){return this._keyMap&&!this._mapped&&"Array"===e.constructor.name&&(e=e.map(e=>this.encodeKeys(e))),this.encode(e,t)},this.encode=function(a,u){if(v||(y=new DataView((v=new no(8192)).buffer,0,8192),nu=0),(x=v.length-10)-nu<2048?(y=new DataView((v=new no(v.length)).buffer,0,v.length),x=v.length-10,nu=0):u===nA&&(nu=nu+7&2147483640),t=nu,l.useSelfDescribedHeader&&(y.setUint32(nu,3654940416),nu+=3),s=l.structuredClone?new Map:null,l.bundleStrings&&"string"!=typeof a?(nc=[]).size=1/0:nc=null,r=l.structures){if(r.uninitialized){let e=l.getShared()||{};l.structures=r=e.structures||[],l.sharedVersion=e.version;let t=l.sharedValues=e.packedValues;if(t){o={};for(let e=0,r=t.length;e<r;e++)o[t[e]]=e}}let e=r.length;if(e>c&&!h&&(e=c),!r.transitions){r.transitions=Object.create(null);for(let t=0;t<e;t++){let e=r[t];if(!e)continue;let n,i=r.transitions;for(let r=0,s=e.length;r<s;r++){void 0===i[nf]&&(i[nf]=t);let s=e[r];(n=i[s])||(n=i[s]=Object.create(null)),i=n}i[nf]=1048576|t}}h||(r.nextId=e)}if(n&&(n=!1),i=r||[],b=o,e.pack){let t=new Map;if(t.values=[],t.encoder=l,t.maxValues=e.maxPrivatePackedValues||(o?16:1/0),t.objectMap=o||!1,t.samplingPackedValues=f,function e(t,r){switch(typeof t){case"string":if(t.length>3){if(r.objectMap[t]>-1||r.values.length>=r.maxValues)return;let e=r.get(t);if(e)2==++e.count&&r.values.push(t);else if(r.set(t,{count:1}),r.samplingPackedValues){let e=r.samplingPackedValues.get(t);e?e.count++:r.samplingPackedValues.set(t,{count:1})}}break;case"object":if(t){if(t instanceof Array)for(let n=0,i=t.length;n<i;n++)e(t[n],r);else{let i=!r.encoder.useRecords;for(var n in t)t.hasOwnProperty(n)&&(i&&e(n,r),e(t[n],r))}}break;case"function":console.log(t)}}(a,t),t.values.length>0){v[nu++]=216,v[nu++]=51,nm(4);let e=t.values;T(e),nm(0),nm(0),b=Object.create(o||null);for(let t=0,r=e.length;t<r;t++)b[e[t]]=t}}g=u&nM;try{if(g)return;if(T(a),nc&&n_(t,T),l.offset=nu,s&&s.idsToInsert){(nu+=2*s.idsToInsert.length)>x&&A(nu),l.offset=nu;let e=function(e,t){let r;let n=2*t.length,i=e.length-n;t.sort((e,t)=>e.offset>t.offset?1:-1);for(let r=0;r<t.length;r++){let n=t[r];for(let t of(n.id=r,n.references))e[t++]=r>>8,e[t]=255&r}for(;r=t.pop();){let t=r.offset;e.copyWithin(t+n,t,i);let s=t+(n-=2);e[s++]=216,e[s++]=28,i=t}return e}(v.subarray(t,nu),s.idsToInsert);return s=null,e}if(u&nA)return v.start=t,v.end=nu,v;return v.subarray(t,nu)}finally{if(r){if(w<10&&w++,r.length>c&&(r.length=c),C>1e4)r.transitions=null,w=0,C=0,S.length>0&&(S=[]);else if(S.length>0&&!h){for(let e=0,t=S.length;e<t;e++)S[e][nf]=void 0;S=[]}}if(n&&l.saveShared){l.structures.length>c&&(l.structures=l.structures.slice(0,c));let e=v.subarray(t,nu);if(!1===l.updateSharedData())return l.encode(a);return e}u&nk&&(nu=t)}},this.findCommonStringsToPack=()=>(f=new Map,o||(o=Object.create(null)),e=>{let t=e&&e.threshold||4,r=this.pack?e.maxPrivatePackedValues||16:0;for(let[e,i]of(_||(_=this.sharedValues=[]),f))i.count>t&&(o[e]=r++,_.push(e),n=!0);for(;this.saveShared&&!1===this.updateSharedData(););f=null});let T=r=>{nu>x&&(v=A(nu));var n,i=typeof r;if("string"===i){let i;if(b){let t=b[r];if(t>=0){t<16?v[nu++]=t+224:(v[nu++]=198,1&t?T(15-t>>1):T(t-16>>1));return}if(f&&!e.pack){let e=f.get(r);e?e.count++:f.set(r,{count:1})}}let s=r.length;if(nc&&s>=4&&s<1024){if((nc.size+=s)>61440){let e;let r=(nc[0]?3*nc[0].length+nc[1].length:0)+10;nu+r>x&&(v=A(nu+r)),v[nu++]=217,v[nu++]=223,v[nu++]=249,v[nu++]=nc.position?132:130,v[nu++]=26,e=nu-t,nu+=4,nc.position&&n_(t,T),(nc=["",""]).size=0,nc.position=e}let e=nh.test(r);nc[e?0:1]+=r,v[nu++]=e?206:207,T(s);return}i=s<32?1:s<256?2:s<65536?3:5;let o=3*s;if(nu+o>x&&(v=A(nu+o)),s<64||!a){let e,t,o,a=nu+i;for(e=0;e<s;e++)(t=r.charCodeAt(e))<128?v[a++]=t:(t<2048?v[a++]=t>>6|192:((64512&t)==55296&&(64512&(o=r.charCodeAt(e+1)))==56320?(t=65536+((1023&t)<<10)+(1023&o),e++,v[a++]=t>>18|240,v[a++]=t>>12&63|128):v[a++]=t>>12|224,v[a++]=t>>6&63|128),v[a++]=63&t|128);n=a-nu-i}else n=a(r,nu+i,o);n<24?v[nu++]=96|n:n<256?(i<2&&v.copyWithin(nu+2,nu+1,nu+1+n),v[nu++]=120,v[nu++]=n):n<65536?(i<3&&v.copyWithin(nu+3,nu+2,nu+2+n),v[nu++]=121,v[nu++]=n>>8,v[nu++]=255&n):(i<5&&v.copyWithin(nu+5,nu+3,nu+3+n),v[nu++]=122,y.setUint32(nu,n),nu+=4),nu+=n}else if("number"===i){if(this.alwaysUseFloat||r>>>0!==r){if(this.alwaysUseFloat||r>>0!==r){let e;if((e=this.useFloat32)>0&&r<4294967296&&r>=-2147483648){let t;if(v[nu++]=250,y.setFloat32(nu,r),e<4||(t=r*nr[(127&v[nu])<<1|v[nu+1]>>7])>>0===t){nu+=4;return}nu--}v[nu++]=251,y.setFloat64(nu,r),nu+=8}else r>=-24?v[nu++]=31-r:r>=-256?(v[nu++]=56,v[nu++]=~r):r>=-65536?(v[nu++]=57,y.setUint16(nu,~r),nu+=2):(v[nu++]=58,y.setUint32(nu,~r),nu+=4)}else r<24?v[nu++]=r:r<256?(v[nu++]=24,v[nu++]=r):r<65536?(v[nu++]=25,v[nu++]=r>>8,v[nu++]=255&r):(v[nu++]=26,y.setUint32(nu,r),nu+=4)}else if("object"===i){if(r){if(s){let e=s.get(r);if(e){if(v[nu++]=216,v[nu++]=29,v[nu++]=25,!e.references){let t=s.idsToInsert||(s.idsToInsert=[]);e.references=[],t.push(e)}e.references.push(nu-t),nu+=2;return}s.set(r,{offset:nu-t})}let e=r.constructor;if(e===Object)P(r,!0);else if(e===Array){(n=r.length)<24?v[nu++]=128|n:nm(n);for(let e=0;e<n;e++)T(r[e])}else if(e===Map){if((this.mapsAsObjects?!1!==this.useTag259ForMaps:this.useTag259ForMaps)&&(v[nu++]=217,v[nu++]=1,v[nu++]=3),(n=r.size)<24?v[nu++]=160|n:n<256?(v[nu++]=184,v[nu++]=n):n<65536?(v[nu++]=185,v[nu++]=n>>8,v[nu++]=255&n):(v[nu++]=186,y.setUint32(nu,n),nu+=4),l.keyMap)for(let[e,t]of r)T(l.encodeKey(e)),T(t);else for(let[e,t]of r)T(e),T(t)}else{for(let e=0,t=p.length;e<t;e++)if(r instanceof m[e]){let t=p[e],n=t.tag;void 0==n&&(n=t.getTag&&t.getTag.call(this,r)),n<24?v[nu++]=192|n:n<256?(v[nu++]=216,v[nu++]=n):n<65536?(v[nu++]=217,v[nu++]=n>>8,v[nu++]=255&n):n>-1&&(v[nu++]=218,y.setUint32(nu,n),nu+=4),t.encode.call(this,r,T,A);return}if(r[Symbol.iterator]){if(g){let e=Error("Iterable should be serialized as iterator");throw e.iteratorNotHandled=!0,e}for(let e of(v[nu++]=159,r))T(e);v[nu++]=255;return}if(r[Symbol.asyncIterator]||nv(r)){let e=Error("Iterable/blob should be serialized as iterator");throw e.iteratorNotHandled=!0,e}if(this.useToJSON&&r.toJSON){let e=r.toJSON();if(e!==r)return T(e)}P(r,!r.hasOwnProperty)}}else v[nu++]=246}else if("boolean"===i)v[nu++]=r?245:244;else if("bigint"===i){if(r<BigInt(1)<<BigInt(64)&&r>=0)v[nu++]=27,y.setBigUint64(nu,r);else if(r>-(BigInt(1)<<BigInt(64))&&r<0)v[nu++]=59,y.setBigUint64(nu,-r-BigInt(1));else if(this.largeBigIntToFloat)v[nu++]=251,y.setFloat64(nu,Number(r));else throw RangeError(r+" was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64");nu+=8}else if("undefined"===i)v[nu++]=247;else throw Error("Unknown type: "+i)},P=!1===this.useRecords?this.variableMapSize?e=>{let t=Object.keys(e),r=Object.values(e),n=t.length;if(n<24?v[nu++]=160|n:n<256?(v[nu++]=184,v[nu++]=n):n<65536?(v[nu++]=185,v[nu++]=n>>8,v[nu++]=255&n):(v[nu++]=186,y.setUint32(nu,n),nu+=4),l.keyMap)for(let e=0;e<n;e++)T(l.encodeKey(t[e])),T(r[e]);else for(let e=0;e<n;e++)T(t[e]),T(r[e])}:(e,r)=>{v[nu++]=185;let n=nu-t;nu+=2;let i=0;if(l.keyMap)for(let t in e)(r||e.hasOwnProperty(t))&&(T(l.encodeKey(t)),T(e[t]),i++);else for(let t in e)(r||e.hasOwnProperty(t))&&(T(t),T(e[t]),i++);v[n+++t]=i>>8,v[n+t]=255&i}:(e,t)=>{let r,s,o,a=i.transitions||(i.transitions=Object.create(null)),l=0,u=0;if(this.keyMap){u=(s=Object.keys(e).map(e=>this.encodeKey(e))).length;for(let e=0;e<u;e++){let t=s[e];!(o=a[t])&&(o=a[t]=Object.create(null),l++),a=o}}else for(let n in e)(t||e.hasOwnProperty(n))&&(!(o=a[n])&&(1048576&a[nf]&&(r=65535&a[nf]),o=a[n]=Object.create(null),l++),a=o,u++);let h=a[nf];if(void 0!==h)h&=65535,v[nu++]=217,v[nu++]=h>>8|224,v[nu++]=255&h;else if(s||(s=a.__keys__||(a.__keys__=Object.keys(e))),void 0===r?((h=i.nextId++)||(h=0,i.nextId=1),h>=256&&(i.nextId=(h=c)+1)):h=r,i[h]=s,h<c){v[nu++]=217,v[nu++]=h>>8|224,v[nu++]=255&h,a=i.transitions;for(let e=0;e<u;e++)(void 0===a[nf]||1048576&a[nf])&&(a[nf]=h),a=a[s[e]];a[nf]=1048576|h,n=!0}else{if(a[nf]=h,y.setUint32(nu,3655335680),nu+=3,l&&(C+=w*l),S.length>=256-c&&(S.shift()[nf]=void 0),S.push(a),nm(u+2),T(57344+h),T(s),null===t)return;for(let r in e)(t||e.hasOwnProperty(r))&&T(e[r]);return}if(u<24?v[nu++]=128|u:nm(u),null!==t)for(let r in e)(t||e.hasOwnProperty(r))&&T(e[r])},A=e=>{let r;if(e>16777216){if(e-t>nl)throw Error("Encoded buffer would be larger than maximum buffer size");r=Math.min(nl,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else r=(Math.max(e-t<<2,v.length-1)>>12)+1<<12;let n=new no(r);return y=new DataView(n.buffer,0,r),v.copy?v.copy(n,0,t,e):n.set(v.slice(t,e)),nu-=t,t=0,x=n.length-10,v=n},k=100,M=1e3;function*R(e,r,n){let i=e.constructor;if(i===Object){let t=!1!==l.useRecords;for(let n in t?P(e,null):nd(Object.keys(e).length,160),e){let i=e[n];t||T(n),i&&"object"==typeof i?r[n]?yield*R(i,r[n]):yield*I(i,r,n):T(i)}}else if(i===Array){let n=e.length;nm(n);for(let i=0;i<n;i++){let n=e[i];n&&("object"==typeof n||nu-t>k)?r.element?yield*R(n,r.element):yield*I(n,r,"element"):T(n)}}else if(e[Symbol.iterator]){for(let n of(v[nu++]=159,e))n&&("object"==typeof n||nu-t>k)?r.element?yield*R(n,r.element):yield*I(n,r,"element"):T(n);v[nu++]=255}else nv(e)?(nd(e.size,64),yield v.subarray(t,nu),yield e,E()):e[Symbol.asyncIterator]?(v[nu++]=159,yield v.subarray(t,nu),yield e,E(),v[nu++]=255):T(e);n&&nu>t?yield v.subarray(t,nu):nu-t>k&&(yield v.subarray(t,nu),E())}function*I(e,r,n){let i=nu-t;try{T(e),nu-t>k&&(yield v.subarray(t,nu),E())}catch(s){if(s.iteratorNotHandled)r[n]={},nu=t+i,yield*R.call(this,e,r[n]);else throw s}}function E(){k=M,l.encode(null,nM)}function O(e,t,r){return(k=t&&t.chunkThreshold?M=t.chunkThreshold:100,e&&"object"==typeof e)?(l.encode(null,nM),r(e,l.iterateProperties||(l.iterateProperties={}),!0)):[l.encode(e)]}async function*z(e,t){for(let r of R(e,t,!0)){let e=r.constructor;if(e===na||e===Uint8Array)yield r;else if(nv(r)){let e,t=r.stream().getReader();for(;!(e=await t.read()).done;)yield e.value}else if(r[Symbol.asyncIterator])for await(let e of r)E(),e?yield*z(e,t.async||(t.async={})):yield l.encode(e);else yield r}}this.encodeAsIterable=function(e,t){return O(e,t,R)},this.encodeAsAsyncIterable=function(e,t){return O(e,t,z)}}useBuffer(e){y=new DataView((v=e).buffer,v.byteOffset,v.byteLength),nu=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let t=this.structures.slice(0),r=new np(t,this.sharedValues,this.sharedVersion),n=this.saveShared(r,t=>(t&&t.version||0)==e);return!1===n?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):t.forEach((e,t)=>this.structures[t]=e),n}}({useRecords:!1});nS.encode,nS.encodeAsIterable,nS.encodeAsAsyncIterable;const{NEVER:nC,ALWAYS:nw,DECIMAL_ROUND:nT,DECIMAL_FIT:nP}={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},nA=512,nk=1024,nM=2048;function nR(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}rP.Buffer;var nI=function(e,t){this.type=e,this.data=t},nE=(T=function(e,t){return(T=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}T(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),nO=function(e){function t(r){var n=e.call(this,r)||this;return Object.setPrototypeOf(n,Object.create(t.prototype)),Object.defineProperty(n,"name",{configurable:!0,enumerable:!1,value:t.name}),n}return nE(t,e),t}(Error);function nz(e,t,r){e.setUint32(t,Math.floor(r/4294967296)),e.setUint32(t+4,r)}function nF(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}var nU={type:-1,encode:function(e){var t,r,n,i;return e instanceof Date?function(e){var t=e.sec,r=e.nsec;if(t>=0&&r>=0&&t<=17179869183){if(0===r&&t<=4294967295){var n=new Uint8Array(4),i=new DataView(n.buffer);return i.setUint32(0,t),n}var s=t/4294967296,n=new Uint8Array(8),i=new DataView(n.buffer);return i.setUint32(0,r<<2|3&s),i.setUint32(4,4294967295&t),n}var n=new Uint8Array(12),i=new DataView(n.buffer);return i.setUint32(0,r),nz(i,4,t),n}((r=Math.floor((t=e.getTime())/1e3),i=Math.floor((n=(t-1e3*r)*1e6)/1e9),{sec:r+i,nsec:n-1e9*i})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:var r=t.getUint32(0),n=0;return{sec:r,nsec:0};case 8:var i=t.getUint32(0),r=(3&i)*4294967296+t.getUint32(4),n=i>>>2;return{sec:r,nsec:n};case 12:var r=nF(t,4),n=t.getUint32(0);return{sec:r,nsec:n};default:throw new nO("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},nD=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(nU)}return e.prototype.register=function(e){var t=e.type,r=e.encode,n=e.decode;if(t>=0)this.encoders[t]=r,this.decoders[t]=n;else{var i=1+t;this.builtInEncoders[i]=r,this.builtInDecoders[i]=n}},e.prototype.tryToEncode=function(e,t){for(var r=0;r<this.builtInEncoders.length;r++){var n=this.builtInEncoders[r];if(null!=n){var i=n(e,t);if(null!=i){var s=-1-r;return new nI(s,i)}}}for(var r=0;r<this.encoders.length;r++){var n=this.encoders[r];if(null!=n){var i=n(e,t);if(null!=i){var s=r;return new nI(s,i)}}}return e instanceof nI?e:null},e.prototype.decode=function(e,t,r){var n=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return n?n(e,t,r):new nI(t,e)},e.defaultCodec=new e,e}(),nB={},nL=nB={};function nG(){throw Error("setTimeout has not been defined")}function nj(){throw Error("clearTimeout has not been defined")}function nN(e){if(D===setTimeout)return setTimeout(e,0);if((D===nG||!D)&&setTimeout)return D=setTimeout,setTimeout(e,0);try{return D(e,0)}catch(t){try{return D.call(null,e,0)}catch(t){return D.call(this,e,0)}}}!function(){try{D="function"==typeof setTimeout?setTimeout:nG}catch(e){D=nG}try{B="function"==typeof clearTimeout?clearTimeout:nj}catch(e){B=nj}}();var nV=[],nX=!1,nY=-1;function nH(){nX&&L&&(nX=!1,L.length?nV=L.concat(nV):nY=-1,nV.length&&nW())}function nW(){if(!nX){var e=nN(nH);nX=!0;for(var t=nV.length;t;){for(L=nV,nV=[];++nY<t;)L&&L[nY].run();nY=-1,t=nV.length}L=null,nX=!1,function(e){if(B===clearTimeout)return clearTimeout(e);if((B===nj||!B)&&clearTimeout)return B=clearTimeout,clearTimeout(e);try{B(e)}catch(t){try{return B.call(null,e)}catch(t){return B.call(this,e)}}}(e)}}function nq(e,t){this.fun=e,this.array=t}function n$(){}nL.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];nV.push(new nq(e,t)),1!==nV.length||nX||nN(nW)},nq.prototype.run=function(){this.fun.apply(null,this.array)},nL.title="browser",nL.browser=!0,nL.env={},nL.argv=[],nL.version="",nL.versions={},nL.on=n$,nL.addListener=n$,nL.once=n$,nL.off=n$,nL.removeListener=n$,nL.removeAllListeners=n$,nL.emit=n$,nL.prependListener=n$,nL.prependOnceListener=n$,nL.listeners=function(e){return[]},nL.binding=function(e){throw Error("process.binding is not supported")},nL.cwd=function(){return"/"},nL.chdir=function(e){throw Error("process.chdir is not supported")},nL.umask=function(){return 0};var nK=(void 0===nB||(null===(G=null==nB?void 0:nB.env)||void 0===G?void 0:G.TEXT_ENCODING)!=="never")&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function nQ(e){for(var t=e.length,r=0,n=0;n<t;){var i=e.charCodeAt(n++);if((4294967168&i)==0){r++;continue}if((4294965248&i)==0)r+=2;else{if(i>=55296&&i<=56319&&n<t){var s=e.charCodeAt(n);(64512&s)==56320&&(++n,i=((1023&i)<<10)+(1023&s)+65536)}(4294901760&i)==0?r+=3:r+=4}}return r}var nJ=nK?new TextEncoder:void 0,nZ=nK?void 0!==nB&&(null===(j=null==nB?void 0:nB.env)||void 0===j?void 0:j.TEXT_ENCODING)!=="force"?200:0:4294967295,n0=(null==nJ?void 0:nJ.encodeInto)?function(e,t,r){nJ.encodeInto(e,t.subarray(r))}:function(e,t,r){t.set(nJ.encode(e),r)};function n2(e,t,r){for(var n=t,i=n+r,s=[],o="";n<i;){var a=e[n++];if((128&a)==0)s.push(a);else if((224&a)==192){var l=63&e[n++];s.push((31&a)<<6|l)}else if((240&a)==224){var l=63&e[n++],u=63&e[n++];s.push((31&a)<<12|l<<6|u)}else if((248&a)==240){var l=63&e[n++],u=63&e[n++],c=(7&a)<<18|l<<12|u<<6|63&e[n++];c>65535&&(c-=65536,s.push(c>>>10&1023|55296),c=56320|1023&c),s.push(c)}else s.push(a);s.length>=4096&&(o+=String.fromCharCode.apply(String,s),s.length=0)}return s.length>0&&(o+=String.fromCharCode.apply(String,s)),o}var n1=nK?new TextDecoder:null,n3=nK?void 0!==nB&&(null===(N=null==nB?void 0:nB.env)||void 0===N?void 0:N.TEXT_DECODER)!=="force"?200:0:4294967295;function n4(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}var n5=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var r=0;r<this.maxKeyLength;r++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,r){var n=this.caches[r-1];e:for(var i=0;i<n.length;i++){for(var s=n[i],o=s.bytes,a=0;a<r;a++)if(o[a]!==e[t+a])continue e;return s.str}return null},e.prototype.store=function(e,t){var r=this.caches[e.length-1],n={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=n:r.push(n)},e.prototype.decode=function(e,t,r){var n=this.find(e,t,r);if(null!=n)return this.hit++,n;this.miss++;var i=n2(e,t,r),s=Uint8Array.prototype.slice.call(e,t,t+r);return this.store(s,i),i},e}(),n6=function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},n8=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){!function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}(n,i,(t=e[r](t)).done,t.value)})}}},n9=function(e){return this instanceof n9?(this.v=e,this):new n9(e)},n7=function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||a(e,t)})})}function a(e,t){try{var r;(r=i[e](t)).value instanceof n9?Promise.resolve(r.value.v).then(l,u):c(s[0][2],r)}catch(e){c(s[0][3],e)}}function l(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},ie=function(e){var t=typeof e;return"string"===t||"number"===t},it=new DataView(new ArrayBuffer(0)),ir=new Uint8Array(it.buffer),ii=function(){try{it.getInt8(0)}catch(e){return e.constructor}throw Error("never reached")}(),is=new ii("Insufficient data"),io=new n5;function ia(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}!function(){function e(e,t,r,n,i,s,o,a){void 0===e&&(e=nD.defaultCodec),void 0===t&&(t=void 0),void 0===r&&(r=4294967295),void 0===n&&(n=4294967295),void 0===i&&(i=4294967295),void 0===s&&(s=4294967295),void 0===o&&(o=4294967295),void 0===a&&(a=io),this.extensionCodec=e,this.context=t,this.maxStrLength=r,this.maxBinLength=n,this.maxArrayLength=i,this.maxMapLength=s,this.maxExtLength=o,this.keyDecoder=a,this.totalPos=0,this.pos=0,this.view=it,this.bytes=ir,this.headByte=-1,this.stack=[]}e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=n4(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=n4(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),r=n4(e),n=new Uint8Array(t.length+r.length);n.set(t),n.set(r,t.length),this.setBuffer(n)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,r=this.pos;return RangeError("Extra ".concat(t.byteLength-r," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return n6(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return t.sent(),[3,1];case 3:return[2]}})},e.prototype.decodeAsync=function(e){var t,r,n,i,s,o,a,l;return s=this,o=void 0,a=void 0,l=function(){var s,o,a,l,u,c,h;return n6(this,function(f){switch(f.label){case 0:s=!1,f.label=1;case 1:f.trys.push([1,6,7,12]),t=n8(e),f.label=2;case 2:return[4,t.next()];case 3:if((r=f.sent()).done)return[3,5];if(a=r.value,s)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{o=this.doDecodeSync(),s=!0}catch(e){if(!(e instanceof ii))throw e}this.totalPos+=this.pos,f.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return n={error:f.sent()},[3,12];case 7:if(f.trys.push([7,,10,11]),!(r&&!r.done&&(i=t.return)))return[3,9];return[4,i.call(t)];case 8:f.sent(),f.label=9;case 9:return[3,11];case 10:if(n)throw n.error;return[7];case 11:return[7];case 12:if(s){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,o]}throw l=this,u=l.headByte,c=l.pos,h=l.totalPos,RangeError("Insufficient data in parsing ".concat(nR(u)," at ").concat(h," (").concat(c," in the current buffer)"))}})},new(a||(a=Promise))(function(e,t){function r(e){try{i(l.next(e))}catch(e){t(e)}}function n(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):((i=t.value)instanceof a?i:new a(function(e){e(i)})).then(r,n)}i((l=l.apply(s,o||[])).next())})},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return n7(this,arguments,function(){var r,n,i,s,o,a,l,u;return n6(this,function(c){switch(c.label){case 0:r=t,n=-1,c.label=1;case 1:c.trys.push([1,13,14,19]),i=n8(e),c.label=2;case 2:return[4,n9(i.next())];case 3:if((s=c.sent()).done)return[3,12];if(o=s.value,t&&0===n)throw this.createExtraByteError(this.totalPos);this.appendBuffer(o),r&&(n=this.readArraySize(),r=!1,this.complete()),c.label=4;case 4:c.trys.push([4,9,,10]),c.label=5;case 5:return[4,n9(this.doDecodeSync())];case 6:return[4,c.sent()];case 7:if(c.sent(),0==--n)return[3,8];return[3,5];case 8:return[3,10];case 9:if(!((a=c.sent())instanceof ii))throw a;return[3,10];case 10:this.totalPos+=this.pos,c.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return l={error:c.sent()},[3,19];case 14:if(c.trys.push([14,,17,18]),!(s&&!s.done&&(u=i.return)))return[3,16];return[4,n9(u.call(i))];case 15:c.sent(),c.label=16;case 16:return[3,18];case 17:if(l)throw l.error;return[7];case 18:return[7];case 19:return[2]}})})},e.prototype.doDecodeSync=function(){t:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192){if(e<128)t=e;else if(e<144){var r=e-128;if(0!==r){this.pushMapState(r),this.complete();continue}t={}}else if(e<160){var r=e-144;if(0!==r){this.pushArrayState(r),this.complete();continue}t=[]}else{var n=e-160;t=this.decodeUtf8String(n,0)}}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.readI64();else if(217===e){var n=this.lookU8();t=this.decodeUtf8String(n,1)}else if(218===e){var n=this.lookU16();t=this.decodeUtf8String(n,2)}else if(219===e){var n=this.lookU32();t=this.decodeUtf8String(n,4)}else if(220===e){var r=this.readU16();if(0!==r){this.pushArrayState(r),this.complete();continue}t=[]}else if(221===e){var r=this.readU32();if(0!==r){this.pushArrayState(r),this.complete();continue}t=[]}else if(222===e){var r=this.readU16();if(0!==r){this.pushMapState(r),this.complete();continue}t={}}else if(223===e){var r=this.readU32();if(0!==r){this.pushMapState(r),this.complete();continue}t={}}else if(196===e){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(197===e){var r=this.lookU16();t=this.decodeBinary(r,2)}else if(198===e){var r=this.lookU32();t=this.decodeBinary(r,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){var r=this.lookU8();t=this.decodeExtension(r,1)}else if(200===e){var r=this.lookU16();t=this.decodeExtension(r,2)}else if(201===e){var r=this.lookU32();t=this.decodeExtension(r,4)}else throw new nO("Unrecognized type byte: ".concat(nR(e)));this.complete();for(var i=this.stack;i.length>0;){var s=i[i.length-1];if(0===s.type){if(s.array[s.position]=t,s.position++,s.position===s.size)i.pop(),t=s.array;else continue t}else if(1===s.type){if(!ie(t))throw new nO("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new nO("The key __proto__ is not allowed");s.key=t,s.type=2;continue t}else if(s.map[s.key]=t,s.readCount++,s.readCount===s.size)i.pop(),t=s.map;else{s.key=null,s.type=1;continue t}}return t}},e.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new nO("Unrecognized array type byte: ".concat(nR(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new nO("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new nO("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){if(e>this.maxStrLength)throw new nO("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw is;var r,n,i,s=this.pos+t;return this.stateIsMapKey()&&(null===(n=this.keyDecoder)||void 0===n?void 0:n.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,s,e):e>n3?(r=this.bytes.subarray(s,s+e),i=n1.decode(r)):i=n2(this.bytes,s,e),this.pos+=t+e,i},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new nO("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw is;var r=this.pos+t,n=this.bytes.subarray(r,r+e);return this.pos+=t+e,n},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new nO("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var r=this.view.getInt8(this.pos+t),n=this.decodeBinary(e,t+1);return this.extensionCodec.decode(n,r,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,r=(e=this.view,t=this.pos,4294967296*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,r},e.prototype.readI64=function(){var e=nF(this.view,this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e}}(),function(){function e(e,t,r,n,i,s,o,a){void 0===e&&(e=nD.defaultCodec),void 0===t&&(t=void 0),void 0===r&&(r=100),void 0===n&&(n=2048),void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),this.extensionCodec=e,this.context=t,this.maxDepth=r,this.initialBufferSize=n,this.sortKeys=i,this.forceFloat32=s,this.ignoreUndefined=o,this.forceIntegerToFloat=a,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t),n=new DataView(t);r.set(this.bytes),this.view=n,this.bytes=r},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw Error("Too long string: ".concat(e," bytes in UTF-8"))},e.prototype.encodeString=function(e){if(e.length>nZ){var t=nQ(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),n0(e,this.bytes,this.pos),this.pos+=t}else{var t=nQ(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,r){for(var n=e.length,i=r,s=0;s<n;){var o=e.charCodeAt(s++);if((4294967168&o)==0){t[i++]=o;continue}if((4294965248&o)==0)t[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<n){var a=e.charCodeAt(s);(64512&a)==56320&&(++s,o=((1023&o)<<10)+(1023&a)+65536)}(4294901760&o)==0?t[i++]=o>>12&15|224:(t[i++]=o>>18&7|240,t[i++]=o>>12&63|128),t[i++]=o>>6&63|128}t[i++]=63&o|128}}(e,this.bytes,this.pos),this.pos+=t}},e.prototype.encodeObject=function(e,t){var r=this.extensionCodec.tryToEncode(e,this.context);if(null!=r)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if("object"==typeof e)this.encodeMap(e,t);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw Error("Too large binary: ".concat(t));var r=n4(e);this.writeU8a(r)},e.prototype.encodeArray=function(e,t){var r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw Error("Too large array: ".concat(r));for(var n=0;n<e.length;n++){var i=e[n];this.doEncode(i,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var r=0,n=0;n<t.length;n++)void 0!==e[t[n]]&&r++;return r},e.prototype.encodeMap=function(e,t){var r=Object.keys(e);this.sortKeys&&r.sort();var n=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw Error("Too large map object: ".concat(n));for(var i=0;i<r.length;i++){var s=r[i],o=e[s];this.ignoreUndefined&&void 0===o||(this.encodeString(s),this.doEncode(o,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){var t,r;this.ensureBufferSizeToWrite(8),t=this.view,r=this.pos,t.setUint32(r,e/4294967296),t.setUint32(r+4,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),nz(this.view,this.pos,e),this.pos+=8}}();class il{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{let t=[],r=e.byteLength,n=Math.ceil(r/this.chunkedMTU),i=0,s=0;for(;s<r;){let o=Math.min(r,s+this.chunkedMTU),a=e.slice(s,o),l={__peerData:this._dataCount,n:i,data:a,total:n};t.push(l),s=o,i++}return this._dataCount++,t}}}const iu=rT.default||rT,ic=new class{isWebRTCSupported(){return"undefined"!=typeof RTCPeerConnection}isBrowserSupported(){let e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&!this.isIOS&&t>=this.minSafariVersion)}getBrowser(){return iu.browserDetails.browser}getVersion(){return iu.browserDetails.version||0}isUnifiedPlanSupported(){let e;let t=this.getBrowser(),r=iu.browserDetails.version||0;if("chrome"===t&&r<this.minChromeVersion)return!1;if("firefox"===t&&r>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),n=!0}catch(e){}finally{e&&e.close()}return n}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},ih=e=>!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e),id=()=>Math.random().toString(36).slice(2),ip={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},im=new class extends il{noop(){}blobToArrayBuffer(e,t){let r=new FileReader;return r.onload=function(e){e.target&&t(e.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer}isSecure(){return"https:"===location.protocol}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=ip,this.browser=ic.getBrowser(),this.browserVersion=ic.getVersion(),this.pack=tR,this.unpack=tM,this.supports=function(){let e;let t={browser:ic.isBrowserSupported(),webRTC:ic.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{let r;e=new RTCPeerConnection(ip),t.audioVideo=!0;try{r=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!r.ordered;try{r.binaryType="blob",t.binaryBlob=!ic.isIOS}catch(e){}}catch(e){}finally{r&&r.close()}}catch(e){}finally{e&&e.close()}return t}(),this.validateId=ih,this.randomToken=id}};(P=V||(V={}))[P.Disabled=0]="Disabled",P[P.Errors=1]="Errors",P[P.Warnings=2]="Warnings",P[P.All=3]="All";var ig=new class{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){let r=["PeerJS: ",...t];for(let e in r)r[e]instanceof Error&&(r[e]="("+r[e].name+") "+r[e].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}},iv={},iy=Object.prototype.hasOwnProperty,ix="~";function ib(){}function i_(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function iS(e,t,r,n,i){if("function"!=typeof r)throw TypeError("The listener must be a function");var s=new i_(r,n||e,i),o=ix?ix+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],s]:e._events[o].push(s):(e._events[o]=s,e._eventsCount++),e}function iC(e,t){0==--e._eventsCount?e._events=new ib:delete e._events[t]}function iw(){this._events=new ib,this._eventsCount=0}Object.create&&(ib.prototype=Object.create(null),new ib().__proto__||(ix=!1)),iw.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)iy.call(e,t)&&r.push(ix?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},iw.prototype.listeners=function(e){var t=ix?ix+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,i=r.length,s=Array(i);n<i;n++)s[n]=r[n].fn;return s},iw.prototype.listenerCount=function(e){var t=ix?ix+e:e,r=this._events[t];return r?r.fn?1:r.length:0},iw.prototype.emit=function(e,t,r,n,i,s){var o=ix?ix+e:e;if(!this._events[o])return!1;var a,l,u=this._events[o],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,i),!0;case 6:return u.fn.call(u.context,t,r,n,i,s),!0}for(l=1,a=Array(c-1);l<c;l++)a[l-1]=arguments[l];u.fn.apply(u.context,a)}else{var h,f=u.length;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,n);break;default:if(!a)for(h=1,a=Array(c-1);h<c;h++)a[h-1]=arguments[h];u[l].fn.apply(u[l].context,a)}}return!0},iw.prototype.on=function(e,t,r){return iS(this,e,t,r,!1)},iw.prototype.once=function(e,t,r){return iS(this,e,t,r,!0)},iw.prototype.removeListener=function(e,t,r,n){var i=ix?ix+e:e;if(!this._events[i])return this;if(!t)return iC(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||n&&!s.once||r&&s.context!==r||iC(this,i);else{for(var o=0,a=[],l=s.length;o<l;o++)(s[o].fn!==t||n&&!s[o].once||r&&s[o].context!==r)&&a.push(s[o]);a.length?this._events[i]=1===a.length?a[0]:a:iC(this,i)}return this},iw.prototype.removeAllListeners=function(e){var t;return e?(t=ix?ix+e:e,this._events[t]&&iC(this,t)):(this._events=new ib,this._eventsCount=0),this},iw.prototype.off=iw.prototype.removeListener,iw.prototype.addListener=iw.prototype.on,iw.prefixed=ix,iw.EventEmitter=iw,iv=iw;var iT={};ia(iT,"ConnectionType",()=>X),ia(iT,"PeerErrorType",()=>Y),ia(iT,"BaseConnectionErrorType",()=>H),ia(iT,"DataConnectionErrorType",()=>W),ia(iT,"SerializationType",()=>q),ia(iT,"SocketEventType",()=>$),ia(iT,"ServerMessageType",()=>K),(A=X||(X={})).Data="data",A.Media="media",(k=Y||(Y={})).BrowserIncompatible="browser-incompatible",k.Disconnected="disconnected",k.InvalidID="invalid-id",k.InvalidKey="invalid-key",k.Network="network",k.PeerUnavailable="peer-unavailable",k.SslUnavailable="ssl-unavailable",k.ServerError="server-error",k.SocketError="socket-error",k.SocketClosed="socket-closed",k.UnavailableID="unavailable-id",k.WebRTC="webrtc",(M=H||(H={})).NegotiationFailed="negotiation-failed",M.ConnectionClosed="connection-closed",(R=W||(W={})).NotOpenYet="not-open-yet",R.MessageToBig="message-too-big",(I=q||(q={})).Binary="binary",I.BinaryUTF8="binary-utf8",I.JSON="json",I.None="raw",(E=$||($={})).Message="message",E.Disconnected="disconnected",E.Error="error",E.Close="close",(O=K||(K={})).Heartbeat="HEARTBEAT",O.Candidate="CANDIDATE",O.Offer="OFFER",O.Answer="ANSWER",O.Open="OPEN",O.Error="ERROR",O.IdTaken="ID-TAKEN",O.InvalidKey="INVALID-KEY",O.Leave="LEAVE",O.Expire="EXPIRE";var iP={};iP=JSON.parse('{"name":"peerjs","version":"1.5.2","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-cbor":"dist/serializer.cbor.mjs","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-cbor":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/Cbor.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","cbor-x":"1.5.4","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^8.0.0"},"alias":{"process":false,"buffer":false}}');class iA extends iv.EventEmitter{constructor(e,t,r,n,i,s=5e3){super(),this.pingInterval=s,this._disconnected=!0,this._messagesQueue=[],this._baseUrl=(e?"wss://":"ws://")+t+":"+r+n+"peerjs?key="+i}start(e,t){this._id=e;let r=`${this._baseUrl}&id=${e}&token=${t}`;!this._socket&&this._disconnected&&(this._socket=new WebSocket(r+"&version="+iP.version),this._disconnected=!1,this._socket.onmessage=e=>{let t;try{t=JSON.parse(e.data),ig.log("Server message received:",t)}catch(t){ig.log("Invalid server message",e.data);return}this.emit($.Message,t)},this._socket.onclose=e=>{this._disconnected||(ig.log("Socket closed.",e),this._cleanup(),this._disconnected=!0,this.emit($.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),ig.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){ig.log("Cannot send heartbeat, because socket closed");return}let e=JSON.stringify({type:K.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&1===this._socket.readyState}_sendQueuedMessages(){let e=[...this._messagesQueue];for(let t of(this._messagesQueue=[],e))this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit($.Error,"Invalid message");return}if(!this._wsOpen())return;let t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class ik{constructor(e){this.connection=e}startConnection(e){let t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===X.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){let r=this.connection,n={ordered:!!e.reliable},i=t.createDataChannel(r.label,n);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){ig.log("Creating RTCPeerConnection.");let e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){let t=this.connection.peer,r=this.connection.connectionId,n=this.connection.type,i=this.connection.provider;ig.log("Listening for ICE candidates."),e.onicecandidate=e=>{e.candidate&&e.candidate.candidate&&(ig.log(`Received ICE candidates for ${t}:`,e.candidate),i.socket.send({type:K.Candidate,payload:{candidate:e.candidate,type:n,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":ig.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(H.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":ig.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(H.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":ig.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{}}this.connection.emit("iceStateChanged",e.iceConnectionState)},ig.log("Listening for data channel"),e.ondatachannel=e=>{ig.log("Received data channel");let n=e.channel;i.getConnection(t,r)._initializeDataChannel(n)},ig.log("Listening for remote stream"),e.ontrack=e=>{ig.log("Received remote stream");let n=e.streams[0],s=i.getConnection(t,r);s.type===X.Media&&this._addStreamToMediaConnection(n,s)}}cleanup(){ig.log("Cleaning up PeerConnection to "+this.connection.peer);let e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};let t="closed"!==e.signalingState,r=!1,n=this.connection.dataChannel;n&&(r=!!n.readyState&&"closed"!==n.readyState),(t||r)&&e.close()}async _makeOffer(){let e=this.connection.peerConnection,t=this.connection.provider;try{let r=await e.createOffer(this.connection.options.constraints);ig.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),ig.log("Set localDescription:",r,`for:${this.connection.peer}`);let n={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===X.Data){let e=this.connection;n={...n,label:e.label,reliable:e.reliable,serialization:e.serialization}}t.socket.send({type:K.Offer,payload:n,dst:this.connection.peer})}catch(e){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=e&&(t.emitError(Y.WebRTC,e),ig.log("Failed to setLocalDescription, ",e))}}catch(e){t.emitError(Y.WebRTC,e),ig.log("Failed to createOffer, ",e)}}async _makeAnswer(){let e=this.connection.peerConnection,t=this.connection.provider;try{let r=await e.createAnswer();ig.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),ig.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:K.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(e){t.emitError(Y.WebRTC,e),ig.log("Failed to setLocalDescription, ",e)}}catch(e){t.emitError(Y.WebRTC,e),ig.log("Failed to create answer, ",e)}}async handleSDP(e,t){t=new RTCSessionDescription(t);let r=this.connection.peerConnection,n=this.connection.provider;ig.log("Setting remote description",t);try{await r.setRemoteDescription(t),ig.log(`Set remoteDescription:${e} for:${this.connection.peer}`),"OFFER"===e&&await this._makeAnswer()}catch(e){n.emitError(Y.WebRTC,e),ig.log("Failed to setRemoteDescription, ",e)}}async handleCandidate(e){ig.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),ig.log(`Added ICE candidate for:${this.connection.peer}`)}catch(e){this.connection.provider.emitError(Y.WebRTC,e),ig.log("Failed to handleCandidate, ",e)}}_addTracksToConnection(e,t){if(ig.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return ig.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){ig.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class iM extends iv.EventEmitter{emitError(e,t){ig.error("Error:",t),this.emit("error",new iR(`${e}`,t))}}class iR extends Error{constructor(e,t){"string"==typeof t?super(t):(super(),Object.assign(this,t)),this.type=e}}class iI extends iM{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}class iE extends iI{static #e=this.ID_PREFIX="mc_";get type(){return X.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||iE.ID_PREFIX+im.randomToken(),this._negotiator=new ik(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{ig.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{ig.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){ig.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){let t=e.type,r=e.payload;switch(e.type){case K.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case K.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:ig.warn(`Unrecognized message type:${t} from peer:${this.peer}`)}}answer(e,t={}){if(this._localStream){ig.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}for(let r of(this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e}),this.provider._getMessages(this.connectionId)))this.handleMessage(r);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class iO{constructor(e){this._options=e}_buildRequest(e){let t=this._options.secure?"https":"http",{host:r,port:n,path:i,key:s}=this._options,o=new URL(`${t}://${r}:${n}${i}${s}/${e}`);return o.searchParams.set("ts",`${Date.now()}${Math.random()}`),o.searchParams.set("version",iP.version),fetch(o.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{let e=await this._buildRequest("id");if(200!==e.status)throw Error(`Error. Status:${e.status}`);return e.text()}catch(t){ig.error("Error retrieving ID",t);let e="";throw"/"===this._options.path&&this._options.host!==im.CLOUD_HOST&&(e=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),Error("Could not get an ID from the server."+e)}}async listAllPeers(){try{let e=await this._buildRequest("peers");if(200!==e.status){if(401===e.status){let e="";throw e=this._options.host===im.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",Error("It doesn't look like you have permission to list peers IDs. "+e)}throw Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw ig.error("Error retrieving list peers",e),Error("Could not get list peers from the server."+e)}}}class iz extends iI{static #e=this.ID_PREFIX="dc_";static #t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return X.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||iz.ID_PREFIX+id(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new ik(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{ig.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=e=>{ig.log(`DC#${this.connectionId} dc onmessage:`,e.data)},this.dataChannel.onclose=()=>{ig.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(W.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){let t=e.payload;switch(e.type){case K.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case K.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:ig.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}}}class iF extends iz{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",e=>this._handleDataMessage(e))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>iz.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(e){return ig.error(`DC#:${this.connectionId} Error when sending:`,e),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||0===this._buffer.length)return;let e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class iU extends iF{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new il,this.serialization=q.Binary,this._chunkedData={}}_handleDataMessage({data:e}){let t=tM(e),r=t.__peerData;if(r){if("close"===r.type){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){let t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];let e=function(e){let t=0;for(let r of e)t+=r.byteLength;let r=new Uint8Array(t),n=0;for(let t of e)r.set(t,n),n+=t.byteLength;return r}(r.data);this._handleDataMessage({data:e})}}_send(e,t){let r=tR(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){let t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){let t=this.chunker.chunk(e);for(let e of(ig.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`),t))this.send(e,!0)}}class iD extends iF{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=q.None}}class iB extends iF{_handleDataMessage({data:e}){let t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&"close"===r.type){this.close();return}this.emit("data",t)}_send(e,t){let r=this.encoder.encode(this.stringify(e));if(r.byteLength>=im.chunkedMTU){this.emitError(W.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=q.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class iL extends iM{static #e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){let e=Object.create(null);for(let[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){let r;if(super(),this._serializers={raw:iD,json:iB,binary:iU,"binary-utf8":iU,default:iU},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map,e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:im.CLOUD_HOST,port:im.CLOUD_PORT,path:"/",key:iL.DEFAULT_KEY,token:im.randomToken(),config:im.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},"/"===this._options.host&&(this._options.host=window.location.hostname),this._options.path&&("/"!==this._options.path[0]&&(this._options.path="/"+this._options.path),"/"!==this._options.path[this._options.path.length-1]&&(this._options.path+="/")),void 0===this._options.secure&&this._options.host!==im.CLOUD_HOST?this._options.secure=im.isSecure():this._options.host==im.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&ig.setLogFunction(this._options.logFunction),ig.logLevel=this._options.debug||0,this._api=new iO(t),this._socket=this._createServerConnection(),!im.supports.audioVideo&&!im.supports.data){this._delayedAbort(Y.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!im.validateId(r)){this._delayedAbort(Y.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(e=>this._initialize(e)).catch(e=>this._abort(Y.ServerError,e))}_createServerConnection(){let e=new iA(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on($.Message,e=>{this._handleMessage(e)}),e.on($.Error,e=>{this._abort(Y.SocketError,e)}),e.on($.Disconnected,()=>{this.disconnected||(this.emitError(Y.Network,"Lost connection to server."),this.disconnect())}),e.on($.Close,()=>{this.disconnected||this._abort(Y.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){let t=e.type,r=e.payload,n=e.src;switch(t){case K.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case K.Error:this._abort(Y.ServerError,r.msg);break;case K.IdTaken:this._abort(Y.UnavailableID,`ID "${this.id}" is taken`);break;case K.InvalidKey:this._abort(Y.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case K.Leave:ig.log(`Received leave message from ${n}`),this._cleanupPeer(n),this._connections.delete(n);break;case K.Expire:this.emitError(Y.PeerUnavailable,`Could not connect to peer ${n}`);break;case K.Offer:{let e=r.connectionId,t=this.getConnection(n,e);if(t&&(t.close(),ig.warn(`Offer received for existing Connection ID:${e}`)),r.type===X.Media){let i=new iE(n,this,{connectionId:e,_payload:r,metadata:r.metadata});t=i,this._addConnection(n,t),this.emit("call",i)}else if(r.type===X.Data){let i=new this._serializers[r.serialization](n,this,{connectionId:e,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});t=i,this._addConnection(n,t),this.emit("connection",i)}else{ig.warn(`Received malformed connection type:${r.type}`);return}for(let r of this._getMessages(e))t.handleMessage(r);break}default:{if(!r){ig.warn(`You received a malformed message from ${n} of type ${t}`);return}let i=r.connectionId,s=this.getConnection(n,i);s&&s.peerConnection?s.handleMessage(e):i?this._storeMessage(i,e):ig.warn("You received an unrecognized message:",e)}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){let t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){ig.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Y.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}let r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){ig.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Y.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){ig.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}let n=new iE(e,this,{...r,_stream:t});return this._addConnection(e,n),n}_addConnection(e,t){ig.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){let t=this._connections.get(e.peer);if(t){let r=t.indexOf(e);-1!==r&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){let r=this._connections.get(e);if(!r)return null;for(let e of r)if(e.connectionId===t)return e;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){ig.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(ig.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(let e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){let t=this._connections.get(e);if(t)for(let e of t)e.close()}disconnect(){if(this.disconnected)return;let e=this.id;ig.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)ig.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else if(this.destroyed)throw Error("This peer cannot reconnect to the server. It has already been destroyed.");else if(this.disconnected||this.open)throw Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`);else ig.error("In a hurry? We're still trying to make the initial connection!")}listAllPeers(e=e=>{}){this._api.listAllPeers().then(t=>e(t)).catch(e=>this._abort(Y.ServerError,e))}}Symbol.for(null);class iG{constructor(e){this.userId=e,this.members=[],this.unloadListener=()=>this.destroy(),this.listeners=[],this.peer=new iL(e,{host:"9000-peers-peerjsserver-b4wsb47xcxr.ws-eu110.gitpod.io",path:"/takeseats",secure:!0}),this.peer.on("error",e=>{console.error(`${e.name}: ${e.message} [${e.type}]`)}),this.peer.on("connection",e=>this.addDataConnectionEventHandlers(e)),window.addEventListener("beforeunload",this.unloadListener)}emit(e,t){this.listeners.forEach(r=>r(e,t))}addDataConnectionEventHandlers(e){e.on("open",()=>{this.members.push(e),e.send({type:"members-list",message:this.members.map(e=>e.peer).filter(t=>t!==e.peer)}),this.emit(e.peer,{type:"announce",message:e.peer})}),e.on("close",()=>{this.members=this.members.filter(t=>t!==e),this.emit(e.peer,{type:"player-disconnected",message:null})}),e.on("data",t=>{if("members-list"===t.type){t.message.forEach(e=>{if(!this.members.some(t=>t.peer===e)){let t=this.peer.connect(e);this.addDataConnectionEventHandlers(t)}});return}this.emit(e.peer,t)}),e.on("error",()=>{console.log("error")})}connectToMember(e){this.peer.once("open",()=>{let t=this.peer.connect(e);this.addDataConnectionEventHandlers(t)})}destroy(){this.peer.destroy(),window.removeEventListener("beforeunload",this.unloadListener)}address(){return this.userId}on(e,t){this.listeners.push(t)}send(e){this.listeners.forEach(t=>t(this.userId,e)),this.members.forEach(t=>t.send(e))}}class ij{constructor(e=0,t=0){this.x=e,this.y=t}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){let e=this.length;return new ij(this.x/e,this.y/e)}static distance(e,t){return new ij(t.x-e.x,t.y-e.y).length}}(z=Q||(Q={}))[z.OFF=0]="OFF",z[z.HELD=1]="HELD",z[z.PRESSED=2]="PRESSED";class iN{static get instance(){if(iN._instance)return iN._instance;throw Error("Controls is not created!")}keyDown(e){iN.instance.keyboard.set(e.key.toLowerCase(),1),e.preventDefault()}keyUp(e){iN.instance.keyboard.set(e.key.toLowerCase(),2),e.preventDefault(),requestAnimationFrame(()=>iN.instance.keyboard.set(e.key.toLowerCase(),0))}mouseMove(e){iN.instance.mouse.position=new ij(e.offsetX,e.offsetY)}mouseDown(e){0===e.button&&(iN.instance.mouse.pressed=!0)}mouseUp(e){0===e.button&&(iN.instance.mouse.pressed=!1)}constructor(e){this.keyboard=new Map,this.mouse={position:new ij(0,0),pressed:!1},e.addEventListener("keydown",e=>this.keyDown(e)),e.addEventListener("keyup",this.keyUp),e.addEventListener("mousemove",this.mouseMove),e.addEventListener("mousedown",this.mouseDown),e.addEventListener("mouseup",this.mouseUp),iN._instance=this}}var ed=et("lR3Ev");class iV extends ed.Container{constructor(){super(),this.desiredPosition=new ij(0,0),this.zoom=1,this.desiredZoom=1}screenToWorldPoint(e){return new ij((this.pivot.x*this.zoom-this.position.x+e.x)/this.zoom,(this.pivot.y*this.zoom-this.position.y+e.y)/this.zoom)}update(e){let t=this.desiredZoom-this.zoom;this.zoom=+this.zoom+t*e/15,this.scale.x=this.zoom,this.scale.y=this.zoom;let r={x:this.desiredPosition.x-this.pivot.x,y:this.desiredPosition.y-this.pivot.y};this.pivot.x=this.pivot.x+r.x*e/15,this.pivot.y=this.pivot.y+r.y*e/15}}var tA=et("9Qy7u"),ex=et("5h88T"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),iX="in vec2 aPosition;\nout vec2 vTextureCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",iY="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}",iH=Object.defineProperty,iW=(e,t,r)=>t in e?iH(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,iq=(e,t,r)=>(iW(e,"symbol"!=typeof t?t+"":t,r),r);const i$=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct AdjustmentUniforms {\n  uGamma: f32,\n  uContrast: f32,\n  uSaturation: f32,\n  uBrightness: f32,\n  uColor: vec4<f32>,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> adjustmentUniforms : AdjustmentUniforms;\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n  var sample = textureSample(uTexture, uSampler, uv);\n  let color = adjustmentUniforms.uColor;\n\n  if (sample.a > 0.0) \n  {\n    sample = vec4<f32>(sample.rgb / sample.a, sample.a);\n    var rgb: vec3<f32> = pow(sample.rgb, vec3<f32>(1. / adjustmentUniforms.uGamma));\n    rgb = mix(vec3<f32>(.5), mix(vec3<f32>(dot(vec3<f32>(.2125, .7154, .0721), rgb)), rgb, adjustmentUniforms.uSaturation), adjustmentUniforms.uContrast);\n    rgb.r *= color.r;\n    rgb.g *= color.g;\n    rgb.b *= color.b;\n    sample = vec4<f32>(rgb.rgb * adjustmentUniforms.uBrightness, sample.a);\n    sample = vec4<f32>(sample.rgb * sample.a, sample.a);\n  }\n\n  return sample * color.a;\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uGamma;\nuniform float uContrast;\nuniform float uSaturation;\nuniform float uBrightness;\nuniform vec4 uColor;\n\nvoid main()\n{\n    vec4 c = texture(uTexture, vTextureCoord);\n\n    if (c.a > 0.0) {\n        c.rgb /= c.a;\n\n        vec3 rgb = pow(c.rgb, vec3(1. / uGamma));\n        rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, uSaturation), uContrast);\n        rgb.r *= uColor.r;\n        rgb.g *= uColor.g;\n        rgb.b *= uColor.b;\n        c.rgb = rgb * uBrightness;\n\n        c.rgb *= c.a;\n    }\n\n    finalColor = c * uColor.a;\n}\n",name:"adjustment-filter"}),resources:{adjustmentUniforms:{uGamma:{value:t.gamma,type:"f32"},uContrast:{value:t.contrast,type:"f32"},uSaturation:{value:t.saturation,type:"f32"},uBrightness:{value:t.brightness,type:"f32"},uColor:{value:[t.red,t.green,t.blue,t.alpha],type:"vec4<f32>"}}}}),iq(this,"uniforms"),this.uniforms=this.resources.adjustmentUniforms.uniforms}get gamma(){return this.uniforms.uGamma}set gamma(e){this.uniforms.uGamma=e}get contrast(){return this.uniforms.uContrast}set contrast(e){this.uniforms.uContrast=e}get saturation(){return this.uniforms.uSaturation}set saturation(e){this.uniforms.uSaturation=e}get brightness(){return this.uniforms.uBrightness}set brightness(e){this.uniforms.uBrightness=e}get red(){return this.uniforms.uColor[0]}set red(e){this.uniforms.uColor[0]=e}get green(){return this.uniforms.uColor[1]}set green(e){this.uniforms.uColor[1]=e}get blue(){return this.uniforms.uColor[2]}set blue(e){this.uniforms.uColor[2]=e}get alpha(){return this.uniforms.uColor[3]}set alpha(e){this.uniforms.uColor[3]=e}};iq(i$,"DEFAULT_OPTIONS",{gamma:1,contrast:1,saturation:1,brightness:1,red:1,green:1,blue:1,alpha:1});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),ex=et("5h88T"),tv=et("7U2uj"),ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),tv=et("7U2uj"),iK=Object.defineProperty,iQ=(e,t,r)=>t in e?iK(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,iJ=(e,t,r)=>(iQ(e,"symbol"!=typeof t?t+"":t,r),r);const iZ=class e extends td.Filter{constructor(...t){let r=t[0]??{};("number"==typeof r||Array.isArray(r))&&((0,ep.deprecation)("6.0.0","KawaseBlurFilter constructor params are now options object. See params: { strength, quality, clamp, pixelSize }"),r={strength:r},void 0!==t[1]&&(r.quality=t[1]),void 0!==t[2]&&(r.clamp=t[2])),r={...e.DEFAULT_OPTIONS,...r},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:r?.clamp?"struct KawaseBlurUniforms {\n  uOffset:vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> kawaseBlurUniforms : KawaseBlurUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uOffset = kawaseBlurUniforms.uOffset;\n  var color: vec4<f32> = vec4(0.0);\n\n  // Sample top left pixel\n  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x - uOffset.x, uv.y + uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n  // Sample top right pixel\n  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x + uOffset.x, uv.y + uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n  // Sample bottom right pixel\n  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x + uOffset.x, uv.y - uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n  // Sample bottom left pixel\n  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x - uOffset.x, uv.y - uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n  // Average\n  color *= 0.25;\n    \n  return color;\n}":"struct KawaseBlurUniforms {\n  uOffset:vec2<f32>,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> kawaseBlurUniforms : KawaseBlurUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uOffset = kawaseBlurUniforms.uOffset;\n  var color: vec4<f32> = vec4<f32>(0.0);\n\n  // Sample top left pixel\n  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x - uOffset.x, uv.y + uOffset.y));\n  // Sample top right pixel\n  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x + uOffset.x, uv.y + uOffset.y));\n  // Sample bottom right pixel\n  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x + uOffset.x, uv.y - uOffset.y));\n  // Sample bottom left pixel\n  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x - uOffset.x, uv.y - uOffset.y));\n  // Average\n  color *= 0.25;\n\n  return color;\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:r?.clamp?"\nprecision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uOffset;\n\nuniform vec4 uInputClamp;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture(uTexture, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), uInputClamp.xy, uInputClamp.zw));\n\n    // Sample top right pixel\n    color += texture(uTexture, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), uInputClamp.xy, uInputClamp.zw));\n\n    // Sample bottom right pixel\n    color += texture(uTexture, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), uInputClamp.xy, uInputClamp.zw));\n\n    // Sample bottom left pixel\n    color += texture(uTexture, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), uInputClamp.xy, uInputClamp.zw));\n\n    // Average\n    color *= 0.25;\n\n    finalColor = color;\n}\n":"\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uOffset;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture(uTexture, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample top right pixel\n    color += texture(uTexture, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample bottom right pixel\n    color += texture(uTexture, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Sample bottom left pixel\n    color += texture(uTexture, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Average\n    color *= 0.25;\n\n    finalColor = color;\n}",name:"kawase-blur-filter"}),resources:{kawaseBlurUniforms:{uOffset:{value:new Float32Array(2),type:"vec2<f32>"}}}}),iJ(this,"uniforms"),iJ(this,"_pixelSize",{x:0,y:0}),iJ(this,"_clamp"),iJ(this,"_kernels",[]),iJ(this,"_blur"),iJ(this,"_quality"),this.uniforms=this.resources.kawaseBlurUniforms.uniforms,this.pixelSize=r.pixelSize??{x:1,y:1},Array.isArray(r.strength)?this.kernels=r.strength:"number"==typeof r.strength&&(this._blur=r.strength,this.quality=r.quality??3),this._clamp=!!r.clamp}apply(e,t,r,n){let i;let s=this.pixelSizeX/t.source.width,o=this.pixelSizeY/t.source.height;if(1===this._quality||0===this._blur)i=this._kernels[0]+.5,this.uniforms.uOffset[0]=i*s,this.uniforms.uOffset[1]=i*o,e.applyFilter(this,t,r,n);else{let a;let l=(0,tv.TexturePool).getSameSizeTexture(t),u=t,c=l,h=this._quality-1;for(let t=0;t<h;t++)i=this._kernels[t]+.5,this.uniforms.uOffset[0]=i*s,this.uniforms.uOffset[1]=i*o,e.applyFilter(this,u,c,!0),a=u,u=c,c=a;i=this._kernels[h]+.5,this.uniforms.uOffset[0]=i*s,this.uniforms.uOffset[1]=i*o,e.applyFilter(this,u,r,n),(0,tv.TexturePool).returnTexture(l)}}get strength(){return this._blur}set strength(e){this._blur=e,this._generateKernels()}get quality(){return this._quality}set quality(e){this._quality=Math.max(1,Math.round(e)),this._generateKernels()}get kernels(){return this._kernels}set kernels(e){Array.isArray(e)&&e.length>0?(this._kernels=e,this._quality=e.length,this._blur=Math.max(...e)):(this._kernels=[0],this._quality=1)}get pixelSize(){return this._pixelSize}set pixelSize(e){if("number"==typeof e){this.pixelSizeX=this.pixelSizeY=e;return}if(Array.isArray(e)){this.pixelSizeX=e[0],this.pixelSizeY=e[1];return}this._pixelSize=e}get pixelSizeX(){return this.pixelSize.x}set pixelSizeX(e){this.pixelSize.x=e}get pixelSizeY(){return this.pixelSize.y}set pixelSizeY(e){this.pixelSize.y=e}get clamp(){return this._clamp}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce((e,t)=>e+t+.5,0))}_generateKernels(){let e=this._blur,t=this._quality,r=[e];if(e>0){let n=e,i=e/t;for(let e=1;e<t;e++)n-=i,r.push(n)}this._kernels=r,this._updatePadding()}};iJ(iZ,"DEFAULT_OPTIONS",{strength:4,quality:3,clamp:!1,pixelSize:{x:1,y:1}});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),i0=Object.defineProperty,i2=(e,t,r)=>t in e?i0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,i1=(e,t,r)=>(i2(e,"symbol"!=typeof t?t+"":t,r),r);const i3=class e extends td.Filter{constructor(t){super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct ExtractBrightnessUniforms {\n  uThreshold: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> extractBrightnessUniforms : ExtractBrightnessUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  // A simple & fast algorithm for getting brightness.\n  // It's inaccurate, but good enough for this feature.\n  let max: f32 = max(max(color.r, color.g), color.b);\n  let min: f32 = min(min(color.r, color.g), color.b);\n  let brightness: f32 = (max + min) * 0.5;\n\n  return select(vec4<f32>(0.), color, brightness > extractBrightnessUniforms.uThreshold);\n}\n",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uThreshold;\n\nvoid main() {\n    vec4 color = texture(uTexture, vTextureCoord);\n\n    // A simple & fast algorithm for getting brightness.\n    // It's inaccuracy , but good enought for this feature.\n    float _max = max(max(color.r, color.g), color.b);\n    float _min = min(min(color.r, color.g), color.b);\n    float brightness = (_max + _min) * 0.5;\n\n    if(brightness > uThreshold) {\n        finalColor = color;\n    } else {\n        finalColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n}\n",name:"extract-brightness-filter"}),resources:{extractBrightnessUniforms:{uThreshold:{value:(t={...e.DEFAULT_OPTIONS,...t}).threshold,type:"f32"}}}}),i1(this,"uniforms"),this.uniforms=this.resources.extractBrightnessUniforms.uniforms}get threshold(){return this.uniforms.uThreshold}set threshold(e){this.uniforms.uThreshold=e}};i1(i3,"DEFAULT_OPTIONS",{threshold:.5});var i4=Object.defineProperty,i5=(e,t,r)=>t in e?i4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,i6=(e,t,r)=>(i5(e,"symbol"!=typeof t?t+"":t,r),r);const i8=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct AdvancedBloomUniforms {\n  uBloomScale: f32,\n  uBrightness: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> advancedBloomUniforms : AdvancedBloomUniforms;\n@group(1) @binding(1) var uMapTexture: texture_2d<f32>;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  var color = textureSample(uTexture, uSampler, uv);\n  color = vec4<f32>(color.rgb * advancedBloomUniforms.uBrightness, color.a);\n\n  var bloomColor = vec4<f32>(textureSample(uMapTexture, uSampler, uv).rgb, 0.0);\n  bloomColor = vec4<f32>(bloomColor.rgb * advancedBloomUniforms.uBloomScale, bloomColor.a);\n  \n  return color + bloomColor;\n}\n",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMapTexture;\nuniform float uBloomScale;\nuniform float uBrightness;\n\nvoid main() {\n    vec4 color = texture(uTexture, vTextureCoord);\n    color.rgb *= uBrightness;\n    vec4 bloomColor = vec4(texture(uMapTexture, vTextureCoord).rgb, 0.0);\n    bloomColor.rgb *= uBloomScale;\n    finalColor = color + bloomColor;\n}\n",name:"advanced-bloom-filter"}),resources:{advancedBloomUniforms:{uBloomScale:{value:t.bloomScale,type:"f32"},uBrightness:{value:t.brightness,type:"f32"}},uMapTexture:ex.Texture.WHITE}}),i6(this,"uniforms"),i6(this,"bloomScale",1),i6(this,"brightness",1),i6(this,"_extractFilter"),i6(this,"_blurFilter"),this.uniforms=this.resources.advancedBloomUniforms.uniforms,this._extractFilter=new i3({threshold:t.threshold}),this._blurFilter=new iZ({strength:t.kernels??t.blur,quality:t.kernels?void 0:t.quality}),Object.assign(this,t)}apply(e,t,r,n){let i=(0,tv.TexturePool).getSameSizeTexture(t);this._extractFilter.apply(e,t,i,!0);let s=(0,tv.TexturePool).getSameSizeTexture(t);this._blurFilter.apply(e,i,s,!0),this.uniforms.uBloomScale=this.bloomScale,this.uniforms.uBrightness=this.brightness,this.resources.uMapTexture=s.source,e.applyFilter(this,t,r,n),(0,tv.TexturePool).returnTexture(s),(0,tv.TexturePool).returnTexture(i)}get threshold(){return this._extractFilter.threshold}set threshold(e){this._extractFilter.threshold=e}get kernels(){return this._blurFilter.kernels}set kernels(e){this._blurFilter.kernels=e}get blur(){return this._blurFilter.strength}set blur(e){this._blurFilter.strength=e}get quality(){return this._blurFilter.quality}set quality(e){this._blurFilter.quality=e}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(e){"number"==typeof e&&(e={x:e,y:e}),Array.isArray(e)&&(e={x:e[0],y:e[1]}),this._blurFilter.pixelSize=e}get pixelSizeX(){return this._blurFilter.pixelSizeX}set pixelSizeX(e){this._blurFilter.pixelSizeX=e}get pixelSizeY(){return this._blurFilter.pixelSizeY}set pixelSizeY(e){this._blurFilter.pixelSizeY=e}};i6(i8,"DEFAULT_OPTIONS",{threshold:.5,bloomScale:1,brightness:1,blur:8,quality:4,pixelSize:{x:1,y:1}});var tu=et("AHTcQ"),ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),i9=Object.defineProperty,i7=(e,t,r)=>t in e?i9(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,se=(e,t,r)=>(i7(e,"symbol"!=typeof t?t+"":t,r),r);const st=class e extends td.Filter{constructor(...t){let r=t[0]??{};"number"==typeof r&&((0,ep.deprecation)("6.0.0","AsciiFilter constructor params are now options object. See params: { size, color, replaceColor }"),r={size:r}),super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct AsciiUniforms {\n    uSize: f32,\n    uColor: vec3<f32>,\n    uReplaceColor: f32,\n};\n\nstruct GlobalFilterUniforms {\n    uInputSize:vec4<f32>,\n    uInputPixel:vec4<f32>,\n    uInputClamp:vec4<f32>,\n    uOutputFrame:vec4<f32>,\n    uGlobalFrame:vec4<f32>,\n    uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> asciiUniforms : AsciiUniforms;\n\n@fragment\nfn mainFragment(\n    @location(0) uv: vec2<f32>,\n    @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n    let pixelSize: f32 = asciiUniforms.uSize;\n    let coord: vec2<f32> = mapCoord(uv);\n\n    // get the rounded color..\n    var pixCoord: vec2<f32> = pixelate(coord, vec2<f32>(pixelSize));\n    pixCoord = unmapCoord(pixCoord);\n\n    var color = textureSample(uTexture, uSampler, pixCoord);\n\n    // determine the character to use\n    let gray: f32 = 0.3 * color.r + 0.59 * color.g + 0.11 * color.b;\n    \n    var n: f32 = 65536.0; // .\n    if (gray > 0.2) {\n        n = 65600.0;    // :\n    }\n    if (gray > 0.3) {\n        n = 332772.0;   // *\n    }\n    if (gray > 0.4) {\n        n = 15255086.0; // o\n    }\n    if (gray > 0.5) {\n        n = 23385164.0; // &\n    }\n    if (gray > 0.6) {\n        n = 15252014.0; // 8\n    }\n    if (gray > 0.7) {\n        n = 13199452.0; // @\n    }\n    if (gray > 0.8) {\n        n = 11512810.0; // #\n    }\n\n    // get the mod..\n    let modd: vec2<f32> = getMod(coord, vec2<f32>(pixelSize));\n    return select(color, vec4<f32>(asciiUniforms.uColor, 1.), asciiUniforms.uReplaceColor > 0.5) * character(n, vec2<f32>(-1.0) + modd * 2.0);\n}\n\nfn pixelate(coord: vec2<f32>, size: vec2<f32>) -> vec2<f32>\n{\n    return floor( coord / size ) * size;\n}\n\nfn getMod(coord: vec2<f32>, size: vec2<f32>) -> vec2<f32>\n{\n    return moduloVec2( coord , size) / size;\n}\n\nfn character(n: f32, p: vec2<f32>) -> f32\n{\n    var q: vec2<f32> = floor(p*vec2<f32>(4.0, 4.0) + 2.5);\n\n    if (clamp(q.x, 0.0, 4.0) == q.x)\n    {\n        if (clamp(q.y, 0.0, 4.0) == q.y)\n        {\n        if (i32(modulo(n/exp2(q.x + 5.0*q.y), 2.0)) == 1)\n        {\n            return 1.0;\n        }\n        }\n    }\n\n    return 0.0;\n}\n\nfn modulo(x: f32, y: f32) -> f32\n{\n  return x - y * floor(x/y);\n}\n\nfn moduloVec2(x: vec2<f32>, y: vec2<f32>) -> vec2<f32>\n{\n  return x - y * floor(x/y);\n}\n\nfn mapCoord(coord: vec2<f32> ) -> vec2<f32>\n{\n    var mappedCoord: vec2<f32> = coord;\n    mappedCoord *= gfu.uInputSize.xy;\n    mappedCoord += gfu.uOutputFrame.xy;\n    return mappedCoord;\n}\n\nfn unmapCoord(coord: vec2<f32> ) -> vec2<f32>\n{\n    var mappedCoord: vec2<f32> = coord;\n    mappedCoord -= gfu.uOutputFrame.xy;\n    mappedCoord /= gfu.uInputSize.xy;\n    return mappedCoord;\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uSize;\nuniform vec3 uColor;\nuniform float uReplaceColor;\n\nuniform vec4 uInputSize;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= uInputSize.xy;\n    coord += uInputSize.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= uInputSize.zw;\n    coord /= uInputSize.xy;\n\n    return coord;\n}\n\nvec2 pixelate(vec2 coord, vec2 size)\n{\n    return floor(coord / size) * size;\n}\n\nvec2 getMod(vec2 coord, vec2 size)\n{\n    return mod(coord, size) / size;\n}\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, 4.0) + 2.5);\n\n    if (clamp(p.x, 0.0, 4.0) == p.x)\n    {\n        if (clamp(p.y, 0.0, 4.0) == p.y)\n        {\n            if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n        }\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 coord = mapCoord(vTextureCoord);\n\n    // get the grid position\n    vec2 pixCoord = pixelate(coord, vec2(uSize));\n    pixCoord = unmapCoord(pixCoord);\n\n    // sample the color at grid position\n    vec4 color = texture(uTexture, pixCoord);\n\n    // brightness of the color as it's perceived by the human eye\n    float gray = 0.3 * color.r + 0.59 * color.g + 0.11 * color.b;\n\n    // determine the character to use\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    // get the mod..\n    vec2 modd = getMod(coord, vec2(uSize));\n\n    finalColor = (uReplaceColor > 0.5 ? vec4(uColor, 1.) : color) * character( n, vec2(-1.0) + modd * 2.0);\n}\n",name:"ascii-filter"}),resources:{asciiUniforms:{uSize:{value:(r={...e.DEFAULT_OPTIONS,...r}).size,type:"f32"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uReplaceColor:{value:Number(r?.color&&!1!==r.replaceColor),type:"f32"}}}}),se(this,"uniforms"),se(this,"_color"),this.uniforms=this.resources.asciiUniforms.uniforms,this._color=new tu.Color,this.color=r.color??16777215}get size(){return this.uniforms.uSize}set size(e){this.uniforms.uSize=e}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,n]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=n}get replaceColor(){return this.uniforms.uReplaceColor>.5}set replaceColor(e){this.uniforms.uReplaceColor=e?1:0}};se(st,"DEFAULT_OPTIONS",{size:8,color:16777215,replaceColor:!1});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),ex=et("5h88T"),tv=et("7U2uj"),tu=et("AHTcQ"),tC=et("gIu8o"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sr=Object.defineProperty,sn=(e,t,r)=>t in e?sr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,si=(e,t,r)=>(sn(e,"symbol"!=typeof t?t+"":t,r),r);const ss=class e extends td.Filter{constructor(t){let r=((t={...e.DEFAULT_OPTIONS,...t}).rotation??45)*tC.DEG_TO_RAD;super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct BevelUniforms {\n  uLightColor: vec3<f32>,\n  uLightAlpha: f32,\n  uShadowColor: vec3<f32>,\n  uShadowAlpha: f32,\n  uTransform: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> bevelUniforms : BevelUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let transform = vec2<f32>(1.0 / gfu.uInputSize.xy) * vec2<f32>(bevelUniforms.uTransform.x, bevelUniforms.uTransform.y);\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let lightSample: f32 = textureSample(uTexture, uSampler, uv - transform).a;\n  let shadowSample: f32 = textureSample(uTexture, uSampler, uv + transform).a;\n\n  let light = vec4<f32>(bevelUniforms.uLightColor, bevelUniforms.uLightAlpha);\n  let shadow = vec4<f32>(bevelUniforms.uShadowColor, bevelUniforms.uShadowAlpha);\n\n  color = vec4<f32>(mix(color.rgb, light.rgb, clamp((color.a - lightSample) * light.a, 0.0, 1.0)), color.a);\n  color = vec4<f32>(mix(color.rgb, shadow.rgb, clamp((color.a - shadowSample) * shadow.a, 0.0, 1.0)), color.a);\n  \n  return vec4<f32>(color.rgb * color.a, color.a);\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uTransform;\nuniform vec3 uLightColor;\nuniform float uLightAlpha;\nuniform vec3 uShadowColor;\nuniform float uShadowAlpha;\n\nuniform vec4 uInputSize;\n\nvoid main(void) {\n    vec2 transform = vec2(1.0 / uInputSize) * vec2(uTransform.x, uTransform.y);\n    vec4 color = texture(uTexture, vTextureCoord);\n    float light = texture(uTexture, vTextureCoord - transform).a;\n    float shadow = texture(uTexture, vTextureCoord + transform).a;\n\n    color.rgb = mix(color.rgb, uLightColor, clamp((color.a - light) * uLightAlpha, 0.0, 1.0));\n    color.rgb = mix(color.rgb, uShadowColor, clamp((color.a - shadow) * uShadowAlpha, 0.0, 1.0));\n    finalColor = vec4(color.rgb * color.a, color.a);\n}\n",name:"bevel-filter"}),resources:{bevelUniforms:{uLightColor:{value:new Float32Array(3),type:"vec3<f32>"},uLightAlpha:{value:t.lightAlpha,type:"f32"},uShadowColor:{value:new Float32Array(3),type:"vec3<f32>"},uShadowAlpha:{value:t.shadowAlpha,type:"f32"},uTransform:{value:new Float32Array(2),type:"vec2<f32>"}}},padding:1}),si(this,"uniforms"),si(this,"_thickness"),si(this,"_rotation"),si(this,"_lightColor"),si(this,"_shadowColor"),this.uniforms=this.resources.bevelUniforms.uniforms,this._lightColor=new tu.Color,this._shadowColor=new tu.Color,this.lightColor=t.lightColor??16777215,this.shadowColor=t.shadowColor??0,Object.assign(this,t,{rotation:r})}get rotation(){return this._rotation/tC.DEG_TO_RAD}set rotation(e){this._rotation=e*tC.DEG_TO_RAD,this._updateTransform()}get thickness(){return this._thickness}set thickness(e){this._thickness=e,this._updateTransform()}get lightColor(){return this._lightColor.value}set lightColor(e){this._lightColor.setValue(e);let[t,r,n]=this._lightColor.toArray();this.uniforms.uLightColor[0]=t,this.uniforms.uLightColor[1]=r,this.uniforms.uLightColor[2]=n}get lightAlpha(){return this.uniforms.uLightAlpha}set lightAlpha(e){this.uniforms.uLightAlpha=e}get shadowColor(){return this._shadowColor.value}set shadowColor(e){this._shadowColor.setValue(e);let[t,r,n]=this._shadowColor.toArray();this.uniforms.uShadowColor[0]=t,this.uniforms.uShadowColor[1]=r,this.uniforms.uShadowColor[2]=n}get shadowAlpha(){return this.uniforms.uShadowAlpha}set shadowAlpha(e){this.uniforms.uShadowAlpha=e}_updateTransform(){this.uniforms.uTransform[0]=this.thickness*Math.cos(this._rotation),this.uniforms.uTransform[1]=this.thickness*Math.sin(this._rotation)}};si(ss,"DEFAULT_OPTIONS",{rotation:45,thickness:2,lightColor:16777215,lightAlpha:.7,shadowColor:0,shadowAlpha:.7});var ep=et("eX50w"),tv=et("7U2uj"),so=Object.defineProperty,sa=(e,t,r)=>t in e?so(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sl=(e,t,r)=>(sa(e,"symbol"!=typeof t?t+"":t,r),r);const su=class e extends tg{constructor(...t){let r=t[0]??{};if("number"==typeof r||Array.isArray(r)||"x"in r&&"y"in r){(0,ep.deprecation)("6.0.0","BloomFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }");let e=r;Array.isArray(e)&&(e={x:e[0],y:e[1]}),r={strength:e},void 0!==t[1]&&(r.quality=t[1]),void 0!==t[2]&&(r.resolution=t[2]),void 0!==t[3]&&(r.kernelSize=t[3])}r={...e.DEFAULT_OPTIONS,...r},super(),sl(this,"_blurXFilter"),sl(this,"_blurYFilter"),sl(this,"_strength"),this._strength={x:2,y:2},r.strength&&("number"==typeof r.strength?(this._strength.x=r.strength,this._strength.y=r.strength):(this._strength.x=r.strength.x,this._strength.y=r.strength.y)),this._blurXFilter=new t_({...r,horizontal:!0,strength:this.strengthX}),this._blurYFilter=new t_({...r,horizontal:!1,strength:this.strengthY}),this._blurYFilter.blendMode="screen",Object.assign(this,r)}apply(e,t,r,n){let i=(0,tv.TexturePool).getSameSizeTexture(t);e.applyFilter(this,t,r,n),this._blurXFilter.apply(e,t,i,!0),this._blurYFilter.apply(e,i,r,!1),(0,tv.TexturePool).returnTexture(i)}get strength(){return this._strength}set strength(e){this._strength="number"==typeof e?{x:e,y:e}:e,this._updateStrength()}get strengthX(){return this.strength.x}set strengthX(e){this.strength.x=e,this._updateStrength()}get strengthY(){return this.strength.y}set strengthY(e){this.strength.y=e,this._updateStrength()}_updateStrength(){this._blurXFilter.blur=this.strengthX,this._blurYFilter.blur=this.strengthY}get blur(){return(0,ep.deprecation)("6.0.0","BloomFilter.blur is deprecated, please use BloomFilter.strength instead"),this.strengthX}set blur(e){(0,ep.deprecation)("6.0.0","BloomFilter.blur is deprecated, please use BloomFilter.strength instead"),this.strength=e}get blurX(){return(0,ep.deprecation)("6.0.0","BloomFilter.blurX is deprecated, please use BloomFilter.strengthX instead"),this.strengthX}set blurX(e){(0,ep.deprecation)("6.0.0","BloomFilter.blurX is deprecated, please use BloomFilter.strengthX instead"),this.strengthX=e}get blurY(){return(0,ep.deprecation)("6.0.0","BloomFilter.blurY is deprecated, please use BloomFilter.strengthY instead"),this.strengthY}set blurY(e){(0,ep.deprecation)("6.0.0","BloomFilter.blurY is deprecated, please use BloomFilter.strengthY instead"),this.strengthY=e}};sl(su,"DEFAULT_OPTIONS",{strength:{x:2,y:2},quality:4,resolution:1,kernelSize:5});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sc=Object.defineProperty,sh=(e,t,r)=>t in e?sc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sf=(e,t,r)=>(sh(e,"symbol"!=typeof t?t+"":t,r),r);const sd=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct BulgePinchUniforms {\n  uDimensions: vec2<f32>,\n  uCenter: vec2<f32>,\n  uRadius: f32,\n  uStrength: f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> bulgePinchUniforms : BulgePinchUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let dimensions: vec2<f32> = bulgePinchUniforms.uDimensions;\n  let center: vec2<f32> = bulgePinchUniforms.uCenter;\n  let radius: f32 = bulgePinchUniforms.uRadius;\n  let strength: f32 = bulgePinchUniforms.uStrength;\n  var coord: vec2<f32> = (uv * gfu.uInputSize.xy) - center * dimensions.xy;\n\n  let distance: f32 = length(coord);\n\n  if (distance < radius) {\n      let percent: f32 = distance / radius;\n      if (strength > 0.0) {\n          coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\n      } else {\n          coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\n      }\n  }\n    coord += (center * dimensions.xy);\n    coord /= gfu.uInputSize.xy;\n\n    let clampedCoord: vec2<f32> = clamp(coord, gfu.uInputClamp.xy, gfu.uInputClamp.zw);\n    var color: vec4<f32> = textureSample(uTexture, uSampler, clampedCoord);\n    if (coord.x != clampedCoord.x && coord.y != clampedCoord.y) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    return color;\n}\n\nfn compareVec2(x: vec2<f32>, y: vec2<f32>) -> bool\n{\n  if (x.x == y.x && x.y == y.y)\n  {\n    return true;\n  }\n\n  return false;\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uDimensions;\nuniform vec2 uCenter;\nuniform float uRadius;\nuniform float uStrength;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nvoid main()\n{\n    vec2 coord = vTextureCoord * uInputSize.xy;\n    coord -= uCenter * uDimensions.xy;\n    float distance = length(coord);\n\n    if (distance < uRadius) {\n        float percent = distance / uRadius;\n        if (uStrength > 0.0) {\n            coord *= mix(1.0, smoothstep(0.0, uRadius / distance, percent), uStrength * 0.75);\n        } else {\n            coord *= mix(1.0, pow(percent, 1.0 + uStrength * 0.75) * uRadius / distance, 1.0 - percent);\n        }\n    }\n\n    coord += uCenter * uDimensions.xy;\n    coord /= uInputSize.xy;\n    vec2 clampedCoord = clamp(coord, uInputClamp.xy, uInputClamp.zw);\n    vec4 color = texture(uTexture, clampedCoord);\n\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    finalColor = color;\n}\n",name:"bulge-pinch-filter"}),resources:{bulgePinchUniforms:{uDimensions:{value:[0,0],type:"vec2<f32>"},uCenter:{value:t.center,type:"vec2<f32>"},uRadius:{value:t.radius,type:"f32"},uStrength:{value:t.strength,type:"f32"}}}}),sf(this,"uniforms"),this.uniforms=this.resources.bulgePinchUniforms.uniforms,Object.assign(this,t)}apply(e,t,r,n){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,e.applyFilter(this,t,r,n)}get center(){return this.uniforms.uCenter}set center(e){"number"==typeof e&&(e={x:e,y:e}),Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uCenter=e}get centerX(){return this.uniforms.uCenter.x}set centerX(e){this.uniforms.uCenter.x=e}get centerY(){return this.uniforms.uCenter.y}set centerY(e){this.uniforms.uCenter.y=e}get radius(){return this.uniforms.uRadius}set radius(e){this.uniforms.uRadius=e}get strength(){return this.uniforms.uStrength}set strength(e){this.uniforms.uStrength=e}};sf(sd,"DEFAULT_OPTIONS",{center:{x:.5,y:.5},radius:100,strength:1});var tu=et("AHTcQ"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sp="struct BaseUniforms {\n  uOptions: vec4<f32>,\n  uCounts: vec2<f32>,\n};\n\nstruct StopsUniforms {\n  uColors: array<vec3<f32>, MAX_STOPS>,\n  uStops: array<vec4<f32>, MAX_STOPS>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> baseUniforms : BaseUniforms;\n@group(1) @binding(1) var<uniform> stopsUniforms : StopsUniforms;\n\nstruct VSOutput {\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>,\n  @location(1) coord : vec2<f32>\n};\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn filterCoord( vTextureCoord:vec2<f32> ) -> vec2<f32>\n{\n    return vTextureCoord * gfu.uInputSize.xy / gfu.uOutputFrame.zw;\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  let vTextureCoord: vec2<f32> = filterTextureCoord(aPosition);\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   vTextureCoord,\n   filterCoord(vTextureCoord),\n  );\n}\n\nstruct ColorStop {\n  offset: f32,\n  color: vec3<f32>,\n  alpha: f32,\n};\n\nfn rotate2d(angle: f32) -> mat2x2<f32>{\n  return mat2x2(cos(angle), -sin(angle),\n  sin(angle), cos(angle));\n}\n\nfn projectLinearPosition(pos: vec2<f32>, angle: f32) -> f32 {\n  var center: vec2<f32> = vec2<f32>(0.5);\n  var result: vec2<f32> = pos - center;\n  result = rotate2d(angle) * result;\n  result = result + center;\n  return clamp(result.x, 0.0, 1.0);\n}\n\nfn projectRadialPosition(pos: vec2<f32>) -> f32 {\n  var r: f32 = distance(pos, vec2<f32>(0.5));\n  return clamp(2.0 * r, 0.0, 1.0);\n}\n\nfn projectAnglePosition(pos: vec2<f32>, angle: f32) -> f32 {\n  var center: vec2<f32> = pos - vec2<f32>(0.5, 0.5);\n  var polarAngle: f32 = atan2(-center.y, center.x);\n  return ((polarAngle + angle) % PI_2) / PI_2;\n}\n\nfn projectPosition(pos: vec2<f32>, gradientType: i32, angle: f32) -> f32 {\n  if (gradientType == TYPE_LINEAR) {\n      return projectLinearPosition(pos, angle);\n  } else if (gradientType == TYPE_RADIAL) {\n      return projectRadialPosition(pos);\n  } else if (gradientType == TYPE_CONIC) {\n      return projectAnglePosition(pos, angle);\n  }\n\n  return pos.y;\n}\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>,\n  @location(1) coord : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uType: i32 = i32(baseUniforms.uOptions[0]);\n  let uAngle: f32 = baseUniforms.uOptions[1];\n  let uAlpha: f32 = baseUniforms.uOptions[2];\n  let uReplace: f32 = baseUniforms.uOptions[3];\n\n  let uNumStops: i32 = i32(baseUniforms.uCounts[0]);\n  let uMaxColors: f32 = baseUniforms.uCounts[1];\n\n  // current/original color\n  var currentColor: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  // skip calculations if gradient alpha is 0\n  if (uAlpha == 0.0) { return currentColor; }\n\n  // project position\n  var y: f32 = projectPosition(coord, uType, radians(uAngle));\n\n  // check gradient bounds\n  var offsetMin: f32 = stopsUniforms.uStops[0][0];\n  var offsetMax: f32 = 0.0;\n\n  let numStops: i32 = uNumStops;\n\n  for (var i: i32 = 0; i < MAX_STOPS; i = i + 1) {\n      if (i == numStops - 1) { // last index\n          offsetMax = stopsUniforms.uStops[i][0];\n      }\n  }\n\n  if (y  < offsetMin || y > offsetMax) { return currentColor; }\n\n  // limit colors\n  if (uMaxColors > 0.0) {\n      var stepSize: f32 = 1.0 / uMaxColors;\n      var stepNumber: f32 = floor(y / stepSize);\n      y = stepSize * (stepNumber + 0.5); // offset by 0.5 to use color from middle of segment\n  }\n\n  // find color stops\n  var stopFrom: ColorStop;\n  var stopTo: ColorStop;\n\n  for (var i: i32 = 0; i < MAX_STOPS; i = i + 1) {\n      if (y >= stopsUniforms.uStops[i][0]) {\n          stopFrom = ColorStop(stopsUniforms.uStops[i][0], stopsUniforms.uColors[i], stopsUniforms.uStops[i][1]);\n          stopTo = ColorStop(stopsUniforms.uStops[i + 1][0], stopsUniforms.uColors[i + 1], stopsUniforms.uStops[i + 1][1]);\n      }\n\n      if (i == numStops - 1) { // last index\n          break;\n      }\n  }\n\n  // mix colors from stops\n  var colorFrom: vec4<f32> = vec4<f32>(stopFrom.color * stopFrom.alpha, stopFrom.alpha);\n  var colorTo: vec4<f32> = vec4<f32>(stopTo.color * stopTo.alpha, stopTo.alpha);\n\n  var segmentHeight: f32 = stopTo.offset - stopFrom.offset;\n  var relativePos: f32 = y - stopFrom.offset; // position from 0 to [segmentHeight]\n  var relativePercent: f32 = relativePos / segmentHeight; // position in percent between [from.offset] and [to.offset].\n\n  var gradientAlpha: f32 = uAlpha * currentColor.a;\n  var gradientColor: vec4<f32> = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;\n\n  if (uReplace < 0.5) {\n      // mix resulting color with current color\n      return gradientColor + currentColor * (1.0 - gradientColor.a);\n  } else {\n      // replace with gradient color\n      return gradientColor;\n  }\n}\n\nconst PI: f32 = 3.14159265358979323846264;\nconst PI_2: f32 = PI * 2.0;\n\nconst TYPE_LINEAR: i32 = 0;\nconst TYPE_RADIAL: i32 = 1;\nconst TYPE_CONIC: i32 = 2;\nconst MAX_STOPS: i32 = 32;",sm=sm||{};sm.stringify=(F={"visit_linear-gradient":function(e){return F.visit_gradient(e)},"visit_repeating-linear-gradient":function(e){return F.visit_gradient(e)},"visit_radial-gradient":function(e){return F.visit_gradient(e)},"visit_repeating-radial-gradient":function(e){return F.visit_gradient(e)},visit_gradient:function(e){var t=F.visit(e.orientation);return t&&(t+=", "),e.type+"("+t+F.visit(e.colorStops)+")"},visit_shape:function(e){var t=e.value,r=F.visit(e.at),n=F.visit(e.style);return n&&(t+=" "+n),r&&(t+=" at "+r),t},"visit_default-radial":function(e){var t="",r=F.visit(e.at);return r&&(t+=r),t},"visit_extent-keyword":function(e){var t=e.value,r=F.visit(e.at);return r&&(t+=" at "+r),t},"visit_position-keyword":function(e){return e.value},visit_position:function(e){return F.visit(e.value.x)+" "+F.visit(e.value.y)},"visit_%":function(e){return e.value+"%"},visit_em:function(e){return e.value+"em"},visit_px:function(e){return e.value+"px"},visit_literal:function(e){return F.visit_color(e.value,e)},visit_hex:function(e){return F.visit_color("#"+e.value,e)},visit_rgb:function(e){return F.visit_color("rgb("+e.value.join(", ")+")",e)},visit_rgba:function(e){return F.visit_color("rgba("+e.value.join(", ")+")",e)},visit_color:function(e,t){var r=e,n=F.visit(t.length);return n&&(r+=" "+n),r},visit_angular:function(e){return e.value+"deg"},visit_directional:function(e){return"to "+e.value},visit_array:function(e){var t="",r=e.length;return e.forEach(function(e,n){t+=F.visit(e),n<r-1&&(t+=", ")}),t},visit:function(e){if(!e)return"";if(e instanceof Array)return F.visit_array(e,"");if(e.type){var t=F["visit_"+e.type];if(t)return t(e);throw Error("Missing visitor visit_"+e.type)}throw Error("Invalid node.")}},function(e){return F.visit(e)});var sm=sm||{};sm.parse=function(){var e={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},t="";function r(e){var r=Error(t+": "+e);throw r.source=t,r}function n(){return i("linear-gradient",e.linearGradient,o)||i("repeating-linear-gradient",e.repeatingLinearGradient,o)||i("radial-gradient",e.radialGradient,a)||i("repeating-radial-gradient",e.repeatingRadialGradient,a)}function i(t,n,i){return s(n,function(n){var s=i();return s&&!y(e.comma)&&r("Missing comma before color stops"),{type:t,orientation:s,colorStops:f(d)}})}function s(t,n){var i=y(t);if(i){y(e.startCall)||r("Missing (");var s=n(i);return y(e.endCall)||r("Missing )"),s}}function o(){return v("directional",e.sideOrCorner,1)||v("angular",e.angleValue,1)}function a(){var r,n,i=l();return i&&((r=[]).push(i),n=t,y(e.comma)&&((i=l())?r.push(i):t=n)),r}function l(){var e,t,r=((e=v("shape",/^(circle)/i,0))&&(e.style=g()||u()),e||((t=v("shape",/^(ellipse)/i,0))&&(t.style=m()||u()),t));if(r)r.at=c();else{var n=u();if(n){r=n;var i=c();i&&(r.at=i)}else{var s=h();s&&(r={type:"default-radial",at:s})}}return r}function u(){return v("extent-keyword",e.extentKeywords,1)}function c(){if(v("position",/^at/,0)){var e=h();return e||r("Missing positioning value"),e}}function h(){var e={x:m(),y:m()};if(e.x||e.y)return{type:"position",value:e}}function f(t){var n=t(),i=[];if(n)for(i.push(n);y(e.comma);)(n=t())?i.push(n):r("One extra comma");return i}function d(){var t=v("hex",e.hexColor,1)||s(e.rgbaColor,function(){return{type:"rgba",value:f(p)}})||s(e.rgbColor,function(){return{type:"rgb",value:f(p)}})||v("literal",e.literalColor,0);return t||r("Expected color definition"),t.length=m(),t}function p(){return y(e.number)[1]}function m(){return v("%",e.percentageValue,1)||v("position-keyword",e.positionKeywords,1)||g()}function g(){return v("px",e.pixelValue,1)||v("em",e.emValue,1)}function v(e,t,r){var n=y(t);if(n)return{type:e,value:n[r]}}function y(e){var r,n;return(n=/^[\n\r\t\s]+/.exec(t))&&x(n[0].length),(r=e.exec(t))&&x(r[0].length),r}function x(e){t=t.substr(e)}return function(e){var i;return t=e.toString(),i=f(n),t.length>0&&r("Invalid input not EOF"),i}}();var sg=sm.parse;sm.stringify;var tu=et("AHTcQ");function sv(e){return e.toString().length>6?parseFloat(e.toString().substring(0,6)):e}var sy=Object.defineProperty,sx=(e,t,r)=>t in e?sy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sb=(e,t,r)=>(sx(e,"symbol"!=typeof t?t+"":t,r),r);const s_=class e extends td.Filter{constructor(t){if(!(t=t&&"css"in t?{...function(e){let t;let r=sg(e.replace(/\s{2,}/gu," ").replace(/;/g,"").replace(/ ,/g,",").replace(/\( /g,"(").replace(/ \)/g,")").trim());if(0===r.length)throw Error("Invalid CSS gradient.");if(1!==r.length)throw Error("Unsupported CSS gradient (multiple gradients is not supported).");let n=r[0];return{type:function(e){let t={"linear-gradient":0,"radial-gradient":1};if(!(e in t))throw Error(`Unsupported gradient type "${e}"`);return t[e]}(n.type),stops:function(e){let t=function(e){let t=[];for(let r=0;r<e.length;r++){let n=e[r],i=-1;"literal"===n.type&&n.length&&"type"in n.length&&"%"===n.length.type&&"value"in n.length&&(i=parseFloat(n.length.value)/100),t.push(i)}let r=e=>{for(let r=e;r<t.length;r++)if(-1!==t[r])return{indexDelta:r-e,offset:t[r]};return{indexDelta:t.length-1-e,offset:1}},n=0;for(let e=0;e<t.length;e++){let i=t[e];if(-1!==i)n=i;else if(0===e)t[e]=0;else if(e+1===t.length)t[e]=1;else{let i=r(e),s=(i.offset-n)/(1+i.indexDelta);for(let r=0;r<=i.indexDelta;r++)t[e+r]=n+(r+1)*s;e+=i.indexDelta,n=t[e]}}return t.map(sv)}(e),r=[],n=new tu.Color;for(let i=0;i<e.length;i++){let s=function(e){switch(e.type){case"hex":return`#${e.value}`;case"literal":return e.value;default:return`${e.type}(${e.value.join(",")})`}}(e[i]),o=n.setValue(s).toArray();r.push({offset:t[i],color:o.slice(0,3),alpha:o[3]})}return r}(n.colorStops),angle:function(e){if(void 0===e)return 0;if("type"in e&&"value"in e)switch(e.type){case"angular":return parseFloat(e.value);case"directional":return function(e){let t={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(e in t))throw Error(`Unsupported directional value "${e}"`);return t[e]}(e.value)}return 0}(n.orientation)}}(t.css||""),alpha:t.alpha??e.defaults.alpha,maxColors:t.maxColors??e.defaults.maxColors}:{...e.defaults,...t}).stops||t.stops.length<2)throw Error("ColorGradientFilter requires at least 2 color stops.");super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:sp,entryPoint:"mainVertex"},fragment:{source:sp,entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:"in vec2 aPosition;\nout vec2 vTextureCoord;\nout vec2 vFilterCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n    vFilterCoord = vTextureCoord * uInputSize.xy / uOutputFrame.zw;\n}\n",fragment:"precision highp float;\nin vec2 vTextureCoord;\nin vec2 vFilterCoord;\nout vec4 finalColor;\n\nconst int TYPE_LINEAR = 0;\nconst int TYPE_RADIAL = 1;\nconst int TYPE_CONIC = 2;\nconst int MAX_STOPS = 32;\n\nuniform sampler2D uTexture;\nuniform vec4 uOptions;\nuniform vec2 uCounts;\nuniform vec3 uColors[MAX_STOPS];\nuniform vec4 uStops[MAX_STOPS];\n\nconst float PI = 3.1415926538;\nconst float PI_2 = PI*2.;\n\nstruct ColorStop {\n    float offset;\n    vec3 color;\n    float alpha;\n};\n\nmat2 rotate2d(float angle){\n    return mat2(cos(angle), -sin(angle),\n    sin(angle), cos(angle));\n}\n\nfloat projectLinearPosition(vec2 pos, float angle){\n    vec2 center = vec2(0.5);\n    vec2 result = pos - center;\n    result = rotate2d(angle) * result;\n    result = result + center;\n    return clamp(result.x, 0., 1.);\n}\n\nfloat projectRadialPosition(vec2 pos) {\n    float r = distance(pos, vec2(0.5));\n    return clamp(2.*r, 0., 1.);\n}\n\nfloat projectAnglePosition(vec2 pos, float angle) {\n    vec2 center = pos - vec2(0.5);\n    float polarAngle=atan(-center.y, center.x);\n    return mod(polarAngle + angle, PI_2) / PI_2;\n}\n\nfloat projectPosition(vec2 pos, int type, float angle) {\n    if (type == TYPE_LINEAR) {\n        return projectLinearPosition(pos, angle);\n    } else if (type == TYPE_RADIAL) {\n        return projectRadialPosition(pos);\n    } else if (type == TYPE_CONIC) {\n        return projectAnglePosition(pos, angle);\n    }\n\n    return pos.y;\n}\n\nvoid main(void) {\n    int uType = int(uOptions[0]);\n    float uAngle = uOptions[1];\n    float uAlpha = uOptions[2];\n    float uReplace = uOptions[3];\n\n    int uNumStops = int(uCounts[0]);\n    float uMaxColors = uCounts[1];\n\n    // current/original color\n    vec4 currentColor = texture(uTexture, vTextureCoord);\n\n    // skip calculations if gradient alpha is 0\n    if (0.0 == uAlpha) {\n        finalColor = currentColor;\n        return;\n    }\n\n    // project position\n    float y = projectPosition(vFilterCoord, int(uType), radians(uAngle));\n\n    // check gradient bounds\n    float offsetMin = uStops[0][0];\n    float offsetMax = 0.0;\n\n    int numStops = int(uNumStops);\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (i == numStops-1){ // last index\n            offsetMax = uStops[i][0];\n        }\n    }\n\n    if (y  < offsetMin || y > offsetMax) {\n        finalColor = currentColor;\n        return;\n    }\n\n    // limit colors\n    if (uMaxColors > 0.) {\n        float stepSize = 1./uMaxColors;\n        float stepNumber = float(floor(y/stepSize));\n        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment\n    }\n\n    // find color stops\n    ColorStop from;\n    ColorStop to;\n\n    for (int i = 0; i < MAX_STOPS; i++) {\n        if (y >= uStops[i][0]) {\n            from = ColorStop(uStops[i][0], uColors[i], uStops[i][1]);\n            to = ColorStop(uStops[i+1][0], uColors[i+1], uStops[i+1][1]);\n        }\n\n        if (i == numStops-1){ // last index\n            break;\n        }\n    }\n\n    // mix colors from stops\n    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);\n    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);\n\n    float segmentHeight = to.offset - from.offset;\n    float relativePos = y - from.offset;// position from 0 to [segmentHeight]\n    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].\n\n    float gradientAlpha = uAlpha * currentColor.a;\n    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;\n\n    if (uReplace < 0.5) {\n        // mix resulting color with current color\n        finalColor = gradientColor + currentColor*(1.-gradientColor.a);\n    } else {\n        // replace with gradient color\n        finalColor = gradientColor;\n    }\n}\n",name:"color-gradient-filter"}),resources:{baseUniforms:{uOptions:{value:[t.type,t.angle??90,t.alpha,t.replace?1:0],type:"vec4<f32>"},uCounts:{value:[t.stops.length,t.maxColors],type:"vec2<f32>"}},stopsUniforms:{uColors:{value:new Float32Array(96),type:"vec3<f32>",size:32},uStops:{value:new Float32Array(128),type:"vec4<f32>",size:32}}}}),sb(this,"baseUniforms"),sb(this,"stopsUniforms"),sb(this,"_stops",[]),this.baseUniforms=this.resources.baseUniforms.uniforms,this.stopsUniforms=this.resources.stopsUniforms.uniforms,Object.assign(this,t)}get stops(){return this._stops}set stops(e){let t,r,n;let i=[...e].sort((e,t)=>e.offset-t.offset),s=new tu.Color;for(let e=0;e<i.length;e++){s.setValue(i[e].color);let o=3*e;[t,r,n]=s.toArray(),this.stopsUniforms.uColors[o]=t,this.stopsUniforms.uColors[o+1]=r,this.stopsUniforms.uColors[o+2]=n,this.stopsUniforms.uStops[4*e]=i[e].offset,this.stopsUniforms.uStops[4*e+1]=i[e].alpha}this.baseUniforms.uCounts[0]=i.length,this._stops=i}get type(){return this.baseUniforms.uOptions[0]}set type(e){this.baseUniforms.uOptions[0]=e}get angle(){return this.baseUniforms.uOptions[1]+90}set angle(e){this.baseUniforms.uOptions[1]=e-90}get alpha(){return this.baseUniforms.uOptions[2]}set alpha(e){this.baseUniforms.uOptions[2]=e}get maxColors(){return this.baseUniforms.uCounts[1]}set maxColors(e){this.baseUniforms.uCounts[1]=e}get replace(){return this.baseUniforms.uOptions[3]>.5}set replace(e){this.baseUniforms.uOptions[3]=e?1:0}};sb(s_,"LINEAR",0),sb(s_,"RADIAL",1),sb(s_,"CONIC",2),sb(s_,"defaults",{type:s_.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0,replace:!1});var ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),ex=et("5h88T"),tT=et("9Ur0D"),sS=Object.defineProperty,sC=(e,t,r)=>t in e?sS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sw=(e,t,r)=>(sC(e,"symbol"!=typeof t?t+"":t,r),r);const sT=class e extends td.Filter{constructor(...t){let r=t[0]??{};if((r instanceof ex.Texture||r instanceof tT.TextureSource)&&((0,ep.deprecation)("6.0.0","ColorMapFilter constructor params are now options object. See params: { colorMap, nearest, mix }"),r={colorMap:r},void 0!==t[1]&&(r.nearest=t[1]),void 0!==t[2]&&(r.mix=t[2])),!(r={...e.DEFAULT_OPTIONS,...r}).colorMap)throw Error("No color map texture source was provided to ColorMapFilter");super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct ColorMapUniforms {\n  uMix: f32,\n  uSize: f32,\n  uSliceSize: f32,\n  uSlicePixelSize: f32,\n  uSliceInnerSize: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> colorMapUniforms : ColorMapUniforms;\n@group(1) @binding(1) var uMapTexture: texture_2d<f32>;\n@group(1) @binding(2) var uMapSampler: sampler;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  var color:vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  var adjusted: vec4<f32>;\n\n  var altColor: vec4<f32> = vec4<f32>(color.rgb / color.a, color.a);\n  let innerWidth: f32 = colorMapUniforms.uSize - 1.0;\n  let zSlice0: f32 = min(floor(color.b * innerWidth), innerWidth);\n  let zSlice1: f32 = min(zSlice0 + 1.0, innerWidth);\n  let xOffset: f32 = colorMapUniforms.uSlicePixelSize * 0.5 + color.r * colorMapUniforms.uSliceInnerSize;\n  let s0: f32 = xOffset + (zSlice0 * colorMapUniforms.uSliceSize);\n  let s1: f32 = xOffset + (zSlice1 * colorMapUniforms.uSliceSize);\n  let yOffset: f32 = colorMapUniforms.uSliceSize * 0.5 + color.g * (1.0 - colorMapUniforms.uSliceSize);\n  let slice0Color: vec4<f32> = textureSample(uMapTexture, uMapSampler, vec2(s0,yOffset));\n  let slice1Color: vec4<f32> = textureSample(uMapTexture, uMapSampler, vec2(s1,yOffset));\n  let zOffset: f32 = fract(color.b * innerWidth);\n  adjusted = mix(slice0Color, slice1Color, zOffset);\n  altColor = vec4<f32>(color.rgb * color.a, color.a);\n\n  let realColor: vec4<f32> = select(color, altColor, color.a > 0.0);\n\n  return vec4<f32>(mix(realColor, adjusted, colorMapUniforms.uMix).rgb, realColor.a);\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMapTexture;\nuniform float uMix;\nuniform float uSize;\nuniform float uSliceSize;\nuniform float uSlicePixelSize;\nuniform float uSliceInnerSize;\n\nvoid main() {\n    vec4 color = texture(uTexture, vTextureCoord.xy);\n    vec4 adjusted;\n\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n        float innerWidth = uSize - 1.0;\n        float zSlice0 = min(floor(color.b * innerWidth), innerWidth);\n        float zSlice1 = min(zSlice0 + 1.0, innerWidth);\n        float xOffset = uSlicePixelSize * 0.5 + color.r * uSliceInnerSize;\n        float s0 = xOffset + (zSlice0 * uSliceSize);\n        float s1 = xOffset + (zSlice1 * uSliceSize);\n        float yOffset = uSliceSize * 0.5 + color.g * (1.0 - uSliceSize);\n        vec4 slice0Color = texture(uMapTexture, vec2(s0,yOffset));\n        vec4 slice1Color = texture(uMapTexture, vec2(s1,yOffset));\n        float zOffset = fract(color.b * innerWidth);\n        adjusted = mix(slice0Color, slice1Color, zOffset);\n\n        color.rgb *= color.a;\n    }\n\n    finalColor = vec4(mix(color, adjusted, uMix).rgb, color.a);\n\n}",name:"color-map-filter"}),resources:{colorMapUniforms:{uMix:{value:r.mix,type:"f32"},uSize:{value:0,type:"f32"},uSliceSize:{value:0,type:"f32"},uSlicePixelSize:{value:0,type:"f32"},uSliceInnerSize:{value:0,type:"f32"}},uMapTexture:r.colorMap.source,uMapSampler:r.colorMap.source.style}}),sw(this,"uniforms"),sw(this,"_size",0),sw(this,"_sliceSize",0),sw(this,"_slicePixelSize",0),sw(this,"_sliceInnerSize",0),sw(this,"_nearest",!1),sw(this,"_scaleMode","linear"),sw(this,"_colorMap"),this.uniforms=this.resources.colorMapUniforms.uniforms,Object.assign(this,r)}get mix(){return this.uniforms.uMix}set mix(e){this.uniforms.uMix=e}get colorSize(){return this._size}get colorMap(){return this._colorMap}set colorMap(e){if(!e||e===this.colorMap)return;let t=e instanceof ex.Texture?e.source:e;t.style.scaleMode=this._scaleMode,t.autoGenerateMipmaps=!1,this._size=t.height,this._sliceSize=1/this._size,this._slicePixelSize=this._sliceSize/this._size,this._sliceInnerSize=this._slicePixelSize*(this._size-1),this.uniforms.uSize=this._size,this.uniforms.uSliceSize=this._sliceSize,this.uniforms.uSlicePixelSize=this._slicePixelSize,this.uniforms.uSliceInnerSize=this._sliceInnerSize,this.resources.uMapTexture=t,this._colorMap=e}get nearest(){return this._nearest}set nearest(e){this._nearest=e,this._scaleMode=e?"nearest":"linear";let t=this._colorMap;t&&t.source&&(t.source.scaleMode=this._scaleMode,t.source.autoGenerateMipmaps=!1,t.source.style.update(),t.source.update())}updateColorMap(){let e=this._colorMap;e?.source&&(e.source.update(),this.colorMap=e)}destroy(){this._colorMap?.destroy(),super.destroy()}};sw(sT,"DEFAULT_OPTIONS",{colorMap:ex.Texture.WHITE,nearest:!1,mix:1});var tu=et("AHTcQ"),ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sP=Object.defineProperty,sA=(e,t,r)=>t in e?sP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sk=(e,t,r)=>(sA(e,"symbol"!=typeof t?t+"":t,r),r);const sM=class e extends td.Filter{constructor(...t){let r=t[0]??{};("number"==typeof r||Array.isArray(r)||r instanceof Float32Array)&&((0,ep.deprecation)("6.0.0","ColorOverlayFilter constructor params are now options object. See params: { color, alpha }"),r={color:r},void 0!==t[1]&&(r.alpha=t[1])),super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct ColorOverlayUniforms {\n    uColor: vec3<f32>,\n    uAlpha: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> colorOverlayUniforms : ColorOverlayUniforms;\n\n@fragment\nfn mainFragment(\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n    let c = textureSample(uTexture, uSampler, uv);\n    return vec4<f32>(mix(c.rgb, colorOverlayUniforms.uColor.rgb, c.a * colorOverlayUniforms.uAlpha), c.a);\n}\n",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec3 uColor;\nuniform float uAlpha;\n\nvoid main(void) {\n    vec4 c = texture(uTexture, vTextureCoord);\n    finalColor = vec4(mix(c.rgb, uColor.rgb, c.a * uAlpha), c.a);\n}\n",name:"color-overlay-filter"}),resources:{colorOverlayUniforms:{uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:(r={...e.DEFAULT_OPTIONS,...r}).alpha,type:"f32"}}}}),sk(this,"uniforms"),sk(this,"_color"),this.uniforms=this.resources.colorOverlayUniforms.uniforms,this._color=new tu.Color,this.color=r.color??0}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,n]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=n}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};sk(sM,"DEFAULT_OPTIONS",{color:0,alpha:1});var tu=et("AHTcQ"),ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sR=Object.defineProperty,sI=(e,t,r)=>t in e?sR(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sE=(e,t,r)=>(sI(e,"symbol"!=typeof t?t+"":t,r),r);const sO=class e extends td.Filter{constructor(...t){let r=t[0]??{};("number"==typeof r||Array.isArray(r)||r instanceof Float32Array)&&((0,ep.deprecation)("6.0.0","ColorReplaceFilter constructor params are now options object. See params: { originalColor, targetColor, tolerance }"),r={originalColor:r},void 0!==t[1]&&(r.targetColor=t[1]),void 0!==t[2]&&(r.tolerance=t[2])),super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct ColorReplaceUniforms {\n  uOriginalColor: vec3<f32>,\n  uTargetColor: vec3<f32>,\n  uTolerance: f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> colorReplaceUniforms : ColorReplaceUniforms;\n\n@fragment\nfn mainFragment(\n   @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let sample: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  let colorDiff: vec3<f32> = colorReplaceUniforms.uOriginalColor - (sample.rgb / max(sample.a, 0.0000000001));\n  let colorDistance: f32 = length(colorDiff);\n  let doReplace: f32 = step(colorDistance, colorReplaceUniforms.uTolerance);\n\n  return vec4<f32>(mix(sample.rgb, (colorReplaceUniforms.uTargetColor + colorDiff) * sample.a, doReplace), sample.a);\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec3 uOriginalColor;\nuniform vec3 uTargetColor;\nuniform float uTolerance;\n\nvoid main(void) {\n    vec4 c = texture(uTexture, vTextureCoord);\n    vec3 colorDiff = uOriginalColor - (c.rgb / max(c.a, 0.0000000001));\n    float colorDistance = length(colorDiff);\n    float doReplace = step(colorDistance, uTolerance);\n    finalColor = vec4(mix(c.rgb, (uTargetColor + colorDiff) * c.a, doReplace), c.a);\n}\n",name:"color-replace-filter"}),resources:{colorReplaceUniforms:{uOriginalColor:{value:new Float32Array(3),type:"vec3<f32>"},uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"},uTolerance:{value:(r={...e.DEFAULT_OPTIONS,...r}).tolerance,type:"f32"}}}}),sE(this,"uniforms"),sE(this,"_originalColor"),sE(this,"_targetColor"),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this._originalColor=new tu.Color,this._targetColor=new tu.Color,this.originalColor=r.originalColor??16711680,this.targetColor=r.targetColor??0,Object.assign(this,r)}get originalColor(){return this._originalColor.value}set originalColor(e){this._originalColor.setValue(e);let[t,r,n]=this._originalColor.toArray();this.uniforms.uOriginalColor[0]=t,this.uniforms.uOriginalColor[1]=r,this.uniforms.uOriginalColor[2]=n}get targetColor(){return this._targetColor.value}set targetColor(e){this._targetColor.setValue(e);let[t,r,n]=this._targetColor.toArray();this.uniforms.uTargetColor[0]=t,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=n}get tolerance(){return this.uniforms.uTolerance}set tolerance(e){this.uniforms.uTolerance=e}set newColor(e){(0,ep.deprecation)("6.0.0","ColorReplaceFilter.newColor is deprecated, please use ColorReplaceFilter.targetColor instead"),this.targetColor=e}get newColor(){return(0,ep.deprecation)("6.0.0","ColorReplaceFilter.newColor is deprecated, please use ColorReplaceFilter.targetColor instead"),this.targetColor}set epsilon(e){(0,ep.deprecation)("6.0.0","ColorReplaceFilter.epsilon is deprecated, please use ColorReplaceFilter.tolerance instead"),this.tolerance=e}get epsilon(){return(0,ep.deprecation)("6.0.0","ColorReplaceFilter.epsilon is deprecated, please use ColorReplaceFilter.tolerance instead"),this.tolerance}};sE(sO,"DEFAULT_OPTIONS",{originalColor:16711680,targetColor:0,tolerance:.4});var ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sz=Object.defineProperty,sF=(e,t,r)=>t in e?sz(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sU=(e,t,r)=>(sF(e,"symbol"!=typeof t?t+"":t,r),r);const sD=class e extends td.Filter{constructor(...t){let r=t[0]??{};Array.isArray(r)&&((0,ep.deprecation)("6.0.0","ConvolutionFilter constructor params are now options object. See params: { matrix, width, height }"),r={matrix:r},void 0!==t[1]&&(r.width=t[1]),void 0!==t[2]&&(r.height=t[2]));let n=(r={...e.DEFAULT_OPTIONS,...r}).width??200,i=r.height??200;super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct ConvolutionUniforms {\n    uMatrix: mat3x3<f32>,\n    uTexelSize: vec2<f32>,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> convolutionUniforms : ConvolutionUniforms;\n\n@fragment\nfn mainFragment(\n    @location(0) uv: vec2<f32>,\n    @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n    let texelSize = convolutionUniforms.uTexelSize;\n    let matrix = convolutionUniforms.uMatrix;\n\n    let c11: vec4<f32> = textureSample(uTexture, uSampler, uv - texelSize); // top left\n    let c12: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x, uv.y - texelSize.y)); // top center\n    let c13: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x + texelSize.x, uv.y - texelSize.y)); // top right\n\n    let c21: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x - texelSize.x, uv.y)); // mid left\n    let c22: vec4<f32> = textureSample(uTexture, uSampler, uv); // mid center\n    let c23: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x + texelSize.x, uv.y)); // mid right\n\n    let c31: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x - texelSize.x, uv.y + texelSize.y)); // bottom left\n    let c32: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x, uv.y + texelSize.y)); // bottom center\n    let c33: vec4<f32> = textureSample(uTexture, uSampler, uv + texelSize); // bottom right\n\n    var finalColor: vec4<f32> = vec4<f32>(\n        c11 * matrix[0][0] + c12 * matrix[0][1] + c13 * matrix[0][2] +\n        c21 * matrix[1][0] + c22 * matrix[1][1] + c23 * matrix[1][2] +\n        c31 * matrix[2][0] + c32 * matrix[2][1] + c33 * matrix[2][2]\n    );\n\n    finalColor.a = c22.a;\n\n    return finalColor;\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uTexelSize;\nuniform mat3 uMatrix;\n\nvoid main(void)\n{\n    vec4 c11 = texture(uTexture, vTextureCoord - uTexelSize); // top left\n    vec4 c12 = texture(uTexture, vec2(vTextureCoord.x, vTextureCoord.y - uTexelSize.y)); // top center\n    vec4 c13 = texture(uTexture, vec2(vTextureCoord.x + uTexelSize.x, vTextureCoord.y - uTexelSize.y)); // top right\n\n    vec4 c21 = texture(uTexture, vec2(vTextureCoord.x - uTexelSize.x, vTextureCoord.y)); // mid left\n    vec4 c22 = texture(uTexture, vTextureCoord); // mid center\n    vec4 c23 = texture(uTexture, vec2(vTextureCoord.x + uTexelSize.x, vTextureCoord.y)); // mid right\n\n    vec4 c31 = texture(uTexture, vec2(vTextureCoord.x - uTexelSize.x, vTextureCoord.y + uTexelSize.y)); // bottom left\n    vec4 c32 = texture(uTexture, vec2(vTextureCoord.x, vTextureCoord.y + uTexelSize.y)); // bottom center\n    vec4 c33 = texture(uTexture, vTextureCoord + uTexelSize); // bottom right\n\n    finalColor =\n        c11 * uMatrix[0][0] + c12 * uMatrix[0][1] + c13 * uMatrix[0][2] +\n        c21 * uMatrix[1][0] + c22 * uMatrix[1][1] + c23 * uMatrix[1][2] +\n        c31 * uMatrix[2][0] + c32 * uMatrix[2][1] + c33 * uMatrix[2][2];\n\n    finalColor.a = c22.a;\n}",name:"convolution-filter"}),resources:{convolutionUniforms:{uMatrix:{value:r.matrix,type:"mat3x3<f32>"},uTexelSize:{value:{x:1/n,y:1/i},type:"vec2<f32>"}}}}),sU(this,"uniforms"),this.uniforms=this.resources.convolutionUniforms.uniforms,this.width=n,this.height=i}get matrix(){return this.uniforms.uMatrix}set matrix(e){e.forEach((e,t)=>{this.uniforms.uMatrix[t]=e})}get width(){return 1/this.uniforms.uTexelSize.x}set width(e){this.uniforms.uTexelSize.x=1/e}get height(){return 1/this.uniforms.uTexelSize.y}set height(e){this.uniforms.uTexelSize.y=1/e}};sU(sD,"DEFAULT_OPTIONS",{matrix:new Float32Array(9),width:200,height:200});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sB=Object.defineProperty,sL=(e,t,r)=>t in e?sB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sG=(e,t,r)=>(sL(e,"symbol"!=typeof t?t+"":t,r),r);const sj=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct CRTUniforms {\n    uLine: vec4<f32>,\n    uNoise: vec2<f32>,\n    uVignette: vec3<f32>,\n    uSeed: f32,\n    uTime: f32,\n    uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> crtUniforms : CRTUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n    \n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let coord: vec2<f32> = uv * gfu.uInputSize.xy / crtUniforms.uDimensions;\n\n  let uNoise = crtUniforms.uNoise;\n\n  if (uNoise[0] > 0.0 && uNoise[1] > 0.0)\n  {\n    color += vec4<f32>(vec3<f32>(noise(uv)), color.a);\n  }\n\n  if (crtUniforms.uVignette[0] > 0.)\n  {\n    color *= vec4<f32>(vec3<f32>(vignette(color.rgb, coord)), color.a);\n  }\n\n  if (crtUniforms.uLine[1] > 0.0)\n  {\n    color = vec4<f32>(vec3<f32>(interlaceLines(color.rgb, uv)), color.a);  \n  }\n\n  return color;\n}\n\nconst SQRT_2: f32 = 1.414213;\n\nfn modulo(x: f32, y: f32) -> f32\n{\n  return x - y * floor(x/y);\n}\n\nfn rand(co: vec2<f32>) -> f32\n{\n  return fract(sin(dot(co, vec2<f32>(12.9898, 78.233))) * 43758.5453);\n}\n\nfn vignette(co: vec3<f32>, coord: vec2<f32>) -> f32\n{\n  let uVignette = crtUniforms.uVignette;\n  let uDimensions = crtUniforms.uDimensions;\n  \n  let outter: f32 = SQRT_2 - uVignette[0] * SQRT_2;\n  var dir: vec2<f32> = vec2<f32>(0.5) - coord;\n  dir.y *= uDimensions.y / uDimensions.x;\n  let darker: f32 = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignette[2] * SQRT_2), 0.0, 1.0);\n  return darker + (1.0 - darker) * (1.0 - uVignette[1]);\n}\n\nfn noise(coord: vec2<f32>) -> f32\n{\n  let uNoise = crtUniforms.uNoise;\n  let uSeed = crtUniforms.uSeed;\n\n  var pixelCoord: vec2<f32> = coord * gfu.uInputSize.xy;\n  pixelCoord.x = floor(pixelCoord.x / uNoise[1]);\n  pixelCoord.y = floor(pixelCoord.y / uNoise[1]);\n  return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];\n}\n\nfn interlaceLines(co: vec3<f32>, coord: vec2<f32>) -> vec3<f32>\n{\n  var color = co;\n\n  let uDimensions = crtUniforms.uDimensions;\n\n  let curvature: f32 = crtUniforms.uLine[0];\n  let lineWidth: f32 = crtUniforms.uLine[1];\n  let lineContrast: f32 = crtUniforms.uLine[2];\n  let verticalLine: f32 = crtUniforms.uLine[3];\n\n  let dir: vec2<f32> = vec2<f32>(coord * gfu.uInputSize.xy / uDimensions - 0.5);\n\n  let _c: f32 = select(1., curvature, curvature > 0.);\n  let k: f32 = select(1., (length(dir * dir) * 0.25 * _c * _c + 0.935 * _c), curvature > 0.);\n  let uv: vec2<f32> = dir * k;\n  let v: f32 = select(uv.y * uDimensions.y, uv.x * uDimensions.x, verticalLine > 0.5) * min(1.0, 2.0 / lineWidth ) / _c;\n  let j: f32 = 1. + cos(v * 1.2 - crtUniforms.uTime) * 0.5 * lineContrast;\n  color *= j;\n\n  let segment: f32 = select(modulo((dir.y + .5) * uDimensions.y, 4.), modulo((dir.x + .5) * uDimensions.x, 4.), verticalLine > 0.5);\n  color *= 0.99 + ceil(segment) * 0.015;\n\n  return color;\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec4 uLine;\nuniform vec2 uNoise;\nuniform vec3 uVignette;\nuniform float uSeed;\nuniform float uTime;\nuniform vec2 uDimensions;\n\nuniform vec4 uInputSize;\n\nconst float SQRT_2 = 1.414213;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat vignette(vec3 co, vec2 coord)\n{\n    float outter = SQRT_2 - uVignette[0] * SQRT_2;\n    vec2 dir = vec2(0.5) - coord;\n    dir.y *= uDimensions.y / uDimensions.x;\n    float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignette[2] * SQRT_2), 0.0, 1.0);\n    return darker + (1.0 - darker) * (1.0 - uVignette[1]);\n}\n\nfloat noise(vec2 coord)\n{\n    vec2 pixelCoord = coord * uInputSize.xy;\n    pixelCoord.x = floor(pixelCoord.x / uNoise[1]);\n    pixelCoord.y = floor(pixelCoord.y / uNoise[1]);\n    return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];\n}\n\nvec3 interlaceLines(vec3 co, vec2 coord)\n{\n    vec3 color = co;\n\n    float curvature = uLine[0];\n    float lineWidth = uLine[1];\n    float lineContrast = uLine[2];\n    float verticalLine = uLine[3];\n\n    vec2 dir = vec2(coord * uInputSize.xy / uDimensions - 0.5);\n\n    float _c = curvature > 0. ? curvature : 1.;\n    float k = curvature > 0. ? (length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;\n    vec2 uv = dir * k;\n    float v = verticalLine > 0.5 ? uv.x * uDimensions.x : uv.y * uDimensions.y;\n    v *= min(1.0, 2.0 / lineWidth ) / _c;\n    float j = 1. + cos(v * 1.2 - uTime) * 0.5 * lineContrast;\n    color *= j;\n\n    float segment = verticalLine > 0.5 ? mod((dir.x + .5) * uDimensions.x, 4.) : mod((dir.y + .5) * uDimensions.y, 4.);\n    color *= 0.99 + ceil(segment) * 0.015;\n\n    return color;\n}\n\nvoid main(void)\n{\n    finalColor = texture(uTexture, vTextureCoord);\n    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions;\n\n    if (uNoise[0] > 0.0 && uNoise[1] > 0.0)\n    {\n        float n = noise(vTextureCoord);\n        finalColor += vec4(n, n, n, finalColor.a);\n    }\n\n    if (uVignette[0] > 0.)\n    {\n        float v = vignette(finalColor.rgb, coord);\n        finalColor *= vec4(v, v, v, finalColor.a);\n    }\n\n    if (uLine[1] > 0.0)\n    {\n        finalColor = vec4(interlaceLines(finalColor.rgb, vTextureCoord), finalColor.a);  \n    }\n}\n",name:"crt-filter"}),resources:{crtUniforms:{uLine:{value:new Float32Array(4),type:"vec4<f32>"},uNoise:{value:new Float32Array(2),type:"vec2<f32>"},uVignette:{value:new Float32Array(3),type:"vec3<f32>"},uSeed:{value:t.seed,type:"f32"},uTime:{value:t.time,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),sG(this,"uniforms"),sG(this,"seed"),sG(this,"time"),this.uniforms=this.resources.crtUniforms.uniforms,Object.assign(this,t)}apply(e,t,r,n){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,this.uniforms.uSeed=this.seed,this.uniforms.uTime=this.time,e.applyFilter(this,t,r,n)}get curvature(){return this.uniforms.uLine[0]}set curvature(e){this.uniforms.uLine[0]=e}get lineWidth(){return this.uniforms.uLine[1]}set lineWidth(e){this.uniforms.uLine[1]=e}get lineContrast(){return this.uniforms.uLine[2]}set lineContrast(e){this.uniforms.uLine[2]=e}get verticalLine(){return this.uniforms.uLine[3]>.5}set verticalLine(e){this.uniforms.uLine[3]=e?1:0}get noise(){return this.uniforms.uNoise[0]}set noise(e){this.uniforms.uNoise[0]=e}get noiseSize(){return this.uniforms.uNoise[1]}set noiseSize(e){this.uniforms.uNoise[1]=e}get vignetting(){return this.uniforms.uVignette[0]}set vignetting(e){this.uniforms.uVignette[0]=e}get vignettingAlpha(){return this.uniforms.uVignette[1]}set vignettingAlpha(e){this.uniforms.uVignette[1]=e}get vignettingBlur(){return this.uniforms.uVignette[2]}set vignettingBlur(e){this.uniforms.uVignette[2]=e}};sG(sj,"DEFAULT_OPTIONS",{curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0,seed:0});var ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sN=Object.defineProperty;b=class e extends td.Filter{constructor(...t){let r=t[0]??{};"number"==typeof r&&((0,ep.deprecation)("6.0.0","DotFilter constructor params are now options object. See params: { scale, angle, grayscale }"),r={scale:r},void 0!==t[1]&&(r.angle=t[1]),void 0!==t[2]&&(r.grayscale=t[2])),super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct DotUniforms {\n  uScale:f32,\n  uAngle:f32,\n  uGrayScale:f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> dotUniforms : DotUniforms;\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n  let color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let gray: vec3<f32> = vec3<f32>(dot(color.rgb, vec3<f32>(0.299, 0.587, 0.114)));\n  // dotUniforms.uGrayScale == 1 doesn't ever pass so it is converted to a float and compared to 0.5 instead \n  let finalColor: vec3<f32> = select(color.rgb, gray, f32(dotUniforms.uGrayScale) >= 0.5);\n\n  return vec4<f32>(finalColor * 10.0 - 5.0 + pattern(uv), color.a);\n}\n\nfn pattern(uv: vec2<f32>) -> f32\n{\n  let s: f32 = sin(dotUniforms.uAngle);\n  let c: f32 = cos(dotUniforms.uAngle);\n  \n  let tex: vec2<f32> = uv * gfu.uInputSize.xy;\n  \n  let p: vec2<f32> = vec2<f32>(\n      c * tex.x - s * tex.y,\n      s * tex.x + c * tex.y\n  ) * dotUniforms.uScale;\n\n  return (sin(p.x) * sin(p.y)) * 4.0;\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uAngle;\nuniform float uScale;\nuniform bool uGrayScale;\n\nuniform vec4 uInputSize;\n\nfloat pattern()\n{\n    float s = sin(uAngle), c = cos(uAngle);\n    vec2 tex = vTextureCoord * uInputSize.xy;\n    vec2 point = vec2(\n        c * tex.x - s * tex.y,\n        s * tex.x + c * tex.y\n    ) * uScale;\n    return (sin(point.x) * sin(point.y)) * 4.0;\n    }\n\n    void main()\n    {\n    vec4 color = texture(uTexture, vTextureCoord);\n    vec3 colorRGB = vec3(color);\n\n    if (uGrayScale)\n    {\n        colorRGB = vec3(color.r + color.g + color.b) / 3.0;\n    }\n\n    finalColor = vec4(colorRGB * 10.0 - 5.0 + pattern(), color.a);\n}\n",name:"dot-filter"}),resources:{dotUniforms:{uScale:{value:(r={...e.DEFAULT_OPTIONS,...r}).scale,type:"f32"},uAngle:{value:r.angle,type:"f32"},uGrayScale:{value:r.grayscale?1:0,type:"f32"}}}})}get scale(){return this.resources.dotUniforms.uniforms.uScale}set scale(e){this.resources.dotUniforms.uniforms.uScale=e}get angle(){return this.resources.dotUniforms.uniforms.uAngle}set angle(e){this.resources.dotUniforms.uniforms.uAngle=e}get grayscale(){return 1===this.resources.dotUniforms.uniforms.uGrayScale}set grayscale(e){this.resources.dotUniforms.uniforms.uGrayScale=e?1:0}},S={scale:1,angle:5,grayscale:!0},(_="symbol"!=typeof(U="DEFAULT_OPTIONS")?U+"":U)in b?sN(b,_,{enumerable:!0,configurable:!0,writable:!0,value:S}):b[_]=S;var tu=et("AHTcQ"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),tv=et("7U2uj"),sV=Object.defineProperty,sX=(e,t,r)=>t in e?sV(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sY=(e,t,r)=>(sX(e,"symbol"!=typeof t?t+"":t,r),r);const sH=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct DropShadowUniforms {\n  uAlpha: f32,\n  uColor: vec3<f32>,\n  uOffset: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> dropShadowUniforms : DropShadowUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv - dropShadowUniforms.uOffset * gfu.uInputSize.zw);\n\n  // Premultiply alpha\n  color = vec4<f32>(vec3<f32>(dropShadowUniforms.uColor.rgb * color.a), color.a);\n  // alpha user alpha\n  color *= dropShadowUniforms.uAlpha;\n\n  return color;\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uAlpha;\nuniform vec3 uColor;\nuniform vec2 uOffset;\n\nuniform vec4 uInputSize;\n\nvoid main(void){\n    vec4 sample = texture(uTexture, vTextureCoord - uOffset * uInputSize.zw);\n\n    // Premultiply alpha\n    sample.rgb = uColor.rgb * sample.a;\n\n    // alpha user alpha\n    sample *= uAlpha;\n\n    finalColor = sample;\n}",name:"drop-shadow-filter"}),resources:{dropShadowUniforms:{uAlpha:{value:t.alpha,type:"f32"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uOffset:{value:t.offset,type:"vec2<f32>"}}},resolution:t.resolution}),sY(this,"uniforms"),sY(this,"shadowOnly",!1),sY(this,"_color"),sY(this,"_blurFilter"),sY(this,"_basePass"),this.uniforms=this.resources.dropShadowUniforms.uniforms,this._color=new tu.Color,this.color=t.color??0,this._blurFilter=new iZ({strength:t.kernels??t.blur,quality:t.kernels?void 0:t.quality}),this._basePass=new td.Filter({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:`
                    @group(0) @binding(1) var uTexture: texture_2d<f32>; 
                    @group(0) @binding(2) var uSampler: sampler;
                    @fragment
                    fn mainFragment(
                        @builtin(position) position: vec4<f32>,
                        @location(0) uv : vec2<f32>
                    ) -> @location(0) vec4<f32> {
                        return textureSample(uTexture, uSampler, uv);
                    }
                    `,entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:`
                in vec2 vTextureCoord;
                out vec4 finalColor;
                uniform sampler2D uTexture;

                void main(void){
                    finalColor = texture(uTexture, vTextureCoord);
                }
                `,name:"drop-shadow-filter"}),resources:{}}),Object.assign(this,t)}apply(e,t,r,n){let i=(0,tv.TexturePool).getSameSizeTexture(t);e.applyFilter(this,t,i,!0),this._blurFilter.apply(e,i,r,n),this.shadowOnly||e.applyFilter(this._basePass,t,r,!1),(0,tv.TexturePool).returnTexture(i)}get offset(){return this.uniforms.uOffset}set offset(e){this.uniforms.uOffset=e,this._updatePadding()}get offsetX(){return this.offset.x}set offsetX(e){this.offset.x=e,this._updatePadding()}get offsetY(){return this.offset.y}set offsetY(e){this.offset.y=e,this._updatePadding()}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,n]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=n}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}get blur(){return this._blurFilter.strength}set blur(e){this._blurFilter.strength=e,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(e){this._blurFilter.quality=e,this._updatePadding()}get kernels(){return this._blurFilter.kernels}set kernels(e){this._blurFilter.kernels=e}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(e){"number"==typeof e&&(e={x:e,y:e}),Array.isArray(e)&&(e={x:e[0],y:e[1]}),this._blurFilter.pixelSize=e}get pixelSizeX(){return this._blurFilter.pixelSizeX}set pixelSizeX(e){this._blurFilter.pixelSizeX=e}get pixelSizeY(){return this._blurFilter.pixelSizeY}set pixelSizeY(e){this._blurFilter.pixelSizeY=e}_updatePadding(){let e=Math.max(Math.abs(this.offsetX),Math.abs(this.offsetY));this.padding=e+2*this.blur+4*this.quality}};sY(sH,"DEFAULT_OPTIONS",{offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:void 0,blur:2,quality:3,pixelSize:{x:1,y:1},resolution:1});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),tC=et("gIu8o"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),eH=et("4XrO5"),ex=et("5h88T"),sW=Object.defineProperty,sq=(e,t,r)=>t in e?sW(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s$=(e,t,r)=>(sq(e,"symbol"!=typeof t?t+"":t,r),r);const sK=class e extends td.Filter{constructor(t){t={...e.defaults,...t};let r=(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct GlitchUniforms {\n  uSeed: f32,\n  uDimensions: vec2<f32>,\n  uAspect: f32,\n  uFillMode: f32,\n  uOffset: f32,\n  uDirection: f32,\n  uRed: vec2<f32>,\n  uGreen: vec2<f32>,\n  uBlue: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> glitchUniforms : GlitchUniforms;\n@group(1) @binding(1) var uDisplacementMap: texture_2d<f32>; \n@group(1) @binding(2) var uDisplacementSampler: sampler; \n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uSeed: f32 = glitchUniforms.uSeed;\n  let uDimensions: vec2<f32> = glitchUniforms.uDimensions;\n  let uAspect: f32 = glitchUniforms.uAspect;\n  let uOffset: f32 = glitchUniforms.uOffset;\n  let uDirection: f32 = glitchUniforms.uDirection;\n  let uRed: vec2<f32> = glitchUniforms.uRed;\n  let uGreen: vec2<f32> = glitchUniforms.uGreen;\n  let uBlue: vec2<f32> = glitchUniforms.uBlue;\n\n  let uInputSize: vec4<f32> = gfu.uInputSize;\n  let uInputClamp: vec4<f32> = gfu.uInputClamp;\n\n  var discarded: bool = false;\n  var coord: vec2<f32> = (uv * uInputSize.xy) / uDimensions;\n\n    if (coord.x > 1.0 || coord.y > 1.0) {\n      discarded = true;\n    }\n\n    let sinDir: f32 = sin(uDirection);\n    let cosDir: f32 = cos(uDirection);\n\n    let cx: f32 = coord.x - 0.5;\n    let cy: f32 = (coord.y - 0.5) * uAspect;\n    var ny: f32 = (-sinDir * cx + cosDir * cy) / uAspect + 0.5;\n\n    ny = select(select(ny, -ny, ny < 0.0), 2.0 - ny, ny > 1.0);\n\n    let dc: vec4<f32> = textureSample(uDisplacementMap, uDisplacementSampler, vec2<f32>(0.5, ny));\n\n    let displacement: f32 = (dc.r - dc.g) * (uOffset / uInputSize.x);\n\n    coord = uv + vec2<f32>(cosDir * displacement, sinDir * displacement * uAspect);\n\n    let fillMode: i32 = i32(glitchUniforms.uFillMode);\n\n    if (fillMode == CLAMP) {\n      coord = clamp(coord, uInputClamp.xy, uInputClamp.zw);\n    } else {\n      if (coord.x > uInputClamp.z) {\n        if (fillMode == TRANSPARENT) {\n          discarded = true;\n        } else if (fillMode == LOOP) {\n          coord.x = coord.x - uInputClamp.z;\n        } else if (fillMode == MIRROR) {\n          coord.x = uInputClamp.z * 2.0 - coord.x;\n        }\n      } else if (coord.x < uInputClamp.x) {\n        if (fillMode == TRANSPARENT) {\n          discarded = true;\n        } else if (fillMode == LOOP) {\n          coord.x = coord.x + uInputClamp.z;\n        } else if (fillMode == MIRROR) {\n          coord.x = coord.x * -uInputClamp.z;\n        }\n      }\n\n      if (coord.y > uInputClamp.w) {\n        if (fillMode == TRANSPARENT) {\n          discarded = true;\n        } else if (fillMode == LOOP) {\n          coord.y = coord.y - uInputClamp.w;\n        } else if (fillMode == MIRROR) {\n          coord.y = uInputClamp.w * 2.0 - coord.y;\n        }\n      } else if (coord.y < uInputClamp.y) {\n        if (fillMode == TRANSPARENT) {\n          discarded = true;\n        } else if (fillMode == LOOP) {\n          coord.y = coord.y + uInputClamp.w;\n        } else if (fillMode == MIRROR) {\n          coord.y = coord.y * -uInputClamp.w;\n        }\n      }\n    }\n\n    let seedR: f32 = 1.0 - uSeed * 0.4;\n    let seedG: f32 = 1.0 - uSeed * 0.3;\n    let seedB: f32 = 1.0 - uSeed * 0.2;\n\n    let offsetR: vec2<f32> = vec2(uRed.x * seedR / uInputSize.x, uRed.y * seedR / uInputSize.y);\n    let offsetG: vec2<f32> = vec2(uGreen.x * seedG / uInputSize.x, uGreen.y * seedG / uInputSize.y);\n    let offsetB: vec2<f32> = vec2(uBlue.x * seedB / uInputSize.x, uBlue.y * seedB / uInputSize.y);\n\n    let r = textureSample(uTexture, uSampler, coord + offsetR).r;\n    let g = textureSample(uTexture, uSampler, coord + offsetG).g;\n    let b = textureSample(uTexture, uSampler, coord + offsetB).b;\n    let a = textureSample(uTexture, uSampler, coord).a;\n\n    return select(vec4<f32>(r, g, b, a), vec4<f32>(0.0,0.0,0.0,0.0), discarded);\n}\n\nconst TRANSPARENT: i32 = 0;\nconst ORIGINAL: i32 = 1;\nconst LOOP: i32 = 2;\nconst CLAMP: i32 = 3;\nconst MIRROR: i32 = 4;",entryPoint:"mainFragment"}}),n=(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uDisplacementMap;\nuniform float uSeed;\nuniform vec2 uDimensions;\nuniform float uAspect;\nuniform float uFillMode;\nuniform float uOffset;\nuniform float uDirection;\nuniform vec2 uRed;\nuniform vec2 uGreen;\nuniform vec2 uBlue;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nconst int TRANSPARENT = 0;\nconst int ORIGINAL = 1;\nconst int LOOP = 2;\nconst int CLAMP = 3;\nconst int MIRROR = 4;\n\nvoid main(void)\n{\n    vec2 coord = (vTextureCoord * uInputSize.xy) / uDimensions;\n\n    if (coord.x > 1.0 || coord.y > 1.0) {\n        return;\n    }\n\n    float sinDir = sin(uDirection);\n    float cosDir = cos(uDirection);\n\n    float cx = coord.x - 0.5;\n    float cy = (coord.y - 0.5) * uAspect;\n    float ny = (-sinDir * cx + cosDir * cy) / uAspect + 0.5;\n\n    // displacementMap: repeat\n    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);\n\n    // displacementMap: mirror\n    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);\n\n    vec4 dc = texture(uDisplacementMap, vec2(0.5, ny));\n\n    float displacement = (dc.r - dc.g) * (uOffset / uInputSize.x);\n\n    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * uAspect);\n\n    int fillMode = int(uFillMode);\n\n    if (fillMode == CLAMP) {\n        coord = clamp(coord, uInputClamp.xy, uInputClamp.zw);\n    } else {\n        if( coord.x > uInputClamp.z ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x -= uInputClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x = uInputClamp.z * 2.0 - coord.x;\n            }\n        } else if( coord.x < uInputClamp.x ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.x += uInputClamp.z;\n            } else if (fillMode == MIRROR) {\n                coord.x *= -uInputClamp.z;\n            }\n        }\n\n        if( coord.y > uInputClamp.w ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y -= uInputClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y = uInputClamp.w * 2.0 - coord.y;\n            }\n        } else if( coord.y < uInputClamp.y ) {\n            if (fillMode == TRANSPARENT) {\n                discard;\n            } else if (fillMode == LOOP) {\n                coord.y += uInputClamp.w;\n            } else if (fillMode == MIRROR) {\n                coord.y *= -uInputClamp.w;\n            }\n        }\n    }\n\n    finalColor.r = texture(uTexture, coord + uRed * (1.0 - uSeed * 0.4) / uInputSize.xy).r;\n    finalColor.g = texture(uTexture, coord + uGreen * (1.0 - uSeed * 0.3) / uInputSize.xy).g;\n    finalColor.b = texture(uTexture, coord + uBlue * (1.0 - uSeed * 0.2) / uInputSize.xy).b;\n    finalColor.a = texture(uTexture, coord).a;\n}\n",name:"glitch-filter"}),i=document.createElement("canvas");i.width=4,i.height=t.sampleSize??512;let s=new ex.Texture({source:new eH.ImageSource({resource:i})});super({gpuProgram:r,glProgram:n,resources:{glitchUniforms:{uSeed:{value:t?.seed??0,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"},uAspect:{value:1,type:"f32"},uFillMode:{value:t?.fillMode??0,type:"f32"},uOffset:{value:t?.offset??100,type:"f32"},uDirection:{value:t?.direction??0,type:"f32"},uRed:{value:t.red,type:"vec2<f32>"},uGreen:{value:t.green,type:"vec2<f32>"},uBlue:{value:t.blue,type:"vec2<f32>"}},uDisplacementMap:s.source,uDisplacementSampler:s.source.style}}),s$(this,"uniforms"),s$(this,"average",!1),s$(this,"minSize",8),s$(this,"sampleSize",512),s$(this,"_canvas"),s$(this,"texture"),s$(this,"_slices",0),s$(this,"_sizes",new Float32Array(1)),s$(this,"_offsets",new Float32Array(1)),this.uniforms=this.resources.glitchUniforms.uniforms,this._canvas=i,this.texture=s,Object.assign(this,t)}apply(e,t,r,n){let{width:i,height:s}=t.frame;this.uniforms.uDimensions[0]=i,this.uniforms.uDimensions[1]=s,this.uniforms.uAspect=s/i,e.applyFilter(this,t,r,n)}_randomizeSizes(){let e=this._sizes,t=this._slices-1,r=this.sampleSize,n=Math.min(this.minSize/r,.9/this._slices);if(this.average){let r=this._slices,i=1;for(let s=0;s<t;s++){let t=Math.max(i/(r-s)*(1-.6*Math.random()),n);e[s]=t,i-=t}e[t]=i}else{let r=1,i=Math.sqrt(1/this._slices);for(let s=0;s<t;s++){let t=Math.max(i*r*Math.random(),n);e[s]=t,r-=t}e[t]=r}this.shuffle()}shuffle(){let e=this._sizes,t=this._slices-1;for(let r=t;r>0;r--){let t=Math.random()*r>>0,n=e[r];e[r]=e[t],e[t]=n}}_randomizeOffsets(){for(let e=0;e<this._slices;e++)this._offsets[e]=Math.random()*(.5>Math.random()?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){let e;let t=this.sampleSize,r=this.texture,n=this._canvas.getContext("2d");n.clearRect(0,0,8,t);let i=0;for(let r=0;r<this._slices;r++){e=Math.floor(256*this._offsets[r]);let s=this._sizes[r]*t,o=e>0?e:0,a=e<0?-e:0;n.fillStyle=`rgba(${o}, ${a}, 0, 1)`,n.fillRect(0,i>>0,t,s+1>>0),i+=s}r.source.update()}set sizes(e){let t=Math.min(this._slices,e.length);for(let r=0;r<t;r++)this._sizes[r]=e[r]}get sizes(){return this._sizes}set offsets(e){let t=Math.min(this._slices,e.length);for(let r=0;r<t;r++)this._offsets[r]=e[r]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(e){this._slices!==e&&(this._slices=e,this._sizes=new Float32Array(e),this._offsets=new Float32Array(e),this.refresh())}get offset(){return this.uniforms.uOffset}set offset(e){this.uniforms.uOffset=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}get fillMode(){return this.uniforms.uFillMode}set fillMode(e){this.uniforms.uFillMode=e}get direction(){return this.uniforms.uDirection/tC.DEG_TO_RAD}set direction(e){this.uniforms.uDirection=e*tC.DEG_TO_RAD}get red(){return this.uniforms.uRed}set red(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uRed=e}get green(){return this.uniforms.uGreen}set green(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uGreen=e}get blue(){return this.uniforms.uBlue}set blue(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uBlue=e}destroy(){this.texture?.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}};s$(sK,"defaults",{slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:{x:0,y:0},green:{x:0,y:0},blue:{x:0,y:0},minSize:8,sampleSize:512});var tu=et("AHTcQ"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),sQ=Object.defineProperty,sJ=(e,t,r)=>t in e?sQ(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sZ=(e,t,r)=>(sJ(e,"symbol"!=typeof t?t+"":t,r),r);const s0=class e extends td.Filter{constructor(t){let r=(t={...e.DEFAULT_OPTIONS,...t}).distance??10,n=t.quality??.1;super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct GlowUniforms {\n  uDistance: f32,\n  uStrength: vec2<f32>,\n  uColor: vec3<f32>,\n  uAlpha: f32,\n  uQuality: f32,\n  uKnockout: f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> glowUniforms : GlowUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let quality = glowUniforms.uQuality;\n  let distance = glowUniforms.uDistance;\n\n  let dist: f32 = glowUniforms.uDistance;\n  let angleStepSize: f32 = min(1. / quality / distance, PI * 2.0);\n  let angleStepNum: f32 = ceil(PI * 2.0 / angleStepSize);\n\n  let px: vec2<f32> = vec2<f32>(1.0 / gfu.uInputSize.xy);\n\n  var totalAlpha: f32 = 0.0;\n\n  var direction: vec2<f32>;\n  var displaced: vec2<f32>;\n  var curColor: vec4<f32>;\n\n  for (var angle = 0.0; angle < PI * 2.0; angle += angleStepSize) {\n    direction = vec2<f32>(cos(angle), sin(angle)) * px;\n    for (var curDistance = 0.0; curDistance < dist; curDistance+=1) {\n      displaced = vec2<f32>(clamp(uv + direction * (curDistance + 1.0), gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n      curColor = textureSample(uTexture, uSampler, displaced);\n      totalAlpha += (dist - curDistance) * curColor.a;\n    }\n  }\n    \n  curColor = textureSample(uTexture, uSampler, uv);\n\n  let glowColorRGB = glowUniforms.uColor;\n  let glowAlpha = glowUniforms.uAlpha;\n  let glowColor = vec4<f32>(glowColorRGB, glowAlpha);\n  let knockout: bool = glowUniforms.uKnockout > 0.5;\n  let innerStrength = glowUniforms.uStrength[0];\n  let outerStrength = glowUniforms.uStrength[1];\n\n  let alphaRatio: f32 = (totalAlpha / (angleStepNum * dist * (dist + 1.0) / 2.0));\n  let innerGlowAlpha: f32 = (1.0 - alphaRatio) * innerStrength * curColor.a * glowAlpha;\n  let innerGlowStrength: f32 = min(1.0, innerGlowAlpha);\n  \n  let innerColor: vec4<f32> = mix(curColor, glowColor, innerGlowStrength);\n  let outerGlowAlpha: f32 = alphaRatio * outerStrength * (1. - curColor.a) * glowAlpha;\n  let outerGlowStrength: f32 = min(1.0 - innerColor.a, outerGlowAlpha);\n  let outerGlowColor: vec4<f32> = outerGlowStrength * glowColor.rgba;\n  \n  if (knockout) {\n    let resultAlpha: f32 = outerGlowAlpha + innerGlowAlpha;\n    return vec4<f32>(glowColor.rgb * resultAlpha, resultAlpha);\n  }\n  else {\n    return innerColor + outerGlowColor;\n  }\n}\n\nconst PI: f32 = 3.14159265358979323846264;",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uStrength;\nuniform vec3 uColor;\nuniform float uKnockout;\nuniform float uAlpha;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nconst float PI = 3.14159265358979323846264;\n\n// Hard-assignment of DIST and ANGLE_STEP_SIZE instead of using uDistance and uQuality to allow them to be use on GLSL loop conditions\nconst float DIST = __DIST__;\nconst float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.);\nconst float ANGLE_STEP_NUM = ceil(PI * 2. / ANGLE_STEP_SIZE);\nconst float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.) / 2.;\n\nvoid main(void) {\n    vec2 px = vec2(1.) / uInputSize.xy;\n\n    float totalAlpha = 0.;\n\n    vec2 direction;\n    vec2 displaced;\n    vec4 curColor;\n\n    for (float angle = 0.; angle < PI * 2.; angle += ANGLE_STEP_SIZE) {\n      direction = vec2(cos(angle), sin(angle)) * px;\n\n      for (float curDistance = 0.; curDistance < DIST; curDistance++) {\n          displaced = clamp(vTextureCoord + direction * (curDistance + 1.), uInputClamp.xy, uInputClamp.zw);\n          curColor = texture(uTexture, displaced);\n          totalAlpha += (DIST - curDistance) * curColor.a;\n      }\n    }\n    \n    curColor = texture(uTexture, vTextureCoord);\n\n    vec4 glowColor = vec4(uColor, uAlpha);\n    bool knockout = uKnockout > .5;\n    float innerStrength = uStrength[0];\n    float outerStrength = uStrength[1];\n\n    float alphaRatio = totalAlpha / MAX_TOTAL_ALPHA;\n    float innerGlowAlpha = (1. - alphaRatio) * innerStrength * curColor.a * uAlpha;\n    float innerGlowStrength = min(1., innerGlowAlpha);\n    \n    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);\n    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a) * uAlpha;\n    float outerGlowStrength = min(1. - innerColor.a, outerGlowAlpha);\n    vec4 outerGlowColor = outerGlowStrength * glowColor.rgba;\n\n    if (knockout) {\n      float resultAlpha = outerGlowAlpha + innerGlowAlpha;\n      finalColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);\n    }\n    else {\n      finalColor = innerColor + outerGlowColor;\n    }\n}\n".replace(/__ANGLE_STEP_SIZE__/gi,`${(1/n/r).toFixed(7)}`).replace(/__DIST__/gi,`${r.toFixed(0)}.0`),name:"glow-filter"}),resources:{glowUniforms:{uDistance:{value:r,type:"f32"},uStrength:{value:[t.innerStrength,t.outerStrength],type:"vec2<f32>"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:t.alpha,type:"f32"},uQuality:{value:n,type:"f32"},uKnockout:{value:t?.knockout?1:0,type:"f32"}}},padding:r}),sZ(this,"uniforms"),sZ(this,"_color"),this.uniforms=this.resources.glowUniforms.uniforms,this._color=new tu.Color,this.color=t.color??16777215}get distance(){return this.uniforms.uDistance}set distance(e){this.uniforms.uDistance=this.padding=e}get innerStrength(){return this.uniforms.uStrength[0]}set innerStrength(e){this.uniforms.uStrength[0]=e}get outerStrength(){return this.uniforms.uStrength[1]}set outerStrength(e){this.uniforms.uStrength[1]=e}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,n]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=n}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}get quality(){return this.uniforms.uQuality}set quality(e){this.uniforms.uQuality=e}get knockout(){return 1===this.uniforms.uKnockout}set knockout(e){this.uniforms.uKnockout=e?1:0}};sZ(s0,"DEFAULT_OPTIONS",{distance:10,outerStrength:4,innerStrength:0,color:16777215,alpha:1,quality:.1,knockout:!1});var tC=et("gIu8o"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),s2=Object.defineProperty,s1=(e,t,r)=>t in e?s2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s3=(e,t,r)=>(s1(e,"symbol"!=typeof t?t+"":t,r),r);const s4=class e extends td.Filter{constructor(t){super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct GodrayUniforms {\n  uLight: vec2<f32>,\n  uParallel: f32,\n  uAspect: f32,\n  uTime: f32,\n  uRay: vec3<f32>,\n  uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> godrayUniforms : GodrayUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uDimensions: vec2<f32> = godrayUniforms.uDimensions;\n  let uParallel: bool = godrayUniforms.uParallel > 0.5;\n  let uLight: vec2<f32> = godrayUniforms.uLight;\n  let uAspect: f32 = godrayUniforms.uAspect;\n\n  let coord: vec2<f32> = uv * gfu.uInputSize.xy / uDimensions;\n\n  var d: f32;\n\n  if (uParallel) {\n    let _cos: f32 = uLight.x;\n    let _sin: f32 = uLight.y;\n    d = (_cos * coord.x) + (_sin * coord.y * uAspect);\n  } else {\n    let dx: f32 = coord.x - uLight.x / uDimensions.x;\n    let dy: f32 = (coord.y - uLight.y / uDimensions.y) * uAspect;\n    let dis: f32 = sqrt(dx * dx + dy * dy) + 0.00001;\n    d = dy / dis;\n  }\n\n  let uTime: f32 = godrayUniforms.uTime;\n  let uRay: vec3<f32> = godrayUniforms.uRay;\n  \n  let gain = uRay[0];\n  let lacunarity = uRay[1];\n  let alpha = uRay[2];\n\n  let dir: vec3<f32> = vec3<f32>(d, d, 0.0);\n  var noise: f32 = turb(dir + vec3<f32>(uTime, 0.0, 62.1 + uTime) * 0.05, vec3<f32>(480.0, 320.0, 480.0), lacunarity, gain);\n  noise = mix(noise, 0.0, 0.3);\n  //fade vertically.\n  var mist: vec4<f32> = vec4<f32>(vec3<f32>(noise), 1.0) * (1.0 - coord.y);\n  mist.a = 1.0;\n  // apply user alpha\n  mist *= alpha;\n  return textureSample(uTexture, uSampler, uv) + mist;\n}\n\n${PERLIN}".replace("${PERLIN}","// Taken from https://gist.github.com/munrocket/236ed5ba7e409b8bdf1ff6eca5dcdc39\n\nfn moduloVec3(x: vec3<f32>, y: vec3<f32>) -> vec3<f32>\n{\n  return x - y * floor(x/y);\n}\nfn mod289Vec3(x: vec3<f32>) -> vec3<f32>\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nfn mod289Vec4(x: vec4<f32>) -> vec4<f32>\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nfn permute4(x: vec4<f32>) -> vec4<f32>\n{\n    return mod289Vec4(((x * 34.0) + 1.0) * x);\n}\nfn taylorInvSqrt(r: vec4<f32>) -> vec4<f32>\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\nfn fade3(t: vec3<f32>) -> vec3<f32>\n{\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\nfn fade2(t: vec2<f32>) -> vec2<f32> { return t * t * t * (t * (t * 6. - 15.) + 10.); }\n\nfn perlinNoise2(P: vec2<f32>) -> f32 {\n  var Pi: vec4<f32> = floor(P.xyxy) + vec4<f32>(0., 0., 1., 1.);\n  let Pf = fract(P.xyxy) - vec4<f32>(0., 0., 1., 1.);\n  Pi = Pi % vec4<f32>(289.); // To avoid truncation effects in permutation\n  let ix = Pi.xzxz;\n  let iy = Pi.yyww;\n  let fx = Pf.xzxz;\n  let fy = Pf.yyww;\n  let i = permute4(permute4(ix) + iy);\n  var gx: vec4<f32> = 2. * fract(i * 0.0243902439) - 1.; // 1/41 = 0.024...\n  let gy = abs(gx) - 0.5;\n  let tx = floor(gx + 0.5);\n  gx = gx - tx;\n  var g00: vec2<f32> = vec2<f32>(gx.x, gy.x);\n  var g10: vec2<f32> = vec2<f32>(gx.y, gy.y);\n  var g01: vec2<f32> = vec2<f32>(gx.z, gy.z);\n  var g11: vec2<f32> = vec2<f32>(gx.w, gy.w);\n  let norm = 1.79284291400159 - 0.85373472095314 *\n      vec4<f32>(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));\n  g00 = g00 * norm.x;\n  g01 = g01 * norm.y;\n  g10 = g10 * norm.z;\n  g11 = g11 * norm.w;\n  let n00 = dot(g00, vec2<f32>(fx.x, fy.x));\n  let n10 = dot(g10, vec2<f32>(fx.y, fy.y));\n  let n01 = dot(g01, vec2<f32>(fx.z, fy.z));\n  let n11 = dot(g11, vec2<f32>(fx.w, fy.w));\n  let fade_xy = fade2(Pf.xy);\n  let n_x = mix(vec2<f32>(n00, n01), vec2<f32>(n10, n11), vec2<f32>(fade_xy.x));\n  let n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise, periodic variant\nfn perlinNoise3(P: vec3<f32>, rep: vec3<f32>) -> f32\n{\n    var Pi0: vec3<f32> = moduloVec3(floor(P), rep); // Integer part, modulo period\n    var Pi1: vec3<f32> = moduloVec3(Pi0 + vec3<f32>(1.0), rep); // Integer part + 1, mod period\n    Pi0 = mod289Vec3(Pi0);\n    Pi1 = mod289Vec3(Pi1);\n    let Pf0: vec3<f32> = fract(P); // Fractional part for interpolation\n    let Pf1: vec3<f32> = Pf0 - vec3<f32>(1.0); // Fractional part - 1.0\n    let ix: vec4<f32> = vec4<f32>(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    let iy: vec4<f32> = vec4<f32>(Pi0.yy, Pi1.yy);\n    let iz0: vec4<f32> = Pi0.zzzz;\n    let iz1: vec4<f32> = Pi1.zzzz;\n    let ixy: vec4<f32> = permute4(permute4(ix) + iy);\n    let ixy0: vec4<f32> = permute4(ixy + iz0);\n    let ixy1: vec4<f32> = permute4(ixy + iz1);\n    var gx0: vec4<f32> = ixy0 * (1.0 / 7.0);\n    var gy0: vec4<f32> = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    let gz0: vec4<f32> = vec4<f32>(0.5) - abs(gx0) - abs(gy0);\n    let sz0: vec4<f32> = step(gz0, vec4<f32>(0.0));\n    gx0 -= sz0 * (step(vec4<f32>(0.0), gx0) - 0.5);\n    gy0 -= sz0 * (step(vec4<f32>(0.0), gy0) - 0.5);\n    var gx1: vec4<f32> = ixy1 * (1.0 / 7.0);\n    var gy1: vec4<f32> = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    let gz1: vec4<f32> = vec4<f32>(0.5) - abs(gx1) - abs(gy1);\n    let sz1: vec4<f32> = step(gz1, vec4<f32>(0.0));\n    gx1 -= sz1 * (step(vec4<f32>(0.0), gx1) - 0.5);\n    gy1 -= sz1 * (step(vec4<f32>(0.0), gy1) - 0.5);\n    var g000: vec3<f32> = vec3<f32>(gx0.x, gy0.x, gz0.x);\n    var g100: vec3<f32> = vec3<f32>(gx0.y, gy0.y, gz0.y);\n    var g010: vec3<f32> = vec3<f32>(gx0.z, gy0.z, gz0.z);\n    var g110: vec3<f32> = vec3<f32>(gx0.w, gy0.w, gz0.w);\n    var g001: vec3<f32> = vec3<f32>(gx1.x, gy1.x, gz1.x);\n    var g101: vec3<f32> = vec3<f32>(gx1.y, gy1.y, gz1.y);\n    var g011: vec3<f32> = vec3<f32>(gx1.z, gy1.z, gz1.z);\n    var g111: vec3<f32> = vec3<f32>(gx1.w, gy1.w, gz1.w);\n    let norm0: vec4<f32> = taylorInvSqrt(vec4<f32>(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    let norm1: vec4<f32> = taylorInvSqrt(vec4<f32>(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n    let n000: f32 = dot(g000, Pf0);\n    let n100: f32 = dot(g100, vec3<f32>(Pf1.x, Pf0.yz));\n    let n010: f32 = dot(g010, vec3<f32>(Pf0.x, Pf1.y, Pf0.z));\n    let n110: f32 = dot(g110, vec3<f32>(Pf1.xy, Pf0.z));\n    let n001: f32 = dot(g001, vec3<f32>(Pf0.xy, Pf1.z));\n    let n101: f32 = dot(g101, vec3<f32>(Pf1.x, Pf0.y, Pf1.z));\n    let n011: f32 = dot(g011, vec3<f32>(Pf0.x, Pf1.yz));\n    let n111: f32 = dot(g111, Pf1);\n    let fade_xyz: vec3<f32> = fade3(Pf0);\n    let n_z: vec4<f32> = mix(vec4<f32>(n000, n100, n010, n110), vec4<f32>(n001, n101, n011, n111), fade_xyz.z);\n    let n_yz: vec2<f32> = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    let n_xyz: f32 = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n}\nfn turb(P: vec3<f32>, rep: vec3<f32>, lacunarity: f32, gain: f32) -> f32\n{\n    var sum: f32 = 0.0;\n    var sc: f32 = 1.0;\n    var totalgain: f32 = 1.0;\n    for (var i = 0.0; i < 6.0; i += 1)\n    {\n        sum += totalgain * perlinNoise3(P * sc, rep);\n        sc *= lacunarity;\n        totalgain *= gain;\n    }\n    return abs(sum);\n}"),entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uDimensions;\nuniform float uParallel;\nuniform vec2 uLight;\nuniform float uAspect;\nuniform float uTime;\nuniform vec3 uRay;\n\nuniform vec4 uInputSize;\n\n${PERLIN}\n\nvoid main(void) {\n    vec2 uDimensions = uDimensions;\n    bool uParallel = uParallel > 0.5;\n    vec2 uLight = uLight;\n    float uAspect = uAspect;\n\n    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions;\n\n    float d;\n\n    if (uParallel) {\n        float _cos = uLight.x;\n        float _sin = uLight.y;\n        d = (_cos * coord.x) + (_sin * coord.y * uAspect);\n    } else {\n        float dx = coord.x - uLight.x / uDimensions.x;\n        float dy = (coord.y - uLight.y / uDimensions.y) * uAspect;\n        float dis = sqrt(dx * dx + dy * dy) + 0.00001;\n        d = dy / dis;\n    }\n\n    float uTime = uTime;\n    vec3 uRay = uRay;\n\n    float gain = uRay[0];\n    float lacunarity = uRay[1];\n    float alpha = uRay[2];\n\n    vec3 dir = vec3(d, d, 0.0);\n    float noise = turb(dir + vec3(uTime, 0.0, 62.1 + uTime) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);\n    noise = mix(noise, 0.0, 0.3);\n    //fade vertically.\n    vec4 mist = vec4(vec3(noise), 1.0) * (1.0 - coord.y);\n    mist.a = 1.0;\n    // apply user alpha\n    mist *= alpha;\n\n    finalColor = texture(uTexture, vTextureCoord) + mist;\n}\n".replace("${PERLIN}","vec3 mod289(vec3 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x)\n{\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 permute(vec4 x)\n{\n    return mod289(((x * 34.0) + 1.0) * x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\n    return 1.79284291400159 - 0.85373472095314 * r;\n}\nvec3 fade(vec3 t)\n{\n    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n    Pi0 = mod289(Pi0);\n    Pi1 = mod289(Pi1);\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = Pi0.zzzz;\n    vec4 iz1 = Pi1.zzzz;\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n    vec4 gx0 = ixy0 * (1.0 / 7.0);\n    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n    gx0 = fract(gx0);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n    vec4 sz0 = step(gz0, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n    vec4 gx1 = ixy1 * (1.0 / 7.0);\n    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n    gx1 = fract(gx1);\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n    vec4 sz1 = step(gz1, vec4(0.0));\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);\n    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);\n    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);\n    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);\n    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);\n    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);\n    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);\n    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n    float n000 = dot(g000, Pf0);\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n    float n111 = dot(g111, Pf1);\n    vec3 fade_xyz = fade(Pf0);\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n}\nfloat turb(vec3 P, vec3 rep, float lacunarity, float gain)\n{\n    float sum = 0.0;\n    float sc = 1.0;\n    float totalgain = 1.0;\n    for (float i = 0.0; i < 6.0; i++)\n    {\n        sum += totalgain * pnoise(P * sc, rep);\n        sc *= lacunarity;\n        totalgain *= gain;\n    }\n    return abs(sum);\n}\n"),name:"god-ray-filter"}),resources:{godrayUniforms:{uLight:{value:new Float32Array(2),type:"vec2<f32>"},uParallel:{value:0,type:"f32"},uAspect:{value:0,type:"f32"},uTime:{value:(t={...e.DEFAULT_OPTIONS,...t}).time,type:"f32"},uRay:{value:new Float32Array(3),type:"vec3<f32>"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),s3(this,"uniforms"),s3(this,"time",0),s3(this,"_angleLight",[0,0]),s3(this,"_angle",0),s3(this,"_center"),this.uniforms=this.resources.godrayUniforms.uniforms,Object.assign(this,t)}apply(e,t,r,n){let i=t.frame.width,s=t.frame.height;this.uniforms.uLight[0]=this.parallel?this._angleLight[0]:this._center.x,this.uniforms.uLight[1]=this.parallel?this._angleLight[1]:this._center.y,this.uniforms.uDimensions[0]=i,this.uniforms.uDimensions[1]=s,this.uniforms.uAspect=s/i,this.uniforms.uTime=this.time,e.applyFilter(this,t,r,n)}get angle(){return this._angle}set angle(e){this._angle=e;let t=e*tC.DEG_TO_RAD;this._angleLight[0]=Math.cos(t),this._angleLight[1]=Math.sin(t)}get parallel(){return this.uniforms.uParallel>.5}set parallel(e){this.uniforms.uParallel=e?1:0}get center(){return this._center}set center(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this._center=e}get centerX(){return this.center.x}set centerX(e){this.center.x=e}get centerY(){return this.center.y}set centerY(e){this.center.y=e}get gain(){return this.uniforms.uRay[0]}set gain(e){this.uniforms.uRay[0]=e}get lacunarity(){return this.uniforms.uRay[1]}set lacunarity(e){this.uniforms.uRay[1]=e}get alpha(){return this.uniforms.uRay[2]}set alpha(e){this.uniforms.uRay[2]=e}};s3(s4,"DEFAULT_OPTIONS",{angle:30,gain:.5,lacunarity:2.5,parallel:!0,time:0,center:{x:0,y:0},alpha:1});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),s5=Object.defineProperty,s6=(e,t,r)=>t in e?s5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s8=(e,t,r)=>(s6(e,"symbol"!=typeof t?t+"":t,r),r);const s9=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct HslUniforms {\n  uHsl:vec3<f32>,\n  uColorize:f32,\n  uAlpha:f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> hslUniforms : HslUniforms;\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n    let color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n    var resultRGB: vec3<f32> = color.rgb;\n\n    let hue: f32 = hslUniforms.uHsl[0];\n    let saturation: f32 = hslUniforms.uHsl[1];\n    let lightness: f32 = hslUniforms.uHsl[2];\n\n    // colorize\n    if (hslUniforms.uColorize > 0.5) {\n        resultRGB = vec3<f32>(dot(color.rgb, vec3<f32>(0.299, 0.587, 0.114)), 0., 0.);\n    }\n\n    // hue\n    resultRGB = hueShift(resultRGB, hue);\n\n    // saturation\n    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js\n    let average: f32 = (resultRGB.r + resultRGB.g + resultRGB.b) / 3.0;\n\n    if (saturation > 0.) {\n        resultRGB += (average - resultRGB) * (1. - 1. / (1.001 - saturation));\n    } else {\n        resultRGB -= (average - resultRGB) * saturation;\n    }\n\n    // lightness\n    resultRGB = mix(resultRGB, vec3<f32>(ceil(lightness)) * color.a, abs(lightness));\n\n    // alpha\n    return mix(color, vec4<f32>(resultRGB, color.a), hslUniforms.uAlpha);\n}\n\n// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243\nconst k: vec3<f32> = vec3(0.57735, 0.57735, 0.57735);\n\nfn hueShift(color: vec3<f32>, angle: f32) -> vec3<f32> \n{\n    let cosAngle: f32 = cos(angle);\n    return vec3<f32>(\n    color * cosAngle +\n    cross(k, color) * sin(angle) +\n    k * dot(k, color) * (1.0 - cosAngle)\n    );\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec3 uHsl;\nuniform float uAlpha;\nuniform float uColorize;\n\n// https://en.wikipedia.org/wiki/Luma_(video)\nconst vec3 weight = vec3(0.299, 0.587, 0.114);\n\nfloat getWeightedAverage(vec3 rgb) {\n    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;\n}\n\n// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243\nconst vec3 k = vec3(0.57735, 0.57735, 0.57735);\n\nvec3 hueShift(vec3 color, float angle) {\n    float cosAngle = cos(angle);\n    return vec3(\n    color * cosAngle +\n    cross(k, color) * sin(angle) +\n    k * dot(k, color) * (1.0 - cosAngle)\n    );\n}\n\nvoid main()\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n    vec3 resultRGB = color.rgb;\n\n    float hue = uHsl[0];\n    float saturation = uHsl[1];\n    float lightness = uHsl[2];\n\n    // colorize\n    if (uColorize > 0.5) {\n        resultRGB = vec3(getWeightedAverage(resultRGB), 0., 0.);\n    }\n\n    // hue\n    resultRGB = hueShift(resultRGB, hue);\n\n    // saturation\n    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js\n    float average = (resultRGB.r + resultRGB.g + resultRGB.b) / 3.0;\n\n    if (saturation > 0.) {\n        resultRGB += (average - resultRGB) * (1. - 1. / (1.001 - saturation));\n    } else {\n        resultRGB -= (average - resultRGB) * saturation;\n    }\n\n    // lightness\n    resultRGB = mix(resultRGB, vec3(ceil(lightness)) * color.a, abs(lightness));\n\n    // alpha\n    finalColor = mix(color, vec4(resultRGB, color.a), uAlpha);\n}\n",name:"hsl-adjustment-filter"}),resources:{hslUniforms:{uHsl:{value:new Float32Array(3),type:"vec3<f32>"},uColorize:{value:t.colorize?1:0,type:"f32"},uAlpha:{value:t.alpha,type:"f32"}}}}),s8(this,"uniforms"),s8(this,"_hue"),this.uniforms=this.resources.hslUniforms.uniforms,this.hue=t.hue}get hue(){return this._hue}set hue(e){this._hue=e,this.resources.hslUniforms.uniforms.uHsl[0]=Math.PI/180*e}get saturation(){return this.resources.hslUniforms.uniforms.uHsl[1]}set saturation(e){this.resources.hslUniforms.uniforms.uHsl[1]=e}get lightness(){return this.resources.hslUniforms.uniforms.uHsl[2]}set lightness(e){this.resources.hslUniforms.uniforms.uHsl[2]=e}get colorize(){return 1===this.resources.hslUniforms.uniforms.uColorize}set colorize(e){this.resources.hslUniforms.uniforms.uColorize=e?1:0}get alpha(){return this.resources.hslUniforms.uniforms.uAlpha}set alpha(e){this.resources.hslUniforms.uniforms.uAlpha=e}};s8(s9,"DEFAULT_OPTIONS",{hue:0,saturation:0,lightness:0,colorize:!1,alpha:1});var ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),tw=et("ep73P"),s7=Object.defineProperty,oe=(e,t,r)=>t in e?s7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ot=(e,t,r)=>(oe(e,"symbol"!=typeof t?t+"":t,r),r);const or=class e extends td.Filter{constructor(...t){let r=t[0]??{};(Array.isArray(r)||"x"in r&&"y"in r||r instanceof tw.ObservablePoint)&&((0,ep.deprecation)("6.0.0","MotionBlurFilter constructor params are now options object. See params: { velocity, kernelSize, offset }"),r={velocity:{x:"x"in r?r.x:r[0],y:"y"in r?r.y:r[1]}},void 0!==t[1]&&(r.kernelSize=t[1]),void 0!==t[2]&&(r.offset=t[2])),r={...e.DEFAULT_OPTIONS,...r},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct MotionBlurUniforms {\n  uVelocity: vec2<f32>,\n  uKernelSize: f32,\n  uOffset: f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> motionBlurUniforms : MotionBlurUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uVelocity = motionBlurUniforms.uVelocity;\n  let uKernelSize = motionBlurUniforms.uKernelSize;\n  let uOffset = motionBlurUniforms.uOffset;\n\n  let velocity: vec2<f32> = uVelocity / gfu.uInputSize.xy;\n  let offset: f32 = -uOffset / length(uVelocity) - 0.5;\n  let k: i32 = i32(min(uKernelSize - 1, MAX_KERNEL_SIZE - 1));\n\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  for(var i: i32 = 0; i < k; i += 1) {\n    let bias: vec2<f32> = velocity * (f32(i) / f32(k) + offset);\n    color += textureSample(uTexture, uSampler, uv + bias);\n  }\n  \n  return select(color / f32(uKernelSize), textureSample(uTexture, uSampler, uv), uKernelSize == 0);\n}\n\nconst MAX_KERNEL_SIZE: f32 = 2048;",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uVelocity;\nuniform int uKernelSize;\nuniform float uOffset;\n\nuniform vec4 uInputSize;\n\nconst int MAX_KERNEL_SIZE = 2048;\n\n// Notice:\n// the perfect way:\n//    int kernelSize = min(uKernelSize, MAX_KERNELSIZE);\n// BUT in real use-case , uKernelSize < MAX_KERNELSIZE almost always.\n// So use uKernelSize directly.\n\nvoid main(void)\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n\n    if (uKernelSize == 0)\n    {\n        finalColor = color;\n        return;\n    }\n\n    vec2 velocity = uVelocity / uInputSize.xy;\n    float offset = -uOffset / length(uVelocity) - 0.5;\n    int k = uKernelSize - 1;\n\n    for(int i = 0; i < MAX_KERNEL_SIZE - 1; i++) {\n        if (i == k) {\n            break;\n        }\n        vec2 bias = velocity * (float(i) / float(k) + offset);\n        color += texture(uTexture, vTextureCoord + bias);\n    }\n    finalColor = color / float(uKernelSize);\n}\n",name:"motion-blur-filter"}),resources:{motionBlurUniforms:{uVelocity:{value:r.velocity,type:"vec2<f32>"},uKernelSize:{value:Math.trunc(r.kernelSize??5),type:"f32"},uOffset:{value:r.offset,type:"f32"}}}}),ot(this,"uniforms"),ot(this,"_kernelSize"),this.uniforms=this.resources.motionBlurUniforms.uniforms,Object.assign(this,r)}get velocity(){return this.uniforms.uVelocity}set velocity(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uVelocity=e,this._updateDirty()}get velocityX(){return this.velocity.x}set velocityX(e){this.velocity.x=e,this._updateDirty()}get velocityY(){return this.velocity.y}set velocityY(e){this.velocity.y=e,this._updateDirty()}get kernelSize(){return this._kernelSize}set kernelSize(e){this._kernelSize=e,this._updateDirty()}get offset(){return this.uniforms.uOffset}set offset(e){this.uniforms.uOffset=e}_updateDirty(){this.padding=(Math.max(Math.abs(this.velocityX),Math.abs(this.velocityY))>>0)+1,this.uniforms.uKernelSize=0!==this.velocityX||0!==this.velocityY?this._kernelSize:0}};ot(or,"DEFAULT_OPTIONS",{velocity:{x:0,y:0},kernelSize:5,offset:0});var tu=et("AHTcQ"),ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),on=Object.defineProperty,oi=(e,t,r)=>t in e?on(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,os=(e,t,r)=>(oi(e,"symbol"!=typeof t?t+"":t,r),r);const oo=class e extends td.Filter{constructor(...t){let r=t[0]??{};Array.isArray(r)&&((0,ep.deprecation)("6.0.0","MultiColorReplaceFilter constructor params are now options object. See params: { replacements, tolerance, maxColors }"),r={replacements:r},t[1]&&(r.tolerance=t[1]),t[2]&&(r.maxColors=t[2]));let n=(r={...e.DEFAULT_OPTIONS,...r}).maxColors??r.replacements.length;super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct MultiColorReplaceUniforms {\n  uOriginalColors: array<vec3<f32>, MAX_COLORS>,\n  uTargetColors: array<vec3<f32>, MAX_COLORS>,\n  uTolerance:f32,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> multiColorReplaceUniforms : MultiColorReplaceUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uOriginalColors = multiColorReplaceUniforms.uOriginalColors;\n  let uTargetColors = multiColorReplaceUniforms.uTargetColors;\n  let uTolerance = multiColorReplaceUniforms.uTolerance;\n\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  let alpha: f32 = color.a;\n\n  if (alpha > 0.0001)\n  {\n    var modColor: vec3<f32> = vec3<f32>(color.rgb) / alpha;\n\n    for(var i: i32 = 0; i < MAX_COLORS; i += 1)\n    {\n      let origColor: vec3<f32> = uOriginalColors[i];\n      if (origColor.r < 0.0)\n      {\n        break;\n      }\n      let colorDiff: vec3<f32> = origColor - modColor;\n      \n      if (length(colorDiff) < uTolerance)\n      {\n        let targetColor: vec3<f32> = uTargetColors[i];\n        color = vec4((targetColor + colorDiff) * alpha, alpha);\n        return color;\n      }\n    }\n  }\n\n  return color;\n}\n\nconst MAX_COLORS: i32 = ${MAX_COLORS};".replace(/\$\{MAX_COLORS\}/g,n.toFixed(0)),entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nconst int MAX_COLORS = ${MAX_COLORS};\n\nuniform sampler2D uTexture;\nuniform vec3 uOriginalColors[MAX_COLORS];\nuniform vec3 uTargetColors[MAX_COLORS];\nuniform float uTolerance;\n\nvoid main(void)\n{\n    finalColor = texture(uTexture, vTextureCoord);\n\n    float alpha = finalColor.a;\n    if (alpha < 0.0001)\n    {\n      return;\n    }\n\n    vec3 color = finalColor.rgb / alpha;\n\n    for(int i = 0; i < MAX_COLORS; i++)\n    {\n      vec3 origColor = uOriginalColors[i];\n      if (origColor.r < 0.0)\n      {\n        break;\n      }\n      vec3 colorDiff = origColor - color;\n      if (length(colorDiff) < uTolerance)\n      {\n        vec3 targetColor = uTargetColors[i];\n        finalColor = vec4((targetColor + colorDiff) * alpha, alpha);\n        return;\n      }\n    }\n}\n".replace(/\$\{MAX_COLORS\}/g,n.toFixed(0)),name:"multi-color-replace-filter"}),resources:{multiColorReplaceUniforms:{uOriginalColors:{value:new Float32Array(3*n),type:"vec3<f32>",size:n},uTargetColors:{value:new Float32Array(3*n),type:"vec3<f32>",size:n},uTolerance:{value:r.tolerance,type:"f32"}}}}),os(this,"uniforms"),os(this,"_replacements",[]),os(this,"_maxColors"),this._maxColors=n,this.uniforms=this.resources.multiColorReplaceUniforms.uniforms,this.replacements=r.replacements}set replacements(e){let t,r,n;let i=this.uniforms.uOriginalColors,s=this.uniforms.uTargetColors,o=e.length,a=new tu.Color;if(o>this._maxColors)throw Error(`Length of replacements (${o}) exceeds the maximum colors length (${this._maxColors})`);i[3*o]=-1;for(let l=0;l<o;l++){let o=e[l];a.setValue(o[0]),[t,r,n]=a.toArray(),i[3*l]=t,i[3*l+1]=r,i[3*l+2]=n,a.setValue(o[1]),[t,r,n]=a.toArray(),s[3*l]=t,s[3*l+1]=r,s[3*l+2]=n}this._replacements=e}get replacements(){return this._replacements}refresh(){this.replacements=this._replacements}get maxColors(){return this._maxColors}get tolerance(){return this.uniforms.uTolerance}set tolerance(e){this.uniforms.uTolerance=e}set epsilon(e){(0,ep.deprecation)("6.0.0","MultiColorReplaceFilter.epsilon is deprecated, please use MultiColorReplaceFilter.tolerance instead"),this.tolerance=e}get epsilon(){return(0,ep.deprecation)("6.0.0","MultiColorReplaceFilter.epsilon is deprecated, please use MultiColorReplaceFilter.tolerance instead"),this.tolerance}};os(oo,"DEFAULT_OPTIONS",{replacements:[[16711680,255]],tolerance:.05,maxColors:void 0});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),oa=Object.defineProperty,ol=(e,t,r)=>t in e?oa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ou=(e,t,r)=>(ol(e,"symbol"!=typeof t?t+"":t,r),r);const oc=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct OldFilmUniforms {\n    uSepia: f32,\n    uNoise: vec2<f32>,\n    uScratch: vec3<f32>,\n    uVignetting: vec3<f32>,\n    uSeed: f32,\n    uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> oldFilmUniforms : OldFilmUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n\n  if (oldFilmUniforms.uSepia > 0.)\n  {\n    color = vec4<f32>(sepia(color.rgb), color.a);\n  }\n\n  let coord: vec2<f32> = uv * gfu.uInputSize.xy / oldFilmUniforms.uDimensions;\n\n  if (oldFilmUniforms.uVignetting[0] > 0.)\n  {\n    color *= vec4<f32>(vec3<f32>(vignette(color.rgb, coord)), color.a);\n  }\n\n  let uScratch = oldFilmUniforms.uScratch; \n\n  if (uScratch[1] > oldFilmUniforms.uSeed && uScratch[0] != 0.)\n  {\n    color = vec4<f32>(scratch(color.rgb, coord), color.a);\n  }\n\n  let uNoise = oldFilmUniforms.uNoise;\n\n  if (uNoise[0] > 0.0 && uNoise[1] > 0.0)\n  {\n    color += vec4<f32>(vec3<f32>(noise(uv)), color.a);\n  }\n\n  return color;\n}\n\nconst SQRT_2: f32 = 1.414213;\nconst SEPIA_RGB: vec3<f32> = vec3<f32>(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);\n\nfn modulo(x: f32, y: f32) -> f32\n{\n  return x - y * floor(x/y);\n}\n\nfn rand(co: vec2<f32>) -> f32\n{\n  return fract(sin(dot(co, vec2<f32>(12.9898, 78.233))) * 43758.5453);\n}\n\nfn overlay(src: vec3<f32>, dst: vec3<f32>) -> vec3<f32>\n{\n    // if (dst <= 0.5) then: 2 * src * dst\n    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)\n\n    return vec3<f32>(\n      select((1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)), (2.0 * src.x * dst.x), (dst.x <= 0.5)), \n      select((1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)), (2.0 * src.y * dst.y), (dst.y <= 0.5)),\n      select((1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)), (2.0 * src.z * dst.z), (dst.z <= 0.5))\n    );\n}\n\nfn sepia(co: vec3<f32>) -> vec3<f32>\n{\n  let gray: f32 = (co.x + co.y + co.z) / 3.0;\n  let grayscale: vec3<f32> = vec3<f32>(gray);\n  let color = overlay(SEPIA_RGB, grayscale);\n  return grayscale + oldFilmUniforms.uSepia * (color - grayscale);\n}\n\nfn vignette(co: vec3<f32>, coord: vec2<f32>) -> f32\n{\n  let uVignetting = oldFilmUniforms.uVignetting;\n  let uDimensions = oldFilmUniforms.uDimensions;\n  \n  let outter: f32 = SQRT_2 - uVignetting[0] * SQRT_2;\n  var dir: vec2<f32> = vec2<f32>(vec2<f32>(0.5) - coord);\n  dir.y *= uDimensions.y / uDimensions.x;\n  let darker: f32 = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignetting[2] * SQRT_2), 0.0, 1.0);\n  return darker + (1.0 - darker) * (1.0 - uVignetting[1]);\n}\n\nfn scratch(co: vec3<f32>, coord: vec2<f32>) -> vec3<f32>\n{\n  var color = co;\n  let uScratch = oldFilmUniforms.uScratch;\n  let uSeed = oldFilmUniforms.uSeed;\n  let uDimensions = oldFilmUniforms.uDimensions;\n\n  let phase: f32 = uSeed * 256.0;\n  let s: f32 = modulo(floor(phase), 2.0);\n  let dist: f32 = 1.0 / uScratch[1];\n  let d: f32 = distance(coord, vec2<f32>(uSeed * dist, abs(s - uSeed * dist)));\n\n  if (d < uSeed * 0.6 + 0.4)\n  {\n    let period: f32 = uScratch[1] * 10.0;\n\n    let xx: f32 = coord.x * period + phase;\n    let aa: f32 = abs(modulo(xx, 0.5) * 4.0);\n    let bb: f32 = modulo(floor(xx / 0.5), 2.0);\n    let yy: f32 = (1.0 - bb) * aa + bb * (2.0 - aa);\n\n    let kk: f32 = 2.0 * period;\n    let dw: f32 = uScratch[2] / uDimensions.x * (0.75 + uSeed);\n    let dh: f32 = dw * kk;\n\n    var tine: f32 = (yy - (2.0 - dh));\n\n    if (tine > 0.0) {\n        let _sign: f32 = sign(uScratch[0]);\n\n        tine = s * tine / period + uScratch[0] + 0.1;\n        tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);\n\n        color *= tine;\n    }\n  }\n\n  return color;\n}\n\nfn noise(coord: vec2<f32>) -> f32\n{\n  let uNoise = oldFilmUniforms.uNoise;\n  let uSeed = oldFilmUniforms.uSeed;\n\n  var pixelCoord: vec2<f32> = coord * gfu.uInputSize.xy;\n  pixelCoord.x = floor(pixelCoord.x / uNoise[1]);\n  pixelCoord.y = floor(pixelCoord.y / uNoise[1]);\n  return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uSepia;\nuniform vec2 uNoise;\nuniform vec3 uScratch;\nuniform vec3 uVignetting;\nuniform float uSeed;\nuniform vec2 uDimensions;\n\nuniform vec4 uInputSize;\n\nconst float SQRT_2 = 1.414213;\nconst vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvec3 Overlay(vec3 src, vec3 dst)\n{\n    // if (dst <= 0.5) then: 2 * src * dst\n    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)\n    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),\n                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),\n                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));\n}\n\n\nvoid main()\n{\n    finalColor = texture(uTexture, vTextureCoord);\n    vec3 color = finalColor.rgb;\n\n    if (uSepia > 0.0)\n    {\n        float gray = (color.x + color.y + color.z) / 3.0;\n        vec3 grayscale = vec3(gray);\n\n        color = Overlay(SEPIA_RGB, grayscale);\n\n        color = grayscale + uSepia * (color - grayscale);\n    }\n\n    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions.xy;\n\n    float vignette = uVignetting[0];\n    float vignetteAlpha = uVignetting[1];\n    float vignetteBlur = uVignetting[2];\n\n    if (vignette > 0.0)\n    {\n        float outter = SQRT_2 - vignette * SQRT_2;\n        vec2 dir = vec2(vec2(0.5, 0.5) - coord);\n        dir.y *= uDimensions.y / uDimensions.x;\n        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignetteBlur * SQRT_2), 0.0, 1.0);\n        color.rgb *= darker + (1.0 - darker) * (1.0 - vignetteAlpha);\n    }\n\n    float scratch = uScratch[0];\n    float scratchDensity = uScratch[1];\n    float scratchWidth = uScratch[2];\n\n    if (scratchDensity > uSeed && scratch != 0.0)\n    {\n        float phase = uSeed * 256.0;\n        float s = mod(floor(phase), 2.0);\n        float dist = 1.0 / scratchDensity;\n        float d = distance(coord, vec2(uSeed * dist, abs(s - uSeed * dist)));\n        if (d < uSeed * 0.6 + 0.4)\n        {\n            highp float period = scratchDensity * 10.0;\n\n            float xx = coord.x * period + phase;\n            float aa = abs(mod(xx, 0.5) * 4.0);\n            float bb = mod(floor(xx / 0.5), 2.0);\n            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);\n\n            float kk = 2.0 * period;\n            float dw = scratchWidth / uDimensions.x * (0.75 + uSeed);\n            float dh = dw * kk;\n\n            float tine = (yy - (2.0 - dh));\n\n            if (tine > 0.0) {\n                float _sign = sign(scratch);\n\n                tine = s * tine / period + scratch + 0.1;\n                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);\n\n                color.rgb *= tine;\n            }\n        }\n    }\n\n    float noise = uNoise[0];\n    float noiseSize = uNoise[1];\n\n    if (noise > 0.0 && noiseSize > 0.0)\n    {\n        vec2 pixelCoord = vTextureCoord.xy * uInputSize.xy;\n        pixelCoord.x = floor(pixelCoord.x / noiseSize);\n        pixelCoord.y = floor(pixelCoord.y / noiseSize);\n        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + uSeed * 512.0, 1024.0 - uSeed * 512.0);\n        // float _noise = snoise(d) * 0.5;\n        float _noise = rand(pixelCoord * noiseSize * uSeed) - 0.5;\n        color += _noise * noise;\n    }\n\n    finalColor.rgb = color;\n}",name:"old-film-filter"}),resources:{oldFilmUniforms:{uSepia:{value:t.sepia,type:"f32"},uNoise:{value:new Float32Array(2),type:"vec2<f32>"},uScratch:{value:new Float32Array(3),type:"vec3<f32>"},uVignetting:{value:new Float32Array(3),type:"vec3<f32>"},uSeed:{value:t.seed,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),ou(this,"uniforms"),ou(this,"seed"),this.uniforms=this.resources.oldFilmUniforms.uniforms,Object.assign(this,t)}apply(e,t,r,n){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,this.uniforms.uSeed=this.seed,e.applyFilter(this,t,r,n)}get sepia(){return this.uniforms.uSepia}set sepia(e){this.uniforms.uSepia=e}get noise(){return this.uniforms.uNoise[0]}set noise(e){this.uniforms.uNoise[0]=e}get noiseSize(){return this.uniforms.uNoise[1]}set noiseSize(e){this.uniforms.uNoise[1]=e}get scratch(){return this.uniforms.uScratch[0]}set scratch(e){this.uniforms.uScratch[0]=e}get scratchDensity(){return this.uniforms.uScratch[1]}set scratchDensity(e){this.uniforms.uScratch[1]=e}get scratchWidth(){return this.uniforms.uScratch[2]}set scratchWidth(e){this.uniforms.uScratch[2]=e}get vignetting(){return this.uniforms.uVignetting[0]}set vignetting(e){this.uniforms.uVignetting[0]=e}get vignettingAlpha(){return this.uniforms.uVignetting[1]}set vignettingAlpha(e){this.uniforms.uVignetting[1]=e}get vignettingBlur(){return this.uniforms.uVignetting[2]}set vignettingBlur(e){this.uniforms.uVignetting[2]=e}};ou(oc,"DEFAULT_OPTIONS",{sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,seed:0});var tu=et("AHTcQ"),ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),oh=Object.defineProperty,of=(e,t,r)=>t in e?oh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,od=(e,t,r)=>(of(e,"symbol"!=typeof t?t+"":t,r),r);const op=class e extends td.Filter{constructor(...t){let r=t[0]??{};"number"==typeof r&&((0,ep.deprecation)("6.0.0","OutlineFilter constructor params are now options object. See params: { thickness, color, quality, alpha, knockout }"),r={thickness:r},void 0!==t[1]&&(r.color=t[1]),void 0!==t[2]&&(r.quality=t[2]),void 0!==t[3]&&(r.alpha=t[3]),void 0!==t[4]&&(r.knockout=t[4]));let n=(r={...e.DEFAULT_OPTIONS,...r}).quality??.1;super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct OutlineUniforms {\n  uThickness:vec2<f32>,\n  uColor:vec3<f32>,\n  uAlpha:f32,\n  uAngleStep:f32,\n  uKnockout:f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> outlineUniforms : OutlineUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let sourceColor: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let contentColor: vec4<f32> = sourceColor * (1. - outlineUniforms.uKnockout);\n  \n  let outlineAlpha: f32 = outlineUniforms.uAlpha * outlineMaxAlphaAtPos(uv) * (1. - sourceColor.a);\n  let outlineColor: vec4<f32> = vec4<f32>(vec3<f32>(outlineUniforms.uColor) * outlineAlpha, outlineAlpha);\n  \n  return contentColor + outlineColor;\n}\n\nfn outlineMaxAlphaAtPos(uv: vec2<f32>) -> f32 {\n  let thickness = outlineUniforms.uThickness;\n\n  if (thickness.x == 0. || thickness.y == 0.) {\n    return 0.;\n  }\n  \n  let angleStep = outlineUniforms.uAngleStep;\n\n  var displacedColor: vec4<f32>;\n  var displacedPos: vec2<f32>;\n\n  var maxAlpha: f32 = 0.;\n  var displaced: vec2<f32>;\n  var curColor: vec4<f32>;\n\n  for (var angle = 0.; angle <= DOUBLE_PI; angle += angleStep)\n  {\n    displaced.x = uv.x + thickness.x * cos(angle);\n    displaced.y = uv.y + thickness.y * sin(angle);\n    curColor = textureSample(uTexture, uSampler, clamp(displaced, gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n    maxAlpha = max(maxAlpha, curColor.a);\n  }\n\n  return maxAlpha;\n}\n\nconst DOUBLE_PI: f32 = 3.14159265358979323846264 * 2.;",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uThickness;\nuniform vec3 uColor;\nuniform float uAlpha;\nuniform float uKnockout;\n\nuniform vec4 uInputClamp;\n\nconst float DOUBLE_PI = 2. * 3.14159265358979323846264;\nconst float ANGLE_STEP = ${ANGLE_STEP};\n\nfloat outlineMaxAlphaAtPos(vec2 pos) {\n    if (uThickness.x == 0. || uThickness.y == 0.) {\n        return 0.;\n    }\n\n    vec4 displacedColor;\n    vec2 displacedPos;\n    float maxAlpha = 0.;\n\n    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {\n        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);\n        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);\n        displacedColor = texture(uTexture, clamp(displacedPos, uInputClamp.xy, uInputClamp.zw));\n        maxAlpha = max(maxAlpha, displacedColor.a);\n    }\n\n    return maxAlpha;\n}\n\nvoid main(void) {\n    vec4 sourceColor = texture(uTexture, vTextureCoord);\n    vec4 contentColor = sourceColor * float(uKnockout < 0.5);\n    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);\n    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);\n    finalColor = contentColor + outlineColor;\n}\n".replace(/\$\{ANGLE_STEP\}/,e.getAngleStep(n).toFixed(7)),name:"outline-filter"}),resources:{outlineUniforms:{uThickness:{value:new Float32Array(2),type:"vec2<f32>"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:r.alpha,type:"f32"},uAngleStep:{value:0,type:"f32"},uKnockout:{value:r.knockout?1:0,type:"f32"}}}}),od(this,"uniforms"),od(this,"_thickness"),od(this,"_quality"),od(this,"_color"),this.uniforms=this.resources.outlineUniforms.uniforms,this.uniforms.uAngleStep=e.getAngleStep(n),this._color=new tu.Color,this.color=r.color??0,Object.assign(this,r)}apply(e,t,r,n){this.uniforms.uThickness[0]=this.thickness/t.source.width,this.uniforms.uThickness[1]=this.thickness/t.source.height,e.applyFilter(this,t,r,n)}static getAngleStep(t){return parseFloat((2*Math.PI/Math.max(t*e.MAX_SAMPLES,e.MIN_SAMPLES)).toFixed(7))}get thickness(){return this._thickness}set thickness(e){this._thickness=this.padding=e}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,n]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=n}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}get quality(){return this._quality}set quality(t){this._quality=t,this.uniforms.uAngleStep=e.getAngleStep(t)}get knockout(){return 1===this.uniforms.uKnockout}set knockout(e){this.uniforms.uKnockout=e?1:0}};od(op,"DEFAULT_OPTIONS",{thickness:1,color:0,alpha:1,quality:.1,knockout:!1}),od(op,"MIN_SAMPLES",1),od(op,"MAX_SAMPLES",100);var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4");et("2NXni");var ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),om=Object.defineProperty,og=(e,t,r)=>t in e?om(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ov=(e,t,r)=>(og(e,"symbol"!=typeof t?t+"":t,r),r);const oy=class e extends td.Filter{constructor(...t){let r=t[0]??{};if("number"==typeof r){if((0,ep.deprecation)("6.0.0","RadialBlurFilter constructor params are now options object. See params: { angle, center, kernelSize, radius }"),r={angle:r},t[1]){let e="x"in t[1]?t[1].x:t[1][0],n="y"in t[1]?t[1].y:t[1][1];r.center={x:e,y:n}}t[2]&&(r.kernelSize=t[2]),t[3]&&(r.radius=t[3])}r={...e.DEFAULT_OPTIONS,...r},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct RadialBlurUniforms {\n  uRadian: f32,\n  uCenter: vec2<f32>,\n  uKernelSize: f32,\n  uRadius: f32,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> radialBlurUniforms : RadialBlurUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uRadian = radialBlurUniforms.uRadian;\n  let uCenter = radialBlurUniforms.uCenter;\n  let uKernelSize = radialBlurUniforms.uKernelSize;\n  let uRadius = radialBlurUniforms.uRadius;\n  \n  var returnColorOnly = false;\n\n  if (uKernelSize == 0)\n  {\n    returnColorOnly = true;\n  }\n\n  let aspect: f32 = gfu.uInputSize.y / gfu.uInputSize.x;\n  let center: vec2<f32> = uCenter.xy / gfu.uInputSize.xy;\n  let gradient: f32 = uRadius / gfu.uInputSize.x * 0.3;\n  let radius: f32 = uRadius / gfu.uInputSize.x - gradient * 0.5;\n  let k: i32 = i32(uKernelSize - 1);\n\n  var coord: vec2<f32> = uv;\n  let dir: vec2<f32> = vec2<f32>(center - coord);\n  let dist: f32 = length(vec2<f32>(dir.x, dir.y * aspect));\n\n  var radianStep: f32 = uRadian;\n  \n  if (radius >= 0.0 && dist > radius)\n  {\n    let delta: f32 = dist - radius;\n    let gap: f32 = gradient;\n    let scale: f32 = 1.0 - abs(delta / gap);\n    if (scale <= 0.0) {\n      returnColorOnly = true;\n    }\n    radianStep *= scale;\n  }\n\n  radianStep /= f32(k);\n\n  let s: f32 = sin(radianStep);\n  let c: f32 = cos(radianStep);\n  let rotationMatrix: mat2x2<f32> = mat2x2<f32>(vec2<f32>(c, -s), vec2<f32>(s, c));\n  \n  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let baseColor = vec4<f32>(color);\n\n  let minK: i32 = min(i32(uKernelSize) - 1, MAX_KERNEL_SIZE - 1);\n\n  for(var i: i32 = 0; i < minK; i += 1) \n  {\n    coord -= center;\n    coord.y *= aspect;\n    coord = rotationMatrix * coord;\n    coord.y /= aspect;\n    coord += center;\n    let sample: vec4<f32> = textureSample(uTexture, uSampler, coord);\n    // switch to pre-multiplied alpha to correctly blur transparent images\n    // sample.rgb *= sample.a;\n    color += sample;\n  }\n\n  return select(color / f32(uKernelSize), baseColor, returnColorOnly);\n}\n\nconst MAX_KERNEL_SIZE: i32 = 2048;",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uRadian;\nuniform vec2 uCenter;\nuniform float uRadius;\nuniform int uKernelSize;\n\nuniform vec4 uInputSize;\n\nconst int MAX_KERNEL_SIZE = 2048;\n\nvoid main(void)\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n\n    if (uKernelSize == 0)\n    {\n        finalColor = color;\n        return;\n    }\n\n    float aspect = uInputSize.y / uInputSize.x;\n    vec2 center = uCenter.xy / uInputSize.xy;\n    float gradient = uRadius / uInputSize.x * 0.3;\n    float radius = uRadius / uInputSize.x - gradient * 0.5;\n    int k = uKernelSize - 1;\n\n    vec2 coord = vTextureCoord;\n    vec2 dir = vec2(center - coord);\n    float dist = length(vec2(dir.x, dir.y * aspect));\n\n    float radianStep = uRadian;\n    if (radius >= 0.0 && dist > radius) {\n        float delta = dist - radius;\n        float gap = gradient;\n        float scale = 1.0 - abs(delta / gap);\n        if (scale <= 0.0) {\n            finalColor = color;\n            return;\n        }\n        radianStep *= scale;\n    }\n    radianStep /= float(k);\n\n    float s = sin(radianStep);\n    float c = cos(radianStep);\n    mat2 rotationMatrix = mat2(vec2(c, -s), vec2(s, c));\n\n    for(int i = 0; i < MAX_KERNEL_SIZE - 1; i++) {\n        if (i == k) {\n            break;\n        }\n\n        coord -= center;\n        coord.y *= aspect;\n        coord = rotationMatrix * coord;\n        coord.y /= aspect;\n        coord += center;\n\n        vec4 sample = texture(uTexture, coord);\n\n        // switch to pre-multiplied alpha to correctly blur transparent images\n        // sample.rgb *= sample.a;\n\n        color += sample;\n    }\n\n    finalColor = color / float(uKernelSize);\n}\n",name:"radial-blur-filter"}),resources:{radialBlurUniforms:{uRadian:{value:0,type:"f32"},uCenter:{value:r.center,type:"vec2<f32>"},uKernelSize:{value:r.kernelSize,type:"i32"},uRadius:{value:r.radius,type:"f32"}}}}),ov(this,"uniforms"),ov(this,"_angle"),ov(this,"_kernelSize"),this.uniforms=this.resources.radialBlurUniforms.uniforms,Object.assign(this,r)}_updateKernelSize(){this.uniforms.uKernelSize=0!==this._angle?this.kernelSize:0}get angle(){return this._angle}set angle(e){this._angle=e,this.uniforms.uRadian=e*Math.PI/180,this._updateKernelSize()}get center(){return this.uniforms.uCenter}set center(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uCenter=e}get centerX(){return this.center.x}set centerX(e){this.center.x=e}get centerY(){return this.center.y}set centerY(e){this.center.y=e}get kernelSize(){return this._kernelSize}set kernelSize(e){this._kernelSize=e,this._updateKernelSize()}get radius(){return this.uniforms.uRadius}set radius(e){this.uniforms.uRadius=e<0||e===1/0?-1:e}};ov(oy,"DEFAULT_OPTIONS",{angle:0,center:{x:0,y:0},kernelSize:5,radius:-1});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),ox=Object.defineProperty,ob=(e,t,r)=>t in e?ox(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o_=(e,t,r)=>(ob(e,"symbol"!=typeof t?t+"":t,r),r);const oS=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct ReflectionUniforms {\n  uMirror: f32,\n  uBoundary: f32,\n  uAmplitude: vec2<f32>,\n  uWavelength: vec2<f32>,\n  uAlpha: vec2<f32>,\n  uTime: f32,\n  uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> reflectionUniforms : ReflectionUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uDimensions: vec2<f32> = reflectionUniforms.uDimensions;\n  let uBoundary: f32 = reflectionUniforms.uBoundary;\n  let uMirror: bool = reflectionUniforms.uMirror > 0.5;\n  let uAmplitude: vec2<f32> = reflectionUniforms.uAmplitude;\n  let uWavelength: vec2<f32> = reflectionUniforms.uWavelength;\n  let uAlpha: vec2<f32> = reflectionUniforms.uAlpha;\n  let uTime: f32 = reflectionUniforms.uTime;\n\n  let pixelCoord: vec2<f32> = uv * gfu.uInputSize.xy;\n  let coord: vec2<f32> = pixelCoord /uDimensions;\n  var returnColorOnly: bool = false;\n\n  if (coord.y < uBoundary) {\n    returnColorOnly = true;\n  }\n\n  let k: f32 = (coord.y - uBoundary) / (1. - uBoundary + 0.0001);\n  let areaY: f32 = uBoundary * uDimensions.y / gfu.uInputSize.y;\n  let v: f32 = areaY + areaY - uv.y;\n  let y: f32 = select(uv.y, v, uMirror);\n\n  let amplitude: f32 = ((uAmplitude.y - uAmplitude.x) * k + uAmplitude.x ) / gfu.uInputSize.x;\n  let waveLength: f32 = ((uWavelength.y - uWavelength.x) * k + uWavelength.x) / gfu.uInputSize.y;\n  let alpha: f32 = select((uAlpha.y - uAlpha.x) * k + uAlpha.x, 1., returnColorOnly);\n\n  var x: f32 = uv.x + cos(v * 6.28 / waveLength - uTime) * amplitude;\n  x = clamp(x, gfu.uInputClamp.x, gfu.uInputClamp.z);\n  \n  return textureSample(uTexture, uSampler, select(vec2<f32>(x, y), uv, returnColorOnly)) * alpha;\n}\n\nfn rand(co: vec2<f32>) -> f32 \n{\n  return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uMirror;\nuniform float uBoundary;\nuniform vec2 uAmplitude;\nuniform vec2 uWavelength;\nuniform vec2 uAlpha;\nuniform float uTime;\nuniform vec2 uDimensions;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    vec2 pixelCoord = vTextureCoord.xy * uInputSize.xy;\n    vec2 coord = pixelCoord / uDimensions;\n\n    if (coord.y < uBoundary) {\n        finalColor = texture(uTexture, vTextureCoord);\n        return;\n    }\n\n    float k = (coord.y - uBoundary) / (1. - uBoundary + 0.0001);\n    float areaY = uBoundary * uDimensions.y / uInputSize.y;\n    float v = areaY + areaY - vTextureCoord.y;\n    float y = uMirror > 0.5 ? v : vTextureCoord.y;\n\n    float _amplitude = ((uAmplitude.y - uAmplitude.x) * k + uAmplitude.x ) / uInputSize.x;\n    float _waveLength = ((uWavelength.y - uWavelength.x) * k + uWavelength.x) / uInputSize.y;\n    float _alpha = (uAlpha.y - uAlpha.x) * k + uAlpha.x;\n\n    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - uTime) * _amplitude;\n    x = clamp(x, uInputClamp.x, uInputClamp.z);\n\n    vec4 color = texture(uTexture, vec2(x, y));\n\n    finalColor = color * _alpha;\n}\n",name:"reflection-filter"}),resources:{reflectionUniforms:{uMirror:{value:t.mirror?1:0,type:"f32"},uBoundary:{value:t.boundary,type:"f32"},uAmplitude:{value:t.amplitude,type:"vec2<f32>"},uWavelength:{value:t.waveLength,type:"vec2<f32>"},uAlpha:{value:t.alpha,type:"vec2<f32>"},uTime:{value:t.time,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),o_(this,"uniforms"),o_(this,"time",0),this.uniforms=this.resources.reflectionUniforms.uniforms,Object.assign(this,t)}apply(e,t,r,n){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,this.uniforms.uTime=this.time,e.applyFilter(this,t,r,n)}get mirror(){return this.uniforms.uMirror>.5}set mirror(e){this.uniforms.uMirror=e?1:0}get boundary(){return this.uniforms.uBoundary}set boundary(e){this.uniforms.uBoundary=e}get amplitude(){return Array.from(this.uniforms.uAmplitude)}set amplitude(e){this.uniforms.uAmplitude[0]=e[0],this.uniforms.uAmplitude[1]=e[1]}get amplitudeStart(){return this.uniforms.uAmplitude[0]}set amplitudeStart(e){this.uniforms.uAmplitude[0]=e}get amplitudeEnd(){return this.uniforms.uAmplitude[1]}set amplitudeEnd(e){this.uniforms.uAmplitude[1]=e}get waveLength(){return Array.from(this.uniforms.uWavelength)}set waveLength(e){this.uniforms.uWavelength[0]=e[0],this.uniforms.uWavelength[1]=e[1]}get wavelengthStart(){return this.uniforms.uWavelength[0]}set wavelengthStart(e){this.uniforms.uWavelength[0]=e}get wavelengthEnd(){return this.uniforms.uWavelength[1]}set wavelengthEnd(e){this.uniforms.uWavelength[1]=e}get alpha(){return Array.from(this.uniforms.uAlpha)}set alpha(e){this.uniforms.uAlpha[0]=e[0],this.uniforms.uAlpha[1]=e[1]}get alphaStart(){return this.uniforms.uAlpha[0]}set alphaStart(e){this.uniforms.uAlpha[0]=e}get alphaEnd(){return this.uniforms.uAlpha[1]}set alphaEnd(e){this.uniforms.uAlpha[1]=e}};o_(oS,"DEFAULT_OPTIONS",{mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0});var ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),oC=Object.defineProperty,ow=(e,t,r)=>t in e?oC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oT=(e,t,r)=>(ow(e,"symbol"!=typeof t?t+"":t,r),r);const oP=class e extends td.Filter{constructor(...t){let r=t[0]??{};(Array.isArray(r)||"x"in r&&"y"in r)&&((0,ep.deprecation)("6.0.0","RGBSplitFilter constructor params are now options object. See params: { red, green, blue }"),r={red:r},void 0!==t[1]&&(r.green=t[1]),void 0!==t[2]&&(r.blue=t[2])),r={...e.DEFAULT_OPTIONS,...r},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct RgbSplitUniforms {\n    uRed: vec2<f32>,\n    uGreen: vec2<f32>,\n    uBlue: vec3<f32>,\n};\n\nstruct GlobalFilterUniforms {\n    uInputSize:vec4<f32>,\n    uInputPixel:vec4<f32>,\n    uInputClamp:vec4<f32>,\n    uOutputFrame:vec4<f32>,\n    uGlobalFrame:vec4<f32>,\n    uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> rgbSplitUniforms : RgbSplitUniforms;\n\n@fragment\nfn mainFragment(\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n    let r = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uRed.x / gfu.uInputSize.x, rgbSplitUniforms.uRed.y / gfu.uInputSize.y)).r;\n    let g = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uGreen.x / gfu.uInputSize.x, rgbSplitUniforms.uGreen.y / gfu.uInputSize.y)).g;\n    let b = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uBlue.x / gfu.uInputSize.x, rgbSplitUniforms.uBlue.y / gfu.uInputSize.y)).b;\n    let a = textureSample(uTexture, uSampler, uv).a;\n    return vec4<f32>(r, g, b, a);\n}\n",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec4 uInputSize;\nuniform vec2 uRed;\nuniform vec2 uGreen;\nuniform vec2 uBlue;\n\nvoid main(void)\n{\n   float r = texture(uTexture, vTextureCoord + uRed/uInputSize.xy).r;\n   float g = texture(uTexture, vTextureCoord + uGreen/uInputSize.xy).g;\n   float b = texture(uTexture, vTextureCoord + uBlue/uInputSize.xy).b;\n   float a = texture(uTexture, vTextureCoord).a;\n   finalColor = vec4(r, g, b, a);\n}\n",name:"rgb-split-filter"}),resources:{rgbSplitUniforms:{uRed:{value:r.red,type:"vec2<f32>"},uGreen:{value:r.green,type:"vec2<f32>"},uBlue:{value:r.blue,type:"vec2<f32>"}}}}),oT(this,"uniforms"),this.uniforms=this.resources.rgbSplitUniforms.uniforms,Object.assign(this,r)}get red(){return this.uniforms.uRed}set red(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uRed=e}get redX(){return this.red.x}set redX(e){this.red.x=e}get redY(){return this.red.y}set redY(e){this.red.y=e}get green(){return this.uniforms.uGreen}set green(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uGreen=e}get greenX(){return this.green.x}set greenX(e){this.green.x=e}get greenY(){return this.green.y}set greenY(e){this.green.y=e}get blue(){return this.uniforms.uBlue}set blue(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uBlue=e}get blueX(){return this.blue.x}set blueX(e){this.blue.x=e}get blueY(){return this.blue.y}set blueY(e){this.blue.y=e}};oT(oP,"DEFAULT_OPTIONS",{red:{x:-10,y:0},green:{x:0,y:10},blue:{x:0,y:0}});var ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),oA=Object.defineProperty,ok=(e,t,r)=>t in e?oA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oM=(e,t,r)=>(ok(e,"symbol"!=typeof t?t+"":t,r),r);const oR=class e extends td.Filter{constructor(...t){let r=t[0]??{};(Array.isArray(r)||"x"in r&&"y"in r)&&((0,ep.deprecation)("6.0.0","ShockwaveFilter constructor params are now options object. See params: { center, speed, amplitude, wavelength, brightness, radius, time }"),r={center:r,...t[1]},void 0!==t[2]&&(r.time=t[2])),r={...e.DEFAULT_OPTIONS,...r},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"\nstruct ShockWaveUniforms {\n    uTime: f32,\n    uOffset: vec2<f32>,\n    uSpeed: f32,\n    uWave: vec4<f32>,\n};\n\nstruct GlobalFilterUniforms {\n    uInputSize:vec4<f32>,\n    uInputPixel:vec4<f32>,\n    uInputClamp:vec4<f32>,\n    uOutputFrame:vec4<f32>,\n    uGlobalFrame:vec4<f32>,\n    uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> shockwaveUniforms : ShockWaveUniforms;\n\n@fragment\nfn mainFragment(\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n\n    let uTime = shockwaveUniforms.uTime;\n    let uOffset = shockwaveUniforms.uOffset;\n    let uSpeed = shockwaveUniforms.uSpeed;\n    let uAmplitude = shockwaveUniforms.uWave[0];\n    let uWavelength = shockwaveUniforms.uWave[1];\n    let uBrightness = shockwaveUniforms.uWave[2];\n    let uRadius = shockwaveUniforms.uWave[3];\n    let halfWavelength: f32 = uWavelength * 0.5 / gfu.uInputSize.x;\n    let maxRadius: f32 = uRadius / gfu.uInputSize.x;\n    let currentRadius: f32 = uTime * uSpeed / gfu.uInputSize.x;\n    var fade: f32 = 1.0;\n    var returnColorOnly: bool = false;\n    \n    if (maxRadius > 0.0) {\n        if (currentRadius > maxRadius) {\n            returnColorOnly = true;\n        }\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\n    }\n    var dir: vec2<f32> = vec2<f32>(uv - uOffset / gfu.uInputSize.xy);\n    dir.y *= gfu.uInputSize.y / gfu.uInputSize.x;\n\n    let dist:f32 = length(dir);\n\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\n        returnColorOnly = true;\n    }\n\n    let diffUV: vec2<f32> = normalize(dir);\n    let diff: f32 = (dist - currentRadius) / halfWavelength;\n    let p: f32 = 1.0 - pow(abs(diff), 2.0);\n    let powDiff: f32 = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );\n    let offset: vec2<f32> = diffUV * powDiff / gfu.uInputSize.xy;\n    // Do clamp :\n    let coord: vec2<f32> = uv + offset;\n    let clampedCoord: vec2<f32> = clamp(coord, gfu.uInputClamp.xy, gfu.uInputClamp.zw);\n\n    var clampedColor: vec4<f32> = textureSample(uTexture, uSampler, clampedCoord);\n    \n    if (boolVec2(coord, clampedCoord)) \n    {\n        clampedColor *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n    // No clamp :\n    var finalColor = clampedColor;\n\n    return select(finalColor, textureSample(uTexture, uSampler, uv), returnColorOnly);\n}\n\nfn boolVec2(x: vec2<f32>, y: vec2<f32>) -> bool\n{\n    if (x.x == y.x && x.y == y.y)\n    {\n        return true;\n    }\n    \n    return false;\n}\n\nconst PI: f32 = 3.14159265358979323846264;\n",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"\nprecision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uCenter;\nuniform float uTime;\nuniform float uSpeed;\nuniform vec4 uWave;\n\nuniform vec4 uInputSize;\nuniform vec4 uInputClamp;\n\nconst float PI = 3.14159;\n\nvoid main()\n{\n    float uAmplitude = uWave[0];\n    float uWavelength = uWave[1];\n    float uBrightness = uWave[2];\n    float uRadius = uWave[3];\n\n    float halfWavelength = uWavelength * 0.5 / uInputSize.x;\n    float maxRadius = uRadius / uInputSize.x;\n    float currentRadius = uTime * uSpeed / uInputSize.x;\n\n    float fade = 1.0;\n\n    if (maxRadius > 0.0) {\n        if (currentRadius > maxRadius) {\n            finalColor = texture(uTexture, vTextureCoord);\n            return;\n        }\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\n    }\n\n    vec2 dir = vec2(vTextureCoord - uCenter / uInputSize.xy);\n    dir.y *= uInputSize.y / uInputSize.x;\n    float dist = length(dir);\n\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\n        finalColor = texture(uTexture, vTextureCoord);\n        return;\n    }\n\n    vec2 diffUV = normalize(dir);\n\n    float diff = (dist - currentRadius) / halfWavelength;\n\n    float p = 1.0 - pow(abs(diff), 2.0);\n\n    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );\n    float powDiff = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );\n\n    vec2 offset = diffUV * powDiff / uInputSize.xy;\n\n    // Do clamp :\n    vec2 coord = vTextureCoord + offset;\n    vec2 clampedCoord = clamp(coord, uInputClamp.xy, uInputClamp.zw);\n    vec4 color = texture(uTexture, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    // No clamp :\n    // finalColor = texture(uTexture, vTextureCoord + offset);\n\n    color.rgb *= 1.0 + (uBrightness - 1.0) * p * fade;\n\n    finalColor = color;\n}\n",name:"shockwave-filter"}),resources:{shockwaveUniforms:{uTime:{value:r.time,type:"f32"},uCenter:{value:r.center,type:"vec2<f32>"},uSpeed:{value:r.speed,type:"f32"},uWave:{value:new Float32Array(4),type:"vec4<f32>"}}}}),oM(this,"uniforms"),oM(this,"time"),this.time=0,this.uniforms=this.resources.shockwaveUniforms.uniforms,Object.assign(this,r)}apply(e,t,r,n){this.uniforms.uTime=this.time,e.applyFilter(this,t,r,n)}get center(){return this.uniforms.uCenter}set center(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uCenter=e}get centerX(){return this.uniforms.uCenter.x}set centerX(e){this.uniforms.uCenter.x=e}get centerY(){return this.uniforms.uCenter.y}set centerY(e){this.uniforms.uCenter.y=e}get speed(){return this.uniforms.uSpeed}set speed(e){this.uniforms.uSpeed=e}get amplitude(){return this.uniforms.uWave[0]}set amplitude(e){this.uniforms.uWave[0]=e}get wavelength(){return this.uniforms.uWave[1]}set wavelength(e){this.uniforms.uWave[1]=e}get brightness(){return this.uniforms.uWave[2]}set brightness(e){this.uniforms.uWave[2]=e}get radius(){return this.uniforms.uWave[3]}set radius(e){this.uniforms.uWave[3]=e}};oM(oR,"DEFAULT_OPTIONS",{center:{x:0,y:0},speed:500,amplitude:30,wavelength:160,brightness:1,radius:-1});var tu=et("AHTcQ"),ep=et("eX50w"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),ex=et("5h88T"),oI=Object.defineProperty,oE=(e,t,r)=>t in e?oI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oO=(e,t,r)=>(oE(e,"symbol"!=typeof t?t+"":t,r),r);const oz=class e extends td.Filter{constructor(...t){let r=t[0]??{};if(r instanceof ex.Texture&&((0,ep.deprecation)("6.0.0","SimpleLightmapFilter constructor params are now options object. See params: { lightMap, color, alpha }"),r={lightMap:r},void 0!==t[1]&&(r.color=t[1]),void 0!==t[2]&&(r.alpha=t[2])),!(r={...e.DEFAULT_OPTIONS,...r}).lightMap)throw Error("No light map texture source was provided to SimpleLightmapFilter");super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct SimpleLightmapUniforms {\n  uColor: vec3<f32>,\n  uAlpha: f32,\n  uDimensions: vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> simpleLightmapUniforms : SimpleLightmapUniforms;\n@group(1) @binding(1) var uMapTexture: texture_2d<f32>;\n@group(1) @binding(2) var uMapSampler: sampler;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>,\n) -> @location(0) vec4<f32> {\n  let uColor = simpleLightmapUniforms.uColor;\n  let uAlpha = simpleLightmapUniforms.uAlpha;\n  let uDimensions = simpleLightmapUniforms.uDimensions;\n\n  let diffuseColor: vec4<f32> = textureSample(uTexture, uSampler, uv);\n  let lightCoord: vec2<f32> = (uv * gfu.uInputSize.xy) / simpleLightmapUniforms.uDimensions;\n  let light: vec4<f32> = textureSample(uMapTexture, uMapSampler, lightCoord);\n  let ambient: vec3<f32> = uColor * uAlpha;\n  let intensity: vec3<f32> = ambient + light.rgb;\n  let finalColor: vec3<f32> = diffuseColor.rgb * intensity;\n  return vec4<f32>(finalColor, diffuseColor.a);\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMapTexture;\nuniform vec3 uColor;\nuniform float uAlpha;\nuniform vec2 uDimensions;\n\nuniform vec4 uInputSize;\n\nvoid main() {\n    vec4 diffuseColor = texture(uTexture, vTextureCoord);\n    vec2 lightCoord = (vTextureCoord * uInputSize.xy) / uDimensions;\n    vec4 light = texture(uMapTexture, lightCoord);\n    vec3 ambient = uColor.rgb * uAlpha;\n    vec3 intensity = ambient + light.rgb;\n    vec3 color = diffuseColor.rgb * intensity;\n    finalColor = vec4(color, diffuseColor.a);\n}\n",name:"simple-lightmap-filter"}),resources:{simpleLightmapUniforms:{uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:r.alpha,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}},uMapTexture:r.lightMap.source,uMapSampler:r.lightMap.source.style}}),oO(this,"uniforms"),oO(this,"_color"),oO(this,"_lightMap"),this.uniforms=this.resources.simpleLightmapUniforms.uniforms,this._color=new tu.Color,this.color=r.color??0,Object.assign(this,r)}apply(e,t,r,n){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,e.applyFilter(this,t,r,n)}get lightMap(){return this._lightMap}set lightMap(e){this._lightMap=e,this.resources.uMapTexture=e.source,this.resources.uMapSampler=e.source.style}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,n]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=n}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};oO(oz,"DEFAULT_OPTIONS",{lightMap:ex.Texture.WHITE,color:0,alpha:1});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),oF=Object.defineProperty,oU=(e,t,r)=>t in e?oF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oD=(e,t,r)=>(oU(e,"symbol"!=typeof t?t+"":t,r),r);const oB=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct TiltShiftUniforms {\n  uBlur: vec2<f32>,\n  uStart: vec2<f32>,\n  uEnd: vec2<f32>,\n  uDelta: vec2<f32>,\n  uTexSize: vec2<f32>,\n};\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> tiltShiftUniforms : TiltShiftUniforms;\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uBlur = tiltShiftUniforms.uBlur[0];\n  let uBlurGradient = tiltShiftUniforms.uBlur[1];\n  let uStart = tiltShiftUniforms.uStart;\n  let uEnd = tiltShiftUniforms.uEnd;\n  let uDelta = tiltShiftUniforms.uDelta;\n  let uTexSize = tiltShiftUniforms.uTexSize;\n\n  var color: vec4<f32> = vec4<f32>(0.0);\n  var total: f32 = 0.0;\n\n  let offset: f32 = random(position, vec3<f32>(12.9898, 78.233, 151.7182), 0.0);\n  let normal: vec2<f32> = normalize(vec2<f32>(uStart.y - uEnd.y, uEnd.x - uStart.x));\n  let radius: f32 = smoothstep(0.0, 1.0, abs(dot(uv * uTexSize - uStart, normal)) / uBlurGradient) * uBlur;\n\n  for (var t: f32 = -30.0; t <= 30.0; t += 1.0)\n  {\n    var percent: f32 = (t + offset - 0.5) / 30.0;\n    var weight: f32 = 1.0 - abs(percent);\n    var sample: vec4<f32> = textureSample(uTexture, uSampler, uv + uDelta / uTexSize * percent * radius);\n    sample = vec4<f32>(sample.xyz * sample.a, sample.a); // multiply sample.rgb with sample.a\n    color += sample * weight;\n    total += weight;\n  }\n\n  color /= total;\n  color = vec4<f32>(color.xyz / (color.a + 0.00001), color.a); // divide color.rgb by color.a + 0.00001\n\n  return color;\n}\n\n\nfn random(position: vec4<f32>, scale: vec3<f32>, seed: f32) -> f32\n{\n  return fract(sin(dot(position.xyz + seed, scale)) * 43758.5453 + seed);\n}",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uBlur;\nuniform vec2 uStart;\nuniform vec2 uEnd;\nuniform vec2 uDelta;\nuniform vec2 uTexSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float blur = uBlur[0];\n    float gradientBlur = uBlur[1];\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(uStart.y - uEnd.y, uEnd.x - uStart.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * uTexSize - uStart, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture(uTexture, vTextureCoord + uDelta / uTexSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    color /= total;\n    color.rgb /= color.a + 0.00001;\n\n    finalColor = color;\n}\n",name:"tilt-shift-axis-filter"}),resources:{tiltShiftUniforms:{uBlur:{value:new Float32Array([t.blur??100,t.gradientBlur??600]),type:"vec2<f32>"},uStart:{value:t.start,type:"vec2<f32>"},uEnd:{value:t.end,type:"vec2<f32>"},uDelta:{value:new Float32Array([30,30]),type:"vec2<f32>"},uTexSize:{value:new Float32Array([window.innerWidth,window.innerHeight]),type:"vec2<f32>"}}}}),oD(this,"uniforms"),oD(this,"_tiltAxis"),this.uniforms=this.resources.tiltShiftUniforms.uniforms,this._tiltAxis=t.axis,this.updateDelta()}updateDelta(){if(this.uniforms.uDelta[0]=0,this.uniforms.uDelta[1]=0,void 0===this._tiltAxis)return;let e=this.uniforms.uEnd,t=this.uniforms.uStart,r=e.x-t.x,n=e.y-t.y,i=Math.sqrt(r*r+n*n),s="vertical"===this._tiltAxis;this.uniforms.uDelta[0]=s?-n/i:r/i,this.uniforms.uDelta[1]=s?r/i:n/i}};oD(oB,"DEFAULT_OPTIONS",{blur:100,gradientBlur:600,start:{x:0,y:window.innerHeight/2},end:{x:600,y:window.innerHeight/2}});var tv=et("7U2uj"),td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),oL=Object.defineProperty,oG=(e,t,r)=>t in e?oL(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oj=(e,t,r)=>(oG(e,"symbol"!=typeof t?t+"":t,r),r);const oN=class e extends td.Filter{constructor(t){t={...e.DEFAULT_OPTIONS,...t},super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct TwistUniforms {\n  uTwist:vec2<f32>,\n  uOffset:vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> twistUniforms : TwistUniforms;\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n  return textureSample(uTexture, uSampler, unmapCoord(twist(mapCoord(uv))));\n}\n\nfn mapCoord(coord: vec2<f32> ) -> vec2<f32>\n{\n  var mappedCoord: vec2<f32> = coord;\n  mappedCoord *= gfu.uInputSize.xy;\n  mappedCoord += gfu.uOutputFrame.xy;\n  return mappedCoord;\n}\n\nfn unmapCoord(coord: vec2<f32> ) -> vec2<f32>\n{\n  var mappedCoord: vec2<f32> = coord;\n  mappedCoord -= gfu.uOutputFrame.xy;\n  mappedCoord /= gfu.uInputSize.xy;\n  return mappedCoord;\n}\n\nfn twist(coord: vec2<f32>) -> vec2<f32>\n{\n  var twistedCoord: vec2<f32> = coord;\n  let uRadius = twistUniforms.uTwist[0];\n  let uAngle = twistUniforms.uTwist[1];\n  let uOffset = twistUniforms.uOffset;\n\n  twistedCoord -= uOffset;\n  \n  let dist = length(twistedCoord);\n\n  if (dist < uRadius)\n  {\n    let ratioDist: f32 = (uRadius - dist) / uRadius;\n    let angleMod: f32 = ratioDist * ratioDist * uAngle;\n    let s: f32 = sin(angleMod);\n    let c: f32 = cos(angleMod);\n    twistedCoord = vec2<f32>(twistedCoord.x * c - twistedCoord.y * s, twistedCoord.x * s + twistedCoord.y * c);\n  }\n\n  twistedCoord += uOffset;\n  return twistedCoord;\n}\n",entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform vec2 uTwist;\nuniform vec2 uOffset;\nuniform vec4 uInputSize;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= uInputSize.xy;\n    coord += uInputSize.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= uInputSize.zw;\n    coord /= uInputSize.xy;\n\n    return coord;\n}\n\nvec2 twist(vec2 coord)\n{\n    coord -= uOffset;\n\n    float dist = length(coord);\n    float uRadius = uTwist[0];\n    float uAngle = uTwist[1];\n\n    if (dist < uRadius)\n    {\n        float ratioDist = (uRadius - dist) / uRadius;\n        float angleMod = ratioDist * ratioDist * uAngle;\n        float s = sin(angleMod);\n        float c = cos(angleMod);\n        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n    }\n\n    coord += uOffset;\n\n    return coord;\n}\n\nvoid main(void)\n{\n    vec2 coord = mapCoord(vTextureCoord);\n    coord = twist(coord);\n    coord = unmapCoord(coord);\n    finalColor = texture(uTexture, coord);\n}\n",name:"twist-filter"}),resources:{twistUniforms:{uTwist:{value:[t.radius??0,t.angle??0],type:"vec2<f32>"},uOffset:{value:t.offset,type:"vec2<f32>"}}},...t}),oj(this,"uniforms"),this.uniforms=this.resources.twistUniforms.uniforms}get radius(){return this.uniforms.uTwist[0]}set radius(e){this.uniforms.uTwist[0]=e}get angle(){return this.uniforms.uTwist[1]}set angle(e){this.uniforms.uTwist[1]=e}get offset(){return this.uniforms.uOffset}set offset(e){this.uniforms.uOffset=e}get offsetX(){return this.offset.x}set offsetX(e){this.offset.x=e}get offsetY(){return this.offset.y}set offsetY(e){this.offset.y=e}};oj(oN,"DEFAULT_OPTIONS",{padding:20,radius:200,angle:4,offset:{x:0,y:0}});var td=et("hskgj"),tc=et("2AaNu"),th=et("9IRF4"),oV=Object.defineProperty,oX=(e,t,r)=>t in e?oV(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oY=(e,t,r)=>(oX(e,"symbol"!=typeof t?t+"":t,r),r);const oH=class e extends td.Filter{constructor(t){let r=(t={...e.DEFAULT_OPTIONS,...t}).maxKernelSize??32;super({gpuProgram:(0,th.GpuProgram).from({vertex:{source:iY,entryPoint:"mainVertex"},fragment:{source:"struct ZoomBlurUniforms {\n    uStrength:f32,\n    uCenter:vec2<f32>,\n    uRadii:vec2<f32>,\n};\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n\n@group(0) @binding(1) var uTexture: texture_2d<f32>; \n@group(0) @binding(2) var uSampler: sampler;\n@group(1) @binding(0) var<uniform> zoomBlurUniforms : ZoomBlurUniforms;\n\n@fragment\nfn mainFragment(\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n) -> @location(0) vec4<f32> {\n  let uStrength = zoomBlurUniforms.uStrength;\n  let uCenter = zoomBlurUniforms.uCenter;\n  let uRadii = zoomBlurUniforms.uRadii;\n\n  let minGradient: f32 = uRadii[0] * 0.3;\n  let innerRadius: f32 = (uRadii[0] + minGradient * 0.5) / gfu.uInputSize.x;\n\n  let gradient: f32 = uRadii[1] * 0.3;\n  let radius: f32 = (uRadii[1] - gradient * 0.5) / gfu.uInputSize.x;\n\n  let MAX_KERNEL_SIZE: f32 = ${MAX_KERNEL_SIZE};\n\n  var countLimit: f32 = MAX_KERNEL_SIZE;\n\n  var dir: vec2<f32> = vec2<f32>(uCenter / gfu.uInputSize.xy - uv);\n  let dist: f32 = length(vec2<f32>(dir.x, dir.y * gfu.uInputSize.y / gfu.uInputSize.x));\n\n  var strength: f32 = uStrength;\n\n  var delta: f32 = 0.0;\n  var gap: f32;\n\n  if (dist < innerRadius) {\n      delta = innerRadius - dist;\n      gap = minGradient;\n  } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity\n      delta = dist - radius;\n      gap = gradient;\n  }\n\n  var returnColorOnly: bool = false;\n\n  if (delta > 0.0) {\n    let normalCount: f32 = gap / gfu.uInputSize.x;\n    delta = (normalCount - delta) / normalCount;\n    countLimit *= delta;\n    strength *= delta;\n    \n    if (countLimit < 1.0)\n    {\n      returnColorOnly = true;;\n    }\n  }\n\n  // randomize the lookup values to hide the fixed number of samples\n  let offset: f32 = rand(uv, 0.0);\n\n  var total: f32 = 0.0;\n  var color: vec4<f32> = vec4<f32>(0.);\n\n  dir *= strength;\n\n  for (var t = 0.0; t < MAX_KERNEL_SIZE; t += 1.0) {\n    let percent: f32 = (t + offset) / MAX_KERNEL_SIZE;\n    let weight: f32 = 4.0 * (percent - percent * percent);\n    let p: vec2<f32> = uv + dir * percent;\n    let sample: vec4<f32> = textureSample(uTexture, uSampler, p);\n    \n    if (t < countLimit)\n    {\n      color += sample * weight;\n      total += weight;\n    }\n  }\n\n  color /= total;\n\n  return select(color, textureSample(uTexture, uSampler, uv), returnColorOnly);\n}\n\nfn modulo(x: f32, y: f32) -> f32\n{\n  return x - y * floor(x/y);\n}\n\n// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nfn rand(co: vec2<f32>, seed: f32) -> f32\n{\n  let a: f32 = 12.9898;\n  let b: f32 = 78.233;\n  let c: f32 = 43758.5453;\n  let dt: f32 = dot(co + seed, vec2<f32>(a, b));\n  let sn: f32 = modulo(dt, 3.14159);\n  return fract(sin(sn) * c + seed);\n}".replace("${MAX_KERNEL_SIZE}",r.toFixed(1)),entryPoint:"mainFragment"}}),glProgram:(0,tc.GlProgram).from({vertex:iX,fragment:"precision highp float;\nin vec2 vTextureCoord;\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform float uStrength;\nuniform vec2 uCenter;\nuniform vec2 uRadii;\n\nuniform vec4 uInputSize;\n\nconst float MAX_KERNEL_SIZE = ${MAX_KERNEL_SIZE};\n\n// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand(vec2 co, float seed) {\n    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);\n    return fract(sin(sn) * c + seed);\n}\n\nvoid main() {\n    float minGradient = uRadii[0] * 0.3;\n    float innerRadius = (uRadii[0] + minGradient * 0.5) / uInputSize.x;\n\n    float gradient = uRadii[1] * 0.3;\n    float radius = (uRadii[1] - gradient * 0.5) / uInputSize.x;\n\n    float countLimit = MAX_KERNEL_SIZE;\n\n    vec2 dir = vec2(uCenter.xy / uInputSize.xy - vTextureCoord);\n    float dist = length(vec2(dir.x, dir.y * uInputSize.y / uInputSize.x));\n\n    float strength = uStrength;\n\n    float delta = 0.0;\n    float gap;\n    if (dist < innerRadius) {\n        delta = innerRadius - dist;\n        gap = minGradient;\n    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity\n        delta = dist - radius;\n        gap = gradient;\n    }\n\n    if (delta > 0.0) {\n        float normalCount = gap / uInputSize.x;\n        delta = (normalCount - delta) / normalCount;\n        countLimit *= delta;\n        strength *= delta;\n        if (countLimit < 1.0)\n        {\n            gl_FragColor = texture(uTexture, vTextureCoord);\n            return;\n        }\n    }\n\n    // randomize the lookup values to hide the fixed number of samples\n    float offset = rand(vTextureCoord, 0.0);\n\n    float total = 0.0;\n    vec4 color = vec4(0.0);\n\n    dir *= strength;\n\n    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {\n        float percent = (t + offset) / MAX_KERNEL_SIZE;\n        float weight = 4.0 * (percent - percent * percent);\n        vec2 p = vTextureCoord + dir * percent;\n        vec4 sample = texture(uTexture, p);\n\n        // switch to pre-multiplied alpha to correctly blur transparent images\n        // sample.rgb *= sample.a;\n\n        color += sample * weight;\n        total += weight;\n\n        if (t > countLimit){\n            break;\n        }\n    }\n\n    color /= total;\n    // switch back from pre-multiplied alpha\n    // color.rgb /= color.a + 0.00001;\n\n    gl_FragColor = color;\n}\n".replace("${MAX_KERNEL_SIZE}",r.toFixed(1)),name:"zoom-blur-filter"}),resources:{zoomBlurUniforms:{uStrength:{value:t.strength,type:"f32"},uCenter:{value:t.center,type:"vec2<f32>"},uRadii:{value:new Float32Array(2),type:"vec2<f32>"}}}}),oY(this,"uniforms"),this.uniforms=this.resources.zoomBlurUniforms.uniforms,Object.assign(this,t)}get strength(){return this.uniforms.uStrength}set strength(e){this.uniforms.uStrength=e}get center(){return this.uniforms.uCenter}set center(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uCenter=e}get centerX(){return this.uniforms.uCenter.x}set centerX(e){this.uniforms.uCenter.x=e}get centerY(){return this.uniforms.uCenter.y}set centerY(e){this.uniforms.uCenter.y=e}get innerRadius(){return this.uniforms.uRadii[0]}set innerRadius(e){this.uniforms.uRadii[0]=e}get radius(){return this.uniforms.uRadii[1]}set radius(e){this.uniforms.uRadii[1]=e<0||e===1/0?-1:e}};oY(oH,"DEFAULT_OPTIONS",{strength:.1,center:{x:0,y:0},innerRadius:0,radius:-1,maxKernelSize:32});const oW=e=>void 0!==e.update;var tP=et("C9JRY"),tA=et("9Qy7u");const oq=e=>void 0!==e.onStack;var tP=et("C9JRY"),tA=et("9Qy7u");const o$=e=>void 0!==e.onDrag;var ed=et("lR3Ev");class oK extends ed.Container{constructor(){super(),this.filters=[],this.filtersMap=new Map,gm.gameObjects.set(this.uid,this)}addFilter(e,t){this.filtersMap.has(e)||(this.filtersMap.set(e,t),this.filters=[...this.filters,t])}removeFilter(e){let t=this.filtersMap.get(e);this.filters=[...this.filters.filter(e=>e!==t)],this.filtersMap.delete(e)}}const oQ=e=>void 0!==e.flip;class oJ extends oK{constructor(e){super(),this.items=e,this.eventMode="dynamic",this.addFilter("deck-details",new sH({offset:{x:0,y:2*this.items.length*gm.camera.scale.x},color:13421772,blur:0,alpha:1})),this.on("pointerdown",()=>{this.onDragStart()}),this.on("pointerup",()=>{gm.dragTarget&&oq(gm.dragTarget)&&(this.onStack(gm.dragTarget),gm.room.send({type:"stack-object",message:{target:this.uid,object_to_stack:gm.dragTarget.uid}}))}),this.on("pointerover",()=>{"length"in this.filters&&this.addFilter("outline",new op({thickness:5,color:"yellow"})),this.cursor="grab",gm.target=this}),this.on("pointerout",()=>{"length"in this.filters&&this.removeFilter("outline"),gm.target=null}),this.currentGraphics=new tA.Sprite,this.currentGraphics.anchor.x=.5,this.currentGraphics.anchor.y=.5,this.addChild(this.currentGraphics),this.updateGraphics(),this.mmask=new(0,tP.Graphics)().roundRect(-this.currentGraphics.width/2,-this.currentGraphics.height/2,this.currentGraphics.width,this.currentGraphics.height,10).fill(4095),this.addChild(this.mmask),this.currentGraphics.mask=this.mmask,this.updateGraphics()}roll(e){for(var t=this.items.length-1;t>0;t--){var r=Math.floor(e()*(t+1)),n=this.items[t];this.items[t]=this.items[r],this.items[r]=n}this.updateGraphics()}flip(){this.items.forEach(e=>{oQ(e)&&e.flip()}),this.items.reverse(),this.updateGraphics()}updateGraphics(){this.currentGraphics.texture=this.items[this.items.length-1].currentGraphics.texture,this.currentGraphics.y=-(2*this.items.length),this.mmask&&(this.mmask.y=-(2*this.items.length)),this.currentGraphics.width=this.items[this.items.length-1].width,this.currentGraphics.height=this.items[this.items.length-1].height;let e=this.filtersMap.get("deck-details");e&&(e.offsetY=2*this.items.length*gm.camera.scale.x)}onTakeFromStack(){let e=this.items.pop();if(this.updateGraphics(),e&&(e.x=this.x,e.y=this.y,e.angle=this.angle,gm.camera.addChild(e)),1===this.items.length){let e=this.items.pop();e.x=this.x,e.y=this.y,e.angle=this.angle,gm.camera.addChild(e)}return 0===this.items.length&&this.destroy(),e||null}getItems(){return this.items}onDragStart(){if(iN.instance.keyboard.get("shift")===Q.HELD){gm.onDragStart(this);return}let e=this.onTakeFromStack();gm.room.send({type:"take-object-from-stack",message:{target:this.uid}}),o$(e)&&e.onDragStart()}onDrag(){}onDragEnd(){}onStack(e){this.items.push(...e.getItems()),this.updateGraphics(),e.removeFromParent()}}class oZ extends oK{constructor(e,t,r){super(),this.face=e,this.back=t,this.label=r,this.currentGraphics=new tA.Sprite({texture:e,width:200,height:280}),this.currentGraphics.anchor.x=.5,this.currentGraphics.anchor.y=.5;let n=new(0,tP.Graphics)().roundRect(-this.currentGraphics.width/2,-this.currentGraphics.height/2,this.currentGraphics.width,this.currentGraphics.height,10).fill(4095);this.addChild(n),this.currentGraphics.mask=n,this.addChild(this.currentGraphics),this.eventMode="static",this.on("pointerdown",this.onDragStart),this.on("pointerup",()=>{gm.dragTarget&&oq(gm.dragTarget)&&(this.onStack(gm.dragTarget),gm.room.send({type:"stack-object",message:{target:this.uid,object_to_stack:gm.dragTarget.uid}}))}),this.on("pointerover",()=>{this.addFilter("outline",new op({thickness:5,color:"yellow"})),this.cursor="grab",gm.target=this}),this.on("pointerout",()=>{this.removeFilter("outline"),gm.target=null}),console.log(this.uid)}onTakeFromStack(){throw Error("Method not implemented.")}flip(){this.currentGraphics.texture===this.face?this.currentGraphics.texture=this.back:this.currentGraphics.texture=this.face}getItems(){return[this]}onStack(e){let t=new oJ([this,...e.getItems()]),r=this.parent;this.removeFromParent(),e.removeFromParent(),r.addChild(t),t.x=this.x,t.y=this.y,t.angle=this.angle}onDragStart(){gm.onDragStart(this)}onDrag(){}onDragEnd(){}}const o0=e=>void 0!==e.roll;function o2(e){return function(){let t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}}class o1{constructor(e,t,r){this.app=e,this.camera=t,this.room=r,this.players=new Map,this.gameObjects=new Map,r.on("message",(e,{type:t,message:n})=>{switch(e!==r?.address()&&console.log(t),t){case"player-cursor":e!==r?.address()&&this.onPlayerCursor(e,n);break;case"move-start-object":if(e!==r?.address()){let e=this.gameObjects.get(n.target);e&&this.onMoveStart(e)}break;case"move-object":e!==r?.address()&&this.onObjectMove(e,n);break;case"move-end-object":if(e!==r?.address()){let e=this.gameObjects.get(n.target);e&&this.onMoveEnd(e)}break;case"rotate-object":if(e!==r?.address()){let e=this.gameObjects.get(n.target);e&&(e.angle=n.angle)}break;case"roll-object":if(e!==r?.address()){let e=this.gameObjects.get(n.target);e&&o0(e)&&e.roll(o2(n.seed))}break;case"flip-object":if(e!==r?.address()){let e=this.gameObjects.get(n.target);e&&oQ(e)&&e.flip()}break;case"stack-object":e!==r?.address()&&this.onObjectStack(e,n);break;case"take-object-from-stack":e!==r?.address()&&this.onTakeObjectFromStack(e,n)}})}onPlayerCursor(e,t){if(this.players.has(e)){let r=this.players.get(e);r.position.x=t.position.x,r.position.y=t.position.y}else{let r={position:t.position};this.players.set(e,r);let n=new tA.Sprite({texture:(0,ex.Texture).from("cursor"),width:24,height:24,x:r.position.x,y:r.position.y,zIndex:1e3});n.label=e,this.camera.addChild(n)}}onObjectMove(e,t){let r=this.gameObjects.get(t.target);r&&(r.position=t.position)}onObjectStack(e,t){let r=this.gameObjects.get(t.target),n=this.gameObjects.get(t.object_to_stack);oq(r)&&oq(n)&&r.onStack(n)}onTakeObjectFromStack(e,t){let r=this.gameObjects.get(t.target);if(oq(r)){let e=r.onTakeFromStack();e&&this.onMoveStart(e)}}onMoveStart(e){e.eventMode="none",e.zIndex=100,e.addFilter("shadow",new sH({blur:2,offset:{x:4,y:20},pixelSize:{x:1,y:1}}))}onMoveEnd(e){e.eventMode="static",e.zIndex=0,e.removeFilter("shadow")}onDragStart(e){this.dragTarget=e,this.onMoveStart(e),this.room.send({type:"move-start-object",message:{target:this.dragTarget.uid}}),this.app.stage.on("pointermove",this.onDragMove,this)}onDragMove(e){if(this.dragTarget){if(this.dragTarget.onDrag(),this.room.send({type:"move-object",message:{target:this.dragTarget.uid,position:new ij(this.dragTarget.x,this.dragTarget.y)}}),this.dragTarget.parent){let t=this.camera.screenToWorldPoint(new ij(e.screen.x,e.screen.y));this.dragTarget.x=t.x,this.dragTarget.y=t.y}else this.onDragEnd()}}onDragEnd(){this.dragTarget&&(this.dragTarget.onDragEnd(),this.onMoveEnd(this.dragTarget),this.room.send({type:"move-end-object",message:{target:this.dragTarget.uid}}),this.app.stage.off("pointermove",this.onDragMove,this),this.dragTarget=null)}createCard(e){return new oZ((0,ex.Texture).from("card-face"),(0,ex.Texture).from("card"),e)}async startGame(){ta.add({alias:"card",src:"assets/card.png"}),ta.add({alias:"card-face",src:"assets/card-face.png"}),ta.add({alias:"cursor",src:"assets/cursor.png"}),ta.add({alias:"cards-sheet",src:"assets/spritesheet.json"}),await ta.load(["card","cursor","card-face","cards-sheet"]);let e=ta.get("cards-sheet"),t=[];for(let r=0;r<Object.keys(e.textures).length-1;r++){let n=new oZ(e.textures[`card${r+1}`],e.textures.card20,`Card${r+1}`);t.push(n)}this.camera.addChild(new oJ(t)),this.app.stage.on("pointerup",this.onDragEnd,this),this.app.stage.on("pointerupoutside",this.onDragEnd,this),this.app.stage.on("wheel",e=>{this.camera.desiredZoom=Math.min(Math.max(this.camera.desiredZoom-e.deltaY/2e3,.3),6)}),this.app.stage.eventMode="dynamic",this.app.stage.hitArea=this.app.screen;let r=new ij(this.app.screen.width/2,this.app.screen.height/2);this.camera.position.x=r.x,this.camera.position.y=r.y,this.app.ticker.add(e=>{for(let t of this.camera.children){if(t.label&&this.players.has(t.label)){let e=this.players.get(t.label);t.x=e.position.x,t.y=e.position.y}oW(t)&&t.update(e.deltaTime)}let t=new ij;iN.instance.keyboard.get("w")===Q.HELD&&(t.y+=-1),iN.instance.keyboard.get("a")===Q.HELD&&(t.x+=-1),iN.instance.keyboard.get("s")===Q.HELD&&(t.y+=1),iN.instance.keyboard.get("d")===Q.HELD&&(t.x+=1);let r=0;if(iN.instance.keyboard.get("q")===Q.HELD&&(r-=1),iN.instance.keyboard.get("e")===Q.HELD&&(r+=1),iN.instance.keyboard.get("f")===Q.PRESSED&&(this.dragTarget&&oQ(this.dragTarget)?(this.dragTarget.flip(),this.room.send({type:"flip-object",message:{target:this.dragTarget.uid}})):this.target&&oQ(this.target)&&(this.target.flip(),this.room.send({type:"flip-object",message:{target:this.target.uid}}))),iN.instance.keyboard.get("r")===Q.PRESSED){let e=Date.now(),t=o2(e);this.dragTarget&&o0(this.dragTarget)?(this.dragTarget.roll(t),this.room.send({type:"roll-object",message:{target:this.dragTarget.uid,seed:e}})):this.target&&o0(this.target)&&(this.target.roll(t),this.room.send({type:"roll-object",message:{target:this.target.uid,seed:e}}))}this.dragTarget?(this.dragTarget.angle+=r,this.room.send({type:"rotate-object",message:{target:this.dragTarget.uid,angle:this.dragTarget.angle}})):this.target&&(this.target.angle+=r,this.room.send({type:"rotate-object",message:{target:this.target.uid,angle:this.target.angle}})),this.room.send({type:"player-cursor",message:{position:this.camera.screenToWorldPoint(iN.instance.mouse.position)}}),this.camera.desiredPosition.x+=t.x*e.deltaTime*10,this.camera.desiredPosition.y+=t.y*e.deltaTime*10,this.camera.update(e.deltaTime)})}}const o3=document.querySelector("canvas");o3.tabIndex=0,o3.autofocus=!0;const o4=document.querySelector("div#lobby-controls"),o5=document.querySelector("input#nickname"),o6=document.querySelector("button#host"),o8=document.querySelector("input#lobby"),o9=document.querySelector("button#join"),o7=localStorage.getItem("nickname");o7&&(o5.value=o7);let ae=null;(async()=>{let e=new em;await e.init({canvas:o3,resizeTo:window,backgroundColor:"#1E553E",antialias:!0,roundPixels:!0});let t=new iV;e.stage.addChild(t),new iN(o3);let r=(r,n)=>{localStorage.setItem("nickname",r),ae=new iG(`${r}_takeseats`),n&&(console.log("connect"),ae.connectToMember(`${n}_takeseats`)),o4.hidden=!0;let i=new o1(e,t,ae);globalThis.gm=i,i.startGame()};o6.addEventListener("click",e=>{r(o5.value)}),o9.addEventListener("click",e=>{r(o5.value,o8.value)})})();
//# sourceMappingURL=index.7213dbb5.js.map
